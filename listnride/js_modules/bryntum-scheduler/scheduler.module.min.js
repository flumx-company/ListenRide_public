/*

Bryntum Scheduler 2.1.0
Copyright(c) 2019 Bryntum AB
https://bryntum.com/contact
https://bryntum.com/license

*/
const productName="scheduler";var support={searchParams:"URLSearchParams"in self,iterable:"Symbol"in self&&"iterator"in Symbol,blob:"FileReader"in self&&"Blob"in self&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in self,arrayBuffer:"ArrayBuffer"in self};function isDataView(e){return e&&DataView.prototype.isPrototypeOf(e)}if(support.arrayBuffer)var viewClasses=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],isArrayBufferView=ArrayBuffer.isView||function(e){return e&&viewClasses.indexOf(Object.prototype.toString.call(e))>-1};function normalizeName(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function normalizeValue(e){return"string"!=typeof e&&(e=String(e)),e}function iteratorFor(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return support.iterable&&(t[Symbol.iterator]=function(){return t}),t}function Headers(e){this.map={},e instanceof Headers?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function consumed(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function fileReaderReady(e){return new Promise(function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}})}function readBlobAsArrayBuffer(e){var t=new FileReader,r=fileReaderReady(t);return t.readAsArrayBuffer(e),r}function readBlobAsText(e){var t=new FileReader,r=fileReaderReady(t);return t.readAsText(e),r}function readArrayBufferAsText(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}function bufferClone(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function Body(){return this.bodyUsed=!1,this._initBody=function(e){this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:support.blob&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:support.formData&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:support.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():support.arrayBuffer&&support.blob&&isDataView(e)?(this._bodyArrayBuffer=bufferClone(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):support.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(e)||isArrayBufferView(e))?this._bodyArrayBuffer=bufferClone(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):support.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},support.blob&&(this.blob=function(){var e=consumed(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?consumed(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(readBlobAsArrayBuffer)}),this.text=function(){var e=consumed(this);if(e)return e;if(this._bodyBlob)return readBlobAsText(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(readArrayBufferAsText(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},support.formData&&(this.formData=function(){return this.text().then(decode)}),this.json=function(){return this.text().then(JSON.parse)},this}Headers.prototype.append=function(e,t){e=normalizeName(e),t=normalizeValue(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},Headers.prototype.delete=function(e){delete this.map[normalizeName(e)]},Headers.prototype.get=function(e){return e=normalizeName(e),this.has(e)?this.map[e]:null},Headers.prototype.has=function(e){return this.map.hasOwnProperty(normalizeName(e))},Headers.prototype.set=function(e,t){this.map[normalizeName(e)]=normalizeValue(t)},Headers.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},Headers.prototype.keys=function(){var e=[];return this.forEach(function(t,r){e.push(r)}),iteratorFor(e)},Headers.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),iteratorFor(e)},Headers.prototype.entries=function(){var e=[];return this.forEach(function(t,r){e.push([r,t])}),iteratorFor(e)},support.iterable&&(Headers.prototype[Symbol.iterator]=Headers.prototype.entries);var methods=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function normalizeMethod(e){var t=e.toUpperCase();return methods.indexOf(t)>-1?t:e}function Request(e,t){var r=(t=t||{}).body;if(e instanceof Request){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new Headers(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,r||null==e._bodyInit||(r=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new Headers(t.headers)),this.method=normalizeMethod(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function decode(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),i=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(i))}}),t}function parseHeaders(e){var t=new Headers;return e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(e){var r=e.split(":"),n=r.shift().trim();if(n){var i=r.join(":").trim();t.append(n,i)}}),t}function Response$1(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new Headers(t.headers),this.url=t.url||"",this._initBody(e)}Request.prototype.clone=function(){return new Request(this,{body:this._bodyInit})},Body.call(Request.prototype),Body.call(Response$1.prototype),Response$1.prototype.clone=function(){return new Response$1(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new Headers(this.headers),url:this.url})},Response$1.error=function(){var e=new Response$1(null,{status:0,statusText:""});return e.type="error",e};var redirectStatuses=[301,302,303,307,308];Response$1.redirect=function(e,t){if(-1===redirectStatuses.indexOf(t))throw new RangeError("Invalid status code");return new Response$1(null,{status:t,headers:{location:e}})};var DOMException$1=self.DOMException;try{new DOMException$1}catch(e){(DOMException$1=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack}).prototype=Object.create(Error.prototype),DOMException$1.prototype.constructor=DOMException$1}function fetch$1(e,t){return new Promise(function(r,n){var i=new Request(e,t);if(i.signal&&i.signal.aborted)return n(new DOMException$1("Aborted","AbortError"));var s=new XMLHttpRequest;function o(){s.abort()}s.onload=function(){var e={status:s.status,statusText:s.statusText,headers:parseHeaders(s.getAllResponseHeaders()||"")};e.url="responseURL"in s?s.responseURL:e.headers.get("X-Request-URL");var t="response"in s?s.response:s.responseText;r(new Response$1(t,e))},s.onerror=function(){n(new TypeError("Network request failed"))},s.ontimeout=function(){n(new TypeError("Network request failed"))},s.onabort=function(){n(new DOMException$1("Aborted","AbortError"))},s.open(i.method,i.url,!0),"include"===i.credentials?s.withCredentials=!0:"omit"===i.credentials&&(s.withCredentials=!1),"responseType"in s&&support.blob&&(s.responseType="blob"),i.headers.forEach(function(e,t){s.setRequestHeader(t,e)}),i.signal&&(i.signal.addEventListener("abort",o),s.onreadystatechange=function(){4===s.readyState&&i.signal.removeEventListener("abort",o)}),s.send(void 0===i._bodyInit?null:i._bodyInit)})}fetch$1.polyfill=!0,self.fetch||(self.fetch=fetch$1,self.Headers=Headers,self.Request=Request,self.Response=Response$1);var commonjsGlobal="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};!function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}function n(e){return(n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function o(e,t,r){return(o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=n(e)););return e}(e,t);if(i){var s=Object.getOwnPropertyDescriptor(i,t);return s.get?s.get.call(r):s.value}})(e,t,r||e)}var a=function(t){function a(){var t,r,i;return e(this,a),r=this,i=n(a).call(this),t=!i||"object"!=typeof i&&"function"!=typeof i?s(r):i,Object.defineProperty(s(t),"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(s(t),"onabort",{value:null,writable:!0,configurable:!0}),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(a,t),r(a,[{key:"toString",value:function(){return"[object AbortSignal]"}},{key:"dispatchEvent",value:function(e){"abort"===e.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,e)),o(n(a.prototype),"dispatchEvent",this).call(this,e)}}]),a}(function(){function t(){e(this,t),Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}return r(t,[{key:"addEventListener",value:function(e,t){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push(t)}},{key:"removeEventListener",value:function(e,t){if(e in this.listeners)for(var r=this.listeners[e],n=0,i=r.length;n<i;n++)if(r[n]===t)return void r.splice(n,1)}},{key:"dispatchEvent",value:function(e){var t=this;if(e.type in this.listeners){for(var r=function(r){setTimeout(function(){return r.call(t,e)})},n=this.listeners[e.type],i=0,s=n.length;i<s;i++)r(n[i]);return!e.defaultPrevented}}}]),t}()),l=function(){function t(){e(this,t),Object.defineProperty(this,"signal",{value:new a,writable:!0,configurable:!0})}return r(t,[{key:"abort",value:function(){var e;try{e=new Event("abort")}catch(t){"undefined"!=typeof document?document.createEvent?(e=document.createEvent("Event")).initEvent("abort",!1,!1):(e=document.createEventObject()).type="abort":e={type:"abort",bubbles:!1,cancelable:!1}}this.signal.dispatchEvent(e)}},{key:"toString",value:function(){return"[object AbortController]"}}]),t}();function d(e){return e.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL?(console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill"),!0):"function"==typeof e.Request&&!e.Request.prototype.hasOwnProperty("signal")||!e.AbortController}"undefined"!=typeof Symbol&&Symbol.toStringTag&&(l.prototype[Symbol.toStringTag]="AbortController",a.prototype[Symbol.toStringTag]="AbortSignal"),function(e){if(d(e))if(e.fetch){var t=function(e){"function"==typeof e&&(e={fetch:e});var t=e,r=t.fetch,n=t.Request,i=void 0===n?r.Request:n,s=t.AbortController,o=t.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL,a=void 0!==o&&o;if(!d({fetch:r,Request:i,AbortController:s,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:a}))return{fetch:r,Request:l};var l=i;(l&&!l.prototype.hasOwnProperty("signal")||a)&&((l=function(e,t){var r;t&&t.signal&&(r=t.signal,delete t.signal);var n=new i(e,t);return r&&Object.defineProperty(n,"signal",{writable:!1,enumerable:!1,configurable:!0,value:r}),n}).prototype=i.prototype);var c=r;return{fetch:function(e,t){var r=l&&l.prototype.isPrototypeOf(e)?e.signal:t?t.signal:void 0;if(r){var n;try{n=new DOMException("Aborted","AbortError")}catch(e){(n=new Error("Aborted")).name="AbortError"}if(r.aborted)return Promise.reject(n);var i=new Promise(function(e,t){r.addEventListener("abort",function(){return t(n)},{once:!0})});return t&&t.signal&&delete t.signal,Promise.race([i,c(e,t)])}return c(e,t)},Request:l}}(e),r=t.fetch,n=t.Request;e.fetch=r,e.Request=n,Object.defineProperty(e,"AbortController",{writable:!0,enumerable:!1,configurable:!0,value:l}),Object.defineProperty(e,"AbortSignal",{writable:!0,enumerable:!1,configurable:!0,value:a})}else console.warn("fetch() is not available, cannot install abortcontroller-polyfill")}("undefined"!=typeof self?self:commonjsGlobal)}();class BryntumWidgetAdapterRegister{static register(e,t){const r=widgetClassRegister[t];widgetRegister[e]=t,r?r[e]=1:widgetClassRegister[t]={[e]:1}}static getClass(e){return widgetRegister[e]}static isType(e,t,r){for(let n=e.constructor;n;n=r&&Object.getPrototypeOf(n)){const e=widgetClassRegister[n]||n.$name&&(widgetClassRegister[n]={[n.$name.toLowerCase()]:1});if(e&&e[t])return!0}}static createWidget(e,t){const r=this.getClass(e);return r?new r(t):null}}const widgetRegister=BryntumWidgetAdapterRegister.widgetRegister={},widgetClassRegister=BryntumWidgetAdapterRegister.widgetClassRegister={};function isInstanceOfClass(e,t){const r=e.classHierarchy();for(let e=0;e<r.length;e++)if(r[e].$name.toLowerCase()===t)return!0;return!1}BryntumWidgetAdapterRegister._$name="BryntumWidgetAdapterRegister";class IdHelper{static generateId(e="generatedId"){return e+ ++IdHelper.idCounter}static register(e,t=""){let r=e.id;if(null==r&&(r=e.id=IdHelper.generateId(t),e.hasGeneratedId=!0),r in IdHelper.idMap&&!this.disableThrow)throw new Error("Id "+r+" already in use");IdHelper.idMap[r]=e}static unregister(e){IdHelper.idMap[e.id]&&delete IdHelper.idMap[e.id]}static get(e){return IdHelper.idMap[e]}static query(e,t=!1){const r=IdHelper.idMap;for(let n in r)if(widgetMatches(r[n],e,t))return r[n];return null}static queryAll(e,t=!1){const r=IdHelper.idMap,n=[];for(let i in r)widgetMatches(r[i],e,t)&&n.push(r[i]);return n}static fromElement(e,t,r){const n=typeof t;e&&e.target&&(e=e.target),("number"===n||t&&1===t.nodeType)&&(r=t,t=null);let i,s,o,a=e,l=IdHelper.idMap,d=0;for("number"!=typeof r&&(i=r,r=Number.MAX_VALUE),"string"===n&&(t=t.toLowerCase());a&&1===a.nodeType&&d<r&&a!==i;){if(s=a.dataset&&a.dataset.ownerCmp||a.id){if(o=l[s]){if(!t)return o;if("function"===n){if(t(o))return o}else if(widgetMatches(o,t)||isInstanceOfClass(o,t))return o}d++}a=a.parentNode}return null}}function widgetMatches(e,t,r){return"*"===t||("function"==typeof t?t(e):BryntumWidgetAdapterRegister.isType(e,t,r))}IdHelper.idCounter=0,IdHelper.idMap={},(window.bryntum||(window.bryntum={})).get=IdHelper.get,window.bryntum.IdHelper=IdHelper,window.bryntum.query=IdHelper.query,window.bryntum.queryAll=IdHelper.queryAll,window.bryntum.fromElement=IdHelper.fromElement,IdHelper._$name="IdHelper";class WidgetHelper{static set adapter(e){this._adapter=new e}static get adapter(){if(!this._adapter)throw new Error("No widget adapter set");return this._adapter}static get hasAdapter(){return!!this._adapter}static getById(e){return IdHelper.get(e)}static fromElement(e,t,r){return IdHelper.fromElement(e,t,r)}static createWidget(e={}){return this.adapter.createWidget(e)}static append(e,t){if(e=Array.isArray(e)&&e||[e],(t instanceof HTMLElement||"string"==typeof t)&&(t={appendTo:t}),t.insertFirst){const e="string"==typeof t.insertFirst?document.getElementById(t.insertFirst):t.insertFirst;e.firstChild?t.insertBefore=e.firstChild:t.appendTo=e}return this.adapter.appendWidgets(e,t)}static openPopup(e,t){return this.adapter.openPopup(e,t)}static showContextMenu(e,t){return this.adapter.showContextMenu(e,t)}static attachTooltip(e,t){return this.adapter.attachTooltip(e,t)}static hasTooltipAttached(e){return this.adapter.hasTooltipAttached(e)}static destroyTooltipAttached(e){return this.adapter.destroyTooltipAttached(e)}static mask(e,t){return this.adapter.mask(e,t)}static unmask(e,t=!0){this.adapter.unmask(e)}static toast(e){this.adapter.toast(e)}static set defaultStyle(e){this.adapter.defaultStyle=e}static get defaultStyle(){return this.adapter.defaultStyle}}WidgetHelper._$name="WidgetHelper";const camelLettersRe=/([a-z])([A-Z])/g,escapeRegExpRe=/[.*+?^${}()|[\]\\]/g,idRe=/(^[^a-z]+|[^\w]+)/gi,replaceCamelLetters=(e,t,r)=>t+"-"+r.toLowerCase(),replaceNonIdChar=e=>e?`_x${e.charCodeAt(0).toString(16)}`:"__blank__";class StringHelper{static capitalizeFirstLetter(e){return e?e[0].toUpperCase()+e.substr(1):null}static lowercaseFirstLetter(e){return e?e[0].toLowerCase()+e.substr(1):null}static hyphenate(e){return e.replace(camelLettersRe,replaceCamelLetters)}static safeJsonParse(e){let t=null;try{t=JSON.parse(e)}catch(e){console.error(e)}return t}static safeJsonStringify(e){let t=null;try{t=JSON.stringify(e)}catch(e){console.error(e)}return t}static createId(e){return String(e).replace(idRe,replaceNonIdChar)}static escapeRegExp(e){return e.replace(escapeRegExpRe,"\\$&")}}StringHelper._$name="StringHelper";const defaultConfigSymbol=Symbol("defaultConfig"),propertyInitializersSymbol=Symbol("propertyInitializers"),classHierarchySymbol=Symbol("classHierarchy"),configurationSymbol=Symbol("configuration"),originalConfigSymbol=Symbol("originalConfig"),instancePropertiesSymbol=Symbol("instanceProperties");class Base{constructor(...e){this.construct(...e),this.afterConstruct()}construct(...e){null!==e[0]&&this.configure(...e),this.afterConfigure()}destroy(){const e=this;e.isDestroying=!0,e.doDestroy(),Object.setPrototypeOf(this,null);for(let t in e)delete e[t];delete e[originalConfigSymbol],e.isDestroyed=!0}_thisIsAUsedExpression(e){}static get $name(){return this.hasOwnProperty("_$name")&&this._$name||this.name}get $name(){return this.constructor.$name}startConfigure(e){}finishConfigure(e){}afterConfigure(){}afterConstruct(){}callback(e,t,r){"this"===t&&(t=this);const{handler:n,thisObj:i}=this.resolveCallback(e,t);return r?n.apply(i,r):n.call(i)}resolveCallback(e,t=this){if(e.substr){if(e.startsWith("up."))for(e=e.substr(3),t=this.owner;t&&!t[e];t=t.owner);else e.startsWith("this.")&&(t=this);e=t[e]}return{handler:e,thisObj:t}}doDestroy(){}destroyProperties(...e){const t=this;let r,n;for(r of e)!(r in t)||t[configurationSymbol]&&t[configurationSymbol][r]||((n=t[r])&&n.destroy&&n.destroy(),delete t[r])}configure(e={}){const t=this;t.initialConfig=e,t.isConfiguring=!0,Object.assign(t,t.getProperties()),t.setConfig(t[originalConfigSymbol]=Base.assign(t.getDefaultConfiguration(),e),!0),t.isConfiguring=!1}setConfig(e,t){const r=this,n=r[configurationSymbol],i=n?r.configDone:r.configDone={},s=r[instancePropertiesSymbol]={};let o,a;for(o in r[configurationSymbol]=n?Object.setPrototypeOf(Object.assign({},e),n):e,e)null!=e[o]||e.hasOwnProperty(o)?(s[o]||!(a=Reflect.getOwnPropertyDescriptor(r,o))||"value"in a||(s[o]=a),Reflect.defineProperty(r,o,Base.createPropInitializer(o)),t||(i[o]=!1)):i[o]=!0;for(o in t&&r.startConfigure(e),e)i[o]||(r[o]=e[o]);n?r[configurationSymbol]=n:delete r[configurationSymbol],t&&r.finishConfigure(e)}get config(){let e,t={},r=this[originalConfigSymbol];for(e in r)t[e]=r[e];return t}getDefaultConfiguration(){return this.constructor.getDefaultConfiguration()}static getDefaultConfiguration(){const e=this.getConfigDescriptor();return e.needsFork?this.fork(e.defaultConfig):Object.setPrototypeOf({},e.defaultConfig)}static getConfigDescriptor(e){const t=this;let r,n,i,s,o,a=!e&&t.hasOwnProperty(defaultConfigSymbol)?t[defaultConfigSymbol]:null;if(!a){for(n in a={defaultConfig:r=t.hasOwnProperty("defaultConfig")?t.defaultConfig:{},needsFork:0},e||(t[defaultConfigSymbol]=a),r)if((s=r[n])&&(s.constructor===Object||Array.isArray(s))&&!Object.isFrozen(s)){a.needsFork=1;break}if(!e)for(i=t.superclass;i&&i!==Base;i=i.superclass)o=i.getConfigDescriptor(!0),Object.keys(o.defaultConfig).length&&(a.needsFork|=o.needsFork,Object.setPrototypeOf(r,r=o.defaultConfig))}return a}static fork(e){var t,r,n;if(e&&e.constructor===Object&&!Object.isFrozen(e))for(r in t=Object.setPrototypeOf({},e),e)(n=e[r])&&(n.constructor===Object?t[r]=this.fork(n):n instanceof Array&&(t[r]=n.slice()));else t=e;return t}static assign(e,...t){for(var r,n,i=0,s=t.length;i<s;i++)for(n in r=t[i])e[n]=r[n];return e}getProperties(){const e=this.classHierarchy(),t=e.length;let r,n,i={};for(r=0;r<t;r++)(n=e[r]).hasOwnProperty("properties")&&Object.assign(i,n.properties);return i}static get superclass(){return Object.getPrototypeOf(this)}static createPropInitializer(e){var t=(this[propertyInitializersSymbol]||(this[propertyInitializersSymbol]={}))[e];if(!t){let r="initializing"+StringHelper.capitalizeFirstLetter(e);t=this[propertyInitializersSymbol][e]={configurable:!0,get(){const t=this,n=t[instancePropertiesSymbol][e];return n?Reflect.defineProperty(t,e,n):delete t[e],t[r]=!0,t[e]=t[configurationSymbol][e],t[r]=!1,t.configDone[e]=!0,t[e]},set(t){const r=this,n=r[instancePropertiesSymbol][e];n?Reflect.defineProperty(r,e,n):delete r[e],r.configDone[e]=!0,r[e]=t}}}return t}classHierarchy(e){let t,r=this.constructor,n=r.hasOwnProperty(classHierarchySymbol)?r[classHierarchySymbol]:null;if(!n){for(n=r[classHierarchySymbol]=[];r!==Base;r=Object.getPrototypeOf(r))n.unshift(r);Object.freeze(n)}if(e)for(let r=0;!t&&r<n.length;r++)n[r]===e&&(t=n.slice(r));else t=n;return t}}Base._$name="Base";var Delayable=e=>(class extends(e||Base){doDestroy(){const e=this;e.timeoutIds&&(Object.keys(e.timeoutIds).forEach(t=>{"function"==typeof e.timeoutIds[t]&&e.timeoutIds[t](),clearTimeout(t)}),e.timeoutIds=null),e.timeoutMap&&(Object.values(e.timeoutMap).forEach(e=>clearTimeout(e)),e.timeoutMap=null),e.intervalIds&&(Object.keys(e.intervalIds).forEach(e=>clearInterval(e)),e.intervalIds=null),e.animationFrameIds&&(Object.keys(e.animationFrameIds).forEach(e=>cancelAnimationFrame(e)),e.animationFrameIds=null),super.doDestroy()}hasTimeout(e){return!(!this.timeoutMap||!this.timeoutMap[e])}setTimeout(e,t,r,n=!1){"string"==typeof e&&(r=e);const i=this,s=i.timeoutIds||(i.timeoutIds={}),o=i.timeoutMap||(i.timeoutMap={}),a=setTimeout(()=>{"string"==typeof e&&(e=i[r]),e.call(i),s&&a in s&&delete s[a],o&&r in o&&delete o[r]},t);return s[a]=!n||e,r&&(o[r]=a),a}clearTimeout(e){let t=e;if("string"==typeof t){if(!this.timeoutMap)return;t=this.timeoutMap[e],delete this.timeoutMap[e]}clearTimeout(t),this.timeoutIds&&delete this.timeoutIds[t]}clearInterval(e){clearInterval(e),this.intervalIds&&delete this.intervalIds[e]}setInterval(e,t){const r=setInterval(e,t);return this.intervalIds||(this.intervalIds={}),this.intervalIds[r]=!0,r}requestAnimationFrame(e,t,r){const n=requestAnimationFrame(t||r?()=>e.apply(r,t):e);return(this.animationFrameIds||(this.animationFrameIds={}))[n]=!0,n}createOnFrame(e,t=[],r=this,n){let i,s=this,o=(...o)=>{i&&n&&(s.cancelAnimationFrame(i),i=null),i||(i=this.requestAnimationFrame(()=>{"string"==typeof e&&(e=r[e]),i=null,o.push(...t),e.apply(r,o)}))};return o.cancel=(()=>s.cancelAnimationFrame(i)),o}cancelAnimationFrame(e){cancelAnimationFrame(e),this.animationFrameIds&&delete this.animationFrameIds[e]}buffer(e,t,r=this){let n=null;"string"==typeof e&&(e=r[e]);const i=(...s)=>{i.called=!1,null!==n&&this.clearTimeout(n),n=this.setTimeout(()=>{e.call(r,...s),i.called=!0},t)};return i}throttle(e,t){let r,n,i,s=this,o=0;const a=()=>{n=0,o=performance.now(),e.apply(s,r),i.called=!0};return(i=((...e)=>{let l=performance.now()-o;r=e,l>=t?(s.clearTimeout(n),a()):n||(n=s.setTimeout(a,t-l),i.called=!1)})).cancel=(()=>s.clearTimeout(n)),i}get widgetClass(){}});class BrowserHelper{static cacheFlags(){const e=this;e._isLinux=!!navigator.platform.match(/Linux/),e._isMac=!!navigator.platform.match(/Mac/),e._isWindows=!!navigator.platform.match(/Win32/),e._isIE11=!!navigator.userAgent.match(/rv:11/),e._isEdge=!!navigator.userAgent.match(/Edge\//),e._isWebkit=!!navigator.userAgent.match(/WebKit/)&&!e.isEdge,e._isFirefox=!!navigator.userAgent.match(/Firefox/)&&!e.isEdge,e._isChrome=!!navigator.userAgent.match(/Chrome/)&&!e.isEdge,e._isSafari=!!navigator.userAgent.match(/Safari/)&&!e.isChrome&&!e.isEdge,e._isMobileSafari=navigator.userAgent.match(/Mobile.*Safari/);try{document.querySelector(":scope"),e.supportsQueryScope=!this.isFirefox}catch(t){e.supportsQueryScope=!1}e._supportsPassive=!1;try{document.addEventListener("__notvalid__",null,{get passive(){e._supportsPassive=!0}})}catch(e){}}static get isTouchDevice(){return"_isTouchDevice"in this?this._isTouchDevice:"ontouchstart"in window||!this.isEdge&&navigator.maxTouchPoints>0||this.isEdge&&window.TouchEvent||navigator.msMaxTouchPoints>0}static set isTouchDevice(e){this._isTouchDevice=e}static get isMac(){return BrowserHelper._isMac}static get isWindows(){return BrowserHelper._isWindows}static get isLinux(){return BrowserHelper._isLinux}static get isIE11(){return BrowserHelper._isIE11}static get isEdge(){return BrowserHelper._isEdge}static get isWebkit(){return BrowserHelper._isWebKit}static get isChrome(){return this._isChrome}static get chromeVersion(){const e=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);return e?parseInt(e[2],10):0}static get isFirefox(){return this._isFirefox}static get isSafari(){return this._isSafari}static get isMobileSafari(){return this._isMobileSafari}static get supportsPassive(){return this._supportsPassive}static get storageAvailable(){let e,t;try{return e=localStorage,t="__storage_test__",e.setItem(t,t),e.removeItem(t),!0}catch(t){return t instanceof DOMException&&(22===t.code||1014===t.code||"QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)&&0!==e.length}}static setLocalStorageItem(e,t){this.storageAvailable&&localStorage.setItem(e,t)}static getLocalStorageItem(e){return this.storageAvailable&&localStorage.getItem(e)}static removeLocalStorageItem(e){this.storageAvailable&&localStorage.removeItem(e)}}BrowserHelper.cacheFlags(),BrowserHelper._$name="BrowserHelper";const allBorders=["border-top-width","border-right-width","border-bottom-width","border-left-width"],allPaddings=["padding-top","padding-right","padding-bottom","padding-left"],borderNames={t:"border-top-width",r:"border-right-width",b:"border-bottom-width",l:"border-left-width"},paddingNames={t:"padding-top",r:"padding-right",b:"padding-bottom",l:"padding-left"},zeroBased=Object.freeze({x:0,y:0}),alignSpecRe=/^([trblc])(\d*)-([trblc])(\d*)$/i,alignPointRe=/^([trblc])(\d*)$/i,edgeNames=["top","right","bottom","left"],edgeIndices={t:0,r:1,b:2,l:3},defaultAlignments=["b-t","l-r","t-b","r-l"],zeroOffsets=Object.freeze([0,0]),matchDimensions=["width","height"];function parseAlign(e){const t=alignSpecRe.exec(e),r=parseInt(t[2]||50),n=parseInt(t[4]||50);return{myAlignmentPoint:t[1]+r,myEdge:t[1],myOffset:r,targetAlignmentPoint:t[3]+n,targetEdge:t[3],targetOffset:n,startZone:edgeIndices[t[3]]}}function flipAlign(e){return`${edgeNames[(edgeIndices[e.myEdge]+2)%4][0]}${e.myOffset}-${edgeNames[(edgeIndices[e.targetEdge]+2)%4][0]}${e.targetOffset}`}function createOffsets(e){return null==e?zeroOffsets:"number"==typeof e?[e,e]:e}class Rectangle{static from(e,t,r=!1){if(e instanceof Rectangle)return e;if(t){let{scrollLeft:e,scrollTop:r}=t;BrowserHelper.isEdge&&t===document.body&&(e=r=0),t=Rectangle.from(t).translate(-e,-r)}else t=zeroBased;const n=e===document||e===window,i=n?new Rectangle(0,0,window.innerWidth,window.innerHeight):e.getBoundingClientRect(),s=r||n?[0,0]:[window.pageXOffset,window.pageYOffset];return new Rectangle(i.left+s[0]-t.x,i.top+s[1]-t.y,i.width,i.height)}static inner(e,t,r=!1){const n=this.from(e,t,r);if(document.body.contains(e)){const t=DomHelper.getStyleValue(e,allBorders);n.x+=parseInt(t[borderNames.l]),n.y+=parseInt(t[borderNames.t]),n.right-=parseInt(t[borderNames.r]),n.bottom-=parseInt(t[borderNames.b])}return n}static content(e,t,r=!1){const n=this.from(e,t,r);if(document.body.contains(e)){const t=DomHelper.getStyleValue(e,allBorders),r=DomHelper.getStyleValue(e,allPaddings);n.x+=parseInt(t[borderNames.l])+parseInt(r[paddingNames.l]),n.y+=parseInt(t[borderNames.t])+parseInt(r[paddingNames.t]),n.right-=parseInt(t[borderNames.r])+parseInt(r[paddingNames.r]),n.bottom-=parseInt(t[borderNames.b])+parseInt(r[paddingNames.b])}return n}static client(e,t,r=!1){let n,i=this.content(e,t,r),s=DomHelper.scrollBarWidth;return s&&(e.scrollHeight>e.clientHeight&&(n=parseInt(DomHelper.getStyleValue(e,"padding-right")),i.right+=n-Math.max(n,s)),e.scrollWidth>e.clientWidth&&(n=parseInt(DomHelper.getStyleValue(e,"padding-bottom")),i.bottom+=n-Math.max(n,s))),i}static union(...e){let t,{x:r,y:n,right:i,bottom:s}=e[0];if(e.length>1)for(let o=1;o<e.length;o++)(t=e[o]).x<r&&(r=t.x),t.y<n&&(n=t.y),t.right>i&&(i=t.right),t.bottom>s&&(s=t.bottom);return new Rectangle(r,n,i-r,s-n)}static get $name(){return this.hasOwnProperty("_$name")&&this._$name||this.name}get $name(){return this.constructor.$name}constructor(e,t,r,n){this._x=e,this._y=t,this._width=r,this._height=n}clone(){const e=this,t=new Rectangle(e.x,e.y,e.width,e.height);return t.minHeight=e.minHeight,t.minWidth=e.minWidth,t}contains(e){const t=this;return e instanceof Rectangle&&(e._x>=t._x&&e._y>=t._y&&e.right<=t.right&&e.bottom<=t.bottom)}intersect(e,t=!1){var r=Math.max(this.y,e.y),n=Math.min(this.right,e.right),i=Math.min(this.bottom,e.bottom),s=Math.max(this.x,e.x);return i>r&&n>s&&(!!t||new Rectangle(s,r,n-s,i-r))}equals(e){return e instanceof Rectangle&&e.x===this.x&&e.y===this.y&&e.width===this.width&&e.height===this.height}translate(e,t){return this._x+=e||0,this._y+=t||0,this}moveTo(e,t){return null!=e&&(this._x=e),null!=t&&(this._y=t),this}getDelta(e){return[e.x-this.x,e.y-this.y]}get center(){return new Rectangle.Point(this.x+this.width/2,this.y+this.height/2)}set x(e){let t=e-this._x;this._x=e,this._width-=t}get x(){return this._x}set left(e){this.x=e}get left(){return this.x}set top(e){this.y=e}get top(){return this.y}set y(e){let t=e-this._y;this._y=e,this._height-=t}get y(){return this._y}set width(e){this._width=e}get width(){return this._width}set height(e){this._height=e}get height(){return this._height}set right(e){this._width=e-this._x}get right(){return this._x+this._width}set bottom(e){this._height=e-this._y}get bottom(){return this._y+this._height}get area(){return this.width*this.height}set minWidth(e){const t=this;isNaN(e)?t._minWidth=null:(t._minWidth=Number(e),t.width=Math.max(t.width,t._minWidth))}get minWidth(){return this._minWidth}set minHeight(e){const t=this;isNaN(e)?t._minHeight=null:(t._minHeight=Number(e),t.height=Math.max(t.height,t._minHeight))}get minHeight(){return this._minHeight}adjust(e,t,r,n){const i=this;return i.x+=e,i.y+=t,i.width+=r,i.height+=n,i}inflate(e){return this.adjust(-e,-e,e,e)}constrainTo(e,t){const r=this,n=r.height,i=r.y,s=r.minWidth||r.width,o=r.minHeight||r.height;if(r.height>=e.height){if(t&&o>e.height)return!1;r._y=e.y,r.height=e.height}if(r.width>=e.width){if(t&&s>e.width)return r.y=i,r.height=n,!1;r._x=e.x,r.width=e.width}let a=r.bottom-e.bottom;return a>0&&r.translate(0,-a),(a=r.right-e.right)>0&&r.translate(-a),(a=e.y-r.y)>0&&r.translate(0,a),(a=e.x-r.x)>0&&r.translate(a),r}alignTo(e){let t,r,n,i,s=this.clone(),o=e.target,a=e.constrainTo;!o||o instanceof Rectangle||(o=Rectangle.from(o.element?o.element:o)),!a||a instanceof Rectangle||(i=a===window||a===document,a=Rectangle.from(a.element?a.element:a,null,e.ignorePageScroll));const l=this,d=createOffsets(e.offset),{align:c,axisLock:u,anchorSize:h,anchorPosition:g}=e,m=parseAlign(c),p=e.position||(o&&"Point"===o.$name?o:null),f=a&&a.clone(),v=[],y=[{zone:r=m.startZone,align:c}],b=e.matchSize&&matchDimensions[1&m.startZone],C=l[b];if(b&&u&&(s[b]=o[b]),a&&s.constrainTo(a),a&&null!=m.startZone)if(u)y.push({zone:r=(r+2)%4,align:flipAlign(m)}),"flexible"===u&&(y.push({zone:r=(m.startZone+1)%4,align:defaultAlignments[r]}),y.push({zone:r=(r+2)%4,align:defaultAlignments[r]}));else for(let e=1;e<4;e++)y.push({zone:r=(r+1)%4,align:defaultAlignments[r]});if(g){let e=1&m.startZone?"y":"x";t={[e]:g[e],edge:edgeNames[(m.startZone+2)%4]}}if(f&&o&&(f.adjust(-o.width,-o.height,o.width,o.height),o.constrainTo(f)),s.minWidth=l.minWidth,s.minHeight=l.minHeight,p)s.moveTo(p.x,p.y),a&&s.constrainTo(a);else{const e=h?[h[1]+d[0],h[1]+d[1]]:d,r=o.getAlignmentPoint(m.targetAlignmentPoint,e),c=s.getAlignmentPoint(m.myAlignmentPoint);if(s.translate(r[0]-c[0],r[1]-c[1]),s.intersect(o,!0))a&&s.constrainTo(a),n=m.startZone;else if(a&&!a.contains(s)){let r,d,c=s.clone(),h=[];t=null,v[0]=r=a.clone(),r.bottom=o.y-e[1],v[1]=r=a.clone(),r.x=o.right+e[0],v[2]=r=a.clone(),r.y=o.bottom+e[1],v[3]=r=a.clone(),r.right=o.x-e[0];for(let t=0;t<y.length;t++){if(b&&2==t&&(s[b]=C),r=v[n=y[t].zone],(s=s.alignTo({target:o,offsets:e,align:y[t].align})).constrainTo(r,!0)&&(h.push({result:s,zone:n}),!d||s.width<l.width||s.height<l.height)){s.align=y[t].align;break}if(!d||r.area>d.area){const e=s.clone();switch(n){case 0:e.moveTo(null,r.bottom-e.height);break;case 1:e.moveTo(r.left);break;case 2:e.moveTo(null,r.top);break;case 3:e.moveTo(r.right-e.width)}d={area:r.area,result:e,zone:n}}}h.length?(h.length>1&&!u&&h.sort((e,t)=>{return Math.sqrt((c.x-e.result.x)**2+(c.y-e.result.y)**2)-Math.sqrt((c.x-t.result.x)**2+(c.y-t.result.y)**2)}),s=h[0].result,n=h[0].zone):(s=d.result,n=d.zone,i&&s.constrainTo(a))}else n=m.startZone;if(s.zone=n,h){if(!t){let e=1&n,r=e?"y":"x",i=e?"bottom":"right",a=Math.max(o[r],s[r]),l=a+(Math.min(o[i],s[i])-a)/2-h[0]/2,d=l+h[0];d>s[i]&&(l-=d-s[i]),l<s[r]&&(l+=s[r]-l),t={[r]:l-s[r],edge:edgeNames[(n+2)%4]}}s.anchor=t}}return s}getAlignmentPoint(e,t=zeroOffsets){const r=this,n=alignPointRe.exec(e),i=n[1].toLowerCase(),s=Math.min(Math.max(parseInt(n[2]||50),0),100)/100;switch(i){case"t":return[r.x+r.width*s,r.y-t[1]];case"r":return[r.right+t[0],r.y+r.height*s];case"b":return[r.x+r.width*s,r.bottom+t[1]];case"l":return[r.x-t[0],r.y+r.height*s];case"c":const e=r.center;return[e.x+t[0],e.y+t[1]]}}highlight(){const e=DomHelper.createElement({parent:document.body,style:`position:absolute;z-index:9999999;pointer-events:none;\n                            left:${this.x}px;top:${this.y}px;width:${this.width}px;height:${this.height}px`}),t=DomHelper.highlight(e);return t.then(()=>e.remove()),t}}Rectangle._$name="Rectangle";class AjaxHelper{static get(e,t){return this.fetch(e,t)}static post(e,t,r={}){return t instanceof FormData||"string"==typeof t||(t=JSON.stringify(t)),this.fetch(e,Object.assign({method:"POST",body:t},r))}static fetch(e,t={}){const r=new AbortController;if(t.signal=r.signal,"credentitals"in t||(t.credentials="include"),t.queryParams){const r=Object.entries(t.queryParams);r.length&&(e+="?"+r.map(([e,t])=>`${e}=${encodeURIComponent(t)}`).join("&"))}const n=new Promise((r,n)=>{fetch(e,t).then(e=>{t.parseJson?e.json().then(t=>{e.parsedJson=t,r(e)}).catch(t=>{e.parsedJson=null,e.error=t,n(e)}):r(e)}).catch(e=>{n(e)})});return n.abort=function(){r.abort()},n}}AjaxHelper._$name="AjaxHelper";class ArrayHelper{static clean(e){return e.reduce((e,t)=>(null===t||void 0===t||Array.isArray(t)&&0===t.length||""===t||e.push(t),e),[])}static remove(e,...t){let r,n=!1;for(const i of t)-1!==(r=e.indexOf(i))&&(e.splice(r,1),n=!0);return n}static findInsertionIndex(e,t,r=this.lexicalCompare,n){const i=t.length;let s,o;return n<i&&(s=n>0?r(t[n-1],e):0,o=n<i-1?r(e,t[n]):0,s<1&&o<1)?n:this.binarySearch(t,e,r)}static binarySearch(e,t,r=0,n=e.length,i=this.lexicalCompare){const s=e.length;let o,a;for(r instanceof Function?(i=r,r=0):n instanceof Function&&(i=n,n=s),--n;r<=n;)(a=i(t,e[o=r+n>>1]))>=0?r=o+1:a<0&&(n=o-1);return r}magnitudeCompare(e,t){return e<t?-1:e>t?1:0}lexicalCompare(e,t){return(e=String(e))<(t=String(t))?-1:e>t?1:0}static fill(e,t={},r=null){const n=[],i=Array.isArray(t)?t:[t];for(let t=0;t<e;t++)for(let e of i){const i=Object.assign({},e);r&&r(i,t),n.push(i)}return n}static populate(e,t){const r=[];for(let n=0;n<e;n++)r.push(t(n));return r}static include(e,t){e.includes(t)||e.push(t)}static allowNegative(e){return new Proxy(e,{get(e,t,r){if("string"!=typeof t)return Reflect.get(e,t,r);const n=Number(t);return Number.isNaN(n)?Reflect.get(e,t,r):e[n<0?e.length+n:n]},set(e,t,r,n){if("string"!=typeof t)return Reflect.set(e,t,r,n);const i=Number(t);return Number.isNaN(i)?Reflect.set(e,t,r,n):(e[i<0?e.length+i:i]=r,!0)}})}}ArrayHelper._$name="ArrayHelper";const specialProperties={thisObj:1,detachable:1,once:1,detacher:1,prio:1,args:1,_oldDestructor:1},priorityComparator=(e,t)=>t.prio-e.prio;var Events=e=>(class extends(e||Base){destroy(){this.trigger("beforeDestroy"),super.destroy()}construct(...e){super.construct(...e),this.processConfiguredListeners()}processConfiguredListeners(e=this.listeners){const t=this;if(t.listeners=e,t.listeners&&!t.defaultListenersInitialized){const e=t.addListener(t.listeners,t);!1!==t.listeners.detachable&&(t.listeners.detacher=e),t.defaultListenersInitialized=!0}}doDestroy(){const e=this;e.trigger("destroy"),e.listeners&&e.listeners.detacher&&e.listeners.detacher(),e.removeAllListeners(),super.doDestroy()}addListener(e,t,r){const n=this,i=n.eventListeners||(n.eventListeners={});if("string"==typeof e)return n.addListener({[e]:t,detachable:!1!==t.detachable,thisObj:r});t=void 0!==e.thisObj?e.thisObj:e.thisObj=t;for(const r in e)if(!specialProperties[r]){const n=e[r],s={fn:"object"==typeof n?n.fn:n,thisObj:void 0!==n.thisObj?n.thisObj:t,args:n.args||e.args,prio:void 0!==n.prio?n.prio:void 0!==e.prio?e.prio:0,once:void 0!==n.once?n.once:void 0!==e.once&&e.once,catchAll:"catchAll"===r},o=r.toLowerCase(),a=i[o]||(i[o]=[]);a.splice(ArrayHelper.findInsertionIndex(s,a,priorityComparator,a.length),0,s)}return e.relayAll&&n.relayAll(e.relayAll),t&&n.attachAutoDetacher(e),!1!==e.detachable?()=>n.removeListener(e):void 0}on(){return this.addListener(...arguments)}un(){this.removeListener(...arguments)}removeListener(e,t=e.thisObj,...r){const n=this;"string"!=typeof e?(Object.entries(e).forEach(([e,r])=>{if(specialProperties[e])return;const i=e.toLowerCase(),s=n.eventListeners[i];if(s){const e=s.findIndex(e=>!(e.fn!==r&&e.fn!==r.fn||e.thisObj!==t&&e.thisObj!==r.thisObj&&t));e>=0&&(s.splice(e,1),s.length||delete n.eventListeners[i])}}),e.thisObj&&!e.thisObj.isDestroyed&&n.detachAutoDetacher(e)):n.removeListener({[e]:t},!(r.length>0)||r[0])}hasListener(e){return Boolean(this.eventListeners&&this.eventListeners[e])}relayAll(e,t,r=!0){this.relayAllTargets||(this.relayAllTargets=[]),this.relayAllTargets.push({through:e,prefix:t,transformCase:r})}removeAllListeners(){const e=this,t=e.eventListeners||(e.eventListeners={});for(let r in t)t[r].forEach(t=>e.removeListener(r,t))}relayEvents(e,t,r){let n=this,i={detachable:!0};return t.forEach(e=>{i[e]=((...t)=>(function(e,...t){return n.trigger((r||"")+e,...t)})(e,...t))}),e.on(i)}attachAutoDetacher(e){const t=e.thisObj,r="doDestroy"in t?"doDestroy":"destroy";r in t?(e._oldDestructor=t[r],t[r]=(()=>{this.isDestroyed||this.removeListener(e),e._oldDestructor.call(t)})):t[r]=(()=>{this.removeListener(e)})}detachAutoDetacher(e){const t=e.thisObj,r="doDestroy"in t?"doDestroy":"destroy";e._oldDestructor&&(t[r]=e._oldDestructor)}await(e,t=!0){return new Promise(r=>{t&&this._triggered&&this._triggered[e]&&r(),this.on({[e]:(...e)=>{r(...e)},once:!0})})}callPreventable(e,t,r,n=[],i=!1){const s=this;if(!i&&!1===s.trigger("before"+StringHelper.capitalizeFirstLetter(e),t))return!1;const o=r(t,...n);return i||s.trigger(e,t),o}trigger(e,t){const r=this,n=e.toLowerCase(),i=r.eventsSuspended,s=r.relayAllTargets,o=r.callOnFunctions;let a=r.eventListeners&&r.eventListeners[n],l=!0;if(r._triggered||(r._triggered={}),r._triggered[e]=!0,i)return i.shouldQueue&&i.queue.push(arguments),!0;if(r.eventListeners&&r.eventListeners.catchall&&((a=a?a.slice():[]).push(...r.eventListeners.catchall),a.sort(priorityComparator),l=!1),!a&&!s&&!o)return!0;if(t?"source"in t||(Object.isExtensible(t)?t.source=r:t=Object.setPrototypeOf({source:r},t)):t={source:r},t.type!==n&&(t.constructor!==Object?Reflect.defineProperty(t,"type",{get:()=>n}):t.type=n),o){const n="on"+StringHelper.capitalizeFirstLetter(e);if(n in r&&(r.callback(r[n],r,[t]),r.hasOwnProperty(n))){const e=Object.getPrototypeOf(r);n in e&&e[n].call(r,t)}}if(a){let e,i,s=0;for(l&&(a=a.slice());s<a.length;s++){let o=(e=a[s]).thisObj;if(!o||!o.isDestroyed){if(e.once&&r.removeListener(n,e),"string"==typeof e.fn){if(o&&(i=o[e.fn]),!i){const t=r.resolveCallback(e.fn);i=t.handler,o=t.thisObj}}else i=e.fn;if(e.args){if(!1===i.call(o||r,...e.args,t))return!1}else if(!1===i.call(o||r,t))return!1}}}if(s&&s.forEach(r=>{let n=e;if(r.transformCase&&(n=StringHelper.capitalizeFirstLetter(n)),r.prefix&&(n=r.prefix+n),!1===r.through.trigger(n,t))return!1}),t.bubbles){const n=r.owner;if(n)return n.trigger(e,t)}return!0}suspendEvents(e=!1){(this.eventsSuspended||(this.eventsSuspended={shouldQueue:e,queue:[],count:0})).count++}resumeEvents(){const e=this.eventsSuspended;if(e&&0==--e.count&&(this.eventsSuspended=null,e.shouldQueue))for(let t of e.queue)this.trigger(...t);return!Boolean(this.eventsSuspended)}});class LocaleManager extends(Events(Base)){static get defaultConfig(){return{locales:{}}}construct(...e){const t=this;super.construct(...e);let r=document.querySelector("script[data-default-locale]");r&&(t.defaultLocaleName=r.dataset.defaultLocale),window.bryntum&&window.bryntum.locales&&(Object.keys(window.bryntum.locales).forEach(e=>{if(!e.startsWith("moment")){let r=window.bryntum.locales[e];r.extends?t.extendLocale(r.extends,r):t.registerLocale(r.localeName,{desc:r.localeDesc,locale:r})}}),t.locale||"En"!==t.defaultLocaleName&&t.applyLocale(t.defaultLocaleName||Object.keys(t.locales)[0]))}set locales(e){this._locales=e}get locales(){return this._locales}set locale(e){"string"==typeof e?this.applyLocale(e):(e.locale||(e={locale:e,localeName:e.localeName||"custom"}),this.registerLocale(e.localeName,e),this.applyLocale(e.localeName))}get locale(){return this._locale}registerLocale(e,t){const r=this,n=r.defaultLocaleName===e,i=r.locale&&r.locale.localeName===e,s=0===Object.keys(r.locales).length;r.locales[e]=t,(n||!r.defaultLocaleName&&(s||i))&&r.internalApplyLocale(t)}extendLocale(e,t){const r=this.locales[e];return!!r&&(Object.keys(t).forEach(e=>{r.locale[e]?Object.assign(r.locale[e],t[e]):r.locale[e]=t[e]}),delete r.locale.extends,!0)}internalApplyLocale(e){this._locale=e.locale,this.trigger("locale",e)}applyLocale(e,t=!1,r=!1){const n=this,i=n.locales[e];if(i&&i.locale&&n._locale===i.locale&&!t)return!0;if(!i){if(r)return!0;throw new Error(`Locale ${e} not registered`)}function s(){n.internalApplyLocale(i)}return i.locale?(s(),!0):new Promise((t,r)=>{n.loadLocale(i.path).then(r=>{r.text().then(r=>{new Function(r)(),i.locale=window.bryntum.locales[e],s(),t(i)})}).catch(e=>r(e))})}loadLocale(e){return AjaxHelper.get(e)}}let LocaleManagerSingelton=new LocaleManager;var Localizable=e=>(class t extends(e||Base){static get defaultConfig(){return{localeClass:null,localizableProperties:[]}}static get inTextLocaleRegExp(){return/L\{([^}]+)\}/g}static parseText(e){const t=this.inTextLocaleRegExp.exec(e);return t?t[1]:e}construct(e={},...t){super.construct(e,...t),LocaleManagerSingelton.on("locale",this.updateLocalization,this),this.updateLocalization()}get localeClass(){return this._localeClass||this.parent&&this.parent.localeClass||null}set localeClass(e){this._localeClass=e}updateLocalization(){const e=this;e.localizableProperties&&e.localizableProperties.forEach(r=>{void 0!==e[r]&&(e.originalLocales=e.originalLocales||{},e.originalLocales[r]=e.originalLocales[r]||e[r],e.originalLocales[r]&&(e[r]=t.L.call(e,e.originalLocales[r])))})}static L(e,r,n=this.localeClass||this){if(LocaleManagerSingelton.locale)for(;n;){const i=n.$name||n.name,s=LocaleManagerSingelton.locale[i],o=s&&s[t.parseText(e)];if(o)return"function"==typeof o&&null!=r?o(r):o;n=Object.getPrototypeOf(n)}return e}L(e,r){return t.L(e,r,this.constructor)}get localeManager(){return LocaleManagerSingelton}});const enOrdinalSuffix=e=>e+({1:"st",2:"nd",3:"rd"}[e[e.length-1]]||"th");let locale="en-US",ordinalSuffix=enOrdinalSuffix,formatCache={},intlFormatterCache={},parserCache={};function useIntlFormat(e,t,r){return(intlFormatterCache[e]||(intlFormatterCache[e]=new Intl.DateTimeFormat(locale,t))).format(r)}const MS_PER_DAY=864e5,MS_PER_WEEK=6048e5,defaultFormat="YYYY-MM-DDTHH:mm:ss.SSSZ",formats={M:e=>e.getMonth()+1,Mo:e=>ordinalSuffix(formats.M(e).toString()),MM:e=>(e.getMonth()+1).toString().padStart(2,"0"),MMM:e=>useIntlFormat("MMM",{month:"short"},e),MMMM:e=>useIntlFormat("MMMM",{month:"long"},e),Q:e=>Math.ceil((e.getMonth()+1)/4),Qo:e=>ordinalSuffix(formats.Q(e).toString()),D:e=>e.getDate(),Do:e=>ordinalSuffix(formats.D(e).toString()),DD:e=>e.getDate().toString().padStart(2,"0"),DDD:e=>Math.ceil((new Date(e.getFullYear(),e.getMonth(),e.getDate(),12,0,0)-new Date(e.getFullYear(),0,0,12,0,0))/864e5),DDDo:e=>ordinalSuffix(formats.DDD(e).toString()),DDDD:e=>formats.DDD(e).toString().padStart(3,"0"),d:e=>e.getDay(),do:e=>ordinalSuffix(e.getDay().toString()),dd:e=>formats.ddd(e).substring(0,2),ddd:e=>useIntlFormat("ddd",{weekday:"short"},e),dddd:e=>useIntlFormat("dddd",{weekday:"long"},e),e:e=>e.getDay(),E:e=>e.getDay()+1,W:e=>{const t=new Date(e.valueOf());t.setDate(t.getDate()-(e.getDay()+6)%7+3);const r=t.valueOf();return t.setMonth(0,1),4!==t.getDay()&&t.setMonth(0,1+(4-t.getDay()+7)%7),1+Math.ceil((r-t)/6048e5)},Wo:e=>ordinalSuffix(formats.W(e).toString()),WW:e=>formats.W(e).toString().padStart(2,"0"),Y:e=>e.getFullYear(),YY:e=>e.getFullYear()%100,YYYY:e=>e.getFullYear(),A:e=>e.getHours()<12?"AM":"PM",a:e=>e.getHours()<12?"am":"pm",H:e=>e.getHours(),HH:e=>e.getHours().toString().padStart(2,"0"),h:e=>e.getHours()%12||12,hh:e=>formats.h(e).toString().padStart(2,"0"),k:e=>e.getHours()+1,kk:e=>formats.k(e).toString().padStart(2,"0"),K:e=>useIntlFormat("K",{hour:"numeric"},e),KK:e=>useIntlFormat("KK",{hour:"2-digit"},e),m:e=>e.getMinutes(),mm:e=>formats.m(e).toString().padStart(2,"0"),s:e=>e.getSeconds(),ss:e=>formats.s(e).toString().padStart(2,"0"),S:e=>e.getMilliseconds().toString().substr(0,1),SS:e=>e.getMilliseconds().toString().substr(0,2).padEnd(2,"0"),SSS:e=>e.getMilliseconds().toString().substr(0,3).padEnd(3,"0"),z:e=>useIntlFormat("z",{timeZoneName:"short"},e),zz:e=>useIntlFormat("zz",{timeZoneName:"long"},e),LT:e=>useIntlFormat("LT",{hour:"2-digit",minute:"2-digit"},e),LTS:e=>useIntlFormat("LTS",{hour:"2-digit",minute:"2-digit",second:"2-digit"},e),L:e=>useIntlFormat("L",{year:"numeric",month:"2-digit",day:"2-digit"},e),l:e=>useIntlFormat("l",{year:"numeric",month:"numeric",day:"numeric"},e),LL:e=>useIntlFormat("LL",{year:"numeric",month:"long",day:"numeric"},e),ll:e=>useIntlFormat("ll",{year:"numeric",month:"short",day:"numeric"},e),LLL:e=>useIntlFormat("LLL",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit"},e),lll:e=>useIntlFormat("lll",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"},e),LLLL:e=>useIntlFormat("LLLL",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit",weekday:"long"},e),llll:e=>useIntlFormat("llll",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",weekday:"short"},e)},formatKeys=Object.keys(formats).sort((e,t)=>t.length-e.length),formatRegexp=`^(?:${formatKeys.join("|")})`,emptyFn=()=>({}),parsers={YYYY:e=>({year:parseInt(e)}),Y:e=>({year:parseInt(e)}),YY:e=>{const t=parseInt(e);return{year:t+(t>1968?1900:2e3)}},MM:e=>({month:parseInt(e)-1}),Mo:e=>({month:parseInt(e)-1}),DD:e=>({date:parseInt(e)}),M:e=>({month:parseInt(e)-1}),D:e=>({date:parseInt(e)}),Do:e=>({date:parseInt(e)}),DDD:emptyFn,MMM:emptyFn,MMMM:emptyFn,DDDo:emptyFn,DDDD:emptyFn,d:emptyFn,do:emptyFn,dd:emptyFn,ddd:emptyFn,dddd:emptyFn,Q:emptyFn,Qo:emptyFn,W:emptyFn,Wo:emptyFn,WW:emptyFn,e:emptyFn,E:emptyFn,HH:e=>({hours:parseInt(e)}),mm:e=>({minutes:parseInt(e)}),H:e=>({hours:parseInt(e)}),m:e=>({minutes:parseInt(e)}),ss:e=>({seconds:parseInt(e)}),s:e=>({seconds:parseInt(e)}),S:e=>({milliseconds:parseInt(e)}),SS:e=>({milliseconds:parseInt(e)}),SSS:e=>({milliseconds:parseInt(e)}),A:e=>({amPm:e.toLowerCase()}),a:e=>({amPm:e.toLowerCase()}),L:"MM/DD/YYYY",LT:"HH:mm A",Z:e=>{if(!e)return{};let t=0;if(!e.endsWith("Z")){const r=timeZoneRegEx.exec(e);if(r){t=("+"===r[1]?1:-1)*(60*(parseInt(r[2])||0)+(parseInt(r[3])||0))}else t=-1*(new Date).getTimezoneOffset()}return{timeZone:t}}},parserKeys=Object.keys(parsers).sort((e,t)=>t.length-e.length),parserRegexp=new RegExp(`(${parserKeys.join("|")})`),localeStrRegExp=new RegExp("(l|LL|ll|LLL|lll|LLLL|llll)"),validConversions={year:{year:1,quarter:4,month:12,week:52,day:365,hour:8760,minute:525600,second:31536e3,millisecond:31536e6},quarter:{year:.25,quarter:1,month:3,week:4,day:91,hour:2184,minute:131040,second:7862400,millisecond:78624e5},month:{year:1/12,quarter:1/3,month:1,week:4,day:-30,hour:-720,minute:-43200,second:-2592e3,millisecond:-2592e6},week:{year:-1/52,quarter:-1/13,month:-.25,day:7,hour:168,minute:10080,second:604800,millisecond:6048e5},day:{year:-1/365,quarter:-1/91,month:-1/30,week:1/7,hour:24,minute:1440,second:86400,millisecond:864e5},hour:{year:-1/8760,quarter:-1/2184,month:-1/720,week:1/168,day:1/24,minute:60,second:3600,millisecond:36e5},minute:{year:-1/525600,quarter:-1/131040,month:-1/43200,week:1/10080,day:1/1440,hour:1/60,second:60,millisecond:6e4},second:{year:-1/31536e3,quarter:-1/7862400,month:-1/2592e3,week:1/604800,day:1/86400,hour:1/3600,minute:1/60,millisecond:1e3},millisecond:{year:-1/31536e6,quarter:-1/78624e5,month:-1/2592e6,week:1/6048e5,day:1/864e5,hour:1/36e5,minute:1/6e4,second:.001}},normalizedUnits={ms:"millisecond",milliseconds:"millisecond",s:"second",seconds:"second",m:"minute",minutes:"minute",h:"hour",hours:"hour",d:"day",days:"day",w:"week",weeks:"week",M:"month",months:"month",q:"quarter",quarters:"quarter",y:"year",years:"year"},withDecimalsDurationRegex=/^\s*([-+]?\d+(?:[.,]\d*)?|[-+]?(?:[.,]\d+))\s*([^\s]+)?/i,noDecimalsDurationRegex=/^\s*([-+]?\d+)(?![.,])\s*([^\s]+)?/i,canonicalUnitNames=["millisecond","second","minute","hour","day","week","month","quarter","year"],deltaUnits=["year","month","week","day","hour","minute","second","millisecond"],dateProperties=["milliseconds","seconds","minutes","hours","date","month","year"],parseNumber=e=>{const t=parseFloat(e);return isNaN(t)?null:t},timeZoneRegEx=/([+-])(\d\d):*(\d\d)*$/;class DateHelper extends(Localizable()){static buildParser(e){const t=e.split(parserRegexp),r=[];return 1===t.length||localeStrRegExp.test(e)?[]:(t.reduce((t,n,i,s)=>{if(0!==i||""!==n)if(parserRegexp.test(n)){const o=("parsers"!==this.L("parsers")&&this.L("parsers")||{})[n]||parsers[n];if("Z"===n&&i<s.length-2)throw new Error(`Invalid format ${e} TimeZone (Z) must be last token`);if("string"==typeof o){const e=DateHelper.buildParser(o),n=e.pop();delete n.last,r.push(...e),t=n}else t.pattern=n,t.fn=parsers[n]}else t.splitter=n,r.push(t),t={};else t.hasOwnProperty("pattern")&&r.push(t);return t},{}),r[r.length-1].last=!0,r)}static parse(e,t=defaultFormat){if(!e)return null;if(e instanceof Date)return e;let r,n={year:0,month:0,date:0,hours:0,minutes:0,seconds:0,milliseconds:0},i=parserCache[t];i||(i=parserCache[t]=DateHelper.buildParser(t)),i.reduce((e,t)=>{if(!t.last){let r,i,s;if(-1===(r="T"===t.splitter&&-1===e.indexOf("T")?e.indexOf(" "):e.indexOf(t.splitter))||""===t.splitter){let t=e.split(/([Z\-+])/);1===t.length?(i=e,s=""):(i=t[0],s=`${t[1]}${t[2]}`)}else i=e.substring(0,r)||e,s=e.substring(r+t.splitter.length);return t.fn&&Object.assign(n,t.fn(i)),s}Object.assign(n,t.fn(e))},e);const s=this.create(n);return r=s||new Date(e)}static create(e){const t=Object.assign({},e);let r=!0,n=!1;if(dateProperties.forEach(e=>{e in t&&!isNaN(t[e])||(t[e]=0),t[e]>0&&(r=!1)}),"pm"===t.amPm&&(t.hours=t.hours%12+12),"timeZone"in t&&(n=!0,t.minutes-=t.timeZone),r)return null;const i=[t.year,t.month,t.date,t.hours,t.minutes,t.seconds,t.milliseconds];return n?new Date(Date.UTC(...i)):new Date(...i)}static format(e,t=defaultFormat){if(!e)return null;let r=formatCache[t],n="";if(!r){r=formatCache[t]=[];for(let e=0;e<t.length;e++){const n=t.substr(e).match(formatRegexp),i=n&&n[0];if(i){const t=("formats"!==this.L("formats")&&this.L("formats")||{})[i]||formats[i];r.push(t),e+=i.length-1}else r.push(t[e])}}return r.forEach(t=>{n+="string"==typeof t?t:t(e)}),(BrowserHelper.isEdge||BrowserHelper.isIE11)&&(n=n.replace(/\u200E/g,"")),n}static asMilliseconds(e,t=null){return"string"==typeof e&&(t=e,e=1),this.as("millisecond",e,t)}static formatDelta(e,t=!1){const r=[],n=t?this.getShortNameOfUnit:this.getLocalizedNameOfUnit,i=t?"":" ";for(const t of deltaUnits){const s=Math.floor(this.as(t,e));if(s&&(r.push(`${s}${i}${n.call(this,t,s>1)}`),e-=this.as("ms",s,t)),!e)break}return r.join(", ")}static as(e,t,r="ms"){if(e===r)return t;const n=validConversions[this.normalizeUnit(r)],i=n&&n[this.normalizeUnit(e)];return null==i?null:t*Math.abs(i)}formatContainsHourInfo(e){return e.match(/[Hhk]/)}static is24HourFormat(e){return this.format(new Date(1970,0,0,13,0,0),e).includes("13")}static add(e,t,r="ms"){const n=this;let i;if(i="string"==typeof e?n.parse(e):new Date(e.getTime()),!r||0===t)return i;switch(r=DateHelper.normalizeUnit(r)){case"millisecond":i=new Date(i.getTime()+t);break;case"second":i=new Date(i.getTime()+1e3*t);break;case"minute":i=new Date(i.getTime()+6e4*t);break;case"hour":i=new Date(i.getTime()+36e5*t);break;case"day":t%1==0?i.setDate(i.getDate()+t):i=new Date(i.getTime()+864e5*t),23===i.getHours()&&0===i.getHours()&&(i=n.add(i,1,"hour"));break;case"week":i.setDate(i.getDate()+7*t);break;case"month":let e=i.getDate();e>28&&(e=Math.min(e,n.getLastDateOfMonth(n.add(n.getFirstDateOfMonth(i),t,"month")).getDate())),i.setDate(e),i.setMonth(i.getMonth()+t);break;case"quarter":i=n.add(i,3*t,"month");break;case"year":i.setFullYear(i.getFullYear()+t)}return i}static diff(e,t,r="ms",n=!0){if(r=DateHelper.normalizeUnit(r),!e||!t)return 0;let i;switch(r){case"year":i=this.diff(e,t,"month")/12;break;case"quarter":i=this.diff(e,t,"month")/3;break;case"month":i=12*(t.getFullYear()-e.getFullYear())+(t.getMonth()-e.getMonth());break;case"week":i=this.diff(e,t,"day")/7;break;case"day":i=(t-e+60*(e.getTimezoneOffset()-t.getTimezoneOffset())*1e3)/864e5;break;case"hour":i=(t-e)/36e5;break;case"minute":i=(t-e)/6e4;break;case"second":i=(t-e)/1e3;break;case"millisecond":i=t-e}return n?i:Math.round(i)}static startOf(e,t="day",r=!0){if(!e)return null;t=this.normalizeUnit(t),r&&(e=this.clone(e));const n={},i=canonicalUnitNames.indexOf(t);for(let e=0;e<i;e++){const t=canonicalUnitNames[e];"quarter"!==t&&"week"!==t&&(n[t]="day"===t?1:0)}if("quarter"===t)n.month=3*(this.get(e,"quarter")-1);else if("week"===t){const t=e.getDay()-this.weekStartDay;n.day=e.getDate()-t}return this.set(e,n)}static clone(e){return new Date(e.getTime())}static clearTime(e,t=!0){return DateHelper.startOf(e,"day",t)}static set(e,t,r){if(!t)return e;if("string"==typeof t)switch(this.normalizeUnit(t)){case"millisecond":(0!==r||e.getMilliseconds()>0)&&e.setMilliseconds(r);break;case"second":(0!==r||e.getSeconds()>0)&&e.setSeconds(r);break;case"minute":(0!==r||e.getMinutes()>0)&&e.setMinutes(r);break;case"hour":e.setHours(r);break;case"day":case"date":e.setDate(r);break;case"week":throw new Error("week not implemented");case"month":e.setMonth(r);break;case"quarter":e.setDate(1),e.setMonth(3*(r-1));break;case"year":e.setFullYear(r)}else Object.entries(t).sort((e,t)=>canonicalUnitNames.indexOf(e[0])-canonicalUnitNames.indexOf(t[0])).forEach(([t,r])=>{this.set(e,t,r)});return e}static constrain(e,t,r){return this.min(this.max(e,t),r)}static getTime(e,t=0,r=0){return new Date(1970,0,1,e,t,r)}static isDST(e){const t=new Date(e.getFullYear(),0,1),r=new Date(e.getFullYear(),6,1);return e.getTimezoneOffset()<Math.max(t.getTimezoneOffset(),r.getTimezoneOffset())}static isBefore(e,t){return e<t}static isAfter(e,t){return e>t}static isEqual(e,t,r=null){return null===r?e-t==0:this.startOf(e,r)-this.startOf(t,r)==0}static compare(e,t,r=null){const n=this;return r&&(e=n.startOf(e,r),t=n.startOf(t,r)),n.isBefore(e,t)?-1:n.isAfter(e,t)?1:0}static isStartOf(e,t){return this.isEqual(e,this.startOf(e,t))}static betweenLesser(e,t,r){return t.getTime()<=e.getTime()&&e.getTime()<r.getTime()}static betweenLesserEqual(e,t,r){return t.getTime()<=e.getTime()&&e.getTime()<=r.getTime()}static intersectSpans(e,t,r,n){return this.betweenLesser(e,r,n)||this.betweenLesser(r,e,t)}static compareUnits(e,t){const r=canonicalUnitNames.indexOf(e),n=canonicalUnitNames.indexOf(t);return Math.sign(r-n)}static timeSpanContains(e,t,r,n){return r-e>=0&&t-n>=0}static get weekStartDay(){let e=this.L("weekStartDay");return"weekStartDay"!==e?e:0}static get(e,t){switch(this.normalizeUnit(t)){case"millisecond":return e.getMilliseconds();case"second":return e.getSeconds();case"minute":return e.getMinutes();case"hour":return e.getHours();case"date":case"day":return e.getDate();case"week":return formats.W(e);case"month":return e.getMonth();case"quarter":return Math.floor(e.getMonth()/3)+1;case"year":return e.getFullYear()}return null}static daysInMonth(e){const t=this.clone(e);return t.setDate(1),t.setMonth(e.getMonth()+1),t.setDate(0),t.getDate()}static getFirstDateOfMonth(e){return new Date(e.getFullYear(),e.getMonth(),1)}static getLastDateOfMonth(e){return new Date(e.getFullYear(),e.getMonth()+1,0)}static min(e,t){return e.getTime()<t.getTime()?e:t}static max(e,t){return e.getTime()>t.getTime()?e:t}static getNext(e,t,r=1,n=this.weekStartDay){const i=this;if("week"===t){let t=i.clone(e),s=t.getDay();return t=i.startOf(t,"day"),(t=i.add(t,n-s+7*(r-(n<=s?0:1)),"day")).getDay()!==n&&i.add(t,1,"hour"),t}return i.startOf(i.add(e,r,t),t)}static getStartOfNextDay(e,t,r){let n=DateHelper.add(r?e:DateHelper.clearTime(e,t),1,"day");if(n.getDate()==e.getDate()){let r=DateHelper.add(DateHelper.clearTime(e,t),"day",2).getTimezoneOffset(),i=e.getTimezoneOffset();n=DateHelper.add(n,i-r,"minute")}return n}static getEndOfPreviousDay(e,t){let r=t?e:DateHelper.clearTime(e,!0);return r-e?r:this.add(r,-1,"day")}static formatCount(e,t){return t=DateHelper.normalizeUnit(t),1!==e&&(t+="s"),e+" "+t}static getUnitToBaseUnitRatio(e,t,r=!1){return(e=DateHelper.normalizeUnit(e))===(t=DateHelper.normalizeUnit(t))?1:validConversions[e]&&validConversions[e][t]&&(r||validConversions[e][t]>0)?1/DateHelper.as(t,1,e):validConversions[t]&&validConversions[t][e]&&(r||validConversions[t][e]>0)?DateHelper.as(e,1,t):-1}static getMeasuringUnit(e){return"week"===e?"day":e}static getShortNameOfUnit(e){return e=this.parseTimeUnit(e),this.unitLookup[e].abbrev}static getLocalizedNameOfUnit(e,t){return e=this.normalizeUnit(e),e=this.parseTimeUnit(e),this.unitLookup[e][t?"plural":"single"]}static normalizeUnit(e){return e?"date"===e.toLowerCase()?e.toLowerCase():canonicalUnitNames.includes(e.toLowerCase())?e.toLowerCase():normalizedUnits[e]||normalizedUnits[e.toLowerCase()]:null}static getUnitByName(e){return DateHelper.normalizeUnit(e)||DateHelper.normalizeUnit(this.parseTimeUnit(e))}static getDurationInUnit(e,t,r,n){return this.diff(e,t,r,n)}static doesUnitsAlign(e,t){return e===t||"week"!==t}static getSmallerUnit(e){return e=this.normalizeUnit(e),canonicalUnitNames[canonicalUnitNames.indexOf(e)-1]||null}static getLargerUnit(e){return e=this.normalizeUnit(e),canonicalUnitNames[canonicalUnitNames.indexOf(e)+1]||null}static parseDuration(e,t=!0,r){const n=(t?withDecimalsDurationRegex:noDecimalsDurationRegex).exec(e);if(null==e||!n)return null;const i=parseNumber(n[1]),s=this.parseTimeUnit(n[2])||r;return s?{magnitude:i,unit:s}:null}static parseTimeUnit(e){const t=null==e?null:this.durationRegEx.exec(e.toLowerCase());if(!t)return null;for(let e=0;e<canonicalUnitNames.length;e++)if(t[e+1])return canonicalUnitNames[e]}static set locale(e){locale=e}static get locale(){return locale}static applyLocale(){const e=this,t=e.L("unitAbbreviations"),r=e.unitNames=e.L("unitNames");if("unitNames"===r)return;"en-US"===(locale=e.L("locale")||"en-US")?ordinalSuffix=enOrdinalSuffix:"ordinalSuffix"!==e.L("ordinalSuffix")&&(ordinalSuffix=e.L("ordinalSuffix")),formatCache={},parserCache={},intlFormatterCache={};let n="";e.unitLookup={};for(let i=0;i<t.length;i++){const s=t[i],o=r[i];o.canonicalUnitName=canonicalUnitNames[i],e.unitLookup[o.single]=e.unitLookup[o.single.toUpperCase()]=e.unitLookup[o.canonicalUnitName]=e.unitLookup[o.canonicalUnitName.toUpperCase()]=o,n+=`${i?"|":""}(`;for(let e=0;e<s.length;e++)n+=`${s[e]}|`;n+=`${o.single}|${o.plural}|${o.canonicalUnitName})`}e.durationRegEx=new RegExp(`^(?:${n})$`)}}DateHelper._$name="DateHelper",LocaleManagerSingelton.on({locale:"applyLocale",thisObj:DateHelper}),LocaleManagerSingelton.locale&&DateHelper.applyLocale(),DateHelper._$name="DateHelper";const whiteSpaceRe=/\s+/,typeOf=e=>{const t=typeof e;if("object"===t){if(null===e)return"null";if("[object Date]"===Object.prototype.toString.call(e))return"date"}return t},toFixedFix="1.01"===1.005.toFixed(2)?null:function(e,t){const r=e.toString().split("."),n=+(r[1]?r.join(".")+"1":r[0]);return e.toFixed.call(n,t)};class ObjectHelper{static isEqual(e,t){let r=!1;switch(!0){case e instanceof Date&&t instanceof Date:r=e-t==0;break;case Array.isArray(e)&&Array.isArray(t):r=e.length===t.length&&e.every((e,r)=>this.isEqual(e,t[r]));break;case e&&t&&"object"==typeof e&&"object"==typeof t&&e.constructor.prototype===t.constructor.prototype:r=JSON.stringify(e)===JSON.stringify(t);break;default:r=String(e)==String(t)}return r}static isPartial(e,t){return e=String(e).toLowerCase(),t=String(t).toLowerCase(),-1!=e.indexOf(t)}static isLessThan(e,t){return e instanceof Date&&t instanceof Date?DateHelper.isBefore(e,t):e<t}static isMoreThan(e,t){return e instanceof Date&&t instanceof Date?DateHelper.isAfter(e,t):e>t}static fork(e){var t,r,n;if(e&&e.constructor===Object)for(r in t=Object.setPrototypeOf({},e),e)(n=e[r])&&(n.constructor===Object?t[r]=this.fork(n):n instanceof Array&&(t[r]=n.slice()));else t=e;return t}static assign(e,...t){for(var r,n,i=0,s=t.length;i<s;i++)for(n in r=t[i])e[n]=r[n];return e}static clone(e){if(null==e)return e;var t,r,n=e.constructor.name,i=e;if("Date"===n)return new Date(e.getTime());if("Array"===n)for(t=e.length,i=[];t--;)i[t]=this.clone(e[t]);else if("Object"===n)for(r in i={},e)i[r]=this.clone(e[r]);return i}static merge(e,...t){for(var r,n,i,s,o=0,a=t.length;o<a;o++)for(n in r=t[o])(i=r[n])&&i.constructor===Object?(s=e[n])&&"Object"===s.constructor.name?this.merge(s,i):e[n]=this.clone(i):e[n]=i;return e}static copyProperties(e,t,r){let n,i;for(i=0;i<r.length;i++)(n=r[i])in t&&(e[n]=t[n]);return e}static copyPropertiesIf(e,t,r){for(const n of r)n in e||(e[n]=t[n]);return e}static keys(e){const t=[];for(const r in e)t.push(r);return t}static isEmpty(e){for(const t in e)return!1;return!0}static getTruthyKeys(e){const t=Object.keys(e);for(let r=0;r<t.length;)e[t[r]]?r++:t.splice(r,1);return t}static getTruthyValues(e){const t=Object.keys(e);for(let r=0;r<t.length;)e[t[r]]?t[r]=e[t[r++]]:t.splice(r,1);return t}static createTruthyKeys(e){"string"==typeof e&&(e=e.split(whiteSpaceRe));const t={};for(const r of e)r.length&&(t[r]=1);return t}static allKeys(e){const t=[];for(;e;e=Object.getPrototypeOf(e))t.push(...Object.keys(e));return t}static pathExists(e,t){return t.split(".").every(t=>t in e&&(e=e[t],!0))}static getPath(e,t){return t.split(".").reduce((e,t)=>(e||{})[t],e)}static setPath(e,t,r){t.split(".").reduce((e,t,n,i)=>{return n===i.length-1?e[t]=r:(e[t]instanceof Object||(e[t]={}),e[t])},e)}static coerce(e,t){var r=typeOf(e),n=typeOf(t),i="string"==typeof e;if(r!==n)switch(n){case"string":return String(e);case"number":return Number(e);case"boolean":return!(i&&(!e||"false"===e||"0"===e))&&Boolean(e);case"null":return!(!i||e&&"null"!==e)&&null;case"undefined":return!(!i||e&&"undefined"!==e)&&void 0;case"date":return i&&isNaN(e)?DateHelper.parse(e):Date(Number(e))}return e}static wrapProperty(e,t,r,n,i=!0){const s={};let o=Object.getPrototypeOf(e),a=Object.getOwnPropertyDescriptor(o,t);for(;!a&&o&&i;)(o=Object.getPrototypeOf(o))&&(a=Object.getOwnPropertyDescriptor(o,t));a?(a.set?s.set=(t=>{a.set.call(e,t),n&&n.call(e,a.get.call(e))}):s.set=n,a.get?s.get=(()=>{let t=a.get.call(e);return r&&(t=r.call(e,t)),t}):s.get=r):(s.set=(r=>{e[`_${t}`]=r,n&&n.call(e,r)}),s.get=(()=>{let n=e[`_${t}`];return r&&(n=r.call(e,n)),n})),Object.defineProperty(e,t,s)}static getPropertyDescriptor(e,t){let r=null;for(let n=e;!r&&n!==Base;n=Object.getPrototypeOf(n))r=Object.getOwnPropertyDescriptor(n,t);return r}static cleanupProperties(e){return Object.entries(e).forEach(([t,r])=>null==r&&delete e[t]),e}static assertType(e,t,r){if(null!=e&&typeof e!==t)throw new Error(`Incorrect type "${typeof e}" for ${r}, expected "${t}"`)}static assertNumber(e,t){this.assertType(e,"number",t)}static assertBoolean(e,t){this.assertType(e,"boolean",t)}static toFixed(e,t){return toFixedFix?toFixedFix(e,t):e.toFixed(t)}}ObjectHelper._$name="ObjectHelper";const DEFAULT_FONT_SIZE=14;let scrollBarWidth=null,idCounter=0,themeInfo=null;const translateMatrixRe=/(?:matrix\((?:-?\d*\.?[0-9]*),\s?(?:-?\d*\.?[0-9]*),\s?(?:-?\d*\.?[0-9]*),\s?(?:-?\d*\.?[0-9]*),\s?(-?\d*\.?[0-9]*),\s?(-?\d*\.?[0-9]*))|(?:matrix3d\((?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(-?\d*),\s?(-?\d*))/,pxTtranslateXRe=/translate(3d|X)?\((-?\d*\.?[0-9]*)px(?:,\s?(-?\d*\.?[0-9]*)px)?/,pxTtranslateYRe=/translate(3d|Y)?\((-?\d*\.?[0-9]*)px(?:,\s?(-?\d*\.?[0-9]*)px)?/,domIdRe=/^[^a-z]+|[^\w:.-]+/gi,whiteSpaceRe$1=/\s+/,elementCreateProperties={tag:1,html:1,children:1,tooltip:1,style:1,dataset:1,parent:1,nextSibling:1,ns:1,reference:1},nativeFocusableTags={BUTTON:1,IFRAME:1,EMBED:1,INPUT:1,OBJECT:1,SELECT:1,TEXTAREA:1,HTML:BrowserHelper.isIE11?1:0,BODY:BrowserHelper.isIE11?0:1},win=window,doc=document,emptyObject={},emptyArray=[],arraySlice=Array.prototype.slice,immediatePromise=new Promise(e=>e()),devicePixelRatio=window.devicePixelRatio||1,roundPx=1===devicePixelRatio?Math.round:e=>Math.round(e*devicePixelRatio)/devicePixelRatio;let templateElement,htmlParser;const fontProps=["font-size","font-size-adjust","font-style","font-weight","font-family","font-kerning","font-stretch","line-height","text-transform","text-decoration","letter-spacing","word-break"];class DomHelper{static isFocusable(e,t=!1){if(!t&&e!==document.body&&!e.offsetParent)return!1;const r=e.nodeName;return nativeFocusableTags[r]||("A"===r||"LINK"===r)&&!!e.href||null!=e.getAttribute("tabIndex")||"true"===e.contentEditable}static isInView(e,t=!0){let r=Rectangle.from(e),n=!0;const i=r.height,s=r.width;for(;n&&e.parentElement;)e=e.parentElement,n=(r=r.intersect(Rectangle.from(e)))&&(!t||r.height>=i&&r.width>=s);return n}static getId(e){return e.id||(e.id="b-element-"+ ++idCounter)}static getElement(e){return e instanceof Element?e:doc.querySelector(e)}static setAttributes(e,t){const r=this.getElement(e);Object.entries(t).forEach(([e,t])=>r.setAttribute(e,t))}static setLength(e,t,r){return 1===arguments.length?"number"==typeof e?`${e}px`:e:(e=this.getElement(e)).style[t]="number"==typeof r?`${r}px`:r}static getChild(e,t){if(BrowserHelper.supportsQueryScope)t=":scope>"+t;else{t=`#${e.id||(e.id="b-element-"+ ++idCounter)} > ${t}`}return e.querySelector(t)}static hasChild(e,t){return null!=DomHelper.getChild(e,t)}static children(e,t){return Array.from(e.querySelectorAll(t))}static down(e,t){if(!e)return null;if(e.matches&&e.matches(t))return e;if(BrowserHelper.supportsQueryScope)t=":scope "+t;else{t=`#${e.id||(e.id="b-element-"+ ++idCounter)} ${t}`}return e.querySelector(t)}static isDescendant(e,t){return e.contains||(e=e.body),e.contains(t)}static forEachSelector(e,t,r){"string"==typeof e&&(r=t,t=e,e=doc),this.children(e,t).forEach(r)}static forEachChild(e,t){Array.from(e.children).forEach(t)}static removeEachSelector(e,t){this.forEachSelector(e,t,e=>e.remove())}static up(e,t){return e&&e.closest(t)}static getAncestor(e,t,r=null){let n,i=!1,s=e;for(Array.isArray(t)||(t=[t]);s=s.parentElement;){if(t.includes(s)){i=!0;break}if(r&&s===r)break;n=s}return i?n||e:null}static makeValidId(e){return null==e?null:String(e).replace(domIdRe,"")}static createElement(e={},t=!1,r=null){"string"==typeof e.parent&&(e.parent=document.getElementById(e.parent));const n=e.parent||e.nextSibling&&e.nextSibling.parentNode;let i;i=e.ns?doc.createElementNS(e.ns,e.tag||"svg"):doc.createElement(e.tag||"div"),e.html&&(i.innerHTML=e.html),e.tooltip&&WidgetHelper.attachTooltip(i,e.tooltip),e.style&&this.applyStyle(i,e.style),e.dataset&&Object.assign(i.dataset,e.dataset),n&&n.insertBefore(i,e.nextSibling),e.reference&&((r||(r={}))[e.reference]=i,i.setAttribute("reference",e.reference));for(const t of Object.keys(e))elementCreateProperties[t]||(e.ns?i.setAttribute(t,e[t]):i[t]=e[t]);return!0===t?t=[i]:Array.isArray(t)&&t.push(i),e.children?(e.children.forEach(n=>{isNaN(n.nodeType)?(n.parent=i,n.ns||(n.ns=e.ns),DomHelper.createElement(n,t,r)):i.appendChild(n)}),r||t||i):r||t||i}static createElementFromTemplate(e,t=emptyObject){const{array:r,raw:n,fragment:i}=t;let s;if(DomHelper.supportsTemplate){if((templateElement||(templateElement=doc.createElement("template"))).innerHTML=e,s=templateElement.content,i)return s.cloneNode(!0)}else if((htmlParser||(htmlParser=new DOMParser)).parseFromString(e,"text/html"),s=htmlParser.parseFromString(e,"text/html").body,i){const e=s?s.childNodes:emptyArray;for(s=document.createDocumentFragment();e.length;)s.appendChild(e[0]);return s}return 1!==(s=n?s.childNodes:s.children).length||r?arraySlice.call(s):s[0]}static insertFirst(e,t){return t&&t.nodeType!==Node.ELEMENT_NODE&&t.tag&&(t=DomHelper.createElement(t)),e.insertBefore(t,e.firstElementChild)}static insertBefore(e,t,r){return t&&t.nodeType!==Node.ELEMENT_NODE&&t.tag&&(t=DomHelper.createElement(t)),r?e.insertBefore(t,r):DomHelper.insertFirst(e,t)}static append(e,t){return t&&("string"==typeof t?t=DomHelper.createElementFromTemplate(t):t.nodeType!==Node.ELEMENT_NODE&&t.tag&&(t=DomHelper.createElement(t))),Array.isArray(t)?t.map(t=>e.appendChild(t)):e.appendChild(t)}static getTranslateX(e){let t=e.style.transform,r=pxTtranslateXRe.exec(t);return r?parseInt(r[2]):(r=translateMatrixRe.exec(t)||translateMatrixRe.exec(this.getStyleValue(this.getElement(e),"transform")))?parseInt(r[1]||r[3]):0}static getTranslateY(e){let t=e.style.transform,r=pxTtranslateYRe.exec(t);if(r){const e=parseInt(r["Y"===r[1]?2:3]);return isNaN(e)?0:e}return(r=translateMatrixRe.exec(t)||translateMatrixRe.exec(this.getStyleValue(this.getElement(e),"transform")))?parseInt(r[2]||r[4]):0}static getTranslateXY(e){return[this.getTranslateX(e),this.getTranslateY(e)]}static getOffsetX(e,t=null){return t?e.getBoundingClientRect().left-t.getBoundingClientRect().left:e.offsetLeft}static getOffsetY(e,t=null){return t?e.getBoundingClientRect().top-t.getBoundingClientRect().top:e.offsetTop}static getOffsetXY(e,t=null){return[this.getOffsetX(e,t),this.getOffsetY(e,t)]}static focusWithoutScrolling(e){const t=win.pageXOffset,r=win.pageYOffset;e.focus({preventScroll:!0}),BrowserHelper.isChrome&&BrowserHelper.chromeVersion>=64||win.scrollTo(t,r)}static getPageX(e){return e.getBoundingClientRect().left+win.pageXOffset}static getPageY(e){return e.getBoundingClientRect().top+win.pageYOffset}static setTranslateX(e,t){const r=DomHelper.getStyleValue(e,"transform").split(/,\s*/);t=roundPx(t),r.length>1?(r[r[0].startsWith("matrix3d")?12:4]=t,e.style.transform=r.join(",")):e.style.transform=`translateX(${t}px)`}static setTranslateY(e,t){const r=DomHelper.getStyleValue(e,"transform").split(/,\s*/);t=roundPx(t),r.length>1?(r[r[0].startsWith("matrix3d")?13:5]=t,e.style.transform=r.join(",")+")"):e.style.transform=`translateY(${t}px)`}static setTop(e,t){this.setLength(e,"top",t)}static setLeft(e,t){this.setLength(e,"left",t)}static setTranslateXY(e,t,r){if(null==t)return this.setTranslateY(e,r);if(null==r)return this.setTranslateX(e,t);t=roundPx(t),r=roundPx(r);const n=DomHelper.getStyleValue(e,"transform").split(/,\s*/),i=n[0].startsWith("matrix3d");n.length>1?(n[i?12:4]=t,n[i?13:5]=r,e.style.transform=n.join(",")+")"):e.style.transform=`translateX(${t}px) translateY(${r}px)`}static addTranslateX(e,t){DomHelper.setTranslateX(e,DomHelper.getTranslateX(e)+t)}static addTranslateY(e,t){DomHelper.setTranslateY(e,DomHelper.getTranslateY(e)+t)}static addLeft(e,t){DomHelper.setLeft(e,DomHelper.getOffsetX(e)+t)}static addTop(e,t){DomHelper.setTop(e,DomHelper.getOffsetY(e)+t)}static getStyleValue(e,t,r,n){const i=r?e.style:e.ownerDocument.defaultView.getComputedStyle(e,n);if(Array.isArray(t)){let e={};for(let r of t)e[r]=i.getPropertyValue(StringHelper.hyphenate(r));return e}return i.getPropertyValue(StringHelper.hyphenate(t))}static applyStyle(e,t){if("string"==typeof t&&t.length)e.style.cssText+=t;else for(let r in t)"length"!==r&&"parentRule"!==r&&(e.style[StringHelper.hyphenate(r)]=t[r])}static addClasses(e,t){t.forEach(t=>e.classList.add(t))}static removeClasses(e,t){t.forEach(t=>e.classList.remove(t))}static toggleClasses(e,t,r=null){Array.isArray(t)||(t=[t]),!0===r?this.addClasses(e,t):!1===r?this.removeClasses(e,t):t.forEach(t=>e.classList.toggle(t))}static highlight(e){return e instanceof Rectangle?e.highlight():new Promise(t=>{setTimeout(()=>{e.classList.add("b-fx-highlight"),setTimeout(()=>{e.classList.remove("b-fx-highlight"),t()},1e3)},0)})}static get scrollBarWidth(){if(null===scrollBarWidth&&doc.body){const e=DomHelper.createElement({parent:doc.body,style:"position:absolute;top:-999px;width:100px;height:100px;overflow:scroll"});scrollBarWidth=e.offsetWidth-e.clientWidth,e.remove()}return scrollBarWidth}static resetScrollBarWidth(){scrollBarWidth=null}static measureText(e,t,r,n){const i=this.getMeasureElement(t,n);i[r?"innerHTML":"innerText"]=e;const s=i.clientWidth;return i.className="",s}static measureSize(e,t){if(!e)return 0;if("number"==typeof e)return e;if(!e.length)return 0;if(/^\d+(px)?$/.test(e))return parseInt(e);if(t){const r=this.getMeasureElement(t);r.innerHTML="",r.style.width=DomHelper.setLength(e);const n=r.offsetWidth;return r.style.width=r.className="",n}return/^\d+em$/.test(e)?parseInt(e)*DEFAULT_FONT_SIZE:isNaN(e)?0:parseInt(e)}static getMeasureElement(e,t=doc.body){const r=win.getComputedStyle(e),n=t.offScreenDiv=t.offScreenDiv||DomHelper.createElement({parent:t,style:"position:fixed;top:-10000px;left:-10000px;visibility:hidden;contain:strict",className:"b-measure-element",children:[{style:"white-space:nowrap;display:inline-block;will-change:contents;width:auto;contain:none"}]},!0)[1];return fontProps.forEach(e=>{n.style[e]!==r[e]&&(n.style[e]=r[e])}),n.className=e.className,n.parentElement.parentElement!==t&&t.appendChild(n.parentElement),n}static sync(e,t){let r=e;"string"==typeof r&&(r=this.createElementFromTemplate(e)),this.syncAttributes(r,t),this.syncContent(r,t),this.syncChildren(r,t)}static syncAttributes(e,t){const r=e.attributes||emptyArray,n=t.attributes||emptyArray,i=Object.values(r).map(e=>e.name),s=Object.values(n).map(e=>e.name),o=i.filter(e=>!s.includes(e)),a=s.filter(e=>!i.includes(e)),l=i.filter(e=>s.includes(e));if(o.length>0)for(let e=0;e<o.length;e++){let n=o[e];t.setAttribute(n,r[n].value)}if(a.length>0)for(let e=0;e<a.length;e++)t.removeAttribute(a[e]);if(l.length>0)for(let e=0;e<l.length;e++){let i=l[e];n[i].value!==r[i].value&&t.setAttribute(i,r[i].value)}}static syncContent(e,t){0===e.childElementCount&&t.childElementCount>0&&(t.innerHTML=""),0===e.childElementCount&&0===t.childElementCount&&e.childNodes.length&&(t.innerText=e.innerText)}static syncChildren(e,t){const r=this,n=arraySlice.call(e.childNodes),i=arraySlice.call(t.childNodes),s=Math.max(n.length,i.length);for(let e=0;e<s;e++){let s=e<n.length&&n[e],o=e<i.length&&i[e];if(s&&s.nodeType!==Node.TEXT_NODE&&s.nodeType!==Node.ELEMENT_NODE)throw new Error(`Source node type ${s.nodeType} not supported by DomHelper.sync()`);if(o&&o.nodeType!==Node.TEXT_NODE&&o.nodeType!==Node.ELEMENT_NODE)throw new Error(`Target node type ${o.nodeType} not supported by DomHelper.sync()`);if(s)if(o)if(s.nodeType===o.nodeType)s.nodeType===Node.TEXT_NODE?o.data=s.data:s.tagName===o.tagName?(r.syncAttributes(s,o),r.syncContent(s,o),r.syncChildren(s,o)):(t.insertBefore(s,o),o.remove());else{if(s.nodeType!==Node.TEXT_NODE||o.nodeType!==Node.ELEMENT_NODE)throw new Error("Currently no support for transforming nodeType");t.innerText=s.data.trim()}else t.appendChild(s);else o.remove()}}static syncClassList(e,t){const r=e.classList,n="string"==typeof t,i=n?t.trim().split(whiteSpaceRe$1):Array.isArray(t)?t:ObjectHelper.getTruthyKeys(t),s=i.length;let o,a=r.length!==s;for(o=0;!a&&o<s;o++)a=!r.contains(i[o]);a&&(e.className=n?t:i.join(" "))}static setTheme(e){e=e.toLowerCase();const t=this.themeInfo.name.toLowerCase(),r=document.head.querySelector("#bryntum-theme")||document.head.querySelector(`[href$="${t}.css"]`);if(!r||!r.href.includes(`${t}.css`))throw new Error(`Theme link for ${t} not found`);return r.href.includes(e)?immediatePromise:new Promise((t,n)=>{const i=document.createElement("link"),s=r.nextSibling,o=DomHelper.themeInfo.name.toLowerCase(),a={theme:e,prev:o};i.rel="stylesheet",i.id="bryntum-theme",i.addEventListener("load",()=>{themeInfo=null,r.remove(),window.bryntum.GlobalEvents.trigger("theme",a),t(a)}),i.addEventListener("error",e=>{n(e)}),i.href=r.href.replace(o,e),s.parentNode.insertBefore(i,s)})}static get themeInfo(){if(!themeInfo){const e=this.createElement({parent:document.body,className:"b-theme-info"}),t=this.getStyleValue(e,"content",!1,":before");if(t)try{themeInfo=JSON.parse(t.replace(/^["']|["']$|\\/g,""))}catch(e){themeInfo=null}e.remove()}return themeInfo}}let clearTouchTimer;const clearTouchEvent=()=>DomHelper.isTouchEvent=!1,setTouchEvent=()=>{DomHelper.isTouchEvent=!0,clearTimeout(clearTouchTimer),clearTouchTimer=setTimeout(clearTouchEvent,400)};if(doc.addEventListener("touchstart",setTouchEvent,!0),doc.addEventListener("touchend",setTouchEvent,!0),DomHelper.supportsTemplate="content"in doc.createElement("template"),!("children"in Node.prototype)){const e=e=>1===e.nodeType;Object.defineProperty(Node.prototype,"children",{get:function(){return Array.prototype.filter.call(this.childNodes,e)}})}if(Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){let t=(this.document||this.ownerDocument).querySelectorAll(e),r=t.length;for(;--r>=0&&t.item(r)!==this;);return r>-1}),win.Element&&!Element.prototype.closest?Node.prototype.closest=Element.prototype.closest=function(e){var t=this;if(!doc.documentElement.contains(t))return null;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null}:Node.prototype.closest=function(e){return this.parentNode.closest(e)},[Element.prototype,CharacterData.prototype,DocumentType.prototype].forEach(function(e){e.hasOwnProperty("remove")||Object.defineProperty(e,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){this.parentNode&&this.parentNode.removeChild(this)}})}),SVGElement.prototype.contains||(SVGElement.prototype.contains=function(e){do{if(this===e)return!0;e=e.parentNode}while(e);return!1}),"function"!=typeof win.CustomEvent){let e,t;win.CustomEvent=t=function(t,r={bubbles:!1,cancelable:!1,detail:void 0}){return(e=doc.createEvent("CustomEvent")).initCustomEvent(t,r.bubbles,r.cancelable,r.detail),e},t.prototype=win.Event.prototype,win.MouseEvent=t=function(t,r={bubbles:!1,cancelable:!1,detail:void 0}){return(e=doc.createEvent("MouseEvents")).initMouseEvent(t,r.bubbles,r.cancelable,doc.defaultView||win,r.detail,r.screenX,r.screenY,r.clientX,r.clientY,!1,!1,!1,!1,0,document),e},t.prototype=win.Event.prototype,win.KeyboardEvent=t=function(t,r={bubbles:!1,cancelable:!1,detail:void 0}){const n=`${r.shiftKey?"Shift ":""}${r.ctrlKey?"Control":""}`;return(e=doc.createEvent("KeyboardEvent")).initKeyboardEvent(t,r.bubbles,r.cancelable,doc.defaultView||win,r.key,r.location,n,!1,""),e},t.prototype=win.Event.prototype}if(BrowserHelper.isEdge&&(!Object.getOwnPropertyDescriptor(SVGElement.prototype,"dataset")||!Object.getOwnPropertyDescriptor(SVGElement.prototype,"dataset").get)){var propDescriptor={enumerable:!0,get:function(){var e,t,r,n,i,s={},o=this.attributes,a=o.length,l=function(e){return e.charAt(1).toUpperCase()},d=function(){return this},c=function(e,t){return void 0!==t?this.setAttribute(e,t):this.removeAttribute(e)};for(e=0;e<a;e++)(i=o[e])&&i.name&&/^data-\w[\w-]*$/.test(i.name)&&(t=i.value,n=(r=i.name).substr(5).replace(/-./g,l),Object.defineProperty(s,n,{enumerable:this.enumerable,get:d.bind(t||""),set:c.bind(this,r)}));return s}};Object.defineProperty(SVGElement.prototype,"dataset",propDescriptor)}const nativeAdd=DOMTokenList.prototype.add,nativeRemove=DOMTokenList.prototype.remove;DOMTokenList.prototype.add=function(e){Array.isArray(e)?nativeAdd.call(this,...e):nativeAdd.call(this,...arguments)},DOMTokenList.prototype.remove=function(e){Array.isArray(e)?nativeRemove.call(this,...e):nativeRemove.call(this,...arguments)},DomHelper._$name="DomHelper";class Mask extends(Delayable()){static get defaultConfig(){return{mode:"dark",icon:"b-icon b-icon-spinner",text:null}}construct(e){super.construct(e),this.element||(this.element=document.body),this.show()}doDestroy(){const e=this;e.maskElement&&(e.maskElement.remove(),e.maskElement=null,e.mode.endsWith("blur")&&DomHelper.forEachChild(e.element,t=>{t.classList.remove(`b-masked-${e.mode}`)}),e.element.mask=null),super.doDestroy()}create(){const e=this.element.mask=this;e.maskElement=DomHelper.createElement({parent:e.element,className:`b-mask b-widget b-mask-${e.mode}`}),e.text=e._text}static mask(e,t=document.body){return new Mask("string"!=typeof e?Object.assign({element:t},e):{element:t,text:e})}static unmask(e=document.body){return e.mask&&e.mask.close()}set text(e){let t=this;t._text=e||"",t.maskElement&&(t.maskElement.innerHTML=`<div class="b-mask-content"><i class="b-mask-icon ${t.icon}"></i>${t._text}</i>`)}get text(){return this._text}show(){const e=this;e.hasTimeout("hide")&&(e.resolve(),e.clearTimeout("hide")),e.element.mask||e.create();const{element:t,maskElement:r}=e;r&&(t.classList.add("b-masked"),r.classList.add("b-visible"),r.classList.remove("b-hidden"),e.shown=!0,e.mode.endsWith("blur")&&DomHelper.forEachChild(t,t=>{t!==r&&t.classList.add(`b-masked-${e.mode}`)}))}hide(){const e=this,{element:t,maskElement:r}=e;return new Promise(n=>{e.shown?(e.shown=!1,r.classList.remove("b-visible"),r.classList.add("b-hidden"),t.classList.remove("b-masked"),e.mode.endsWith("blur")&&DomHelper.forEachChild(t,t=>{t!==r&&t.classList.remove(`b-masked-${e.mode}`)}),e.resolve=n,e.setTimeout(()=>n(),500,"hide")):n()})}close(){return new Promise(e=>{this.hide().then(()=>{this.destroy(),e()})})}}Mask._$name="Mask";let resizeFireTimer=null;const resizedQueue=[],isAbsolutelyPositioned=e=>"absolute"===e.ownerDocument.defaultView.getComputedStyle(e).getPropertyValue("position");class ResizeMonitor{static addResizeListener(e,t){const r=this;if(e!==document&&e!==window||(e=document.body),e.classList.contains("b-resize-monitored")||(e.classList.add("b-resize-monitored"),e._bResizemonitor={handlers:[]}),e===document.body)r.hasWindowResizeListener||window.addEventListener("resize",r.onWindowResize);else if(window.ResizeObserver)r.resizeObserver||(r.resizeObserver=new ResizeObserver(r.onElementResize)),r.resizeObserver.observe(e);else{const[n,i,s]=DomHelper.createElement({parent:e,className:"b-resize-monitors",children:[{className:"b-resize-monitor-expand"},{className:"b-resize-monitor-shrink"}]},!0);i.scrollLeft=i.scrollTop=s.scrollLeft=s.scrollTop=1e6,i.addEventListener("scroll",r.onSizeMonitorScroll,!0),s.addEventListener("scroll",r.onSizeMonitorScroll,!0),(t.targetMutationMonitor=new MutationObserver(e=>{const t=[];for(let r of e)"childList"===r.type&&(t.push.apply(t,e.removedNodes),t.push.apply(t,e.addedNodes));t.length>0&&t.every(isAbsolutelyPositioned)||i.dispatchEvent(new CustomEvent("scroll",{}))})).observe(e,{childList:!0,subtree:!0}),t.monitorElement=n}e._bResizemonitor.handlers.push(t)}static removeResizeListener(e,t){if(e){e!==document&&e!==window||(e=document.body);const r=e._bResizemonitor;r&&r.handlers&&(ArrayHelper.remove(r.handlers,t),t.monitorElement&&(t.monitorElement.remove(),t.monitorElement=null),t.targetMutationMonitor&&t.targetMutationMonitor.disconnect(),r.handlers.length||this.resizeObserver&&this.resizeObserver.unobserve(e))}}static onElementResize(e){for(let t of e){let e=t.target,r=e._bResizemonitor,n=t.contentRect||e.getBoundingClientRect();if(e.offsetParent&&(!r.rectangle||n.width!==r.rectangle.width||n.height!==r.rectangle.height)){const t=r.rectangle;r.rectangle=n;for(let i of r.handlers)i(e,t,n)}}}static onSizeMonitorScroll(e){if(document.body.contains(e.target)){e.stopPropagation();const t=e.target.parentNode,r=t.parentNode,n=r._bResizemonitor,i=r.getBoundingClientRect();n.rectangle&&i.width===n.rectangle.width&&i.height===n.rectangle.height||(resizedQueue.push([r,n.rectangle,i]),n.rectangle=i,resizeFireTimer||(resizeFireTimer=requestAnimationFrame(ResizeMonitor.fireResizeEvents))),t.firstChild.scrollLeft=t.firstChild.scrollTop=t.childNodes[1].scrollTop=t.childNodes[1].scrollLeft=1e6}}static onWindowResize(e){let t=document.body,r=t._bResizemonitor,n=r.rectangle;r.rectangle=document.documentElement.getBoundingClientRect();for(let e of t._bResizemonitor.handlers)e(t,n,r.rectangle)}static fireResizeEvents(){for(let e of resizedQueue)for(let t of e[0]._bResizemonitor.handlers)t.apply(this,e);resizeFireTimer=null,resizedQueue.length=0}}ResizeMonitor._$name="ResizeMonitor";class Point extends Rectangle{static from(e){const t=e.changedTouches;return new Point(t?t[0].screenX:e.screenX,t?t[0].screenY:e.pageY)}constructor(e,t){super(e,t,0,0)}constrain(e){return this.x=Math.min(Math.max(this.x,e.x),e.right-1),this.y=Math.min(Math.max(this.y,e.y),e.bottom-1),this}toArray(){return[this.x,this.y]}}Point.__proto__.Point=Point,Point._$name="Point";class FunctionHelper{static curry(e){return function t(...r){return r.length>=e.length?e.apply(this,r):function(...e){return t.apply(this,r.concat(e))}}}static bindAll(e){for(let t in e)"function"==typeof e[t]&&(e[t]=e[t].bind(e))}static createInterceptor(e,t,r){return(...n)=>!1!==t.call(r,...n)&&e.call(r,...n)}static createSequence(e,t,r){return(...n)=>{const i=e.call(r,...n),s=t.call(r,...n);return void 0===s?i:s}}static createThrottled(e,t,r,n,i){let s,o,a,l=0;const d=()=>{o=0,l=performance.now(),s.push.apply(s,n),e.apply(r,s)};return(a=function(...e){let a=performance.now()-l;s=e,a>=t?(clearTimeout(o),d()):(o||(o=setTimeout(d,t-a)),i&&(s.push.apply(s,n),i.apply(r,s)))}).cancel=(()=>clearTimeout(o)),a}static createBuffered(e,t,r,n){let i,s,o;const a=()=>{s=0,i.push.apply(i,n),e.apply(r,i)};return(o=function(...e){i=e,s&&clearTimeout(s),s=setTimeout(a,t)}).cancel=(()=>clearTimeout(s)),o}static returnTrue(){return!0}static animate(e,t,r,n="linear"){let i=!1;const s=new Promise(s=>{const o=performance.now(),a=()=>{const l=Math.min((performance.now()-o)/e,1);i||!1===t.call(r,this.easingFunctions[n](l))&&s(),i||1===l?requestAnimationFrame(()=>s()):requestAnimationFrame(a)};a()});return s.cancel=(()=>(i=!0,!1)),s}}const half=.5,e1=1.70158,e2=7.5625,e3=1.525,e4=2/2.75,e5=2.25/2.75,e6=1/2.75,e7=1.5/2.75,e8=2.5/2.75,e9=2.625/2.75,e10=.75,e11=.9375,e12=.984375;FunctionHelper.easingFunctions={linear:e=>e,easeInQuad:e=>Math.pow(e,2),easeOutQuad:e=>-(Math.pow(e-1,2)-1),easeInOutQuad:e=>(e/=.5)<1?.5*Math.pow(e,2):-.5*((e-=2)*e-2),easeInCubic:e=>Math.pow(e,3),easeOutCubic:e=>Math.pow(e-1,3)+1,easeInOutCubic:e=>(e/=.5)<1?.5*Math.pow(e,3):.5*(Math.pow(e-2,3)+2),easeInQuart:e=>Math.pow(e,4),easeOutQuart:e=>-(Math.pow(e-1,4)-1),easeInOutQuart:e=>(e/=.5)<1?.5*Math.pow(e,4):-.5*((e-=2)*Math.pow(e,3)-2),easeInQuint:e=>Math.pow(e,5),easeOutQuint:e=>Math.pow(e-1,5)+1,easeInOutQuint:e=>(e/=.5)<1?.5*Math.pow(e,5):.5*(Math.pow(e-2,5)+2),easeInSine:e=>1-Math.cos(e*(Math.PI/2)),easeOutSine:e=>Math.sin(e*(Math.PI/2)),easeInOutSine:e=>-.5*(Math.cos(Math.PI*e)-1),easeInExpo:e=>0===e?0:Math.pow(2,10*(e-1)),easeOutExpo:e=>1===e?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>0===e?0:1===e?1:(e/=.5)<1?.5*Math.pow(2,10*(e-1)):.5*(2-Math.pow(2,-10*--e)),easeInCirc:e=>-(Math.sqrt(1-e*e)-1),easeOutCirc:e=>Math.sqrt(1-Math.pow(e-1,2)),easeInOutCirc:e=>(e/=.5)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1),easeOutBounce:e=>e<e6?e2*e*e:e<e4?e2*(e-=e7)*e+.75:e<e8?e2*(e-=e5)*e+e11:e2*(e-=e9)*e+e12,easeInBack:e=>e*e*((e1+1)*e-e1),easeOutBack:e=>(e-=1)*e*((e1+1)*e+e1)+1,easeInOutBack:e=>{let t=1.70158;return(e/=.5)<1?e*e*((1+(t*=e3))*e-t)*.5:.5*((e-=2)*e*((1+(t*=e3))*e+t)+2)},elastic:e=>-1*Math.pow(4,-8*e)*Math.sin((6*e-1)*(2*Math.PI)/2)+1,swingFromTo:e=>{let t=1.70158;return(e/=.5)<1?e*e*((1+(t*=e3))*e-t)*.5:.5*((e-=2)*e*((1+(t*=e3))*e+t)+2)},swingFrom:e=>e*e*((e1+1)*e-e1),swingTo:e=>(e-=1)*e*((e1+1)*e+e1)+1,bounce:e=>e<e6?e2*e*e:e<e4?e2*(e-=e7)*e+.75:e<e8?e2*(e-=e5)*e+e11:e2*(e-=e9)*e+e12,bouncePast:e=>e<e6?e2*e*e:e<e4?2-(e2*(e-=e7)*e+.75):e<e8?2-(e2*(e-=e5)*e+e11):2-(e2*(e-=e9)*e+e12),easeFromTo:e=>(e/=.5)<1?.5*Math.pow(e,4):-.5*((e-=2)*Math.pow(e,3)-2),easeFrom:e=>Math.pow(e,4),easeTo:e=>Math.pow(e,.25)},FunctionHelper._$name="FunctionHelper";const touchProperties=["clientX","clientY","pageX","pageY","screenX","screenY"],isOption={element:1,thisObj:1,once:1,delegate:1,delay:1,capture:1,passive:1,throttled:1,autoDetach:1},ctrlKeyProp={get:()=>!0},normalizedKeyNames={Spacebar:"Space",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown"},fixEvent=e=>{const{type:t}=e;if(t.startsWith("key")){const t=normalizedKeyNames[e.key];t&&Object.defineProperty(e,"key",{get:()=>t})," "!==e.key||e.code||Object.defineProperty(e,"code",{get:()=>"Space"})}if(e.metaKey&&!e.ctrlKey&&Object.defineProperty(e,"ctrlKey",ctrlKeyProp),e.target&&9===e.target.nodeType&&"clientX"in e){const t=document.elementFromPoint(e.clientX,e.clientY);Object.defineProperty(e,"target",{get:()=>t})}if(e.target&&3===e.target.nodeType){const t=e.target.parentElement;Object.defineProperty(e,"target",{get:()=>t})}if(e.relatedTarget&&3===e.relatedTarget.nodeType){const t=e.target.parentElement;Object.defineProperty(e,"relatedTarget",{get:()=>t})}return t.startsWith("touch")&&e.touches.length&&EventHelper.normalizeEvent(e),e};class EventHelper{static normalizeEvent(e){return ObjectHelper.copyPropertiesIf(e,e.touches[0]||e.changedTouches[0],touchProperties)}static getXY(e){return e.touches&&(e=e.touches[0]),[e.clientX,e.clientY]}static getDistanceBetween(e,t){const r=this.getXY(e),n=this.getXY(t);return Math.sqrt(Math.pow(r[0]-n[0],2)+Math.pow(r[1]-n[1],2))}static getPagePoint(e){return new Point(e.pageX,e.pageY)}static getClientPoint(e){return new Point(e.clientX,e.clientY)}static addListener(e,t,r,n){return n=e.nodeType?"string"==typeof t?Object.assign({element:e,[t]:r},n):Object.assign({element:e},t):e,this.on(n)}static on(e){const t=this,r=e.element,n=e.thisObj,i=[],s=ObjectHelper.allKeys(e);let o,a,l=s.length;for(o=0;o<l;o++)if(a=s[o],!isOption[a]){let s=e[a];"object"!=typeof s&&(s={handler:s});const o=s.element||r;BrowserHelper.isTouchDevice&&("contextmenu"===a?i.push(t.addElementListener(o,"touchstart",{handler:t.createContextMenuWrapper(s.handler,s.thisObj||n)},e)):"dblclick"===a&&i.push(t.addElementListener(o,"touchend",{handler:t.createDblClickWrapper(o,s.handler,s.thisObj||n),delay:10,capture:!0},e))),i.push(t.addElementListener(o,a,s,e))}const d=()=>{for(l=i.length,o=0;o<l;o++){const e=i[o];e[0].removeEventListener(e[1],e[2],e[3])}i.length=0};return n&&!1!==e.autoDetach&&(n.doDestroy=FunctionHelper.createInterceptor(n.doDestroy,d,n)),d}static addElementListener(e,t,r,n){const i=this.createHandler(e,t,r,n),s="passive"in r;let o=r.capture||n.capture;return(s||"passive"in n)&&BrowserHelper.supportsPassive&&(o={capture:!!o,passive:s?r.passive:n.passive}),e.addEventListener(t,i,o),[e,t,i,o]}static createHandler(e,t,r,n){const i=r.delay||n.delay,s=r.throttled||n.throttled,o=r.once||n.once,a=r.thisObj||n.thisObj,l=r.capture||n.capture,d=r.delegate||n.delegate;let c=r.handler,u=(e,...t)=>{if(!(this.playingDemo&&e.isTrusted||a&&a.isDestroyed)){if(fixEvent(e),d){const t=e.target instanceof HTMLElement&&e.target.closest(d);if(!t)return;Object.defineProperty(e,"currentTarget",{get:()=>t,configurable:!0})}"string"==typeof c&&(c=a[c]),c.call(a,e,...t)}};if(null!=i){const e=u;u=((...t)=>{setTimeout(()=>{e(...t)},i)})}if(null!=s){let e,t=s;s.buffer&&(e=(e=>s.alt.call(this,fixEvent(e))),t=s.buffer),u=FunctionHelper.createThrottled(u,t,a,null,e)}if(o){const r=u;u=((...n)=>{e.removeEventListener(t,u,l),r(...n)})}return r.thisObj&&!1!==r.autoDetach&&(a.doDestroy=FunctionHelper.createInterceptor(a.doDestroy,()=>e.removeEventListener(t,u),a)),u}static createContextMenuWrapper(e,t){const r=this;return n=>{if(1===n.touches.length){const i=n.touches[0],s=setTimeout(()=>{a();const s=new MouseEvent("contextmenu",i);Object.defineProperty(s,"target",{get:()=>i.target}),"string"==typeof e&&(e=t[e]),s.browserEvent=n,e.call(t,s),r.contextMenuTouchId=i.identifier},r.longPressTime),o=()=>{r.contextMenuTouchId=null,a(),clearTimeout(s)},a=r.on({element:document,touchmove:o,touchend:o,pointermove:o,pointerup:o,capture:!0})}}}static createDblClickWrapper(e,t,r){const n=this;let i,s,o;return()=>{s||(s=n.on({element:e,touchstart:e=>{i=e.changedTouches[0].identifier,e.preventDefault()},touchend:e=>{if(e.changedTouches[0].identifier===i){e.preventDefault(),clearTimeout(o),i=s=null;const n=Rectangle.from(e.changedTouches[0].target,null,!0),a=e.changedTouches[0].pageX-n.x,l=e.changedTouches[0].pageY-n.y,d=Object.assign({browserEvent:e},e),c=new MouseEvent("dblclick",d);Object.defineProperty(c,"target",{get:()=>e.target}),Object.defineProperty(c,"offsetX",{get:()=>a}),Object.defineProperty(c,"offsetY",{get:()=>l}),"string"==typeof t&&(t=r[t]),t.call(r,c)}},once:!0}),o=setTimeout(()=>{s(),i=s=null},n.dblClickTime))}}}EventHelper.longPressTime=500,EventHelper.dblClickTime=300,EventHelper.on({element:document,mousedown(){DomHelper.isTouchEvent||(DomHelper.usingKeyboard=!1,document.body.classList.remove("b-using-keyboard"))},touchmove(){DomHelper.usingKeyboard=!1,document.body.classList.remove("b-using-keyboard")},keydown(){DomHelper.usingKeyboard=!0,document.body.classList.add("b-using-keyboard")}}),BrowserHelper.isTouchDevice&&EventHelper.on({element:document,touchmove:e=>{e.target.closest(".b-dragging")&&e.preventDefault()},passive:!1,capture:!0}),EventHelper._$name="EventHelper";class CollectionFilter extends Base{static get defaultConfig(){return{property:null,value:null,operator:null,filterBy:null,convert:null,caseSensitive:!0,id:null}}construct(e){"function"==typeof e&&(e={filterBy:e}),super.construct(e)}get id(){return this._id||(this._id=this.property||IdHelper.generateId("b-filter"))}set id(e){this._id=e}onChange(e){const t=this;!t.isConfiguring&&t.owner&&!t.owner.isConfiguring&&t.owner.onFilterChanged&&t.owner.onFilterChanged(t,e)}get filterBy(){return this._filterBy||this.defaultFilterBy}set filterBy(e){this._filterBy=e}defaultFilterBy(e){return this[this.operator](this.convert(e[this.property]))}set property(e){this._property=e,this.onChange("property")}get property(){return this._property}set value(e){this._value=this.caseSensitive||"string"!=typeof e?e:e.toLowerCase(),this.onChange("value")}get value(){return this._value}set operator(e){this._operator=e,this.onChange("operator")}get operator(){return this._operator||("string"==typeof this.value?"*":"=")}convert(e){return this.caseSensitive||"string"!=typeof e?e:e.toLowerCase()}filter(e){return this.filterBy(e)}startsWith(e){return String(e).startsWith(this.value)}endsWith(e){return String(e).endsWith(this.value)}"="(e){return ObjectHelper.isEqual(e,this.value)}"!="(e){return!ObjectHelper.isEqual(e,this.value)}">"(e){return ObjectHelper.isMoreThan(e,this.value)}">="(e){return ObjectHelper.isMoreThan(e,this.value)||ObjectHelper.isEqual(e,this.value)}"<"(e){return ObjectHelper.isLessThan(e,this.value)}"<="(e){return ObjectHelper.isLessThan(e,this.value)||ObjectHelper.isEqual(e,this.value)}"*"(e){return ObjectHelper.isPartial(e,this.value)}static generateFiltersFunction(e){return e&&(e.length||e.count)?function(t){let r=!0;for(const n of e)if(n.disabled||(r=n.filter(t)),!r)break;return r}:FunctionHelper.returnTrue}}CollectionFilter._$name="CollectionFilter";class CollectionSorter extends Base{static get defaultConfig(){return{property:null,direction:"ASC",sortFn:null,convert:null,id:null,useLocaleSort:null}}construct(e){"function"==typeof e&&(e={sortFn:e}),super.construct(e)}get id(){return this._id||(this._id=this.property||IdHelper.generateId("b-sorter"))}set id(e){this._id=e}set sortFn(e){this._sortFn=e}get sortFn(){return this._sortFn?this._sortFn:this.defaultSortFn}defaultSortFn(e,t){const{convert:r,property:n,useLocaleSort:i}=this,s="desc"===this.direction.toLowerCase()?-1:1;if(e=e[n],t=t[n],r&&(e=r(e),t=r(t)),i&&null!=e&&null!=t){if(!0===i)return String(e).localeCompare(t);if("string"==typeof i)return String(e).localeCompare(t,i);if("object"==typeof i)return String(e).localeCompare(t,i.locale,i)}return(e>t?1:e<t?-1:0)*s}static generateSortFunction(e,t){const r=e.isCollection?e.values:e,n=r.length;return(e,i)=>{let s,o;for(o=0;o<n;++o)if(s=r[o].sortFn(e,i))return s;return t?t(e,i):0}}}CollectionSorter._$name="CollectionSorter";const return0=()=>0,reverseNumericSortFn=(e,t)=>t-e,filteredIndicesProperty=Symbol("filteredIndicesProperty"),emptyArray$1=Object.freeze([]),sortEvent=Object.freeze({action:"sort",added:emptyArray$1,removed:emptyArray$1,replaced:emptyArray$1}),filterEvent=Object.freeze({action:"filter",added:emptyArray$1,removed:emptyArray$1,replaced:emptyArray$1}),keyTypes={string:1,number:1},nonPrimitives=new WeakMap,safeIndexKey=e=>{if(e&&"object"==typeof e){let t=nonPrimitives.get(e);void 0===t&&(t=Symbol("bscik"),nonPrimitives.set(e,t)),e=t}return e};class Collection extends(Events(Base)){static get defaultConfig(){return{idProperty:"id",extraKeys:null,autoFilter:!0}}construct(e){this.generation=0,this._values=[],super.construct(e)}doDestroy(){super.doDestroy(),this._values.length=0,this.isFiltered&&(this._filteredValues.length=0,this.filters.destroy()),this._sorters&&this._sorters.destroy()}get isCollection(){return!0}clear(){const e=this,t=this._values.slice();e.totalCount&&(e._values.length=0,e._filteredValues&&(e._filteredValues.length=0),e._indicesInvalid=!0,e.generation++,e.trigger("change",{action:"clear",removed:t}))}replaceValues(e,t,r){const n=this;let i;n.isFiltered&&!r?(i=n._filteredValues,n._filteredValues=e):(i=n._values,n._values=e,n._filteredValues&&(n._filteredValues.length=0)),n._indicesInvalid=!0,n.generation++,t||n.trigger("change",{action:"replaceValues",removed:i,values:e,replaced:[]})}set values(e){this.splice(0,this._values.length,e)}get values(){return this.isFiltered?this._filteredValues:this._values}[Symbol.iterator](){return this.values[Symbol.iterator]()}forEach(e,t=!1){(this.isFiltered&&!t?this._filteredValues:this._values).forEach(e)}map(e,t=!1){return(this.isFiltered&&!t?this._filteredValues:this._values).map(e)}find(e,t=!1){return(this.isFiltered&&!t?this._filteredValues:this._values).find(e)}get first(){return this.values[0]}get last(){return this.values[this.count-1]}get allValues(){return this._values}add(...e){1===e.length?this.splice(this._values.length,null,...e):this.splice(this._values.length,null,e)}remove(...e){1===e.length?this.splice(0,...e):this.splice(0,e)}move(e,t){const r=this,{_values:n}=r,i=r.indexOf(e,!0);let s=t?r.indexOf(t,!0):n.length;if(-1===i||-1===s)throw new Error("Collection move parameters must be present in Collection");return i!==s&&i!==s-1&&(i<s&&s--,n.splice(i,1),n.splice(s,0,e),r._indicesInvalid=!0,r.trigger("change",{action:"move",item:e,from:i,to:s})),s}splice(e=0,t,...r){const n=this,i=n.idProperty,s=n._values,o={},a=[],l=[],d=n.totalCount;let c,u;if(r)if(1===r.length&&Array.isArray(r[0])&&(r=r[0]),d&&r.length){const e=n.indices[i];c=[];for(let t=0;t<r.length;t++){const n=r[t],a=safeIndexKey(n[i]),d=e[a];o[a]=!0,null!=d?s[d]!==n&&(l.push([s[d],n]),s[d]=n):c.push(n)}}else c=r;if(t)if("number"==typeof t)for(let r=e;t;--t){o[safeIndexKey(s[r][i])]?(e++,r++):(a.push(s[r]),s.splice(r,1),n._indicesInvalid=u=!0)}else{let e,r=0===c.length;Array.isArray(t)||(t=[t]);const l=t.reduce((t,i)=>{const s="number"==typeof i,o=s?i:n.indexOf(i,!0);return r&&(null!=e&&o!==e+1||s)&&(r=!1),o>=0&&o<d&&t.push(o),e=o,t},[]).sort(reverseNumericSortFn);if(r)l.length&&(a.push.apply(a,t),s.splice(l[l.length-1],l.length),n._indicesInvalid=u=!0);else for(let e=0;e<l.length;e++){const t=l[e];if(-1!==t){o[safeIndexKey(s[t][i])]||(a.unshift(s[t]),s.splice(t,1),n._indicesInvalid=u=!0)}}}c.length&&(s.splice(Math.min(e,s.length),0,...c),n._indicesInvalid=u=!0),n.isSorted?n.onSortersChanged():n.isFiltered&&(n.autoFilter?n.onFiltersChanged():n._filteredValues.push(...c)),(u||l.length)&&(n.generation++,n.trigger("change",{action:"splice",removed:a,added:c,replaced:l,oldCount:d}))}changeId(e,t){const r=this,{idProperty:n}=r,i=keyTypes[typeof e]?e:e[n],s=r.get(i);if(s){const e=r.get(t);if(e&&s!==e)throw new Error(`Attempt to set item ${i} to already existing member's id ${t}`);if(s[n]=t,!r._indicesInvalid){const e=r.indices.id,n=e[i];delete e[i],e[t]=n}}}get(e,t=!1){return this.getBy(this.idProperty,e,t)}getAt(e,t=!1){return this.isFiltered&&!t?this._filteredValues[e]:this._values[e]}getBy(e,t,r=!1){const n=this;if(n.isFiltered&&r){const r=n.findIndex(e,t,!0);if(-1!==r)return n._values[r]}else{const r=n.findIndex(e,t);if(-1!==r)return n.values[r]}}get count(){return this.values.length}get totalCount(){return this._values.length}set idProperty(e){this._idProperty=e,this.addIndex(e)}get idProperty(){return this._idProperty}set extraKeys(e){Array.isArray(e)||(e=[e]);for(let t=0;t<e.length;t++)this.addIndex(e[t])}get sorters(){return this._sorters||(this._sorters=new Collection({listeners:{change:"onSortersChanged",thisObj:this}})),this._sorters}addSorter(e){const t=e instanceof CollectionSorter?e:new CollectionSorter(e);return this.sorters.add(t),t}get isSorted(){return Boolean(this._sorters&&this._sorters.count)}onSortersChanged(){const e=this;delete e._sortFunction,e._values.sort(e.sortFunction),e._indicesInvalid=!0,e.trigger("change",sortEvent)}get sortFunction(){return this._sortFunction||(this.isSorted?this._sortFunction=CollectionSorter.generateSortFunction(this.sorters.values):this._sortFunction=return0),this._sortFunction}get filters(){return this._filters||(this._filters=new Collection({listeners:{change:"onFiltersChanged",thisObj:this}})),this._filters}addFilter(e){const t=e instanceof CollectionFilter?e:new CollectionFilter(e);return this.filters.add(t),t}get isFiltered(){return Boolean(this._filters&&this._filters.count)}onFiltersChanged(){const e=this;e._filterFunction=null,e._filteredValues=e._values.filter(e.filterFunction),e._indicesInvalid=!0,e.trigger("change",filterEvent)}get filterFunction(){return this._filterFunction||(this.isFiltered?this._filterFunction=CollectionFilter.generateFiltersFunction(this.filters.values):this._filterFunction=FunctionHelper.returnTrue),this._filterFunction}addIndex(e){(this._indices||(this._indices={}))[e]={},this._indicesInvalid=!0}findIndex(e,t,r=!1){const n=this,i=n.isFiltered,s=i&&!r?n.indices[filteredIndicesProperty][e]:n.indices[e];if(s){const e=s[safeIndexKey(t)];if(null!=e)return e}else{const s=i&&!r?n._filteredValues:n._values,o=s.length;for(let r=0;r<o;r++)if(s[r][e]==t)return r}return-1}indexOf(e,t=!1){return this.findIndex(this.idProperty,keyTypes[typeof e]?e:e[this.idProperty],t)}includes(e,t=!1){return-1!==this.indexOf(e,t)}get indices(){return this._indicesInvalid&&this.rebuildIndices(),this._indices}rebuildIndices(){const e=this,t=e.isFiltered,r=e._indices||(e._indices={}),n=Object.keys(r),i=n.length,s=e._values,o=s.length;let a,l;for(t&&(r[filteredIndicesProperty]={}),a=0;a<i;a++)r[n[a]]={},t&&(r[filteredIndicesProperty][n[a]]={});for(a=0;a<o;a++){const e=s[a];for(l=0;l<i;l++){const t=n[l];r[t][safeIndexKey(e[t])]=a}}if(t){const t=e._filteredValues,r=t.length,s=e._indices[filteredIndicesProperty];for(a=0;a<r;a++){const e=t[a];for(l=0;l<i;l++){const t=n[l];s[t][safeIndexKey(e[t])]=a}}}e._indicesInvalid=!1}}Collection._$name="Collection";const scrollLiterals={true:"auto",false:"hidden","hidden-scroll":"auto"},scrollerCls="b-widget-scroller",defaultScrollOptions={block:"nearest"},immediatePromise$1=new Promise(e=>e()),xAxis={x:1};class Scroller extends(Delayable(Events(Base))){get defaultConfig(){return{element:null,overflowX:null,overflowY:null,translate:null}}addPartner(e,t=xAxis){"string"==typeof t&&(t={[t]:1}),(this.partners||(this.partners=new Collection)).add({id:e.id,scroller:e,axes:t}),e.partners&&e.partners.includes(this.id)||e.addPartner(this,t)}removePartner(e){this.partners&&this.partners.includes(e)&&(this.partners.remove(e),e.removePartner(this))}scrollIntoView(e,t=defaultScrollOptions){const r=e instanceof Rectangle,n=r?e:Rectangle.from(e),{xDelta:i,yDelta:s}=this.getDeltaTo(e,t),o=this.scrollBy(i,s,t);return(t.highlight||t.focus)&&o.then(()=>{r&&(e=n.translate(-i,-s)),t.highlight&&DomHelper.highlight(e),t.focus&&e.focus()}),o}scrollBy(e=0,t=0,r=defaultScrollOptions){const n=this,i="object"==typeof r?r.animate:r,s=Math.abs(e),o=Math.abs(t);n.scrollAnimation&&(n.scrollAnimation.cancel(),n.scrollAnimation=null),(e||t)&&(n.silent=r.silent);let a=i&&("number"==typeof i?i:"number"==typeof i.duration?i.duration:300);if(a&&(s>10||o>10)){const{x:r,y:l}=n;let d=r,c=l;return Math.max(s,o)<50&&(a=Math.min(a,500)),n.scrollAnimation=FunctionHelper.animate(a,i=>{const s=1===i;if(e){if(n.x!==d)return n.scrollAnimation&&n.scrollAnimation.cancel();d=n.x=Math.max(r+(s?e:Math.round(e*i)),0)}if(t){if(n.y!==c)return n.scrollAnimation&&n.scrollAnimation.cancel();c=n.y=Math.max(l+(s?t:Math.round(t*i)),0)}},null,i.easing),n.scrollAnimation.then(()=>{n.scrollAnimation=null}),n.scrollAnimation}return n.x+=e,n.y+=t,immediatePromise$1}scrollTo(e,t,r){const{x:n,y:i}=this,s=null==e?0:e-n,o=null==t?0:t-i;return this.scrollBy(s,o,r)}doDestroy(){const e=this;e._element&&(e._element.removeEventListener("scroll",e.scrollHandler),e.wheelListenerRemover&&e.wheelListenerRemover()),e.scrollAnimation&&e.scrollAnimation.cancel(),e.partners&&e.partners.forEach(t=>t.scroller.removePartner(e)),super.doDestroy()}onElMutation(e){const t=this,[r,n]=DomHelper.getTranslateXY(t.element);if(t._x!==-r||t.y!==-n){const e=new CustomEvent("scroll",{bubbles:!0});Object.defineProperty(e,"target",{get:()=>t.element}),t.onScroll(e)}}onScroll(e){const t=this;t.widget&&t.widget.isDestroyed||(t.positionDirty=!0,e.widget=t.widget,t.silent||t.trigger("scroll",e),t.partners&&t.partners.forEach(({axes:e,scroller:r})=>{r!==t.controllingPartner&&r.sync(t,e)}),t.controllingPartner=null,t.scrollEndHandler(e))}onScrollEnd(e){this.silent&&(this.silent=!1),this.trigger("scrollEnd",e)}getDeltaTo(e,t){e instanceof Rectangle||(e=Rectangle.from(e));const r=this,n=t.block||"nearest",i=r.viewport,s=t.edgeOffset||0,o=i.width>=e.width+2*s?s:0,a=i.height>=e.height+2*s?s:0,l=e.clone().adjust(-o,-a,o,a).constrainTo(new Rectangle(i.x-r.x,i.y-r.y,r.scrollWidth,r.scrollHeight)),d=l.clone();let c=0,u=0;if("start"===n)d.moveTo(i.x,i.y),c=l.x-d.x,u=l.y-d.y;else if("end"===n)d.translate(i.right-d.right,i.bottom-d.bottom),c=l.x-d.x,u=l.y-d.y;else if("center"===n){const e=i.center;d.moveTo(e.x-d.width/2,e.y-d.height/2),c=l.x-d.x,u=l.y-d.y}else d.width<=i.width&&(d.right>i.right?c=d.right-i.right:d.x<i.x&&(c=d.x-i.x)),d.height<=i.height&&(d.bottom>i.bottom?u=d.bottom-i.bottom:d.y<i.y&&(u=d.y-i.y));return{xDelta:!1===t.x?0:Math.max(c,-r.x),yDelta:!1===t.y?0:Math.max(u,-r.y)}}get viewport(){return Rectangle.from(this.element)}get element(){return this._element}set element(e){const t=this,r=t.scrollHandler||(t.scrollHandler=t.onScroll.bind(t));if(t.scrollEndHandler||(t.scrollEndHandler=t.buffer(t.onScrollEnd,100)),t._element&&(t.translate?t.mutationObserver&&t.mutationObserver.disconnect(t._element):(t._element.removeEventListener("scroll",r),t._element.classList.remove(scrollerCls))),t._element=e,t.translate){if(t.mutationObserver||(t.mutationObserver=new MutationObserver(e=>t.onElMutation(e))),t.mutationObserver.observe(e,{attributes:!0}),t._x=t._y=0,document.contains(e)){const[r,n]=DomHelper.getTranslateXY(e);t._x=-r,t._y=-n}}else e.addEventListener("scroll",r),e.classList.add(scrollerCls);t.updateOverflowX(t.overflowX),t.updateOverflowY(t.overflowY)}get x(){const e=this,{element:t}=e;if(t&&e.positionDirty){if(e.translate){const[r,n]=DomHelper.getTranslateXY(t);e._x=-r,e._y=-n}else e._x=t.scrollLeft,e._y=t.scrollTop;e.positionDirty=!1}return e._x}set x(e){const{element:t}=this;this._x=e,t&&(this.translate?DomHelper.setTranslateX(t,-e):t.scrollLeft=e,this.positionDirty=!0)}sync(e,t){const{x:r,y:n}=t;this.controllingPartner=e,null!=r&&(this.x=e.x),null!=n&&(this.y=e.y)}get y(){const e=this,{element:t}=e;if(t&&e.positionDirty){if(e.translate){const[r,n]=DomHelper.getTranslateXY(t);e._x=-r,e._y=-n}else e._x=t.scrollLeft,e._y=t.scrollTop;e.positionDirty=!1}return e._y}set y(e){const{element:t}=this;this._y=e,t&&(this.translate?DomHelper.setTranslateY(t,-e):t.scrollTop=e,this.positionDirty=!0)}get maxX(){return this.scrollWidth-this.clientWidth}get maxY(){return this.scrollHeight-this.clientHeight}get overflowX(){return this._overflowX}set overflowX(e){this._overflowX=e,this.element&&this.updateOverflowX(e)}updateOverflowX(e){const{element:t,translate:r}=this;"hidden-scroll"!==e||r||(t.classList.add("b-hide-scroll"),this.enableWheel()),r||(t.style.overflowX=scrollLiterals[e]||e),this.positionDirty=!0}get overflowY(){return this._overflowY}set overflowY(e){this._overflowY=e,this.element&&this.updateOverflowY(e)}updateOverflowY(e){const{element:t,translate:r}=this;"hidden-scroll"!==e||r||(t.classList.add("b-hide-scroll"),this.enableWheel()),r||(t.style.overflowY=scrollLiterals[e]||e),this.positionDirty=!0}enableWheel(){this.wheelListenerRemover||(this.wheelListenerRemover=EventHelper.on({element:this.element,wheel:"onWheel",thisObj:this}))}onWheel(e){e.deltaX>e.deltaY&&!1!==this.overflowX?this.x+=e.deltaX:!1!==this.overflowY&&(this.y+=e.deltaY)}get scrollWidth(){return this.element?this.element.scrollWidth:0}set scrollWidth(e){const t=this;let r=t.widthStretcher;r&&null==e?(r.remove(),t.widthStretcher=null):(r||(r=t.widthStretcher=DomHelper.createElement({className:"b-scroller-stretcher"})),r.style.transform=`translateX(${e-1}px)`,t.element&&t.element.lastChild!==r&&t.element.appendChild(r))}get scrollHeight(){return this.element?this.element.scrollHeight:0}set scrollHeight(e){const t=this,r=t.stretcher||(t.stretcher=DomHelper.createElement({className:"b-scroller-stretcher"}));r.style.transform=`translateY(${e-1}px)`,t.element&&t.element.lastChild!==r&&t.element.appendChild(r)}get clientWidth(){return this.element?this.element.clientWidth:0}get clientHeight(){return this.element?this.element.clientHeight:0}get id(){return this._id||(this.widget?this._id=`${this.widget.id}-scroller`:this._id=IdHelper.generateId("scroller-")),this._id}}Scroller._$name="Scroller";const locale$1={localeName:"En",localeDesc:"English",TemplateColumn:{noTemplate:"TemplateColumn needs a template",noFunction:"TemplateColumn.template must be a function"},ColumnStore:{columnTypeNotFound:e=>`Column type '${e.type}' not registered`},InstancePlugin:{fnMissing:e=>`Trying to chain fn ${e.plugIntoName}#${e.fnName}, but plugin fn ${e.pluginName}#${e.fnName} does not exist`,overrideFnMissing:e=>`Trying to override fn ${e.plugIntoName}#${e.fnName}, but plugin fn ${e.pluginName}#${e.fnName} does not exist`},ColumnPicker:{columnsMenu:"Columns",hideColumn:"Hide column",hideColumnShort:"Hide"},Filter:{applyFilter:"Apply filter",filter:"Filter",editFilter:"Edit filter",on:"On",before:"Before",after:"After",equals:"Equals",lessThan:"Less than",moreThan:"More than",removeFilter:"Remove filter"},FilterBar:{enableFilterBar:"Show filter bar",disableFilterBar:"Hide filter bar"},Group:{groupAscending:"Group ascending",groupDescending:"Group descending",groupAscendingShort:"Ascending",groupDescendingShort:"Descending",stopGrouping:"Stop grouping",stopGroupingShort:"Stop"},Search:{searchForValue:"Search for value"},Sort:{sortAscending:"Sort ascending",sortDescending:"Sort descending",multiSort:"Multi sort",removeSorter:"Remove sorter",addSortAscending:"Add ascending sorter",addSortDescending:"Add descending sorter",toggleSortAscending:"Change to ascending",toggleSortDescending:"Change to descending",sortAscendingShort:"Ascending",sortDescendingShort:"Descending",removeSorterShort:"Remove",addSortAscendingShort:"+ Ascending",addSortDescendingShort:"+ Descending"},Tree:{noTreeColumn:"To use the tree feature one column must be configured with tree: true"},Grid:{featureNotFound:e=>`Feature '${e}' not available, make sure you have imported it`,invalidFeatureNameFormat:e=>`Invalid feature name '${e}', must start with a lowercase letter`,removeRow:"Delete row",removeRows:"Delete rows",loadMask:"Loading...",loadFailedMessage:"Data loading failed.",moveColumnLeft:"Move to left section",moveColumnRight:"Move to right section"},Field:{invalidValue:"Invalid field value",minimumValueViolation:"Minimum value violation",maximumValueViolation:"Maximum value violation",fieldRequired:"This field is required",validateFilter:"Value must be selected from the list"},DateField:{invalidDate:"Invalid date input"},TimeField:{invalidTime:"Invalid time input"},DateHelper:{locale:"en-US",shortWeek:"W",shortQuarter:"q",week:"Week",weekStartDay:0,unitNames:[{single:"millisecond",plural:"ms",abbrev:"ms"},{single:"second",plural:"seconds",abbrev:"s"},{single:"minute",plural:"minutes",abbrev:"min"},{single:"hour",plural:"hours",abbrev:"h"},{single:"day",plural:"days",abbrev:"d"},{single:"week",plural:"weeks",abbrev:"w"},{single:"month",plural:"months",abbrev:"mon"},{single:"quarter",plural:"quarters",abbrev:"q"},{single:"year",plural:"years",abbrev:"yr"}],unitAbbreviations:[["mil"],["s","sec"],["m","min"],["h","hr"],["d"],["w","wk"],["mo","mon","mnt"],["q","quar","qrt"],["y","yr"]]},BooleanCombo:{Yes:"Yes",No:"No"}};LocaleManagerSingelton.registerLocale("En",{desc:"English",locale:locale$1});let globaltouchStart,lastInteractionType,focusEventsSuspended=!1,GlobalEvents=(window.bryntum||(window.bryntum={})).GlobalEvents=new class extends(Events(Base)){suspendFocusEvents(){focusEventsSuspended=!0}resumeFocusEvents(){focusEventsSuspended=!1}get lastInteractionType(){return lastInteractionType}};function createWidgetEvent(e,t,r,n,i,s,o){const a=new CustomEvent(e,o);return Object.defineProperty(a,"target",{get:()=>t}),Object.defineProperty(a,"relatedTarget",{get:()=>r}),a.fromWidget=n,a.toWidget=i,a.backwards=s,a}function getCommonAncestor(e,t){if(e===t)return e;const r=e instanceof Widget;for(;e&&!e[r?"owns":"contains"](t)&&e!==t;)e=e[r?"owner":"parentNode"];return e}const listeners={element:document,touchstart(e){globaltouchStart=globaltouchStart||1!==e.changedTouches.length?null:e.changedTouches[0]},touchend:{handler:e=>{globaltouchStart&&(globaltouchStart.identifier===EventHelper.contextMenuTouchId?(e.stopImmediatePropagation(),e.preventDefault()):1===e.changedTouches.length&&e.changedTouches[0].identifier===globaltouchStart.identifier&&GlobalEvents.trigger("globaltap",{event:e}),globaltouchStart=null)},passive:!1},mousedown(e){lastInteractionType="mouse",globaltouchStart||GlobalEvents.trigger("globaltap",{event:e})},keydown(){lastInteractionType="key"},keypress(){lastInteractionType="key"},focusin(e){if(Widget.floatRoot.scrollTop=Widget.floatRoot.scrollLeft=0,focusEventsSuspended)return;const t=e.relatedTarget,r=e.target||document.body,n=IdHelper.fromElement(t),i=IdHelper.fromElement(r),s=getCommonAncestor(n,i),o=!!(t&&4&r.compareDocumentPosition(t));let a=createWidgetEvent("focusout",t,r,n,i,o);for(let e=n;e&&e!==s;e=e.owner)e.isDestroyed||e.isDestroying||e.onFocusOut&&e.onFocusOut(a);if(s&&e.target===s.element)document.activeElement===r&&s.focusElement&&s.focusElement!==s.element&&setTimeout(()=>s.focus&&s.focus(),0);else{a=createWidgetEvent("focusin",r,t,n,i,o);for(let e=i;e&&e!==s;e=e.owner)e.isDestroyed||e.isDestroying||e.onFocusIn&&e.onFocusIn(a)}const l=getCommonAncestor(t&&1===t.nodeType?t:null,r)||r.parentNode;a=createWidgetEvent("focusmove",r,t,n,i,o,{bubbles:!0}),l.dispatchEvent(a)},focusout(e){focusEventsSuspended||e.relatedTarget&&IdHelper.fromElement(e.relatedTarget)||listeners.focusin({target:e.relatedTarget,relatedTarget:e.target})},capture:!0,passive:!0};EventHelper.on(listeners);const isTransparent=/transparent|rgba\(0,\s*0,\s*0,\s*0\)/,textInputTypes={INPUT:1,TEXTAREA:1},widgetTriggerPaint=e=>e.isVisible&&e.trigger("paint"),negationPseudo=/^:not\((.+)\)$/,isRealigningFloater=e=>e.floating&&"realign"===e.scrollAction,dragGhost=DomHelper.createElement({html:"",style:"position:absolute;top:-10000em;left:-10000em"});class Widget extends(Delayable(Events(Localizable(Base)))){static get defaultConfig(){return{element:!0,callOnFunctions:!0,id:"",html:null,hasGeneratedId:null,cls:null,style:null,disabled:null,appendTo:null,insertBefore:null,insertFirst:null,dataset:null,tooltip:null,preventTooltipOnTouch:null,monitorResize:null,cache:{},floating:null,positioned:null,draggable:null,align:"t-b",centered:null,constrainTo:null,anchor:null,scrollAction:null,hideAnimation:null,showAnimation:null,x:null,y:null,scrollable:null,scrollerClass:Scroller,defaultBindProperty:"html",defaultAction:null,width:null,height:null,scaleToFitWidth:null,allowGrowWidth:!0,margin:null,flex:null,alignSelf:null,ripple:null,title:null,localizableProperties:["title"],requireSize:!1,ref:null}}construct(e={},...t){const r=this;r.alignConstrained=0,r.afterHideShowAnimate=r.afterHideShowAnimate.bind(r),r.callRealign=r.realign.bind(r),r.doHideOrRealign=r.doHideOrRealign.bind(r),r.initialRender=!0,r._isUserAction=!1,super.construct(e,t),r.finalizeInit()}isType(e,t){return IdHelper.isType(this,e,t)}startConfigure(e){super.startConfigure(e),this._thisIsAUsedExpression(this.element)}set title(e){this._title=e,this.titleElement&&(this.titleElement.innerHTML=e)}get title(){return this._title}get element(){return this._element}set element(e){const t=this;"string"==typeof e?e=DomHelper.createElementFromTemplate(e):"Object"===e.constructor.name?e=DomHelper.createElement(e):1!==e.nodeType&&(e=DomHelper.createElementFromTemplate(t.template(t))),t._element=e;const r=e.classList;e.id=t.id,e.className+=" "+t.widgetClassList.join(" "),t._hidden&&r.add("b-hidden"),t.parent||(r.add("b-outer"),BrowserHelper.isTouchDevice&&r.add("b-touch-events"),DomHelper.scrollBarWidth||r.add("b-overlay-scrollbar"),BrowserHelper.isChrome?r.add("b-chrome"):BrowserHelper.isSafari?r.add("b-safari"):BrowserHelper.isFirefox?r.add("b-firefox"):BrowserHelper.isIE11?r.add("b-ie"):BrowserHelper.isEdge&&r.add("b-edge"));const n=e.querySelectorAll("[reference]");for(const e of n){const r=e.getAttribute("reference");e.removeAttribute("reference"),t[r]=e,e.dataset&&(e.dataset.ownerCmp=t.id)}t.contentRange=BrowserHelper.isIE11?document.createRange():new Range}set constrainTo(e){this._constrainTo=e}get constrainTo(){return"_constrainTo"in this?this._constrainTo:window}set centered(e){if(this._centered=e,!this.floating)throw new Error("`centered` is only relevant when a Widget is `floating`");e?this.element.classList.add("b-centered"):this.element.classList.remove("b-centered")}get centered(){return this._centered}get contentElement(){return this.element}get id(){return this._id}set id(e){const t=this;t._id&&IdHelper.unregister(t),e||(e=IdHelper.generateId(`b-${t.$name.toLowerCase()}-`),t.hasGeneratedId=!0),t._id=e,IdHelper.register(t)}get style(){return this.element.ownerDocument.defaultView.getComputedStyle(this.element)}set style(e){DomHelper.applyStyle(this.element,e)}get dataset(){return this.element.dataset}set dataset(e){Object.assign(this.dataset,e)}finalizeInit(){(this.insertBefore||this.appendTo||this.insertFirst)&&this.render()}doDestroy(){const e=this,t=e._element;e.scrollable&&e.scrollable.destroy(),e._tooltip&&e._tooltip.destroy(),e.unmask(),t&&(e.removeTransientListeners(),e.revertFocus(),ResizeMonitor.removeResizeListener(t.parentElement,e.onParentElementResize),ResizeMonitor.removeResizeListener(t,e.onElementResize),t.remove(),e.dragEventDetacher&&e.dragEventDetacher(),e.dragOverEventDetacher&&e.dragOverEventDetacher(),dragGhost.remove()),IdHelper.unregister(e),super.doDestroy()}render(e,t=!0){const r=this,{element:n,contentRange:i,contentElement:s}=r;ResizeMonitor.removeResizeListener(n.parentElement,r.onParentElementResize),ResizeMonitor.removeResizeListener(n,r.onElementResize),r.emptyCache(),r.syncElement&&r.currentElement?DomHelper.sync(n,r.currentElement):(e?(r.appendTo="string"==typeof e?document.getElementById(e):e,r.appendTo.appendChild(n)):r.insertBefore?(r.insertBefore="string"==typeof r.insertBefore?document.getElementById(r.insertBefore):r.insertBefore,r.insertBefore.parentElement.insertBefore(n,r.insertBefore)):r.insertFirst?(r.insertFirst="string"==typeof r.insertFirst?document.getElementById(r.insertFirst):r.insertFirst,r.insertFirst.firstChild?r.insertFirst.insertBefore(n,r.insertFirst.firstChild):r.insertFirst.appendChild(n)):r.appendTo&&(r.appendTo="string"==typeof r.appendTo?document.getElementById(r.appendTo):r.appendTo,r.appendTo.appendChild(n)),r.currentElement=n),"contentRangeStart"in r?(i.setStart(s,r.contentRangeStart),i.setEnd(s,r.contentRangeEnd)):(i.setStart(r.contentElement,0),i.setEnd(r.contentElement,r.contentElement.childNodes.length)),r.scaleToFitWidth?(r.onParentElementResize=r.onParentElementResize.bind(r),ResizeMonitor.addResizeListener(n.parentElement,r.onParentElementResize),r.isVisible&&r.updateScale()):r.monitorResize&&(r.onElementResize=r.onElementResize.bind(r),ResizeMonitor.addResizeListener(n,r.onElementResize),ResizeMonitor.onElementResize([{target:n}])),t&&r.triggerPaint()}template(e){return`<div class="${e.html?"b-html":""}" ${e.name?`data-name="${e.name}"`:""}>${e.html||""}</div>`}alignTo(e){(1===e.nodeType||e instanceof Widget||e instanceof Point)&&(e={target:e}),this.releaseSizeConstraints();const t=this,{scrollable:r,element:n}=t,i=e.target,s=i&&(i instanceof Rectangle?i:i.element||i),o=Rectangle.from(n,t.positioned?n.offsetParent:null,!0),a=s&&1===s.nodeType;if(e=Object.assign({constrainTo:t.positioned?null:t.constrainTo,axisLock:t.axisLock,anchor:t.anchor},"object"==typeof t.align?t.align:{align:t.align},e),o.minWidth=e.minWidth||t.minWidth,o.minHeight=e.minHeight||t.minHeight,t.lastAlignSpec=e,a&&s.offsetParent){(e=Object.setPrototypeOf({},e)).target=Rectangle.from(s,t.positioned?n.offsetParent:null,!t.positioned),e.target.height=Math.max(e.target.height,1),e.target.width=Math.max(e.target.width,1);const r=t.clippedBy;if(r){const n=e.target.intersect(r);if(!n){const e=t.hide();return t.lastAlignSpec.targetHidden=!0,e}e.target=n}t.anchoredTo=s}else t.anchoredTo=null;e.anchor&&(e.anchorSize=t.anchorSize,n.appendChild(t.anchorElement)),t.isAligning=!0,t.trigger("beforeAlign",e),t.isAligning=!1;const{constrainTo:l}=e,d=l===window||l===document,c=o.alignTo(e);let{align:u,anchor:h,x:g,y:m,width:p,height:f,bottom:v,right:y}=c;if(t.lastAlignSpec.zone=c.zone,f!==o.height&&("configuredHeight"in t||(t.configuredHeight=n.style.height),t.height=f,t.alignConstrained=1|t.alignConstrained,r&&(r.overflowY=!0)),p!==o.width&&("configuredWidth"in t||(t.configuredWidth=n.style.width),t.width=p,t.alignConstrained=2|t.alignConstrained,r&&(r.overflowX=!0)),u&&t.alignConstrained){e.align=u;const r=Rectangle.from(n,t.positioned?n.offsetParent:null,!0).alignTo(e);h=r.anchor,g=r.x,m=r.y,p=r.width,f=r.height,v=r.bottom,y=r.right}if(t.setXY(g,m),h){const{edge:e}=h,{anchorElement:r}=t,i=[],s=n.style.pointerEvents;n.style.pointerEvents="all","top"===e||"bottom"===e?(i[0]=g+h.x,i[1]="top"===e?m+1:v-1):(i[0]="left"===e?g+1:y-1,i[1]=m+h.y);const o=document.elementFromPoint(...i);if(n.style.pointerEvents=s||null,o){const e=DomHelper.getStyleValue(o,"background-color");e.match(isTransparent)?t.anchorPathElement.setAttribute("fill",t.defaultAnchorBackgroundColor):t.anchorPathElement.setAttribute("fill",e)}r.classList.remove("b-hide-display"),r.style.transform="",r.className=`b-anchor b-anchor-${e}`,DomHelper.setTranslateXY(r,h.x,h.y)}else t._anchorElement&&t.anchorElement.classList.add("b-hide-display");"hide"!==t.scrollAction||a||(n.style.pointerEvents="none",t.anchoredTo=document.elementFromPoint(g,m),n.style.pointerEvents=""),("realign"===t.scrollAction&&a||"hide"===t.scrollAction)&&!t.documentScrollListener&&t.setTimeout(()=>{document.addEventListener("scroll",t.doHideOrRealign,!0),t.documentScrollListener=!0},0),!l||1!==l.nodeType&&!d||t.constrainListeners||(ResizeMonitor.addResizeListener(l,t.callRealign),d||t.constrainMutationMonitor||(t.constrainMutationMonitor=new MutationObserver(t.callRealign)).observe(l,{attributes:!0,childList:!0}),t.constrainListeners=!0)}realign(e){const t=this;if(t.isVisible&&(t.floating||t.positioned)&&t.lastAlignSpec){const r=t.lastAlignSpec.target;if(r&&1===r.nodeType){const n=Rectangle.from(r);if(n.minHeight=n.minWidth=1,r!==document.body&&!r.offsetParent||e&&1===e.nodeType&&e.contains(r)&&!Rectangle.from(e).intersect(n))return t.hide()}t.alignTo(t.lastAlignSpec)}}releaseSizeConstraints(){const e=this,t=e.scrollable;1&e.alignConstrained&&(e.height=e.configuredHeight,t&&(t.overflowY=t.config.overflowY)),2&e.alignConstrained&&(e.width=e.configuredWidth,t&&(t.overflowX=t.config.overflowX)),e.alignConstrained=0}toFront(){this.element&&this.element.nextSibling&&this.element.parentNode.appendChild(this.element)}set ref(e){this._ref=e,this.element.dataset.ref=e}get ref(){return this._ref}set clippedBy(e){this._clippedBy=Array.isArray(e)?e:e?[e]:null}get clippedBy(){const e=this._clippedBy;if(e){let t,r=Rectangle.from(e[0],null,!0);for(t=1;t<e.length;t++)r=r.intersect(Rectangle.from(e[t],null,!0));return r}}get overflowElement(){return this.contentElement}get maxHeightElement(){return this.element}set scrollable(e){const t=this.overflowElement;"boolean"==typeof e&&(e={overflowX:e,overflowY:e}),t&&(e.element=t),e.widget=this,this._scrollable=new this.scrollerClass(e)}get scrollable(){return this._scrollable}get html(){return this.initializingElement||!this.element?this.content||this._html:this.contentElement.innerHTML}set html(e){const t=this,r=null==e,{element:n,contentElement:i}=t;if(t._html!==e&&(t._html=e,n)){const s=i===n&&t._anchorElement;n.classList[r?"remove":"add"]("b-html"),s&&t.element.removeChild(s),t.contentElement.innerHTML=r?"":e,s&&n.appendChild(s),(t.floating||t.positioned)&&(t.isAligning||t.realign())}}set content(e){const t=this,r=null==e,{element:n}=t;if(t._html!==e&&(t._html=e,n)){let{contentRange:i}=t;n.classList[r?"remove":"add"]("b-html"),i.deleteContents(),r||i.insertNode(DomHelper.createElementFromTemplate(e,{fragment:!0})),t.isAligning&&!t.positioned||t.realign()}}onThemeChange(){this.anchorElement&&this.anchorElement.offsetParent&&(this._anchorSize=null,this.realign())}get anchorSize(){const e=this;let t=this._anchorSize;if(!t){const r=parseFloat(DomHelper.getStyleValue(e.element,"border-top-width")),n=DomHelper.getStyleValue(e.element,"border-top-color"),i=e.anchorElement,s=i.firstElementChild,o=e.anchorPathElement=s.lastElementChild,a=e._hidden;let l=DomHelper.getStyleValue(e.contentElement,"background-color");l.match(isTransparent)&&(l=DomHelper.getStyleValue(e.element,"background-color")),e.defaultAnchorBackgroundColor=l,t=i.getBoundingClientRect();const[d,c]=t=e._anchorSize=[t.width,t.height];s.setAttribute("height",c+r),s.setAttribute("width",d),o.setAttribute("d",`M0,${c}L${d/2},0.5L${d},${c}`),r&&(o.setAttribute("stroke-width",r),o.setAttribute("stroke",n)),t[1]-=r,a&&e.element.classList.add("b-hidden"),e.themeChangeListener||(e.themeChangeListener=GlobalEvents.on({theme:"onThemeChange",thisObj:e}))}return e.anchorPathElement.setAttribute("fill",e.defaultAnchorBackgroundColor),t}get anchorElement(){let e=this._anchorElement;return e||(e=this._anchorElement=DomHelper.createElement({parent:this.element,className:"b-anchor b-anchor-top",children:[{tag:"svg",ns:"http://www.w3.org/2000/svg",version:"1.1",class:"b-pointer-el",children:[{tag:"defs",children:[{tag:"filter",id:"shadow-filter",children:[{tag:"feDropShadow",dx:0,dy:-1,stdDeviation:2,"flood-opacity":.05}]}]},{tag:"path",filter:BrowserHelper.isIE11||BrowserHelper.isEdge?null:"url(#shadow-filter)"}]}]})),e}set anchor(e){this._anchor=e,this._anchorElement&&this._anchorElement.classList[e?"remove":"add"]("b-hide-display")}get draggable(){return this._draggable}set draggable(e){const t=this,{element:r}=t;t._draggable=e,r.setAttribute("draggable",Boolean(e)),e?t.dragEventDetacher=EventHelper.addListener({element:t.element,dragstart:t.onWidgetDragStart,dragend:t.onWidgetDragEnd,thisObj:t}):(t.dragEventDetacher&&t.dragEventDetacher(),t.dragOverEventDetacher&&t.dragOverEventDetacher())}onWidgetDragStart(e){const t=this,r=document.elementFromPoint(e.clientX,e.clientY),{handleSelector:n}=t.draggable;if(n){const i=negationPseudo.exec(n)[1];if(i){if(r.closest(`#${t.element.id} ${i}`))return void e.preventDefault()}else if(!r.closest(`#${t.element.id} ${n}`))return void e.preventDefault()}t.removeTransientListeners();const i=e.clientX,s=e.clientY,o=document.scrollingElement||document.body,a=t.getXY()[0],l=t.getXY()[1];document.body.appendChild(dragGhost),e.dataTransfer.setDragImage&&(e.dataTransfer.setData("application/node type",""),e.dataTransfer.setDragImage(dragGhost,0,0)),e.dataTransfer.effectAllowed="none",t.dragOverEventDetacher=EventHelper.addListener({element:document.body,dragover:e=>t.setXY(a+e.clientX-i-o.scrollLeft,l+e.clientY-s-o.scrollTop)}),t.anchor=null}onWidgetDragEnd(e){dragGhost.remove(),this.dragOverEventDetacher()}get anchor(){return this._anchor}get floating(){return this._floating}set floating(e){e=Boolean(e),Boolean(this.floating)!==e&&(this._floating=e)}get positioned(){return this._positioned}set positioned(e){e=Boolean(e),Boolean(this.positioned)!==e&&(this.element.classList[e?"add":"remove"]("b-positioned"),this._positioned=e)}getXY(){return[DomHelper.getPageX(this.element),DomHelper.getPageY(this.element)]}setXY(e,t){const r=this;(r.floating||r.positioned)&&(null!=e&&(r._x=e),null!=t&&(r._y=t),DomHelper.setTranslateXY(r.element,r._x||0,r._y||0))}set x(e){this.setXY(e)}get x(){return this.getXY()[0]}set y(e){this.setXY(null,e)}get y(){return this.getXY()[1]}get width(){const e=this,t=e.element;return e.monitorResize?(null==e._width&&(e._width=t.offsetWidth),e._width):t.offsetWidth}set width(e){DomHelper.setLength(this.element,"width",e),this._width=null,this.element.style.flex=BrowserHelper.isIE11?"":null}get maxWidth(){return DomHelper.measureSize(this.element.style.maxWidth,this.element)}set maxWidth(e){DomHelper.setLength(this.element,"maxWidth",e)}get minWidth(){return DomHelper.measureSize(this.element.style.minWidth,this.element)}set minWidth(e){DomHelper.setLength(this.element,"minWidth",e)}get flex(){return this._flex}set flex(e){this._flex=e,("number"==typeof e||"string"==typeof e&&1===e.split(/\s/).length)&&(e=`${e} ${e}`),this.element.style.flex=e,this.element.style.width=BrowserHelper.isIE11?"":null}get alignSelf(){return this._alignSelf}set alignSelf(e){this.element.style.alignSelf=e}get margin(){return this._margin}set margin(e){this.element.style.margin=this._margin=this.parseTRBL(e).join(" ")}get height(){const e=this,t=e.element;return e.monitorResize?(null==e._height&&(e._height=t.offsetHeight),e._height):t.offsetHeight}set height(e){DomHelper.setLength(this.element,"height",e),this._height=null}get maxHeight(){return DomHelper.measureSize(this.maxHeightElement.style.maxHeight,this.element)}set maxHeight(e){const t=this,{element:r}=t;DomHelper.setLength(t.maxHeightElement,"maxHeight",e),BrowserHelper.isIE11&&t.contentElement!==r&&(null==e?ResizeMonitor.removeResizeListener(r,t.boundMaxHeightBugHandler):(ResizeMonitor.addResizeListener(r,t.boundMaxHeightBugHandler||(t.boundMaxHeightBugHandler=t.fixIEMaxHeightBug.bind(t))),document.body.contains(r)&&t.fixIEMaxHeightBug()))}fixIEMaxHeightBug(){const{element:e,contentElement:t}=this;if("column"===DomHelper.getStyleValue(e,"flex-direction")){t.style.maxHeight="";let r=Rectangle.client(e).height;const n=e.childNodes,i=n.length;for(let e=0;e<i;e++){const i=n[e];i===t||i.classList.contains("b-resize-monitors")||(r-=i.offsetHeight)}this.contentElement.style.maxHeight=`${r}px`}}get minHeight(){return DomHelper.measureSize(this.element.style.minHeight,this.element)}set minHeight(e){DomHelper.setLength(this.element,"minHeight",e)}get disabled(){return this._disabled}set disabled(e){const t=this.element,r=this.focusElement;e&&this.revertFocus(),t&&(t.classList[e?"add":"remove"]("b-disabled"),r&&(r.disabled=e)),this._disabled=e}disable(){this.disabled=!0}enable(){this.disabled=!1}get tooltip(){return this._tooltip}set tooltip(e){const t=this;t._tooltip&&(t._tooltip.destroy(),t._tooltip=null),!e||t.preventTooltipOnTouch&&BrowserHelper.isTouchDevice||("Object"!==e.constructor.name&&(e={html:"string"==typeof e?e:t.placeholder,textContent:!0}),e.type="tooltip",e.forElement||(e.forElement=t.element),"showOnHover"in e||(e.showOnHover=!0),"autoClose"in e||(e.autoClose=!0),t._tooltip=WidgetHelper.createWidget(e))}get isVisible(){const e=this.element;let t=e&&!this._hidden;if(t&&(!document.body.contains(e)||this.requireSize&&0===e.offsetWidth&&0===e.offsetHeight)&&(t=!1,window.ShadowRoot)){let r=e;for(;r=r.parentNode;)r instanceof window.ShadowRoot&&(t=!0)}return t}focus(){this.isFocusable&&DomHelper.focusWithoutScrolling(this.focusElement)}get focusElement(){}get isFocusable(){const e=this.focusElement;return e&&this.isVisible&&!this.disabled&&(e===document.body||e.offsetParent)}show(){return new Promise(e=>{const t=this,{showAnimation:r,element:n}=t,i=Widget.floatRoot,s=n.style;let o,a;t.isVisible||!1===t.trigger("beforeShow")||(t.cancelHideShowAnimation(),r&&(a=r[o=Object.keys(r)[0]],t.currentAnimation={styleProp:o},n.addEventListener("transitionend",t.afterHideShowAnimate),s[o]=a.from),t.floating&&(i.contains(n)||t.render(i),document.body.contains(i)||document.body.appendChild(i)),t._hidden=!1,n.classList.remove("b-hidden"),r&&(s.transition=`${o} ${a.duration} ease ${a.delay}`,s[o]=a.to),t.afterShow(e),!t.inShowBy&&t.floating&&t.forElement&&t.alignTo(t.forElement))})}showBy(e){const t=this;t.inShowBy=!0,t.show(),t.inShowBy=!1,t.isVisible&&t.alignTo(e)}showByPoint(e,t,r){const n=1===arguments.length?e:[e,t];this.showBy(Object.assign({target:new Rectangle(n[0],n[1],1,1),align:"t-b"},r))}afterShow(e){this.boundMaxHeightBugHandler&&this.boundMaxHeightBugHandler(),this.trigger("show"),this.triggerPaint(),e()}triggerPaint(){const e=this;e.isVisible&&(e.trigger("paint"),e.eachWidget&&e.eachWidget(widgetTriggerPaint,!0))}cancelHideShowAnimation(){const e=this,t=e.element,r=t.style;e.currentAnimation&&(t.classList.remove("b-hiding"),t.removeEventListener("transitionend",e.afterHideShowAnimate),r.transition=r[e.currentAnimation.styleProp]="",e.currentAnimation=null)}afterHideShowAnimate(e){if(this.isDestroyed)return;const t=this,r=t.element,n=r.style,{styleProp:i,resolve:s}=t.currentAnimation;e.target===r&&e.propertyName===i&&(r.classList.remove("b-hiding"),t.currentAnimation=null,r.removeEventListener("transitionend",t.afterHideShowAnimate),n.transition=n[i]="",t._hidden&&(t.afterHideAnimation(),t.afterHide(s)))}hide(){return new Promise(e=>{const t=this,r=t.element,n=r.style,i=t.hideAnimation;if(!t._hidden&&!1!==t.trigger("beforeHide")){if(t._hidden=!0,!r)return;if(t.revertFocus(),t.isDestroyed)return void e();if(t.currentAnimation&&t.cancelHideShowAnimation(),i){const s=Object.keys(i)[0],o=i[s];t.currentAnimation={styleProp:s,resolve:e},r.classList.add("b-hiding"),r.addEventListener("transitionend",t.afterHideShowAnimate),n[s]=o.from,n.transition=`${s} ${o.duration} ease ${o.delay}`,t.requestAnimationFrame(()=>{n[s]=o.to})}else r.classList.add("b-hidden");t.afterHide(!i&&e)}})}doHideOrRealign(e){const t=this,r=t.anchoredTo,n=document.activeElement;9===e.target.nodeType&&t.element.contains(n)&&textInputTypes[n]&&window.innerHeight<document.body.offsetHeight||("hide"!==t.scrollAction||r&&!DomHelper.isDescendant(e.target,r)?"realign"===t.scrollAction&&(DomHelper.isDescendant(e.target,r)||IdHelper.fromElement(r,isRealigningFloater))&&e.target!==(document.scrollingElement||document.body)&&t.realign(e.target):t.hide())}afterHide(e=null){const t=this,{lastAlignSpec:r}=t;r&&(r.targetHidden=null),t.removeTransientListeners(),t.hideAnimation||t.afterHideAnimation(),t.trigger("hide"),e&&e()}removeTransientListeners(){const e=this;e.documentScrollListener&&(document.removeEventListener("scroll",e.doHideOrRealign,!0),e.documentScrollListener=!1),e.constrainListeners&&(ResizeMonitor.removeResizeListener(e.lastAlignSpec.constrainTo,e.callRealign),e.constrainMutationMonitor&&e.constrainMutationMonitor.disconnect(),e.constrainListeners=!1)}afterHideAnimation(){const e=this,{element:t,contentRange:r}=e;e.floating&&Widget.floatRoot.contains(t)?(r&&(e.contentRangeStart=r.start,e.contentRangeEnd=r.end),t.remove()):t.classList.add("b-hidden")}set visible(e){this.isConfiguring?this._hidden=!e:e?this.show():this.hide()}set hidden(e){this.isConfiguring?(this._hidden=e,this.element.classList[e?"add":"remove"]("b-hidden")):e?this.hide():this.show()}get assignedId(){return this.hasGeneratedId?null:this.id}get owner(){return this.parent||this._owner||IdHelper.fromElement(this.forElement||this.element.parentNode)}set owner(e){this._owner=e}up(e,t,r){const n=typeof r,i="number"===n,s="string"===n;for(let n=this.owner,o=1;n;n=n.owner,o++){if(widgetMatches(n,e,t))return n;if(i&&o>=r)return;if(s&&widgetMatches(n,r,t))return;if(n===r)return}}owns(e){if(e&&1===e.nodeType){if(this.element.contains(e))return!0;e=IdHelper.fromElement(e)}for(;e;){if(e===this)return!0;e=e.owner}return!1}onFocusIn(e){const t=this,{element:r}=t;t.containsFocus=!0,t.focusInEvent=e,r.classList.add("b-contains-focus"),r.contains(e.target)&&t.onInternalKeyDown&&!t.keyDownListenerRemover&&(t.keyDownListenerRemover=EventHelper.on({element:r,keydown:"onInternalKeyDown",thisObj:t})),t.trigger("focusin",e)}onFocusOut(e){const t=this;t.keyDownListenerRemover&&(t.keyDownListenerRemover(),t.keyDownListenerRemover=null),t.isDestroyed||(t.containsFocus=!1,t.focusInEvent=null,t.element.classList.remove("b-contains-focus"),t.trigger("focusout",e))}revertFocus(){this.focusInEvent&&this.focusInEvent.relatedTarget&&1===this.focusInEvent.relatedTarget.nodeType&&this.element.contains(document.activeElement)&&DomHelper.focusWithoutScrolling(this.focusInEvent.relatedTarget)}isFocused(){return this.element.classList.contains("b-contains-focus")}get widgetClassList(){const e=this;let t=e.cls,r=e.classHierarchy(Widget).reduce((t,r)=>{let n,i=Reflect.getOwnPropertyDescriptor(r.prototype,"widgetClass");return(n=i&&i.get?i.get.call(e):`b-${r.$name.toLowerCase()}`)&&t.push(...n.split(" ")),t},t?t.split(" "):[]);return e.floating&&r.push("b-floating"),BrowserHelper.isTouchDevice&&r.push("b-touch"),r}fromCache(e,t=!1,r=this.element){if(!r)return null;const n=this;return n.cache[e]||(n.cache[e]=t?DomHelper.children(r,e):DomHelper.down(r,e)),n.cache[e]}emptyCache(){this.cache={}}mask(e){const t=this;return t.maskInstance&&t.maskInstance.destroy(),"string"==typeof e?t.maskInstance=WidgetHelper.mask(t.element,e):(e.element=t.element,t.maskInstance=WidgetHelper.mask(e))}unmask(){this.maskInstance&&(WidgetHelper.unmask(this.element),this.maskInstance=null)}onInternalResize(e,t,r,n,i){this._width=e.offsetWidth,this._height=e.offsetHeight}onElementResize(e){const t=this,r=t.element,n=t._width,i=t._height,s=r.offsetWidth,o=r.offsetHeight;t.suspendResizeMonitor||n===s&&i===o||(t.onInternalResize(r,s,o,n,i),t.trigger("resize",{width:s,height:o,oldWidth:n,oldHeight:i}))}updateScale(){const e=this,t=e.element,r=t.parentElement;e.configuredWidth||(e.configuredWidth=e.width),e.parentHeight||(e.parentHeight=r.offsetHeight),t.style.display="none";const n=r.offsetWidth/e.configuredWidth,i=e.allowGrowWidth?Math.min(n,1):n;t.style.transform=`scale(${i})`,t.style.transformOrigin="top left",t.style.display="",r.style.height=e.parentHeight*i+"px",e.allowGrowWidth&&n>1&&(e.width=e.configuredWidth*n)}onParentElementResize(e){this.updateScale()}parseTRBL(e,t="px"){if("number"==typeof(e=e||0))return[`${e}${t}`,`${e}${t}`,`${e}${t}`,`${e}${t}`];const r=e.split(" "),n=r.length;return 1===n?r[1]=r[2]=r[3]=r[0]:2===n?(r[2]=r[0],r[3]=r[1]):3===n&&(r[3]=r[1]),[isFinite(r[0])?`${r[0]}${t}`:r[0],isFinite(r[1])?`${r[1]}${t}`:r[2],isFinite(r[2])?`${r[2]}${t}`:r[3],isFinite(r[3])?`${r[3]}${t}`:r[4]]}static get floatRoot(){const e=this;return e._floatRoot||(e._floatRoot=document.querySelector(".b-float-root"),e._floatRoot||(e._floatRoot=DomHelper.createElement({className:"b-float-root",parent:document.body}))),e._floatRoot}static fromElement(e,t,r){}}Widget._$name="Widget",BryntumWidgetAdapterRegister.register("widget",Widget);class Tool extends Widget{template(){return'<div class="b-icon"></div>'}construct(e){super.construct(e),EventHelper.on({element:this.element,click:"onClick",mousedown:"onMousedown",thisObj:this})}onClick(e){const t=this,r=t.panel,n="function"==typeof t.handler?t.handler:r[t.handler];!1!==r.trigger("toolclick",{tool:t})&&n&&t.callback(n,r,[e])}onMousedown(e){const t=this.panel,r=t.focusElement;e.preventDefault(),r&&document.activeElement!==r&&t.focus()}get panel(){return this.parent}}Tool._$name="Tool",BryntumWidgetAdapterRegister.register("tool",Tool);class Layout extends(Events(Base)){static get defaultConfig(){return{containerCls:null,itemCls:null}}static getLayout(e,t){if(e instanceof Layout)return e;const r="string"==typeof e,n={owner:t};return new(r?layoutClasses[e]:e)(r?n:Object.assign(n,e))}static registerLayout(e,t=e.$name.toLowerCase()){layoutClasses[t]=e}renderChildren(){const{owner:e,containerCls:t,itemCls:r}=this,{contentElement:n,items:i}=e,s=e.itemCls,o=i&&i.length;if(n.classList.add("b-content-element"),t&&n.classList.add(t),o)for(let e=0;e<o;e++){const t=i[e],{element:o}=t;o.dataset.index=e,r&&o.classList.add(r),s&&o.classList.add(s),o.classList.remove("b-outer"),t.render(n)}}}const layoutClasses={default:Layout};Layout._$name="Layout";let lastTouchTime=0;const hasRipple=e=>e.ripple,Ripple=window.Ripple=new class extends Widget{static get defaultConfig(){return{old_element:{children:[{className:"b-ripple-inner",reference:"rippleElement"}]},element:{children:[{tag:"svg",class:"b-ripple-inner",reference:"rippleElement",ns:"http://www.w3.org/2000/svg",version:"1.1",viewBox:"0 0 100 100",children:[{reference:"circleElement",tag:"circle",cx:"0",cy:"0",r:10}]}]},floating:!0,hideAnimation:!1,showAnimation:!1,scrollAction:"realign",color:"rgba(0,0,0,.3)",startRadius:10,radius:100}}static get $name(){return"Ripple"}afterConstruct(){super.afterConstruct(),EventHelper.on({element:document,DOMContentLoaded:"doEnableDisable",thisObj:this}),GlobalEvents.on({theme:"doEnableDisable",thisObj:this})}doEnableDisable(){const e=this;e.show();const t=DomHelper.getStyleValue(e.circleElement,"animationName");e.hide(),t&&"none"!==t?e.listenerDetacher=EventHelper.on({mousedown:{element:document,capture:!0,handler:"onDocumentMousedown"},touchstart:{element:document,capture:!0,handler:"onDocumentTouchStart"},animationend:{element:e.circleElement,handler:"onAnimationEnd"},thisObj:e}):e.listenerDetacher&&e.listenerDetacher()}onDocumentTouchStart(e){lastTouchTime=performance.now(),this.handleTriggerEvent(e)}onDocumentMousedown(e){performance.now()-lastTouchTime>200&&this.handleTriggerEvent(e)}handleTriggerEvent(e){const t=IdHelper.fromElement(e.target,hasRipple);if(t){const r=t.ripple,n=r.delegate?e.target.closest(r.delegate):t.focusElement||t.element;if(n){const i=ObjectHelper.assign({event:e,target:n,radius:this.radius},r);if("string"==typeof i.clip&&(i.clip=t[i.clip]||e.target.closest(i.clip),!i.clip))return;this.ripple(i)}}}ripple({event:e,point:t=EventHelper.getClientPoint(e),target:r=e.target,clip:n=r,radius:i=this.radius,color:s=this.color}){this.clip=n;const o=this,a=(n=Rectangle.from(n,null,!0)).getDelta(t),l=o.rippleElement.style,d=o.circleElement;o.hide(),o.alignTo(n),l.transform=`translateX(${a[0]}px) translateY(${a[1]}px)`,l.height=l.width=`${i}px`,d.setAttribute("r",i),d.setAttribute("fill",s),o.show(),o.requestAnimationFrame(()=>{document.addEventListener("scroll",o.callRealign,!0),o.documentScrollListener=!0},0)}alignTo(e){1===e.nodeType&&(e=Rectangle.from(e,null,!0));const{x:t,y:r,width:n,height:i}=e;this.x=t,this.y=r,this.height=i,this.width=n}onAnimationEnd(e){"b-ripple-expand"===e.animationName&&this.hide()}realign(){this.isVisible&&this.alignTo(this.clip)}},emptyObject$1=Object.freeze({});class Container extends Widget{static get defaultConfig(){return{items:null,widgets:null,defaults:null,defaultType:"widget",layoutStyle:null,itemCls:null,layout:"default",namedItems:null}}setConfig(e,t){e.widgets&&(e.items=e.widgets),super.setConfig(e,t)}startConfigure(e){const t=this.items;this.hasItems=!(!t||!t.length),super.startConfigure(e)}set widgets(e){console.warn("`widgets` was deprecated in 2.1, please change your code to use `items`")}get widgets(){return console.warn("`widgets` was deprecated in 2.1, please change your code to use `items`"),this.items}set items(e){this._items=e,this._itemsInvalid=this.itemsInitialized=!0}get items(){const e=this,t=e._items;if(e._widgetMap||(e._widgetMap={}),e._itemsInvalid){const r=e._items=[];Array.isArray(t)?e.processItemsArray(t,r):t&&e.processItemsObject(t,e.namedItems,r),r.some(e=>e.weight)&&r.sort((e,t)=>(e.weight||0)-(t.weight||0)),e._itemsInvalid=!1}return e._items}processItemsArray(e,t){const r=e.length;let n,i;for(n=0;n<r;n++)(i=e[n])instanceof Widget?i.parent=this:i=this.createWidget(i),i&&(t.push(i),this.registerReference(i,i.ref||i.id))}processItemsObject(e,t=emptyObject$1,r){let n,i;for(i in e)(n=e[i])&&(i in t&&(n="object"==typeof n?ObjectHelper.merge(ObjectHelper.clone(t[i]),n):t[i]),n&&(n instanceof Widget?n.parent=this:n=this.createWidget(n),n&&(r.push(n),this.registerReference(n,i))))}registerReference(e,t){for(let r=this;r;r=r.parent)r.widgetMap[t]||(r.widgetMap[t]=e)}get widgetMap(){return this._widgetMap||this._thisIsAUsedExpression(this.items),this._widgetMap}set record(e){const t=this.queryAll(e=>e.name),r=t.length,n=this.element.classList;n.add("b-form-updating");for(let n=0;n<r;n++){const r=t[n],i=r.name,s=r.highlightExternalChange;r.highlightExternalChange=!1,!e&&i?r.value=null:e&&i in e&&(r.value=e[i]),r.highlightExternalChange=s}this.setTimeout(()=>n.remove("b-form-updating"),1500),this._record=e}get record(){return this._record}set layoutStyle(e){DomHelper.applyStyle(this.contentElement,e),this._layoutStyle=e}get layoutStyle(){return this._layoutStyle}set layout(e){this._layout=Layout.getLayout(e,this)}get layout(){return this._layout||(this._layout=new Layout)}eachWidget(e,t=!0){const r=this.items,n=r?r.length:0;for(let i=0;i<n;i++){const n=r[i];if(!1===e(n))return;t&&n.eachWidget&&n.eachWidget(e,t)}}queryAll(e){const t=[];return this.eachWidget(r=>{e(r)&&t.push(r)}),t}query(e){let t=null;return this.eachWidget(r=>{if(e(r))return t=r,!1}),t}getWidgetById(e){return this.widgetMap[e]}processWidgetConfig(e){}createWidget(e){const t=this;e.type||(e.type=t.defaultType);let r=e=Object.setPrototypeOf({parent:t},e);for(;r=r.parent;)if(!1===r.processWidgetConfig(e))return null;return!1===t.trigger("beforeWidgetCreate",{widget:e})?null:WidgetHelper.createWidget(ObjectHelper.assign({},t.defaults,e),t.defaultType||"widget")}render(e){const t=super.render(e,!1);return this.layout.renderChildren(),this.parent||this.triggerPaint(),t}get focusElement(){const e=this.query(this.defaultFocus||(e=>e.focusElement));return e?e.focusElement:super.focusElement}doDestroy(){!this._itemsInvalid&&this.items&&this.items.forEach(e=>e.destroy&&e.destroy()),super.doDestroy()}}Container._$name="Container",BryntumWidgetAdapterRegister.register("container",Container);class Toolbar extends Container{static get defaultConfig(){return{defaultType:"button",layout:"default"}}createWidget(e){return"->"===e&&(e={cls:"b-toolbar-fill"}),super.createWidget(e)}}Toolbar._$name="Toolbar",BryntumWidgetAdapterRegister.register("toolbar",Toolbar);const acceptNode=e=>!e.classList.contains("b-focus-trap")&&DomHelper.isFocusable(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP,byWeight=(e,t)=>(e.weight||0)-(t.weight||0),byWeightReverse=(e,t)=>(t.weight||0)-(e.weight||0);acceptNode.acceptNode=acceptNode;class Panel extends Container{static get defaultConfig(){return{trapFocus:null,title:null,header:null,footer:null,tools:null,tbar:null,bbar:null}}set element(e){const t=this,r=t.title&&(!t.parent||!t.parent.suppressChildHeaders),n=t.header||(t.tools||r?{}:null),i=t.footer,s=n&&("string"==typeof n?n:t.title||n.title),o=n&&(n.titleAlign||"start"),a=t.classHierarchy(Panel).map(e=>`b-${e.$name.toLowerCase()}-header`).join(" "),l=t.tbar,d=t.bbar||t.buttons,c=[{reference:"topFocusTrap",className:"b-focus-trap",tabIndex:0}],u=[],h=[],g={children:c};if((t.hasItems||t.focusable)&&(g.tabIndex=0),n){const e=[{reference:"titleElement",className:"b-header-title",style:`text-align:${o}`,html:s}];for(const e in t.tools){const r=t.tools[e];"start"===r.align?u.unshift(r):h.push(r)}u.sort(byWeight),h.sort(byWeightReverse),e.unshift(...u.map(e=>e.element)),e.push(...h.map(e=>e.element)),c.push({tag:"header",reference:"headerElement",className:`${a} b-dock-${n.dock||"top"} ${n.cls||""}`,children:e})}l&&(l.layout.renderChildren(),c.push(l.element)),c.push(t.bodyConfig),d&&(d.layout.renderChildren(),c.push(d.element)),i&&c.push({tag:"footer",reference:"footerElement",className:`${a} b-dock-${i.dock||"bottom"} ${i.cls||""}`}),c.push({reference:"bottomFocusTrap",className:"b-focus-trap",tabIndex:0}),super.element=g}set bodyConfig(e){this._bodyConfig=e}get bodyConfig(){return this._bodyConfig||{reference:"bodyElement",className:this.classHierarchy(Panel).map(e=>`b-${e.$name.toLowerCase()}-content`).join(" "),html:this.html}}get element(){return super.element}set tbar(e){e instanceof Toolbar?e.parent=this:(Array.isArray(e)&&(e={items:e}),e=new Toolbar(Object.assign({parent:this},e))),e.element.classList.add("b-top-toolbar",`b-dock-${e.dock||"top"}`),this._tbar=e}get tbar(){return this._tbar}set bbar(e){e instanceof Toolbar?e.parent=this:(Array.isArray(e)&&(e={items:e}),e=new Toolbar(Object.assign({parent:this},e))),e.element.classList.add("b-bottom-toolbar",`b-dock-${e.dock||"bottom"}`),this._bbar=e}get bbar(){return this._bbar}eachWidget(e,t=!0){const r=this,n=r.items?r.items.slice():[];r.tbar&&n.unshift(r.tbar),r.bbar&&n.push(r.bbar);for(let r=0;r<n.length;r++){const i=n[r];if(!1===e(i))return;t&&i.eachWidget&&i.eachWidget(e,t)}}set tools(e){const t=this,r=t._tools={};for(const n in e)r[n]=WidgetHelper.createWidget(ObjectHelper.assign({type:"tool",reference:n,parent:t},e[n]),t.defaultToolType||"tool")}get tools(){return this._tools}set trapFocus(e){const t=this;t.element.classList[e?"add":"remove"]("b-focus-trapped"),e?(t.focusTrapListener=EventHelper.on({element:t.element,focusin:"onFocusTrapped",delegate:".b-focus-trap",thisObj:t}),t.treeWalker||(t.treeWalker=document.createTreeWalker(t.element,NodeFilter.SHOW_ELEMENT,acceptNode,!1))):t.focusTrapListener&&(t.focusTrapListener(),t.focusTrapListener=null),t._trapFocus=e}get trapFocus(){return this._trapFocus}onFocusTrapped(e){const t=this,r=t.treeWalker;e.target===t.bottomFocusTrap?(r.currentNode=t.topFocusTrap,r.nextNode()):(r.currentNode=t.bottomFocusTrap,r.previousNode()),t.requestAnimationFrame(()=>r.currentNode.focus())}get focusElement(){return this.hasItems&&(super.focusElement||this.element)}get contentElement(){return this.element&&this.bodyElement}get widgetClassList(){const e=this,t=super.widgetClassList,r=e.header;return(r||e.title||e.tools)&&t.push(`b-panel-has-header b-header-dock-${r&&r.dock||"top"}`),e.tbar&&t.push("b-panel-has-top-toolbar"),e.bbar&&t.push("b-panel-has-bottom-toolbar"),t}doDestroy(){this.tbar&&this.tbar.destroy(),this.bbar&&this.bbar.destroy(),super.doDestroy()}}Panel._$name="Panel",BryntumWidgetAdapterRegister.register("panel",Panel);class Popup extends Panel{static get defaultConfig(){return{autoShow:!0,autoClose:!0,showOnClick:!1,forElement:null,monitorResize:!0,floating:!0,hidden:!0,axisLock:!0,hideAnimation:BrowserHelper.isIE11?null:{opacity:{from:1,to:0,duration:".3s",delay:"0s"}},showAnimation:BrowserHelper.isIE11?null:{opacity:{from:0,to:1,duration:".4s",delay:"0s"}},closeAction:"hide",trapFocus:!0,focusOnToFront:!0,closable:null}}startConfigure(e){this._thisIsAUsedExpression(this.closable),super.startConfigure(e)}finalizeInit(){const e=this;e.anchoredTo=e.forElement,e.initialAnchor=e.anchor,e.forElement&&e.showOnClick&&(e.initialConfig.autoShow||(e.autoShow=!1),EventHelper.on({element:e.forElement,click:"onElementUserAction",thisObj:e})),super.finalizeInit(),e.autoShow&&(!0===e.autoShow?e.show():e.setTimeout(()=>e.show(),e.autoShow))}close(){if(!1!==this.trigger("beforeclose"))return this[this.closeAction]()}onElementResize(e,t,r){const n=this,{lastAlignSpec:i}=n;if(n.isVisible&&i&&i.target){const e=!t||r.height!==t.height,s=!t||r.width!==t.width;(e&&0===i.zone||s&&3===i.zone)&&n.realign()}super.onElementResize(e)}onInternalKeyDown(e){"Escape"===e.key&&(e.stopImmediatePropagation(),this.close(!0))}onDocumentMouseDown({event:e}){!this.owns(e.target)&&this.autoClose&&this.close()}onFocusIn(e){const t=document.activeElement;super.onFocusIn(e),document.activeElement===t&&e.target===this.element&&this.focus()}onFocusOut(e){this.autoClose&&this.close(),super.onFocusOut(e)}onShow(){const e=this;e.autoClose&&!e.mouseDownRemover&&(e.mouseDownRemover=GlobalEvents.on({globaltap:"onDocumentMouseDown",thisObj:e})),e.focusOnToFront&&e.focus(),super.onShow&&super.onShow()}onHide(){this.mouseDownRemover&&(this.mouseDownRemover(),this.mouseDownRemover=null),super.onHide&&super.onHide()}onElementUserAction(){this.show()}set closable(e){this._closable=e,this.tools||(this.tools={})}get closable(){return this._closable}set tools(e){this.closable&&((e||(e={})).close={cls:"b-popup-close",handler:"close",weight:-1e3}),super.tools=e}get tools(){return super.tools}}Popup._$name="Popup",BryntumWidgetAdapterRegister.register("popup",Popup);const tagSpaceRe=/>[ \t\r\n]+</g;class TemplateHelper{static tpl(e,...t){let r=0,n=t.map((t,n)=>{let i=e[n];return Array.isArray(t)?i+=t.reduce((e,t)=>e+=("string"==typeof t?t.trim():t)+"\n",""):(void 0===t&&(t=""),i+="string"==typeof t?t.trim():t),r++,i}).join("");return r<=e.length&&(n+=e[e.length-1]),n.replace(tagSpaceRe,"><").trim()}static repeat(e){return function(...t){return TemplateHelper.tpl(...t).repeat(e)}}static loop(e){}}TemplateHelper._$name="TemplateHelper";class MenuItem extends Widget{static get defaultConfig(){return{menu:null,icon:null,text:null,checked:null,closeParent:null,localizableProperties:["text"]}}doAction(e){const t=this,r=this.parent,n={menu:r,item:t,element:t.element,bubbles:!0};"boolean"==typeof t.checked&&(t.checked=!t.checked),t.trigger("beforeItem",n),t.trigger("item",n),t.closeParent&&r&&(r.rootMenu.close(),e&&e.preventDefault())}doDestroy(){const e=this._menu;e instanceof Widget&&e.destroy(),super.doDestroy()}template(e){const t=e.icon||("boolean"==typeof e.checked?`b-fw-icon b-icon-${e.checked?"":"un"}checked`:"");return TemplateHelper.tpl`
            <div class="${e.hasMenu?"b-has-submenu":""}" ${e.name?`data-name="${e.name}"`:""} tabIndex="-1">
                ${t?`<i class="${t}" reference="iconElement"></i>`:""}
                <span class="b-menu-text" reference="textElement">${e.text}</span>
                ${e.hasMenu?'<i class="b-fw-icon b-icon-sub-menu" reference="subMenuIcon"></i>':""}
            </div>`}get focusElement(){return this.element}get contentElement(){return this.textElement}get isFocusable(){const e=this.focusElement;return e&&this.isVisible&&(e===document.body||e.offsetParent)}onFocusIn(e){super.onFocusIn(e),!this.disabled&&this.menu&&this.openMenu()}onFocusOut(e){super.onFocusOut(e),this.closeMenu()}openMenu(e){const t=this.menu;!this.disabled&&t&&(t.focusOnToFront=e,t.show(),this.owner.currentSubMenu=t)}closeMenu(){this._menu instanceof Widget&&this.menu.close()}set checked(e){const t=this,{isConfiguring:r}=t;(r||"boolean"==typeof t._checked)&&(e=!!e)!==t._checked&&(t._checked=e,r||(t.iconElement.classList[e?"add":"remove"]("b-icon-checked"),t.iconElement.classList[e?"remove":"add"]("b-icon-unchecked"),t.trigger("toggle",{menu:t.owner,item:t,checked:t._checked,element:t.element,bubbles:!0})))}get checked(){return this._checked}set menu(e){this._menu=e}get text(){return this.html}set text(e){this.html=e}get menu(){const e=this;let t=e._menu;return!t||t instanceof Widget||("object"!=typeof t||"items"in t||"widgets"in t||"html"in t||(t={items:t}),t=e.menu=WidgetHelper.createWidget(Object.assign({type:"menu",autoShow:!1,autoClose:!0,scrollAction:e.owner.scrollAction,constrainTo:e.owner.constrainTo,forElement:e.element,align:"l0-r0",anchor:!0,owner:e,cls:"b-sub-menu"},t))),t}set closeParent(e){this._closeParent=e}get closeParent(){return("boolean"==typeof this.checked?this._closeParent:!1!==this._closeParent)&&!this.hasMenu}get hasMenu(){const e=this.isConfiguring?this.initialConfig.menu:this._menu;return e&&(e instanceof Widget||"object"==typeof e||e.length>0)}}MenuItem._$name="MenuItem",BryntumWidgetAdapterRegister.register("menuitem",MenuItem);const validKeys={ArrowUp:1,ArrowDown:1,ArrowRight:1,ArrowLeft:1,Enter:1,Escape:1};class Menu extends Popup{static get defaultConfig(){return{align:"t-b",scrollAction:"hide",focusOnHover:null,scrollable:!1,defaultType:"menuitem"}}construct(e){Array.isArray(e)&&(e={items:e}),super.construct(e),EventHelper.on({element:this.element,click:"onMouseClick",mouseover:"onMouseOver",mouseleave:"onMouseLeave",thisObj:this})}afterShow(e){this.items.some(e=>Boolean(e._menu))&&this.element.classList.add("b-menu-with-submenu"),super.afterShow(e)}createWidget(e){return"string"==typeof e&&(e={text:e}),super.createWidget(e)}get focusElement(){const e=this.parentMenu&&this.parentMenu.element.contains(document.activeElement),t=this.items[0];return!e&&t instanceof MenuItem?this.element:super.focusElement}onDocumentMouseDown(e){this.parentMenu&&this.parentMenu.owns(e.event.target)||super.onDocumentMouseDown(e)}hide(){this.currentSubMenu&&this.currentSubMenu.hide(),super.hide(),this.parentMenu&&(this.parentMenu.currentSubMenu=null)}onMouseClick(e){const t=this,r=e.target.closest(".b-menuitem");r&&(t.triggerElement(r,e),e.stopImmediatePropagation())}onMouseOver(e){if(!1!==this.focusOnHover){const t=DomHelper.up(e.relatedTarget,".b-widget"),r=DomHelper.up(e.target,".b-widget"),n=IdHelper.fromElement(r);!DomHelper.isTouchEvent&&r&&r!==t&&n.parent===this&&n&&n.focus()}}onMouseLeave(e){const t=this,{relatedTarget:r}=e,n=r&&t.owns(r);let i=r&&r instanceof HTMLElement&&IdHelper.fromElement(r),s=!n;if(i){for(;i.ownerCmp;)i=i.ownerCmp;s&=!DomHelper.getAncestor(i.element,[e.target])}!n&&s&&(t.currentSubMenu&&t.currentSubMenu.hide(),t.currentSubMenu=t.selectedElement=null,t.element.contains(document.activeElement)&&document.activeElement.matches(".b-menuitem")&&t.element.focus())}onInternalKeyDown(e){const t=IdHelper.fromElement(e),r=t&&t!==this&&!(t instanceof MenuItem);if("Escape"===e.key)return void(r?this:this.rootMenu).close();if(super.onInternalKeyDown(e),r)return;validKeys[e.key]&&e.preventDefault();const n=document.activeElement,i=this.element;this.navigateFrom(n!==i&&i.contains(n)?n:null,e.key,e)}navigateFrom(e,t,r){const n=this,i=n.treeWalker,s=e&&n.getItemFromElement(e);let o;switch(t){case"ArrowUp":i.currentNode=e||(e=n.bottomFocusTrap),i.previousNode(),o=i.currentNode;break;case"ArrowDown":i.currentNode=e||(e=n.topFocusTrap),i.nextNode(),o=i.currentNode;break;case" ":e&&!e.classList.contains("b-disabled")&&(s&&s.menu?n.openSubMenu(e,s):n.triggerElement(e,r));break;case"ArrowRight":if(e&&s&&s.menu&&!e.classList.contains("b-disabled")){const t=n.openSubMenu(e,s);t&&t.focus()}else i.currentNode=e||(e=n.topFocusTrap),i.nextNode(),o=i.currentNode;break;case"ArrowLeft":n.isSubMenu?n.hide():e||(i.currentNode=e||(e=n.topFocusTrap),i.nextNode(),o=i.currentNode);break;case"Enter":e&&!e.classList.contains("b-disabled")&&n.triggerElement(e,r)}o&&(o===n.element?n.navigateFrom(n.bottomFocusTrap,"ArrowUp",r):o===e?n.navigateFrom(n.topFocusTrap,"ArrowDown",r):o.focus())}getItemFromElement(e){return IdHelper.fromElement(e,"menuitem",this.contentElement)}triggerElement(e,t){const r=this.getItemFromElement(e);r&&!r.disabled&&r.doAction(t)}get isSubMenu(){return this.owner&&this===this.owner.menu}openSubMenu(e,t){const r=this,n=t.menu;if(n){if(!n.isVisible){const i={item:t,element:e};if(!1===r.trigger("beforeSubMenu",i))return;if(t.onBeforeSubMenu&&!1===t.onBeforeSubMenu(i))return;n.show()}return r.currentSubMenu=n}}set selectedElement(e){const t=this,r=t._selectedElement;if(r){const e=t.getItemFromElement(r),n=e&&e.menu;n&&n.hide(),r.classList.remove("b-active")}if(t._selectedElement=e,e){const r=DomHelper.isFocusable(e);e.classList.add("b-active"),t.scrollable.scrollIntoView(e,{animate:!r,focus:r})}}get selectedElement(){return this._selectedElement}selectFirst(){const e=this.treeWalker;e.currentNode=this.topFocusTrap,e.nextNode(),this.requestAnimationFrame(()=>e.currentNode.focus())}get parentMenu(){let e=this.owner;if(e instanceof MenuItem&&(e=e.owner),e instanceof Menu)return e}get rootMenu(){let e=this;for(;e.parentMenu&&e.parentMenu instanceof this.constructor;)e=e.parentMenu;return e}}Menu._$name="Menu",BryntumWidgetAdapterRegister.register("menu",Menu);class Toast extends Widget{static get defaultConfig(){return{floating:!0,timeout:2500,showProgress:!0,bottomMargin:20}}doDestroy(){const e=Toast.toasts.indexOf(this.element);e>-1&&Toast.toasts.splice(e,1),super.doDestroy()}set element(e){}get element(){if(!this._element&&!this.isConfiguring){const e=this,t=Toast.toasts.length&&Toast.toasts[0],r=t?t._nextBottom:e.bottomMargin,n=super.element=DomHelper.createElement({parent:e.appendTo||Widget.floatRoot,children:e.showProgress?[{className:"b-toast-progress",style:`animation-duration:${e.timeout/1e3}s;`}]:null,html:e._html});EventHelper.on({element:n,click:"hide",thisObj:e}),Toast.toasts.unshift(n),n._nextBottom=r+n.offsetHeight+e.bottomMargin,n.style.cssText=`bottom:${r}px;transform:translateY(0)`}return super.element}show(){super.show(),this.timeout>0&&(this.hideTimeout=this.setTimeout("hide",this.timeout))}hide(){const e=this;e.destroyTimeout||(e.element.classList.add("b-toast-hide"),e.element.style.bottom="",e.animationTimeout=e.setTimeout("destroy",200))}static show(e){const t=new Toast("string"==typeof e?{html:e}:e);return t.show(),t}}Toast.toasts=[],Toast._$name="Toast",BryntumWidgetAdapterRegister.register("toast",Toast);const realignTransitions={left:!0,right:!0,top:!0,bottom:!0,transform:!0};class Tooltip extends Popup{static get defaultConfig(){return{mouseOffsetX:15,mouseOffsetY:15,floating:!0,getHtml:null,forElement:null,trackMouse:null,forSelector:null,hideOnDelegateChange:null,anchorToTarget:!0,showOnHover:!1,hoverDelay:500,autoShow:!1,dismissDelay:0,hideDelay:500,loadingMsg:"Loading...",allowOver:!1,textContent:!1,anchor:!0,align:"b-t",axisLock:!0,showAnimation:null,hideAnimation:null}}afterConstruct(){const e=this,{forSelector:t}=e;t&&(e.showOnHover=!0,e.forElement||(e.trackMouse=!0,e.forElement=document.body)),super.afterConstruct(),e.forElement&&e.showOnHover&&EventHelper.on({element:e.forElement,mouseover:"internalOnPointerOver",mouseout:"onPointerOut",transitionend:"onTransitionEnd",thisObj:e}),e.autoShow&&e.show(),e.allowOver&&EventHelper.on({element:e.element,mouseenter:"onOwnElementMouseEnter",mouseleave:"onPointerOut",thisObj:e})}get focusElement(){const e=super.focusElement;if(e!==this.element)return e}get anchorToTarget(){return this._anchorToTarget}set anchorToTarget(e){this._anchorToTarget=e,e||(this.anchor=!1)}set trackMouse(e){this._trackMouse=e}get trackMouse(){return this._trackMouse&&!this.anchorToTarget}internalOnPointerOver(e){const t=this,r=t.forElement,n=t.forSelector,i=t.activeTarget;let s;if(!t.allowOver||!t.element.contains(e.target)){if(n){if(i&&i.contains(e.target)&&i.contains(e.relatedTarget))return;if((s=e.target.closest(n))&&e.relatedTarget&&e.relatedTarget.closest(n)===s)return}else{if(r.contains(e.relatedTarget))return;s=r}s?t.handleForElementOver(e,s):i&&t.handleForElementOut()}}onTransitionEnd(e){const t=this,r=Tooltip.currentOverElement;if(realignTransitions[e.propertyName]){if(t.allowOver&&t.element.contains(r))return;t.isVisible&&t.activeTarget.contains(r)&&!t.trackMouse&&t.realign()}}handleForElementOver(e,t){const r=this;if(!1===r.trigger("pointerOver",{event:e,target:t}))r.onPointerOut(e);else if(r.pointerEvent=e,r.abortDelayedHide(),r.isVisible&&!r.hideOnDelegateChange){if(r.updateActiveTarget(t),!1===r.trigger("beforeShow"))return r.hide();r.alignTo({target:r.anchorToTarget?t:new Point(r.pointerEvent.pageX-window.pageXOffset+r.mouseOffsetX,r.pointerEvent.pageY-window.pageYOffset+r.mouseOffsetY),overlap:!(r.anchorToTarget&&r.anchor)}),r.trigger("show"),r.afterShowByTarget()}else r.hideOnDelegateChange&&r.hide(),r.updateActiveTarget(t),r.delayShow(t)}delayShow(e){const t=this;t.currentAnimation&&(t.cancelHideShowAnimation(),t._hidden=!0),t.isVisible||t.hasTimeout("show")?t.isVisible&&t.showByTarget(e):!t.hoverDelay||t.forSelector&&Date.now()-t.lastHidden<t.quickShowInterval?t.showByTarget(e):(t.listeningForMouseMove||t.anchorToTarget||(t.mouseMoveRemover=EventHelper.on({element:document,mousemove:"onMouseMove",thisObj:t})),t.setTimeout(()=>t.showByTarget(e),t.pointerEvent&&"mouseover"!==t.pointerEvent.type?0:t.hoverDelay,"show"))}showByTarget(e){const t=this;t.mouseMoveRemover&&(t.mouseMoveRemover(),t.mouseMoveRemover=null),t.showBy({target:t.anchorToTarget?e:new Point(t.pointerEvent.pageX-window.pageXOffset+t.mouseOffsetX,t.pointerEvent.pageY-window.pageYOffset+t.mouseOffsetY),overlap:!(t.anchorToTarget&&t.anchor)})}afterShowByTarget(){const e=this,t=e.dismissDelay;e.abortDelayedShow(),t&&e.setTimeout("hide",t),e.toFront()}updateActiveTarget(e){const t=this,r=t.activeTarget;t.activeTarget=e,t.isConfiguring||t.trigger("overtarget",{newTarget:e,lastTarget:r})}onPointerOut(e){const t=this,r=e.relatedTarget;t.allowOver&&t.element.contains(r)||t.element.contains(e.target)&&t.activeTarget&&t.activeTarget.contains(r)||t.activeTarget&&!t.activeTarget.contains(e.relatedTarget)&&t.handleForElementOut()}handleForElementOut(){const e=this,{hideDelay:t}=e;e.abortDelayedShow(),e.isVisible&&!1!==t&&(e.abortDelayedHide(),t>0?e.setTimeout("hide",t):e.hide())}show(){const e=this;e.forElement&&e.anchorToTarget&&!e.forSelector&&!e.inShowBy?e.showByTarget(e.forElement):(e.inShowBy&&(e.y=-1e4),super.show()),e.afterShowByTarget(),e.mouseMoveRemover||e._hidden||!e.trackMouse||(e.mouseMoveRemover=EventHelper.on({element:document,mousemove:"onMouseMove",thisObj:e}))}hide(){const e=this;e.isVisible&&(e.abortDelayedShow(),e.abortDelayedHide(),super.hide(),e.lastHidden=Date.now(),e.activeTarget=null,e.mouseMoveRemover&&(e.mouseMoveRemover(),e.mouseMoveRemover=null),e.listeningForMouseMove=!1)}abortDelayedShow(){const e=this;e.hasTimeout("show")&&(e.clearTimeout("show"),e.mouseMoveRemover&&(e.mouseMoveRemover(),e.mouseMoveRemover=null))}abortDelayedHide(){this.clearTimeout("hide")}realign(e){const t=this,r=t.lastAlignSpec,n=t.clippedBy;if(!t.isConfiguring&&n&&!t.isVisible&&r.targetHidden){Rectangle.from(r.target,t.positioned?t.element.offsetParent:null,!t.positioned).intersect(n)&&(t.show(),r.targetHidden=!1)}super.realign(e)}alignTo(e){const t=this;if(t.isVisible){if(t.getHtml&&(!t.pointerEvent||!t.element.contains(t.pointerEvent.target))){1===e.nodeType&&(e={target:e});const r=e instanceof Point?e:e.position||(1===e.target.nodeType?Rectangle.from(e.target):e.target);t.isAligning=!0,t.html=t.getHtml({tip:t,element:t.element,forElement:t.activeTarget,x:r.x,y:r.y,event:t.pointerEvent}),t.isAligning=!1}t.isVisible&&super.alignTo(e)}}set textContent(e){this._textContent=e,this.element.classList[e?"add":"remove"]("b-tooltip-text-content")}get textContent(){return this._textContent}set html(e){const t=this;if(!1===e?e=`<div class="b-tooltip-loading"><div class="b-icon b-icon-spinner"></div>${t.L(t.loadingMsg)}</div>`:null!=e&&(e=String(e)),e){let r=t.getHtml;t.getHtml=null,super.html=e,t.isAligning||t.realign(),t.getHtml=r,t.trigger("innerHtmlUpdate")}else t.hide()}get html(){return super.html}onMouseMove(e){const t=this,r=e.pageX-window.pageXOffset+t.mouseOffsetX,n=e.pageY-window.pageYOffset+t.mouseOffsetY,i=t.hasTimeout("hide");t.pointerEvent=e,t._hidden||(!t.forSelector||i||1!==e.target.nodeType||e.target.matches(t.forSelector)||t.allowOver&&t.element.contains(e.target)?i&&!t.forElement.contains(e.target)||(t.dismissDelay&&!i&&t.setTimeout("hide",t.dismissDelay),t.trackMouse&&t.alignTo({position:new Point(r,n),ignorePageScroll:!0})):t.handleForElementOut())}onOwnElementMouseEnter(e){this.abortDelayedHide()}}EventHelper.on({element:document,mouseenter:e=>Tooltip.currentOverElement=e.target,capture:!0}),Tooltip._$name="Tooltip",BryntumWidgetAdapterRegister.register("tooltip",Tooltip);var Badge=e=>(class extends(e||Base){construct(e){super.construct(e),this._badge&&(this.badge=this._badge)}set badge(e){const{element:t}=this;this._badge=e,t&&(null!=e&&""!==e?(t.dataset.badge=e,t.classList.add("b-badge")):(t.dataset.badge&&delete t.dataset.badge,t.classList.remove("b-badge")))}get badge(){return this._badge}get widgetClass(){if(this.badge)return"b-badge"}});const bIcon=/^b-icon-/,bFa=/^b-fa-/;class Button extends(Badge(Widget)){static get defaultConfig(){return{icon:null,iconAlign:"start",text:"",color:null,toggleable:!1,pressed:!1,toggleGroup:null,ripple:{radius:75},defaultBindProperty:"text",localizableProperties:["text"],menu:null}}construct(e={},...t){e.toggleGroup&&(e.toggleable=!0),super.construct(e,...t),EventHelper.on({element:this.element,click:"onInternalClick",thisObj:this})}doDestroy(){this.destroyProperties("menu"),super.doDestroy()}get focusElement(){return this.element}get text(){return this._text}set text(e){const{element:t}=this;null!==e&&void 0!==e||(e=""),t.lastChild.data=this._text=e,t.classList[e?"add":"remove"]("b-text")}set menu(e){this._menu=e,this.toggleable=Boolean(e)}get menu(){const e=this;let t=e._menu;return!t||t instanceof Widget||("object"!=typeof t||"items"in t||"widgets"in t||"html"in t||(t={items:t}),t=e.menu=WidgetHelper.createWidget(Object.assign({type:"menu",autoShow:!1,autoClose:!0,scrollAction:"realign",constrainTo:document.body,forElement:e.element,align:"t0-b0",owner:e,onHide(){e.setTimeout(()=>e.toggle(!1),300)}},t))),t}template(){const e=this;return TemplateHelper.tpl`
            <button class="${e.color||""} ${e.toggleable&&e.pressed?"b-pressed":""}" ${e.toggleGroup?`data-group="${e.toggleGroup}"`:""}>
                \xa0
            </button>
        `}onInternalClick(e){const t=this,r={event:e};if(t.toggleable){if(t.toggleGroup&&t.pressed)return;t.toggle(!t.pressed)}t.trigger("click",r),t.trigger("action",r),e.preventDefault(),e.stopPropagation()}toggle(e=null){const t=this,{menu:r}=t;t.toggleable&&(null===e&&(e=!t.pressed),t.pressed=e,t.toggling=!0,r&&(r.minWidth=t.width,r[e?"show":"hide"]()),t.trigger("toggle",{pressed:e}),t.toggling=!1)}set pressed(e){const t=this;e&&t.toggleGroup&&DomHelper.forEachSelector(`button[data-group=${t.toggleGroup}]`,e=>{WidgetHelper.getById(e.id).pressed=!1}),t._pressed=e,t.element&&t.element.classList[e?"add":"remove"]("b-pressed")}get icon(){return this._icon}set icon(e){const t=this;let r=t._iconEl;t._icon=e,e?(r||(r=t._iconEl=DomHelper.createElement({tag:"i",nextSibling:t.element.firstChild})),r.className=e,bIcon.test(e)?r.classList.add("b-icon"):bFa.test(e)&&r.classList.add("b-fa")):r&&r.remove()}set iconAlign(e){const t=this._iconAlign;e!==t&&(t&&this.element.classList.remove(`b-icon-align-${t}`),this.element.classList.add(`b-icon-align-${e}`),this._iconAlign=e)}get pressed(){return this._pressed}}Button._$name="Button",BryntumWidgetAdapterRegister.register("button",Button);class ButtonGroup extends Container{static get defaultConfig(){return{defaultType:"button",cls:null,items:null}}createWidget(e){const t=super.createWidget(e);if(!(t instanceof Button))throw new Error("A ButtonGroup can only contain buttons");return t}}ButtonGroup._$name="ButtonGroup",BryntumWidgetAdapterRegister.register("buttonGroup",ButtonGroup);class ClickRepeater extends(Delayable(Base)){static get defaultConfig(){return{element:null,delegate:null,delay:500,startRate:2,endRate:20,accelerateDuration:4e3}}doDestroy(){this.mousedownRemover&&this.mousedownRemover(),super.doDestroy()}set element(e){this._element=e,this.mousedownRemover=EventHelper.on({element:e,mousedown:"onMouseDown",thisObj:this})}get element(){return this._element}onMouseDown(e){const t=this,r=t.delegate?e.target.closest(t.delegate):t.element;r&&(t.triggerEvent=e,t.activeListenerRemover=EventHelper.on({mouseup:{element:document,handler:"onMouseUp"},mousemove:{element:r,handler:"onTargetMouseMove"},mouseleave:{element:r,handler:"onTargetMouseLeave"},mouseenter:{element:r,handler:"onTargetMouseEnter"},thisObj:t}),t.setTimeout("startAutoRepeat",t.delay))}onMouseUp(e){const t=this;t.acceleration&&t.acceleration.cancel(),t.activeListenerRemover&&t.activeListenerRemover(),t.clearTimeout("startAutoRepeat"),t.clearInterval(t.repeatTimer)}onTargetMouseLeave(){this.clearInterval(this.repeatTimer)}onTargetMouseEnter(e){this.triggerEvent=e,this.fireClick()}onTargetMouseMove(e){this.triggerEvent=e}startAutoRepeat(){const e=this;e.interval=e.startInterval=1e3/e.startRate,e.accelerationDelta=e.startInterval-1e3/e.endRate,e.fireClick(),e.acceleration=FunctionHelper.animate(e.accelerateDuration,e.nextTick,e,"easeOutQuad")}nextTick(e){this.interval=this.startInterval-this.accelerationDelta*e}fireClick(){const e=this,t=new MouseEvent("click",e.triggerEvent);e.triggerEvent.target.dispatchEvent(t),e.repeatTimer=e.setTimeout(e.fireClick,e.interval)}}ClickRepeater._$name="ClickRepeater";const byWeight$1=(e,t)=>(e.weight||0)-(t.weight||0),byWeightReverse$1=(e,t)=>(t.weight||0)-(e.weight||0),arrayOption={array:!0};class Field extends(Badge(Widget)){static get defaultConfig(){return{placeholder:"",value:"",label:null,required:null,clearable:null,labelWidth:null,inputWidth:null,keyStrokeChangeDelay:0,readOnly:null,editable:!0,defaultAction:"change",triggers:null,highlightExternalChange:!0,localizableProperties:["label","title"],autoSelect:!1,autoComplete:"off"}}get errorTip(){return this.constructor.errorTip}static get errorTip(){return BrowserHelper.isIE11&&Field._errorTip&&""===Field._errorTip.html&&(Field._errorTip.destroy(),Field._errorTip=null),Field._errorTip||(Field._errorTip=new Tooltip({cls:"b-field-error-tip",forSelector:".b-field.b-invalid .b-field-inner",align:"l-r",scrollAction:"realign",onBeforeShow(){const e=this,t=IdHelper.fromElement(e.activeTarget);if(t){const r=t.getErrors();if(r)return e.html=r.join("<br>"),e.field=t,!0}return!1}}))}construct(e){const t=this;t.highlightChanged=t.createOnFrame("addUpdatedCls"),super.construct(e),t.keyStrokeChangeDelay&&(t.changeOnKeyStroke=t.buffer(t.internalOnChange,t.keyStrokeChangeDelay))}onFocusOut(e){super.onFocusOut(e),this.onEditComplete()}onEditComplete(){}set element(e){const t=this,r=t.initialConfig.value,n=DomHelper.createElementFromTemplate(t.inputTemplate(t),arrayOption),i=[{className:"b-field-inner",reference:"inputWrap",children:n}],s=[],o=[];t.label&&i.unshift({tag:"label",reference:"labelElement",htmlFor:`${t.id}_input`,html:t.label}),t._thisIsAUsedExpression(t.clearable);for(const e in t.triggers){const r=t.triggers[e];"start"===r.align?s.unshift(r):o.push(r)}s.sort(byWeight$1),o.sort(byWeightReverse$1),n.unshift(...s.map(e=>e.element)),n.push(...o.map(e=>e.element)),super.element={className:t.label?"b-has-label":"",children:i},null!=r&&(t.value=r),t.updateEmpty(),t.updateInvalid()}get element(){return super.element}get focusElement(){return this.input}select(e,t){const r=this.focusElement;if(r.value.length){if(0===arguments.length)return void this.selectAll();if(!this.supportsTextSelection)return;BrowserHelper.isIE11?(r.focus(),r.setSelectionRange(e,t)):r.setSelectionRange(e,t)}}moveCaretToEnd(){const e=this.input;if(e.createTextRange){const t=e.createTextRange();t.collapse(!1),t.select()}else this.supportsTextSelection&&this.select(e.value.length,e.value.length)}selectAll(){this.focusElement.select()}updateEmpty(){const{isEmptyInput:e,isEmpty:t,element:r,clearIcon:n}=this,i=e&&t;r&&(n&&n.classList[i?"add":"remove"]("b-icon-hidden"),r.classList[i?"add":"remove"]("b-empty"))}updateInvalid(){const{isValid:e,element:t,errorTip:r,inputWrap:n}=this;t&&(t.classList[e?"remove":"add"]("b-invalid"),e?r.isVisible&&r.field===this&&r.hide():n.contains(Tooltip.currentOverElement)&&(r.activeTarget===n&&r.isVisible?r.onBeforeShow():(r.activeTarget=n,r.showBy(n))))}get editable(){return this._editable}set editable(e){const t=this,r=t.input;t._editable=e,r&&(r.readOnly=!1===e?"readOnly":null,!1!==e?t.inputListenerRemover=EventHelper.on({element:r,thisObj:t,focus:"internalOnInputFocus",change:"internalOnChange",input:"internalOnInput",keydown:"internalOnKeyPress",keypress:"internalOnKeyPress",keyup:"internalOnKeyPress"}):t.inputListenerRemover&&t.inputListenerRemover())}set clearable(e){this._clearable=e,e&&!this.triggers&&(this.triggers={})}get clearable(){return this._clearable}set triggers(e){const t=this,r=t._triggers={};t.clearable&&((e||(e={})).clear={cls:"b-icon-remove",handler(){t._isUserAction=!0,t.clear(),t._isUserAction=!1},weight:1e3});for(const n in e)r[n]=WidgetHelper.createWidget(ObjectHelper.assign({type:"trigger",reference:n,parent:t},e[n]),t.defaultTriggerType||"trigger")}get triggers(){return this._triggers}set labelWidth(e){this.labelElement&&(this.labelElement.style.flex=`0 0 ${DomHelper.setLength(e)}`,this.inputWrap.style.flexBasis=null==e?"":0)}get label(){return this._label}set label(e){null!==e&&void 0!==e||(e=""),this._label=e,this.labelElement&&(this.labelElement.innerHTML=e)}get readOnly(){return this._readOnly||this.disabled}set readOnly(e){this._readOnly=e,this.editable=!e}get isValid(){return(!this.errors||!ObjectHelper.getTruthyValues(this.errors).length)&&(!this.input||!this.input.validity||this.input.validity.valid)}get isEmpty(){return null==this.value||""===this.value}get isEmptyInput(){return!this.input||null==this.input.value||""===this.input.value}get value(){return this._value}set value(e){const t=this,r=t._value;t.hasChanged(r,e)&&(t.inputting||(t._lastValue=e),t._value=e,!t.required||""!=e&&null!=e?t.clearError("fieldRequired",!0):t.setError("fieldRequired",!0),t.isConfiguring||t.inputting||t.trigger("change",{value:t.value,oldValue:r,userAction:Boolean(t._isUserAction),valid:t.isValid}),t.syncInputFieldValue())}hasChanged(e,t){return t!==e}syncInputFieldValue(){const e=this,t=e.input;t&&!e.inputting&&(e.input.value=e.inputValue,e.isConfiguring||e.containsFocus||!e.highlightExternalChange||(t.classList.remove("b-field-updated"),e.clearTimeout("removeUpdatedCls"),e.highlightChanged())),e.updateEmpty(),e.updateInvalid()}addUpdatedCls(){this.input.classList.add("b-field-updated"),this.setTimeout("removeUpdatedCls",1500)}removeUpdatedCls(){this.input.classList.remove("b-field-updated")}get inputValue(){return null==this.value?"":this.value}internalOnInputFocus(){const e=this.input.value.length;BrowserHelper.isIE11&&e&&!this.autoSelect&&this.select(e,e)}internalOnChange(e){const t=this,r=t.value,n=t._lastValue;t.isValid&&r!==n&&(t._lastValue=r,t.trigger("change",{value:r,oldValue:n,event:e,userAction:!0}),"change"===t.defaultAction&&t.trigger("action",{value:r,oldValue:n,event:e}))}internalOnInput(e){const t=this;t.inputting=!0,t.value=t.input.value,t.inputting=!1,t.trigger("input",{value:t.value,event:e}),t.changeOnKeyStroke&&t.changeOnKeyStroke(e)}internalOnKeyPress(e){const t=this;if("keydown"===e.type)if("Escape"===e.key&&!t.readOnly&&t.clearable){if(t.clear(),t.isDestroyed)return void e.stopImmediatePropagation()}else"Enter"===e.key&&BrowserHelper.isIE11&&this.internalOnChange(e);t.trigger(e.type,{event:e})}clear(){this.value=null,this.trigger("clear")}setError(e,t){(this.errors||(this.errors={}))[e]=this.L(e),t||this.updateInvalid()}clearError(e,t){this.errors&&delete this.errors[e],t||this.updateInvalid()}getErrors(){if(!this.isValid){const e=this.errors?ObjectHelper.getTruthyValues(this.errors):[this.input.validationMessage||this.L("invalidValue")];if(e&&e.length)return e}}get supportsTextSelection(){const e=this.focusElement;return e&&("textarea"===e.tagName.toLowerCase()||e.type&&(/text|search|password|tel|url/.test(e.type)||BrowserHelper.isEdge))}}Field.Trigger=class extends Widget{static get defaultConfig(){return{align:null}}template(){return`<div class="b-icon b-align-${this.align||"end"}"></div>`}construct(e){super.construct(e),EventHelper.on({element:this.element,click:{handler:"onClick",thisObj:this},mousedown:{handler:"onMousedown",thisObj:this}})}onClick(e){const t=this,r=t.field,n="function"==typeof t.handler?t.handler:r[t.handler];r.disabled||n&&!1!==r.trigger("trigger",{trigger:t})&&n.call(r,e)}onMousedown(e){const t=this.field;!("key"in e)&&DomHelper.isTouchEvent&&t.editable&&(t.editable=!1,t.setTimeout(()=>t.editable=!0,500)),e.preventDefault(),document.activeElement!==t.input&&t.focus()}get field(){return this.parent}},Field.SpinTrigger=class extends Field.Trigger{static get defaultConfig(){return{repeat:!0}}template(){return`<div class="b-icon b-align-${this.align||"end"}">\n                    <div reference="upButton" class="b-icon b-spin-up"></div>\n                    <div reference="downButton" class="b-icon b-spin-down"></div>\n                </div>`}set repeat(e){const t=this;e?t.clickRepeater=new ClickRepeater(Object.assign({element:t.element},e)):t.clickrepeater&&(t.clickRepeater.destroy(),t.clickrepeater=null)}onClick(e){const t=this.field;t.disabled||(e.target===this.upButton?t.doSpinUp():e.target===this.downButton&&t.doSpinDown())}},Field.Trigger._$name="FieldTrigger",Field.SpinTrigger._$name="SpinTrigger",Field._$name="Field",BryntumWidgetAdapterRegister.register("trigger",Field.Trigger),BryntumWidgetAdapterRegister.register("spintrigger",Field.SpinTrigger);class Checkbox extends Field{static get defaultConfig(){return{text:"",color:null,value:"",defaultBindProperty:"value"}}construct(e){super.construct(e);this.initialConfig.readOnly&&(this.readOnly=!0)}inputTemplate(){return TemplateHelper.tpl`
            <input type="checkbox" id="${this.id}_input" reference="input"/>
            <label class="b-checkbox-label" for="${this.id}_input" reference="textLabel">${this.text||""}</label>
        `}set element(e){const t=this;super.element=e,t.color&&t.element.classList.add(t.color),t.text&&t.element.classList.add("b-text")}get element(){return super.element}get text(){return this._text}set text(e){this._text=e,this.textLabel&&(this.textLabel.innerHTML=e)}get value(){return this.input.value}set value(e){this.input.value=e}get checked(){return this.input.checked}set checked(e){e=Boolean(e),this.input.checked!==e&&(this.input.checked=e,this.isConfiguring||this.triggerChange(!1))}get readOnly(){return this._readOnly}set readOnly(e){this._readOnly=e,this.element.classList[e?"add":"remove"]("b-readonly"),this.input.disabled=e}check(){this.checked=!0}uncheck(){this.checked=!1}toggle(){this.checked=!this.checked}internalOnChange(e){this.triggerChange(!0)}triggerChange(e){const t=this;!t.callPreventable("change",{checked:t.input.checked,userAction:e},e=>(t.trigger("action",e),!0))&&(t.input.checked=!t.input.checked)}}Checkbox._$name="Checkbox",BryntumWidgetAdapterRegister.register("checkbox",Checkbox),BryntumWidgetAdapterRegister.register("check",Checkbox);const exclude={};for(let e of Object.getOwnPropertyNames(Base.prototype))exclude[e]=1;class InstancePlugin extends(Localizable(Events(Base))){static get defaultConfig(){return{disabled:!1}}static initPlugins(e,...t){let r=e.plugins||(e.plugins={});for(let n of t)r[n.$name]=new n(e)}construct(e,t){this.client=e,super.construct(t),this.applyPluginConfig(e)}applyPluginConfig(e){let t=this,r=t.pluginConfig||t.constructor.pluginConfig,n=r&&r.assign,i=r&&(r.chain||r.after),s=r&&r.before,o=r&&r.override;if(t.pluggedInto=e,n&&t.applyAssign(e,n),i&&t.applyChain(e,i),s&&t.applyChain(e,s,!1),o&&t.applyOverride(e,o),!r||r.publishAll){let r,a,l=[],d=Object.getOwnPropertyDescriptors(Object.getPrototypeOf(t));for(r in d)a=d[r],exclude[r]||n&&n.includes(r)||i&&i.includes(r)||o&&o.includes(r)||s&&s.includes(r)||"value"in a&&"function"!=typeof a.value||l.push(r);t.applyChain(e,l)}}applyAssign(e,t){t.forEach(t=>this.assign(e,t))}applyChain(e,t,r=!0){const n=this;t.forEach(t=>{e[t]?n.chain(e,t,r):n.assign(e,t)})}applyOverride(e,t){const r=this;r.overridden||(r.overridden={}),t.forEach(t=>{if(!r[t])throw new Error(this.L("overrideFnMissing",{plugIntoName:e.$name,pluginName:r.$name,fnName:t}));"function"==typeof e[t]&&(r.overridden[t]=e[t].bind(e)),e[t]=r[t].bind(r)})}assign(e,t){let r=this,n=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(r),t);n&&(n.get||n.set)?Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:n.get&&n.get.bind(r),set:n.set&&n.set.bind(r)}):e[t]=r[t].bind(r)}chain(e,t,r=!0){let n=this,i=e.pluginFunctionChain||(e.pluginFunctionChain={});if(i[t]||(i[t]=[e[t].bind(e)]),!n[t])throw new Error(this.L("fnMissing",{plugIntoName:e.$name,pluginName:n.$name,fnName:t}));r?i[t].push(n[t].bind(n)):i[t].unshift(n[t].bind(n)),e[t]=((...e)=>n.functionChainRunner(t,...e))}functionChainRunner(e,...t){const r=this.pluggedInto.pluginFunctionChain[e];let n;for(let e=0;e<r.length;e++)if(!1===(n=r[e](...t)))return!1;return n}get disabled(){return this._disabled}set disabled(e){this._disabled=e}}InstancePlugin._$name="InstancePlugin";var Pluggable=e=>(class extends(e||Base){get plugins(){return this._plugins||(this._plugins={}),this._plugins}set plugins(e){e&&(Array.isArray(e)||(e=[e]),InstancePlugin.initPlugins(this,...e)),this.initPlugins()}initPlugins(){}addPlugins(...e){InstancePlugin.initPlugins(this,...e)}hasPlugin(e){return null!=this.getPlugin(e)}getPlugin(e){return"function"==typeof e&&(e=e.$name),this.plugins&&this.plugins[e]}get widgetClass(){}}),State=e=>(class extends(e||Base){get state(){return this._state=this.getState(),this._state}set state(e){this._state=e,this.applyState(e)}get widgetClass(){}});const STM_PROP=Symbol("STM_PROP");var ModelStm=e=>(class extends(e||Base){static get defaultConfig(){return{stm:null}}joinStore(e){super.joinStore&&super.joinStore(e),this.stm||(this.stm=e.stm)}unJoinStore(e){this.stm===e.stm&&(this.stm=null),super.unJoinStore&&super.unJoinStore(e)}get stm(){return this[STM_PROP]}set stm(e){this[STM_PROP]=e}beforeSet(e,t,r,n){const i=super.beforeSet?super.beforeSet(e,t,r,n):[],s=this.stm;if(s&&!s.disabled){let r,n;"object"==typeof e?[r,n]=Object.keys(e).reduce((t,r)=>(t[0][r]=e[r],t[1][r]=this.get(r),t),[{},{}]):(r={[e]:t},n={[e]:this.get(e)}),i.push([r,n])}return i}afterSet(e,t,r,n,i,s){const o=this.stm;if(o&&!o.disabled){const e=i.pop();if(s){let[t,r]=e,[n,i]=Object.keys(s).reduce((e,n)=>(e[0][n]=t[n],e[1][n]=r[n],e),[{},{}]);o.onModelUpdate(this,n,i)}}super.afterSet&&super.afterSet(e,t,r,n,i,s)}beforeInsertChild(e){const t=super.beforeInsertChild?super.beforeInsertChild(e):[],r=this.stm;return r&&!r.disabled&&t.push(e.reduce((e,t)=>(t.root===this.root&&e.set(t,{parent:t.parent,index:t.parent?t.parentIndex:void 0}),e),new Map)),t}afterInsertChild(e,t,r,n){const i=this.stm;if(i&&!i.disabled){const t=r.pop();n&&i.onModelInsertChild(this,e,n,t)}super.afterInsertChild&&super.afterInsertChild(e,t,r,n)}beforeRemoveChild(e,t){const r=super.beforeRemoveChild?super.beforeRemoveChild(e,t):[],n=this.stm;return!n||n.disabled||t||r.push(e.reduce((e,t)=>(e.set(t,t.parentIndex),e),new Map)),r}afterRemoveChild(e,t,r){const n=this.stm;if(n&&!n.disabled&&!r){const r=t.pop();e&&e.length&&n.onModelRemoveChild(this,e,r)}super.afterRemoveChild&&super.afterRemoveChild(e,t,r)}}),TreeNode=e=>(class extends(e||Base){construct(e){const t=this,{constructor:r}=t,{fieldMap:n}=r;if(super.construct(null),!r.parentIdFieldProcessed){const i=t.meta.parentIdField||r.parentIdField||e&&e.parentIdField;i&&i!==n.parentId.dataSource&&r.createFieldDefinition({name:"parentId",dataSource:i}),r.parentIdFieldProcessed=!0}}ingestChildren(e,t=this.stores){const r=t[0],n=this.constructor,{id:i,inProcessChildren:s}=this;if(!0===e)return!!s||[];if(e){Array.isArray(e)||(e=[e]);let t,o=0,a=e.length,l=[];for(;o<a;o++)t=(t=e[o])instanceof Model?t:r?r.createRecord(t):new n(t,null,null,!0),l.push(t),s&&(t.data[n.parentIdField]=i);return l}}processChildren(e=this.stores){const t=this;t.inProcessChildren=!0;const r=t.ingestChildren(t.data[t.constructor.childrenField],e);r&&(r.length?(!0===t.children&&(t.children=[]),t.appendChild(r)):!0===r&&(t.children=!0)),t.inProcessChildren=!1}ancestorsExpanded(e){const{parent:t}=this;return!t||t.isExpanded(e)&&t.ancestorsExpanded(e)}isExpanded(e){const t=this.instanceMeta(e.id);return t.hasOwnProperty("collapsed")||(t.collapsed=!this.expanded),!t.collapsed}get expanded(){return this.data.expanded}get childLevel(){return this.parent?this.parent.childLevel+1:this.isRoot?-1:0}get isLeaf(){return!this.children||this.constructor.convertEmptyParentToLeaf&&!this.children.length}get isParent(){return Boolean(this.children)}get isLoaded(){return this.isParent&&Array.isArray(this.children)}get descendantCount(){return this.getDescendantCount()}get visibleDescendantCount(){return this.getDescendantCount(!0)}getDescendantCount(e=!1,t=this.firstStore){const r=this.children;return!r||!Array.isArray(r)||e&&!this.isExpanded(t)?0:r.reduce((t,r)=>t+r.getDescendantCount(e),r.length)}get allChildren(){const e=this.children;return e?e.reduce((e,t)=>(e.push(t),e.push.apply(e,t.allChildren),e),[]):[]}get firstChild(){const e=this.children;return e&&e.length&&e[0]||null}get lastChild(){const e=this.children;return e&&e.length&&e[e.length-1]||null}get previousSiblingsTotalCount(){let e=this.previousSibling,t=this.parentIndex;for(;e;)t+=e.descendantCount,e=e.previousSibling;return t}get root(){return this.parent&&this.parent.root||this}traverse(e,t=!1){const r=this;t||e.call(r,r),r.isLoaded&&r.children.forEach(t=>t.traverse(e))}traverseBefore(e,t=!1){const r=this;r.isLoaded&&r.children.forEach(t=>t.traverse(e)),t||e.call(r,r)}traverseWhile(e,t=!1){const r=this;let n=!0;return t||(n=!1!==e.call(r,r)),n&&r.isLoaded&&(n=r.children.every(t=>t.traverseWhile(e))),n}bubble(e,t=!1){let r=this;for(t||e.call(r,r);r.parent;)r=r.parent,e.call(r,r)}bubbleWhile(e,t=!1){let r=this,n=!0;for(t||(n=e.call(r,r));n&&r.parent;)r=r.parent,n=e.call(r,r);return n}contains(e){return e&&"object"==typeof e&&(e=e.id),!this.traverseWhile(t=>t.id!=e)}getTopParent(e){let t;return e?(t=[],this.bubbleWhile(e=>(t.push(e),e.parent&&!e.parent.isRoot))):(t=null,this.bubbleWhile(e=>(e.parent||(t=e),e.parent&&!e.parent.isRoot))),t}appendChild(e){return this.insertChild(e)}insertChild(e,t){if("number"==typeof e){const r=e;e=t,t=this.children[r]}const r=this,n=r.isLeaf,i=Array.isArray(e);e=r.ingestChildren(e);const s=t?t.parentIndex:r.children?r.children.length:0,o=r.beforeInsertChild?r.beforeInsertChild(e):void 0,a=r.internalAppendInsert(e,t);return r.isLeaf===n||r.root.isLoading||r.stores.forEach(e=>{const t={isLeaf:!1};e.trigger("update",{record:r,changes:t}),e.trigger("change",{action:"update",record:r,changes:t})}),r.afterInsertChild&&r.afterInsertChild(s,e,o,a),i||!a?a:a[0]}internalAppendInsert(e,t){const r=this,n=r.children||(r.children=[]),{stores:i}=r,s={};let o,a,l,d=t?t.parentIndex:n.length;if(n[a=d]===e[0]||n[a=d-1]===e[0])for(o=!0,l=0;o&&l<e.length;l++)e[l]!==n[a+l]&&(o=!1);if(o)return e;for(l=0;l<e.length;l++){const t=e[l];s[t.id]=t.root===r.root,r.isAutoRoot?r.inProcessChildren||r.isLoading?t.setData(r.constructor.parentIdField,null):t.set(r.constructor.parentIdField,null):r.inProcessChildren?t.setData(r.constructor.parentIdField,r.id):t.set(r.constructor.parentIdField,r.id),t.parent&&t.parent.removeChild(t,s[t.id],!0),t.parent=r}return d=t?t.parentIndex:n.length,n.splice(d,0,...e),r.fixChildrensParentIndex(),i.forEach(t=>{t.chained||(e.forEach(e=>{e.instanceMeta(t.id).collapsed=!e.expanded,e.joinStore(t)}),t.onNodeAddChild(r,e,d,s))}),e}removeChild(e,t){const r=this,n=r.isLeaf,{children:i,stores:s}=r;Array.isArray(e)||(e=[e]),e=e.filter(e=>e.parent===r);const o=r.beforeRemoveChild?r.beforeRemoveChild(e,t):void 0;for(const n of e){const e=n.parentIndex;i.splice(e,1),r.fixChildrensParentIndex(),s.forEach(i=>{i.chained||i.onNodeRemoveChild(r,[n],e,t)}),n.parent=n.parentIndex=n.nextSibling=n.previousSibling=null}r.isLeaf!==n&&r.stores.forEach(e=>{const t={isLeaf:!0};e.trigger("update",{record:r,changes:t}),e.trigger("change",{action:"update",record:r,changes:t})}),r.afterRemoveChild&&r.afterRemoveChild(e,o,t)}clearChildren(){const e=this,{children:t,stores:r}=e;t&&(e.children=[],r.forEach(r=>{r.chained||r.onNodeRemoveChild(e,t,0)}))}fixChildrensParentIndex(){const{children:e}=this;let t;for(let r=0;r<e.length;r++){const n=e[r];n.parentIndex=r,n.previousSibling=t,t&&(t.nextSibling=n),r===e.length-1&&(n.nextSibling=null),t=n}}});const internalProps={children:1,data:1,meta:1},emptyObject$2={},convertDate=function(e){return e instanceof Date||(e=DateHelper.parse(e,this.format||this.dateFormat)),e||void 0};class Model extends(TreeNode(ModelStm())){static set convertEmptyParentToLeaf(e){this._convertEmptyParentToLeaf=e}static get convertEmptyParentToLeaf(){return this._convertEmptyParentToLeaf}static set idField(e){this._assignedIdField=!0,this._idField=e}static get idField(){return this._idField}static set parentIdField(e){this._parentIdField=e}static get parentIdField(){return this._parentIdField||"parentId"}static set childrenField(e){this._childrenField=e}static get childrenField(){return this._childrenField||"children"}get indexPath(){const e=[];for(let t=this;t&&!t.isRoot;t=t.parent)e.unshift(t.parentIndex+1);return e}construct(e={},t=null,r=null,n=!1){const i=this,{constructor:s}=i,{fieldMap:o}=s,a=t?Array.isArray(t)?t:[t]:[];if(t=a[0],i.meta=Object.assign({modified:{}},s.metaConfig,r),super.construct(t),n?s.hasOwnProperty("fieldMap")||s.exposeProperties():s.exposeProperties(e),!s.hasOwnProperty("idFieldProcessed")){let e=i.meta.idField;e||(s._assignedIdField?e=s.idField:t&&(e=t.idField)),e&&e!==o.id.dataSource&&s.createFieldDefinition({name:"id",dataSource:e}),s.idFieldProcessed=!0}i._internalId=Model._internalIdCounter++,i.stores=[],i.originalData||(i.originalData=e),i.data=s.processData(e),void 0===i.id&&i.setData("id",i.generateId()),i.data[s.childrenField]&&i.processChildren(a),i.generation=0}static processData(e,t=!1){const{fieldMap:r,defaultValues:n}=this;let i,s=Object.assign({},e);if(!t)for(i in n)void 0===s[i]&&(s[i]=n[i]);for(i in r){const n=r[i],{name:o,dataSource:a}=n,l=a!==o&&!ObjectHelper.pathExists(e,a)&&o in e;if(l||n.convert){const r=l?e[o]:e[a];(!t||l&&o in e||!l&&a in e)&&(ObjectHelper.setPath(s,a,n.convert?n.convert(r):r),l&&delete s[o])}}return s}static exposeProperties(e){const t=this,r=t.superclass,n=t.hasOwnProperty("fields")&&t.fields;if(r.exposeProperties&&!r.hasOwnProperty("fieldMap")&&r.exposeProperties(),t.hasOwnProperty("propertiesExposed")||(t.defaultValues=Object.assign({},r.defaultValues,t.hasOwnProperty("defaults")?t.defaults:null),t.fieldMap=Object.setPrototypeOf({},r.fieldMap||emptyObject$2),t.fieldDataSourceMap=Object.setPrototypeOf({},r.fieldDataSourceMap||emptyObject$2),t.propertiesExposed=Object.setPrototypeOf({},r.propertiesExposed||emptyObject$2),t.hasOwnProperty("idField")&&(t.createFieldDefinition({name:"id",dataSource:t.idField}),t.propertiesExposed[t.idField]=!0),t.hasOwnProperty("parentIdField")&&(t.createFieldDefinition({name:"parentId",dataSource:t.parentIdField}),t.propertiesExposed[t.parentIdField]=!0),n&&n.length&&n.map(t.createFieldDefinition,t)),t.autoExposeFields&&e&&!t.hasOwnProperty("propertiesExposedForData")){for(let r in e)t.propertiesExposed[r]||t.createFieldDefinition({name:r,dataSource:r,fromData:!0});t.propertiesExposedForData=!0}t.exposeRelations()}static createFieldDefinition(e){if(null==e)return;"string"==typeof e&&(e={name:e});const t=this,{propertiesExposed:r,defaultValues:n}=t,{name:i}=e,s=e.dataSource||(e.dataSource=i);return e.hasOwnProperty("persist")||(e.persist=!0),"date"===e.type&&(e.convert=convertDate),t.fieldMap[i]=e,t.fieldDataSourceMap[s]||(t.fieldDataSourceMap[s]=e),-1===s.indexOf(".")?r[s]=!0:(e.complexMapping=!0,r[s.split(".")[0]]=!0),"defaultValue"in e&&(n[s]=e.defaultValue),t.createFieldProperty(i,s),e}static createFieldProperty(e,t){const r=this;internalProps[t]||e in r.prototype||Object.defineProperty(r.prototype,e,{enumerable:!0,get:function(){return this.get(e)},set:function(t){this.set(e,t)}})}static exposeRelations(){const e=this;e.hasOwnProperty("relationsExposed")||e.relationConfig&&(e.relationsExposed=!0,e.relations=[],e.relationConfig.forEach(t=>{e.relations.push(t);let r=t.relationName;Reflect.ownKeys(e.prototype).includes(r)||Object.defineProperty(e.prototype,r,{enumerable:!0,get:function(){return this.getForeign(r)},set:function(e){this.setForeign(r,e,t)}})}))}static get autoExposeFields(){return!0}static get fields(){return[]}static get internalFields(){const{fieldMap:e}=this;let t=this._internalFields;if(this.hasOwnProperty("fieldMap")&&!t){t=this._internalFields=[];for(let r in e)t.push(e[r])}return t}get fields(){return this.constructor.internalFields||this.constructor.fields}getFieldDefinition(e){return this.constructor.getFieldDefinition(e)}get fieldNames(){return Object.keys(this.data)}static getFieldDefinition(e){return this.fieldMap[e]}getDataSource(e){const t=this.constructor.getFieldDefinition(e);if(t)return t.dataSource||t.name}static processField(e,t){const r=this.fieldMap[e];return r&&r.convert?r.convert(t):t}initRelations(){const e=this;e.constructor.relations&&e.stores.forEach(t=>{t.modelRelations||t.initRelations();const r=[];t.modelRelations&&t.modelRelations.forEach(t=>{r.push({related:e.initRelation(t),config:t})}),t.updateRecordRelationCache(e,r)})}initRelation(e){const t=this,r=t.constructor.fieldMap[e.fieldName].dataSource,n=t.get(r),i=void 0!==n&&"string"!=typeof e.store&&e.store.getById(n),s={id:n,placeHolder:!0};return t.meta.relationCache||(t.meta.relationCache={}),t.meta.relationCache[e.relationName]=i||(null!=n?s:null),i}removeRelation(e){this.meta.relationCache[e.relationName]&&(delete this.meta.relationCache[e.relationName],e.nullFieldOnRemove&&this.setData(e.fieldName,null))}getForeign(e){return this.meta.relationCache&&this.meta.relationCache[e]}setForeign(e,t,r){let n=Model.asId(t);return this.set(r.fieldName,n)}get(e){const t=this,r=t.meta.batchChanges?Object.assign({},t.data,t.meta.batchChanges):t.data,n=t.constructor.fieldMap[e],i=n?n.dataSource:e;if(i)return n&&n.complexMapping?ObjectHelper.getPath(r,i):i in r?r[i]:r[e]}setData(e,t){const r=this.constructor.fieldMap[e],n=r?r.dataSource:e;n&&ObjectHelper.setPath(this.data,n,t)}set(e,t,r=!1,n=!1){const i=this;if(i.isBatchUpdating)return i.inBatchSet(e,t),null;{const s=i.beforeSet?i.beforeSet(e,t,r,n):void 0,o=i.inSet(e,t,r,n);return i.afterSet&&i.afterSet(e,t,r,n,s,o),o}}fieldToKeys(e,t){let r;return"string"!=typeof e?(r={},Reflect.ownKeys(e).forEach(t=>r[t]=e[t])):r={[e]:t},r}inBatchSet(e,t){const r=this.fieldToKeys(e,t);Object.keys(r).forEach(e=>{this.meta.batchChanges[e]=this.constructor.processField(e,r[e])})}inSet(e,t,r,n){const i=this,s=i.constructor.fieldMap,o=i.constructor.prototype,a=i.data,l={},d=i.fieldToKeys(e,t);let c=!1;return r||i.triggerBeforeUpdate(d)?(Object.keys(d).forEach(e=>{let t=s[e],r=t?t.dataSource:e,u=!t&&e in o,h=u?i[r]:ObjectHelper.getPath(a,r),g=i.constructor.processField(e,d[e]),m=d[e]={value:g},p=i.getRelationConfig(e),f=(e,r)=>t&&t.isEqual?t.isEqual(e,r):ObjectHelper.isEqual(e,r);f(h,g)?delete d[e]:(i.generation++,m.oldValue=h,c=!0,f(i.meta.modified[r],g)?delete i.meta.modified[r]:(i.meta.modified[r]=h,void 0===m.oldValue&&"oldValue"in m&&delete m.oldValue),l[e]=m,u?i[e]=g:ObjectHelper.setPath(a,r,g),p&&!n&&(i.initRelation(p),i.stores.forEach(e=>e.cacheRelatedRecord(i,g,p.relationName,m.oldValue))))}),c&&(i.stores.forEach(e=>{i.isModified?e.modified.includes(i)||e.added.includes(i)||(e.modified.add(i),e.autoCommit&&e.commit()):e.modified.remove(i)}),r||i.triggerChanges(d,l)),c?l:null):null}get isModified(){return Boolean(this.meta.modified&&Object.keys(this.meta.modified).length>0)}getFieldPersistentValue(e){const t=this.getFieldDefinition(e);let r;return t&&!t.persist||(r=this.get(e),t&&t.serialize&&(r=t.serialize.call(this,r,this))),r}get modifications(){const e=this;if(!e.isModified)return null;const t={};return Object.keys(e.meta.modified).forEach(r=>{const n=e.getFieldPersistentValue(r);void 0!==n&&(t[r]=n)}),t[e.constructor.idField]=e.id,t}get persistableData(){const e=this,t={};return Object.keys(e.data).forEach(r=>{const n=e.getFieldPersistentValue(r);void 0!==n&&(t[r]=n)}),t}get isCommitting(){return Boolean(this.meta.committing)}clearChanges(e=!0,t=!0){const r=this,{meta:n}=r;n.modified={},n.committing=!1,e&&r.stores.forEach(e=>{if(e.modified.remove(r),e.added.remove(r),t){const t=e.collectDescendants(r).all;e.added.remove(t),e.modified.remove(t)}})}get internalId(){return this._internalId}get isPhantom(){return""===this.id||null==this.id||this.hasGeneratedId}get hasGeneratedId(){return this.id&&"string"==typeof this.id&&this.id.startsWith("_generated")}generateId(){return this.constructor.generatedIdIndex||(this.constructor.generatedIdIndex=0),"_generated"+this.$name+ ++this.constructor.generatedIdIndex}static asId(e){return e instanceof Model?e.id:e}get json(){return JSON.stringify(this.data)}toJSON(){return this.data}get isBatchUpdating(){return Boolean(this.batching)}beginBatch(){const e=this;e.batching||(e.batching=0,e.meta.batchChanges={}),e.batching++}endBatch(e=!1){const t=this;if(t.batching&&(t.batching--,!(t.batching>0||ObjectHelper.isEmpty(t.meta.batchChanges)))){const r=Object.assign({},t.meta.batchChanges);this.meta.batchChanges=null,t.set(r,void 0,e),t.cancelBatch()}}cancelBatch(){this.batching=null,this.meta.batchChanges=null}triggerBeforeUpdate(e){return!this.stores.some(t=>{if(!1===t.trigger("beforeUpdate",{record:this,changes:e}))return!0})}triggerChanges(e,t){const r=this;r.stores.forEach(n=>{r.constructor.idField in e&&n.trigger("idChange",{store:n,record:r,oldValue:e[r.constructor.idField].oldValue,value:e[r.constructor.idField].value});const i={record:r,changes:t};null!=r.batching&&(i.batch=!0),n.trigger("update",i),n.trigger("change",Object.assign({action:"update"},i))})}copy(e=null){let t,r,n,i=Object.assign({},this.data),s=!0,o=this.constructor.idField;return e&&"object"==typeof e?(t=e.deep,r=e.id,delete e.id):r=e,t&&this.children?(s=!1,i.children=this.children.map(t=>t.copy(e))):(delete i.children,delete i.expanded),r?i[o]=r:null==r&&(i[o]=this.generateId()),(n=s?new this.constructor(i):i).originalInternalId=this.internalId,n}remove(e=!1){const t=this,{parent:r}=this;r?r.removeChild(t):t.stores.length&&(t.meta.specialRow||t.stores.forEach(r=>r.remove(t,e,!1,!0)))}get firstStore(){return this.stores.length>0&&this.stores[0]}getRelationConfig(e){return this.firstStore&&this.firstStore.modelRelations&&this.firstStore.modelRelations.find(t=>t.fieldName===e)}get isValid(){return!0}joinStore(e){const t=this,{stores:r}=t;r.includes(e)||(super.joinStore&&super.joinStore(e),e.register(t),r.push(e),t.isLoaded&&t.children.forEach(t=>t.joinStore(e)),t.initRelations())}unJoinStore(e){const t=this,{stores:r}=t;r.includes(e)&&(e.unregister(t),t.children&&t.children.forEach(t=>t.unJoinStore(e)),r.splice(r.indexOf(e),1),super.unJoinStore&&super.unJoinStore(e),e.uncacheRelatedRecord(t)),r.length||(t.meta.removed=!0)}isPartOfStore(e){return e?e.indexOf(this)>=0:this.stores.length>0}instanceMeta(e){const{meta:t}=this,r=e.id||e;return t.map||(t.map={}),t.map[r]||(t.map[r]={})}}Model._idField="id",Model._internalIdCounter=1,Model._assignedIdField=!1,Model.exposeProperties(),Model._$name="Model";const base=e=>({mixes:(...t)=>t.reduce((e,t)=>t(e),e||Base)});class Bag{constructor(e){const t=this;t.generation=0,t.items=new Set,t.idMap={},t.idProperty="id",e&&(e.idProperty&&(t.idProperty=e.idProperty),e.values&&(t.values=e.values)),t.idProperty=e&&e.idProperty||"id"}get(e){return this.idMap[safeIndexKey(e)]}get count(){return this.items.size}add(e){Array.isArray(e)||(e=[e]);const t=this,{items:r,idMap:n,idProperty:i}=t,s=e.length;for(let o=0;o<s;o++){const s=e[o],a=safeIndexKey(s[i]),l=n[a];null==l?(n[a]=s,r.add(s),t.generation++):l!==s&&(n[a]=s,r.delete(l),r.add(s))}}remove(e){Array.isArray(e)||(e=[e]);const{items:t,idMap:r,idProperty:n}=this,i=e.length;for(let s=0;s<i;s++){const i=e[s],o=safeIndexKey(i[n]),a=r[o];null!=a&&(t.delete(a),delete r[o],this.generation++)}}clear(){this.items.clear(),this.idMap={},this.generation++}changeId(e,t){const r=this,{idMap:n,idProperty:i}=r,s=keyTypes[typeof e]?e:safeIndexKey(e[i]),o=r.get(s);if(o){const e=r.get(t);if(e&&o!==e)throw new Error(`Attempt to set item ${s} to already existing member's id ${t}`);o[i]=t,delete n[s],n[t]=o}}includes(e){const t=keyTypes[typeof e]?e:safeIndexKey(e[this.idProperty]);return Boolean(this.idMap[t])}map(e,t){const{items:r}=this,n=new Array(r.size);return r.forEach(i=>n[0]=e.call(t,i,0,r)),n}forEach(e,t){return this.items.forEach(e,t)}[Symbol.iterator](){return this.items[Symbol.iterator]()}get values(){return[...this.items]}set values(e){const{generation:t}=this;this.clear(),this.add(e),this.generation=t+1}}Bag._$name="Bag";var StoreCRUD=e=>(class extends(e||Base){static get defaultConfig(){return{autoCommit:!1}}remove(e,t=!1,r){const n=this;return!(e=(Array.isArray(e)?e:[e]).reduce((e,t)=>((t=n.getById(t))&&e.push(t),e),[])).length||!t&&!1===n.trigger("beforeRemove",{records:e})?null:n.tree?(e[0].parent.removeChild(e,!1,r),e):(t&&n.suspendEvents(),n.storage.remove(e),t&&n.resumeEvents(),n.autoCommit&&n.commit(),e)}clear(e=!0){const t=this,{storage:r}=t;if(t.storage.totalCount){if(e&&!1===t.trigger("beforeRemove",{records:r.allValues,removingAll:!0}))return null;if(!e){const e=Object.values(t.idRegister);for(let r,n=e.length-1;n>=0;n--)(r=e[n])&&!r.isDestroyed&&r.unJoinStore(t);t.removed.clear()}e||r.suspendEvents(),r.clear(),e||r.resumeEvents(),t.added.clear(),t.modified.clear()}}removeAll(e){const t=this,r=t.storage;if(e){r.suspendEvents();const e=Object.values(t.idRegister);for(let r,n=e.length-1;n>=0;n--)(r=e[n])&&!r.isDestroyed&&r.unJoinStore(t)}t.clear(),e&&r.resumeEvents()}add(e,t=!1){const r=this,n=r.storage,i=[];if(Array.isArray(e)){if(!e.length)return}else e=[e];return t||!1!==r.trigger("beforeAdd",{records:e})?(r.tree=r.tree||Boolean(r.autoTree&&e[0].children),r.tree?r.rootNode.appendChild(e):(e.forEach(e=>{i.push(e instanceof Model?e:r.createRecord(e))}),t&&r.suspendEvents(),n.add(i),t&&r.resumeEvents(),r.autoCommit&&r.commit(),i)):null}insert(e,t,r=!1){const n=this,i=n.storage,s=[],o=n.getAt(e),a=i.values,l=[];if(Array.isArray(t)||(t=[t]),!1===n.trigger("beforeAdd",{records:t}))return null;let d,c,u;if(a[c=e]===t[0]||a[c=e-1]===t[0])for(d=!0,u=0;d&&u<t.length;u++)t[u]!==a[c+u]&&(d=!1);if(!d){if(t.forEach(t=>{let r=t instanceof Model?t:n.createRecord(t),a=i.indexOf(r);r.children&&r.children.length&&n.autoTree&&(n.tree=!0),s.push(r),a>-1&&(a<e&&o&&e--,l.push(a)),r.meta.previousIndex=a}),n.tree){const r=n.rootNode;return r.insertChild(t,r.children&&r.children[e])}return n.suspendEvents(),n.storage.remove(l),n.resumeEvents(),r&&n.suspendEvents(),i.splice(e,0,...s),r&&n.resumeEvents(),n.autoCommit&&n.commit(),s}}move(e,t){this.storage.move(e,t)}setMultiple(e,t,r){const n=this,i=[],s=[];n.forEach(n=>{e(n)&&(s.push(n.set(t,r,!0)),i.push(n))}),n.trigger("updateMultiple",{records:i,all:n.records.length===i.length}),n.trigger("change",{action:"updatemultiple",records:i,all:n.records.length===i.length}),n.reapplyFilterOnUpdate&&n.isFiltered&&n.filter()}setAll(e,t){const r=this,n=[];r.forEach(r=>{n.push(r.set(e,t,!0))}),r.trigger("updateMultiple",{records:r.records,all:!0}),r.trigger("change",{action:"updatemultiple",records:r.records,all:!0}),r.reapplyFilterOnUpdate&&r.isFiltered&&r.filter()}commit(){const e=this,t=e.changes;return e.callPreventable("commit",{changes:t},()=>(e.modified.forEach(e=>e.clearChanges(!1)),e.added.clear(),e.modified.clear(),e.removed.clear(),t))}clearChanges(){const e=this;e.remove(e.added.values,!0),e.modified.forEach(e=>e.clearChanges(!1)),e.added.clear(),e.modified.clear(),e.removed.clear(),e.trigger("change",{action:"clearchanges"})}get changes(){const e=this;return e.added.count||e.modified.count||e.removed.count?{added:e.added.values.slice(),modified:e.modified.values.slice(),removed:e.removed.values.slice()}:null}get autoCommit(){return this._autoCommit}set autoCommit(e){this._autoCommit=e,e&&this.changes&&this.commit()}applyChangesFromStore(e){const t=this,r=e.changes;r&&(r.added&&t.add(r.added),r.removed&&t.remove(r.removed.map(e=>e.id)),r.modified&&r.modified.forEach(e=>{t.getById(e.id).set(e.modifications)}))}}),StoreFilter=e=>(class extends(e||Base){static get defaultConfig(){return{filters:null,reapplyFilterOnAdd:!1,reapplyFilterOnUpdate:!1}}set filters(e){const t=this,r=t.filters;if(r.clear(),t._filtersFunction=null,e){if("Object"===e.constructor.name)for(const t of Object.entries(e))"filterBy"===t[0]&&"function"==typeof t[1]?r.add(new CollectionFilter({filterBy:t[1]})):r.add(new CollectionFilter("Object"===t[1].constructor.name?Object.assign({property:t[0]},t[1]):{property:t[0],value:t[1]}));else Array.isArray(e)?r.add(...e.map(e=>e instanceof CollectionFilter?e:new CollectionFilter(e))):e.isCollection?r.add(...e.values):r.add(new CollectionFilter({filterBy:e}));r.forEach(e=>e.owner=t)}}get filters(){return this._filters||(this._filters=new Collection({extraKeys:["property"]}))}set filtersFunction(e){this._filtersFunction=e}get filtersFunction(){const e=this,{filters:t,isGrouped:r}=e;if(!e._filtersFunction)if(t.count){const n=CollectionFilter.generateFiltersFunction(t);e._filtersFunction=(e=>r&&e.meta.specialRow?e.groupChildren.some(n):n(e))}else e._filtersFunction=FunctionHelper.returnTrue;return e._filtersFunction}get isFiltered(){return this.filters.values.some(e=>!e.disabled)}traverseFilter(e){let t=this,r=!e.isRoot&&t.filtersFunction(e),n=!1;return e.children&&e.children.length?(e.unfilteredChildren||(e.unfilteredChildren=e.children.slice()),e.children=e.unfilteredChildren.filter(e=>t.traverseFilter(e)),e.children.length&&(n=!0),r||n):r}traverseClearFilter(e){const t=this;e.children&&(e.children=e.unfilteredChildren||e.children,e.children.forEach(e=>t.traverseClearFilter(e)))}get latestFilterField(){return this.filters.last?this.filters.last.property:null}processFieldFilter(e,t){"string"==typeof e&&(e={property:e,value:t}),(e=e instanceof CollectionFilter?e:new CollectionFilter(e)).owner=this,this.filters.add(e)}filter(e,t,r=!1){const n=this,{storage:i,filters:s,rootNode:o}=n,a=n.count;if(e){const i=typeof e;if(n.isConfiguring=!0,Array.isArray(e)?(r=t,e.forEach(n.processFieldFilter,n)):"function"===i?n.filters=e:n.processFieldFilter(e,t),n.isConfiguring=!1,!n.isFiltered)return}n.filtersFunction=null,n.tree?(n.isFiltered?n.traverseFilter(o):n.traverseClearFilter(o),i.replaceValues(n.collectDescendants(o).visible,!0)):n.isFiltered?i.addFilter({id:"primary-filter",filterBy:n.filtersFunction}):i.filters.clear(),n.resetRelationCache(),r||n.triggerFilterEvent({action:"filter",filters:s,oldCount:a,records:n.storage.values})}get filtered(){return this.storage.isFiltered}triggerFilterEvent(e){this.trigger("filter",e),this.trigger("refresh",e),this.trigger("change",e)}filterBy(e){this.filter(e)}removeFieldFilter(e,t){const r=this,n=r.filters.getBy("property",e);n&&(r.filters.remove(n),r._filtersFunction=null,t||r.filter())}clearFilters(e){this.filters.clear(),this.filter(void 0,void 0,e)}convertFilterToString(e){let t=this.filters.getBy("property",e),r="";return t&&!t.filterBy&&(r=String(t)),r}get filterState(){return this.filters.values.map(e=>ObjectHelper.cleanupProperties(e.config))}});const resortActions={add:1,replace:1};var StoreGroup=e=>(class extends(e||Base){static get defaultConfig(){return{groupers:[]}}construct(e){super.construct(e),this.on("change",this.onDataChanged)}onDataChange({source:e,action:t,removed:r}){const n=this;let i=e.values;if(n.isGrouped){if("splice"===t&&r&&r.length){const{groupRecords:e}=n,t={};e&&e.length&&(e.forEach(e=>{n.expand(e)&&(t[e.id]=!0)}),n.storage.replaceValues(n.removeHeadersAndFooters(n.storage.values),!0)),n.storage.replaceValues(n.prepareGroupRecords(n.storage.values),!0),Object.keys(t).forEach(e=>n.collapse(n.getById(e)))}}else e.replaceValues(n.removeHeadersAndFooters(i),!0);super.onDataChange&&super.onDataChange(...arguments)}collapse(e){return!(!e||e.meta.collapsed)&&(this.excludeGroupRecords(e),e.meta.collapsed=!0,!0)}expand(e){return!(!e||!e.meta.collapsed)&&(this.includeGroupRecords(e),e.meta.collapsed=!1,!0)}removeHeadersAndFooters(e){const t=this;return e.filter(e=>!e.meta.specialRow||(t.unregister(e),!1),!0)}prepareGroupRecords(e=this.storage.values){const t=this;if(!t.isGrouped)return t.removeHeadersAndFooters(e);const r=[],n=t.groupers[0].field,i=[];let s=null,o=null,a=0;function l(){const e=o.meta.groupRowFor,n=`group-footer-${"number"==typeof e?e:StringHelper.createId(e)}`,s=t.getById(n)||new t.modelClass({id:n},t,{specialRow:!0,groupFooterFor:e,groupRecord:o});return t.register(s),s.groupChildren=o.groupChildren,i.push(s),r.push(s),t.allRecords.push(s),o.groupChildren.push(s),a++,s}return e.forEach(e=>{const d=e[n],c=`group-header-${"number"==typeof d?d:StringHelper.createId(d)}`;!e.groupChildren||e.groupChildren.length?(ObjectHelper.isEqual(d,s)||(o&&(t.useGroupFooters&&l(),o.meta.childCount=a),o=t.getById(c)||new t.modelClass({id:c},t,{specialRow:!0,groupRowFor:d,groupField:n}),t.register(o),o.groupChildren=[],r.push(o),t.allRecords.push(o),i.push(o),s=d,a=0),e.instanceMeta(t.id).groupParent=o,r.push(e),o.groupChildren.push(e),a++):t.unregister(e)}),o&&(o.meta.childCount=a,t.useGroupFooters&&l()),t.groupRecords=i,r}get isGrouped(){return Boolean(this.groupers.length)}group(e,t,r=!1,n=!0,i=!1){const s=this;let o;if(r?s.groupers.push(o={field:e,ascending:t,complexMapping:e.includes(".")}):e&&(void 0==t&&(t=!s.groupInfo||s.groupInfo.field!==e||!s.groupInfo.ascending),s.groupInfo=o={field:e,ascending:t,complexMapping:e.includes(".")},s.groupers=[s.groupInfo]),o){const{prototype:t}=s.modelClass;o.complexMapping&&!t.hasOwnProperty(e)&&Object.defineProperty(t,e,{get(){return ObjectHelper.getPath(this,e)}})}!1!==n&&s.sort(null,null,!1,!0),i||(s.trigger("group",{isGrouped:s.isGrouped,groupers:s.groupers,records:s.storage.values}),s.trigger("refresh",{action:"group",isGrouped:s.isGrouped,groupers:s.groupers,records:s.storage.values}))}addGrouper(e,t=!0){this.group(e,t,!0)}removeGrouper(e){const t=this,r=t.groupers.findIndex(t=>t.field===e);r>-1&&(t.groupers.splice(r,1),t.group())}clearGroupers(){const e=this,{groupers:t}=e;t.length&&(t.length=0,e.groupRecords.forEach(t=>{t.meta.collapsed&&e.includeGroupRecords(t)}),e.storage.replaceValues(e.removeHeadersAndFooters(e.storage.values),!0),e.group(null,null,null,!1),"groupRecords"in e&&delete e.groupRecords)}isRecordInGroup(e,t){if(!this.isGrouped)return null;return e[this.groupers[0]&&this.groupers[0].field]===t&&!e.meta.specialRow}getGroupRecords(e){const t=this;return t.isGrouped?t.storage.values.filter(r=>t.isRecordInGroup(r,e)):null}getGroupTitles(){return this.isGrouped?this.getDistinctValues(this.groupers[0]&&this.groupers[0].field):null}onDataChanged(e){this.isGrouped&&(!e.changes&&resortActions[e.action]||e.changes&&this.groupers.some(t=>t.field in e.changes))&&this.sort()}sort(e,t,r,n){const i=this,{groupRecords:s}=i,o={};i.isGrouped&&s&&s.length&&(s.forEach(e=>{e.meta.collapsed&&(i.includeGroupRecords(e),o[e.id]=!0)}),i.storage.replaceValues(i.removeHeadersAndFooters(i.storage.values),!0)),super.sort(e,t,r,!0),i.isGrouped&&(i.storage.replaceValues(i.prepareGroupRecords(i.storage.values),!0),Object.keys(o).forEach(e=>{const t=i.getById(e);t&&(i.excludeGroupRecords(t),t.meta.collapsed=!0)})),n||(i.trigger("sort",{sorters:i.sorters,records:i.storage.values}),i.trigger("refresh",{action:"sort",sorters:i.sorters,records:i.storage.values}))}internalIncludeExcludeGroupRecords(e,t){const r=this,n=r.indexOf(e),i=r.id;e.meta.collapsed&&!t||!e.meta.collapsed&&t||(e.groupChildren.forEach(e=>e.instanceMeta(i).hiddenByCollapse=!t),t?r.storage.values.splice(n+1,0,...e.groupChildren):r.storage.values.splice(n+1,e.groupChildren.length),r.storage._indicesInvalid=!0,r._idMap=null)}excludeGroupRecords(e){this.internalIncludeExcludeGroupRecords(e,!1)}includeGroupRecords(e){this.internalIncludeExcludeGroupRecords(e,!0)}collectGroupRecords(){return this.records.reduce((e,t)=>(t.meta.specialRow&&(e.push(t),"groupRowFor"in t.meta&&e.push.apply(e,t.groupChildren)),e),[])}});const noChangeActions={clearchanges:1,update:1,filter:1};var StoreRelation=e=>(class extends(e||Base){initRelations(e){const t=this,r=t.modelClass.relations;e&&t.modelRelations&&t.modelRelations.forEach(e=>{e.storeDetacher&&e.storeDetacher()}),t.modelRelations&&0!==t.modelRelations.length&&!e||!r||(t.modelRelations=[],r&&r.forEach(e=>{const r=Object.assign({},e),n="string"==typeof r.store?t[r.store]:r.store;n?(t.modelRelations.push(r),r.storeProperty=r.store,r.store=n,r.storeDetacher=n.on({change:t.onRelatedStoreChanged,idchange:t.onRelatedStoreIdChange,thisObj:t}),n.count>0&&t.onRelatedStoreChanged({action:"dataset",source:n,records:n.records}),r.collectionName&&n.initRelationCollection(r,t)):t.modelRelations.push(r)}))}initRelationCollection(e,t){const r=this,n=e.collectionName;r.collectionStores||(r.collectionStores={}),r.collectionStores[n]={store:t,config:e},r[n+"Store"]||(r[n+"Store"]=t),r.count>0&&r.initModelRelationCollection(n,r.records)}initModelRelationCollection(e,t){const r=this;t.forEach(t=>{t.traverse(t=>{!(e in t)&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r.getCollection(this,e)},set:function(t){return r.setCollection(this,e,t)}})})})}resetRelationCache(){this.relationCache={},this.forEach(e=>e.initRelations())}updateRecordRelationCache(e,t){const r=this;t&&t.forEach(t=>{let n=t.related?t.related.id:e.get(t.config.fieldName);void 0!==n&&r.cacheRelatedRecord(e,n,t.config.relationName,n)})}getCollection(e,t){const{config:r,store:n}=this.collectionStores[t];return n.relationCache[r.relationName]&&n.relationCache[r.relationName][e.id]||[]}setCollection(e,t,r){const{config:n,store:i}=this.collectionStores[t];i.relationCache[n.relationName]||(i.relationCache[n.relationName]={});const s=(i.relationCache[n.relationName][e.id]||[]).slice(),o=[],a=[];i.suspendEvents(),s.forEach(e=>{r.includes(e)||(e[n.fieldName]=null,i.remove(e),a.push(e))}),r.forEach(t=>{t instanceof Model?t.stores.includes(i)||(i.add(t),o.push(t)):([t]=i.add(t),o.push(t)),t[n.fieldName]=e.id}),i.resumeEvents(),a.length&&(i.trigger("remove",{records:a}),i.trigger("change",{action:"remove",records:a})),o.length&&(i.trigger("add",{records:o}),i.trigger("change",{action:"add",records:o}))}getRelationConfigsFromStore(e){return this.modelRelations&&this.modelRelations.filter(t=>t.store===e)}cacheRelatedRecord(e,t,r,n=null){const i=this,s=i.relationCache[r]||(i.relationCache[r]={});null!==n&&i.uncacheRelatedRecord(e,r,n),t&&ArrayHelper.include(s[t]||(s[t]=[]),e)}uncacheRelatedRecord(e,t=null,r=null){const n=this;function i(t,r){const i=n.relationCache[t],s=i&&i[r];if(s){const t=s.indexOf(e);t>=0&&s.splice(t,1),0===s.length&&delete i[r]}}null!==r?i(t,r):e.meta.relationCache&&Object.entries(e.meta.relationCache).forEach(([e,t])=>{i(e,t&&t.id)})}onRelatedStoreChanged({source:e,action:t,records:r,isCollapse:n,isExpand:i}){const s=this,o=s.getRelationConfigsFromStore(e);noChangeActions[t]||n||i||o.forEach(n=>{const i=s.relationCache[n.relationName];return"dataset"===t?(n.collectionName&&e.initModelRelationCollection(n.collectionName,r),void s.forEach(e=>{const t=e.initRelation(n);t&&s.cacheRelatedRecord(e,t.id,n.relationName,t.id)})):"removeall"===t?(s.forEach(e=>{e.removeRelation(n)}),void delete s.relationCache[n.relationName]):("add"===t&&n.collectionName&&e.initModelRelationCollection(n.collectionName,r),void("add"!==t&&"remove"!==t||r.forEach(e=>{let r=i&&i[e.id];switch(t){case"remove":r&&r.forEach(e=>e.removeRelation(n));break;case"add":s.forEach(t=>{t.get(n.fieldName)==e.id&&(t.initRelation(n),s.cacheRelatedRecord(t,e.id,n.relationName))})}})))})}onRelatedStoreIdChange({store:e,oldValue:t,value:r}){const n=this;n.getRelationConfigsFromStore(e).forEach(e=>{const i=n.relationCache[e.relationName],s=i&&i[t]&&i[t].slice();s&&s.forEach(i=>{i.set(e.fieldName,r,!1,!0),n.cacheRelatedRecord(i,r,e.relationName,t)})})}}),StoreSum=e=>(class extends(e||Base){sum(e,t=this.storage.values){return t?t.reduce((t,r)=>{if(r.meta.specialRow)return t;const n=Number(r[e]);return isNaN(n)?t:t+n},0):0}min(e,t=this.storage.values){return t&&t.length?t.reduce((t,r)=>(r[e]<t&&(t=r[e]),t),t[0][e]):0}max(e,t=this.storage.values){return t&&t.length?t.reduce((t,r)=>(r[e]>t&&(t=r[e]),t),t[0][e]):0}average(e,t=this.storage.values){if(!t||!t.length)return 0;let r=0;return t.reduce((t,n)=>{if(n.meta.specialRow)return t;const i=parseFloat(n[e]);return isNaN(i)?t:(r++,t+i)},0)/r}groupSum(e,t){return this.sum(t,this.getGroupRecords(e))}});const stringFound=(e,t)=>-1!==String(e).toLowerCase().indexOf(t),comparisons={string:stringFound,number:stringFound,boolean:stringFound,date:(e,t)=>e instanceof Date&&t instanceof Date?String(e)===String(t):-1!==String(e.getMonth()+1).indexOf(t)||-1!==String(e.getDate()).indexOf(t)||-1!==String(e.getFullYear()).indexOf(t)};var StoreSearch=e=>(class extends(e||Base){search(e,t=null){const r=this.storage.values,n=r.length,i=[];if(null==e)return null;let s,o,a,l,d;for("string"==typeof e&&(e=String(e).toLowerCase()),s=0;s<n;s++){o=r[s];for(let r of t||o.fieldNames)l=(a=o[r])instanceof Date?"date":typeof a,d=comparisons[l],a&&d&&d(a,e)&&i.push({index:s,data:o,field:r,id:o.id})}return i}findByField(e,t){let r,n,i,s=this.storage.values,o=s.length,a=[];for(null!==t&&void 0!==t&&(t=String(t).toLowerCase()),r=0;r<o;r++){n=s[r];let o=(i=n[e])instanceof Date?"date":typeof i;((null===t||void 0===t)&&i===t||t&&{date:()=>Boolean(i)&&i.toLocaleString().includes(t),string:()=>Boolean(i)&&i.toLowerCase().includes(t),number:()=>"number"==typeof i&&i.toString().includes(t),object:()=>i===t,undefined:()=>i===t}[o]())&&a.push({id:n.id,index:r,data:n})}return a}find(e){return this.storage.values.find(e)}findRecord(e,t,r=!1){const n=r=>ObjectHelper.isEqual(r[e],t);return this.tree?this.query(n)[0]:(r?this.storage.allValues:this.storage.values).find(n)}query(e){if(this.isTree){const t=[];return this.traverse(r=>{e(r)&&t.push(r)}),t}return this.storage.values.filter(e)}some(e){return this.storage.values.some(e)}}),StoreSort=e=>(class extends(e||Base){static get defaultConfig(){return{sorters:[],useLocaleSort:null}}get isSorted(){return Boolean(this.sorters.length)||this.isGrouped}sort(e,t,r=!1,n=!1){const i=this;if(e)if(Array.isArray(e))i.sorters=e.map(e=>"string"==typeof e?{field:e}:e);else{const n="object"==typeof e?e.field:e,s=i.sorters.find(e=>e.field===n);if(void 0===t||null===t){t=!(s&&("string"==typeof e&&s.field===e||"object"==typeof e&&s.field===e.field))||!s.ascending}const o={field:n,ascending:t};"object"==typeof e&&(o.fn=e.fn,o.useLocaleSort=e.useLocaleSort),r?s?s.ascending=t:i.sorters.push(o):i.sorters=[o]}i.performSort(n)}addSorter(e,t=!0){this.sort(e,t,!0)}removeSorter(e){let t=this,r=t.sorters.findIndex(t=>t.field==e);r>-1&&(t.sorters.splice(r,1),t.sort())}clearSorters(){this.sorters.length=0,this.sort()}createSorterFn(e){const t=this.useLocaleSort;return(r,n)=>{for(let{field:i,ascending:s=!0,fn:o=null,useLocaleSort:a=t}of e){const e=s?1:-1;if(o){const t=o(r,n);if(null!==t)return t*e}const t=r[i],l=n[i];if(null==t)return-e;if(null==l)return e;if(a){if(!0===a)return String(t).localeCompare(l)*e;if("string"==typeof a)return String(t).localeCompare(l,a)*e;if("object"==typeof a)return String(t).localeCompare(l,a.locale,a)*e}if(t>l)return e;if(t<l)return-e}return 0}}performSort(e=!1){const t=this,{rootNode:r}=t;t.callPreventable("sort",{sorters:t.sorters,records:t.storage.values},n=>{const i=t.createSorterFn(t.isGrouped?t.groupers.concat(t.sorters):t.sorters);t.tree?(r.traverse(e=>{e.isLoaded&&e.isParent&&(e.children=e.children.sort(i),e.fixChildrensParentIndex())}),t.storage.replaceValues(t.collectDescendants(r).visible,!0)):t.storage.replaceValues(t.storage.values.sort(i),!0),n.records=t.allRecords,t._idMap=null,e||t.trigger("refresh",{action:"sort",sorters:t.sorters,records:t.storage.allValuess})},[],e)}}),StoreChained=e=>(class extends(e||Base){static get defaultConfig(){return{chained:!1,chainedFilterFn:null,chainedFields:null,masterStore:null,doRelayToMaster:["add","remove","insert","removeAll"],dontRelayToMaster:[],keepUncommittedChanges:!1}}construct(e){const t=this;if(super.construct(e),t.chained){if(!t.masterStore)throw new Error("masterStore required on a chained store");t.methodNamesToRelay.forEach(e=>t[e]=((...r)=>t.relayToMaster(e,r))),t.masterStore.on({change:t.onMasterDataChanged,prio:1,thisObj:t}),t.masterStore.chainedStores||(t.masterStore.chainedStores=[]),t.masterStore.chainedStores.push(t),t.fillFromMaster()}}get isChained(){return this.chained}set chainedFilterFn(e){this._chainedFilterFn=this.thisObj?e.bind(this.thisObj):e}get chainedFilterFn(){return this._chainedFilterFn}get methodNamesToRelay(){const e=Array.isArray(this.doRelayToMaster),t=Array.isArray(this.dontRelayToMaster);return e&&this.doRelayToMaster.filter(e=>!t||!this.dontRelayToMaster.includes(e))||[]}updateChainedStores(){this.chainedStores&&this.chainedStores.forEach(e=>e.fillFromMaster())}fillFromMaster(){const e=this;if(!e.chained)throw new Error("fillFromMaster only allowed on chained store");e.keepUncommittedChanges?e.data=[].concat(e.added.values.filter(t=>!e.removed.includes(t)),e.masterStore.allRecords.filter(t=>!e.removed.includes(t)&&!e.added.includes(t)&&e.chainedFilterFn(t))):e.data=e.masterStore.allRecords.filter(e.chainedFilterFn)}commitToMaster(){const e=this,t=e.masterStore;if(!e.chained)throw new Error("commitToMaster only allowed on chained store");return t.beginBatch(),t.remove(e.removed.values),t.add(e.added.values),t.endBatch(),e.commit()}relayToMaster(e,t){if("remove"!==e||4!==t.length||!0!==t[3])return this.masterStore[e](...t)}onMasterDataChanged({action:e,changes:t}){const r=this;if("update"===e){if(!(r.chainedFields&&r.chainedFields.some(e=>e in t)))return}r.fillFromMaster()}}),StoreState=e=>(class extends(e||Base){getState(){const e=this,t={};return e.sorters&&e.sorters.length&&(t.sorters=e.sorters.slice()),e.groupers&&e.groupers.length&&(t.groupers=e.groupers.slice()),e.filters&&e.filters.values.length&&(t.filters=e.filterState),t}applyState(e){const t=this;"sorters"in e&&(t.sorters=e.sorters.slice()),"groupers"in e&&(t.groupers=e.groupers.slice()),("sorters"in e||"groupers"in e)&&t.sort(),"filters"in e&&(t.filters=e.filters.slice(),t.filter())}}),StoreTree=e=>(class extends(e||Base){get isTree(){return this.tree}get leaves(){const e=this,t=[];return e.tree?(e.traverse(e=>{e.isLeaf&&t.push(e)}),t):(e.allRecords.forEach(e=>{e.isLeaf&&t.push(e),e.traverse(e=>{e.isLeaf&&t.push(e)},!0)}),t)}async loadChildren(e){}onNodeAddChild(e,t,r,n){const i=this,s=e===i.rootNode&&e.isLoading,{storage:o}=i,a=[],l=[],d=t[0].previousSibling;let c;if(i.collectDescendants(t,a,l,!(e.isExpanded(i)&&e.ancestorsExpanded(i))),!s&&l.length)for(const e of l)i.modified.includes(e)||n[e.id]||(i.added.add(e),i.removed.remove(e));if(s&&i.rootVisible&&(a.unshift(e),l.unshift(e)),a.length&&(c=0!==r&&d?o.indexOf(d)+d.getDescendantCount(!0,i):o.indexOf(e),o.suspendEvents(),i.storage.splice(++c,0,a),o.resumeEvents()),s&&a.length){const e={action:"dataset",data:i._data,records:a};i.trigger("refresh",e),i.trigger("change",e)}else{const e={action:"add",isChild:!0,records:t,allRecords:l,index:c};i.trigger("add",e),i.trigger("change",e)}}onNodeRemoveChild(e,t,r,n){const i=this,{storage:s}=i,o=[],a=[];if(i.collectDescendants(t,o,a,!(e.isExpanded(i)&&e.ancestorsExpanded(i))),!n){for(let e of t)e.unJoinStore(i);if(a.length){for(let e of a)e.stores.includes(i)&&e.unJoinStore(i),i.added.includes(e)?i.added.remove(e):i.removed.add(e);i.modified.remove(a)}}o.length?(r=s.indexOf(o[0]),s.suspendEvents(),s.splice(r,o.length),s.resumeEvents()):r=-1;const l={action:"remove",isChild:!0,records:t,allRecords:a,index:r};i.trigger("remove",l),i.trigger("change",l)}collectDescendants(e,t=[],r=[],n=!1){const i=this,s=Array.isArray(e)?e:e.children;if(s)for(let e,o=0,a=s.length;o<a;o++)e=s[o],n||t.push(e),r.push(e),i.collectDescendants(e,t,r,n||!e.isExpanded(i));return{visible:t,all:r}}internalToggleTreeSubRecords(e,t){const r=this,{storage:n}=r,i=n.indexOf(e),s=[];let o=0,a=-1;if(e.traverse(e=>{const n=e.isExpanded(r),i=e.instanceMeta(r.id);a&&e.childLevel<=a&&(a=-1),-1===a&&(e.isLeaf||n||(a=e.childLevel),t?s.push(e):i.hidden||(s.push(e),o++)),i.hidden=!t},!0),s.length&&!1!==i){if(n.suspendEvents(),t){n.splice(i+1,0,...s);const e={action:"add",isExpand:!0,records:s,index:i+1};r.trigger("add",e),r.trigger("change",e)}else{n.splice(i+1,o);const e={action:"remove",isCollapse:!0,records:s,index:i+1};r.trigger("remove",e),r.trigger("change",e)}n.resumeEvents()}}onNodeCollapse(e){return this.internalToggleTreeSubRecords(e,!1)}onNodeExpand(e){return this.internalToggleTreeSubRecords(e,!0)}});const STM_PROP$1=Symbol("STM_PROP");var StoreStm=e=>(class extends(e||Base){static get defaultConfig(){return{stm:null}}get stm(){return this[STM_PROP$1]}set stm(e){const t=this;t.stm!=e&&(t.stm&&t.stm.hasStore(t)&&t.stm.removeStore(t),t[STM_PROP$1]=e,t.stm&&!t.stm.hasStore(t)&&t.stm.addStore(t))}add(e,t=!1){let r;const n=this.stm;return this.tree||!n||n.disabled?r=super.add(e,t):(r=super.add(e,t))&&r.length&&n.onStoreModelAdd(this,r,t),r}insert(e,t,r=!1){let n;const i=this.stm;if(this.tree||!i||i.disabled)n=super.insert(e,t,r);else{const s=(Array.isArray(t)?t:[t]).reduce((e,t)=>{const r=t instanceof Model?this.indexOf(t):void 0;return void 0!==r&&-1!==r&&e.set(t,r),e},new Map);(n=super.insert(e,t))&&n.length&&(e=this.indexOf(n[0]),i.onStoreModelInsert(this,e,n,s,r))}return n}remove(e,t=!1,r){let n;const i=this.stm;if(this.tree||!i||i.disabled)n=super.remove(e,t,r);else{const s=(Array.isArray(e)?e:[e]).map(e=>this.getById(e)).filter(e=>!!e).reduce((e,t)=>{const r=this.indexOf(t);return void 0!==r&&-1!=r&&e.set(t,r),e},new Map);(n=super.remove(e,t,r))&&n.length&&i.onStoreModelRemove(this,n,s,t)}return n}removeAll(e){const t=this.stm;if(t&&!t.disabled){const r=this.allRecords.slice(0);super.removeAll(e),r.length&&0===this.count&&t.onStoreRemoveAll(this,this.tree?r[0].children:r,e)}else super.removeAll(e)}});class Store extends(base(Base).mixes(Events,Pluggable,State,StoreFilter,StoreCRUD,StoreRelation,StoreSum,StoreSearch,StoreSort,StoreGroup,StoreChained,StoreState,StoreTree,StoreStm)){static get properties(){return{relationCache:{}}}static get defaultConfig(){return{storeId:null,id:!0,fields:null,autoTree:!0,modelClass:Model,data:null,tree:!1,callOnFunctions:!0,storage:null}}construct(e={}){const t=this;t.added=new Bag,t.removed=new Bag,t.modified=new Bag,t.idRegister={},t.internalIdRegister={},super.construct(e),t.on({idChange:t.onRecordIdChange,update:t.onUpdateRecord,thisObj:t}),t.initRelations()}doDestroy(){const e=this,t=Object.values(e.idRegister);for(let r,n=t.length-1;n>=0;n--)(r=t[n])&&!r.isDestroyed&&r.unJoinStore(e);e.storage.destroy(),delete Store.storeMap[e.id],super.doDestroy()}beginBatch(){this.suspendEvents()}endBatch(){this.resumeEvents()&&this.trigger("refresh",{action:"batch",data:this.storage.values,records:this.storage.values})}set storage(e){const t=this;e&&e.isCollection?t._storage=e:t._storage=new Collection(e),t._storage.autoFilter=t.reapplyFilterOnAdd;for(const e of t._storage)e.joinStore(t);t._storage.on({change:"onDataChange",thisObj:t})}get storage(){return this._storage||(this.storage={}),this._storage}get allRecords(){const e=this;if(e.tree){const t=e.collectDescendants(e.rootNode).all;return e.rootVisible&&t.unshift(e.rootNode),t}return e.isGrouped?e.collectGroupRecords():e.storage.allValues}onDataChange({source:e,action:t,added:r,removed:n,replaced:i,oldCount:s,item:o,from:a,to:l}){const d=this,c=r&&r.length,u=n&&n.length;let h,g;if(d._idMap=null,c&&r.forEach(e=>{e.joinStore(d)}),super.onDataChange(...arguments),!d.tree){if(c){for(h of r)h.joinStore(d);d.added.add(r),d.removed.remove(r),(g=d.filtered&&d.reapplyFilterOnAdd)&&d.filter(null,null,!0)}if(u){for(h of n)h.unJoinStore(d),d.added.includes(h)?d.added.remove(h):d.removed.add(h);d.modified.remove(n),(g=d.filtered)&&d.filter(null,null,!0)}}switch(t){case"clear":d.relationCache&&(d.relationCache={}),d.trigger("removeAll"),d.trigger("change",{action:"removeall"});break;case"splice":if(c){const t=r.reduce((e,t)=>{const{previousIndex:r}=t.meta;return r>-1&&r<e&&(e=r),e},r[0].meta.previousIndex),n={records:r,index:e.indexOf(r[0])};t>-1&&(n.oldIndex=t),d.trigger("add",n),d.trigger("change",Object.assign({action:"add"},n)),g&&d.triggerFilterEvent({action:"filter",filters:d.filters,oldCount:s,records:d.storage.allValues})}n.length&&(d.trigger("remove",{records:n}),d.trigger("change",{action:"remove",records:n})),i.length&&(d.trigger("replace",{records:i,all:d.records.length===i.length}),d.trigger("change",{action:"replace",replaced:i,all:d.records.length===i.length}));break;case"filter":d.isGrouped?d.group():d.isSorted&&d.performSort();break;case"move":for(let e=d.storage.allValues,t=Math.min(a,l);t<=Math.max(a,l);t++)e[t].parentIndex=t;d.trigger("move",{record:o,from:a,to:l}),d.trigger("change",{action:t,record:o,from:a,to:l})}}get idMap(){const e=this.storage.values,t=!this._idMap,r=this._idMap||(this._idMap={});if(t)for(let t,n=0,i=0;n<e.length;n++)r[(t=e[n]).id]={index:n,visibleIndex:i,record:t},t.meta.specialRow||i++;return r}get modelClass(){return this._modelClass}set modelClass(e){const t=this.fields;let r=null;(r=t&&t.length?class extends e{static get fields(){return t}}:class extends e{}).exposeRelations(),this._modelClass=r}set storeId(e){this.id=e}get storeId(){return this.id}set id(e){const t=this;t._id&&delete Store.storeMap[t._id],t._id=!0===e?IdHelper.generateId("store-"):e,e&&(Store.storeMap[e]=t)}get id(){return this._id}get tree(){return this._tree}set tree(e){this._tree=e,e&&!this.rootNode&&(this.rootNode=this.buildRootNode())}buildRootNode(){return{}}static getStore(e,t){if(e instanceof Store)return e;if(this.storeMap[e])return this.storeMap[e];if(Array.isArray(e)){let r;e={autoCreated:!0,data:e.map(e=>(e instanceof Model?r=e.constructor:"string"==typeof e&&(e={text:e}),e)),modelClass:r||class extends Model{}},t||(t=Store)}return t?new t(e):void 0}static get stores(){return Object.values(this.storeMap)}get rootNode(){return this._rootNode}set rootNode(e){const t=this,r=t._rootNode;e!==r&&(r&&t.clear(!1),e instanceof Model?(e.instanceMeta(t).collapsed=!1,t._rootNode=e):(t._rootNode=e=new t.modelClass(Object.assign({expanded:!0,[t.modelClass.idField]:`${t.id}-rootNode`},e),t,null,!0),e.isAutoRoot=!0),t._tree=!0,e.isRoot=!0,e.joinStore(t),(e.children&&e.children.length||t.rootVisible)&&(e.isLoading=!0,t.onNodeAddChild(e,e.children||[],0),e.isLoading=!1),t.trigger("rootChange",{oldRoot:r,rootNode:e}))}set data(e){const t=this;if(t._thisIsAUsedExpression(t.plugins),t._data=e,t.tree=!t.chained&&(t.tree||Boolean(t.autoTree&&e&&e.some(e=>e.children))),t.tree){const r=t.rootNode;r.clearChildren(),r.isLoading=!0,r.appendChild(e),r.isLoading=!1,t.sorters.length&&t.sort(null,null,!1,!0)}else t.loadData(e);t.added.clear(),t.removed.clear(),t.modified.clear()}loadData(e){const t=this,r=t.storage;if(t.allCount&&t.clear(!1),t._idMap=null,e){if(!(e[0]instanceof Model)){t.modelClass.exposeProperties(e[0]);const n=e.length,i=new Array(n);for(let r=0;r<n;r++)i[r]=t.createRecord(e[r],!0),i[r].parentIndex=r;r.replaceValues(i,!0,!0)}else r.replaceValues(e.slice(),!0,!0);t.storage.allValues.forEach(e=>{e.joinStore(t)}),t.isFiltered&&t.filter(null,null,!0),t.groupers.length>0&&t.isGrouped&&t.group(null,null,!1,!t.sorters.length,!0),t.sorters.length&&t.sort(null,null,!1,!0);const n=t.idMap;if(Object.keys(n).length<t.storage.values.length){const e=[];throw t.storage.values.forEach(t=>n[t.id]?delete n[t.id]:e.push(t)),new Error(`Id collision on ${e.map(e=>e.id)}`)}const i={action:"dataset",data:e,records:t.storage.values};t.trigger("refresh",i),t.trigger("change",i)}else t._data=null}get data(){return this._data}getRange(e,t,r=!0){return(r?this.storage.allValues:this.storage.values).slice(e,t)}createRecord(e,t=!1){return new this.modelClass(e,this,null,t)}refreshData(){this.filter(),this.sort()}onRecordIdChange({record:e,oldValue:t,value:r}){const n=this,i=n._idMap,{idRegister:s}=n;n.storage._indicesInvalid=!0,i&&(delete i[t],i[r]=e),n.added.changeId(t,r),n.removed.changeId(t,r),n.modified.changeId(t,r),delete s[t],s[r]=e}onUpdateRecord({record:e,changes:t}){const{internalId:r}=t,{internalIdRegister:n}=this;r&&(this.storage._indicesInvalid=!0,delete n[r.oldValue],n[r.value]=e),this.reapplyFilterOnUpdate&&this.isFiltered&&this.filter()}getCount(e=!0){return e?this.count:this.originalCount}get originalCount(){return this.storage.totalCount}get count(){return this.storage.count}get allCount(){return this.tree?this.rootNode.descendantCount:this.storage.totalCount}get records(){return this.storage.values}get first(){return this.storage.values[0]}get last(){return this.storage.values[this.storage.values.length-1]}getAt(e,t=!1){return this.storage.getAt(e,t)}register(e){this.idRegister[e.id]=e,this.internalIdRegister[e.internalId]=e}unregister(e){delete this.idRegister[e.id],delete this.internalIdRegister[e.internalId]}getById(e){return e instanceof Model?e:this.idRegister[e]}isVisible(e){return this.storage.includes(this.getById(e))}getByInternalId(e){return this.internalIdRegister[e]}includes(e){return this.tree?null!=this.idRegister[Model.asId(e)]:this.indexOf(e)>-1}indexOf(e,t=!1){if(e instanceof Model&&(e=e.id),!e)return-1;if(this.tree)return this.storage.indexOf(e);{const r=this.idMap[e];return r?r[t?"visibleIndex":"index"]:-1}}allIndexOf(e){if(this.tree){let t=-1;const r=e instanceof Model?e:this.getById(e);return r&&r.bubble(e=>{e.parent?t+=e.parentIndex+1:e===this.rootNode&&this.rootVisible&&(t+=1)}),t}return this.storage.indexOf(e,!0)}getDistinctValues(e){const t=[],r={};let n;return this.forEach(i=>{i.meta.specialRow||i.isRoot||(n=i.get(e),r[n]||(t.push(n),r[n]=1))}),t}getValueCount(e,t){let r=0;return this.forEach(n=>{ObjectHelper.isEqual(n.get(e),t)&&r++}),r}get json(){return JSON.stringify(this,null,4)}toJSON(){return(this.tree?this.rootNode.children:this).map(e=>e.toJSON())}forEach(e,t=this){const r=(r,n)=>{if(!r.isRoot&&!r.meta.specialRow)return e.call(t,r,n)};if(this.tree)this.rootNode.traverseWhile(r);else{const e=this.storage.values;for(let t=0;t<e.length;t++)if(!1===r(e[t],t))return}}map(e,t=this){return this.storage.values.map(e,t)}reduce(e,t=[],r=this){return r!==this&&(e=e.bind(r)),this.storage.values.reduce(e,t,r)}[Symbol.iterator](){return this.storage.values[Symbol.iterator]()}traverse(e){if(this.tree)this.rootNode.traverse(e,!0);else for(let t of this.storage)t.traverse(e)}getNext(e,t=!1){let r=this.storage.values,n=this.indexOf(e);if(n>=r.length-1){if(!t)return null;n=-1}return r[n+1]}getPrev(e,t=!1){let r=this.storage.values,n=this.indexOf(e);if(0===n){if(!t)return null;n=r.length}return r[n-1]}getAdjacent(e,t=!0,r=!1){return t?this.getNext(e,r):this.getPrev(e,r)}getNextLeaf(e,t=!1){let r=this.leaves,n=this.getById(e),i=r.indexOf(n);if(i>=r.length-1){if(!t)return null;i=-1}return r[i+1]}getPrevLeaf(e,t=!1){let r=this.leaves,n=this.getById(e),i=r.indexOf(n);if(0===i){if(!t)return null;i=r.length}return r[i-1]}getAdjacentLeaf(e,t=!0,r=!1){return t?this.getNextLeaf(e,r):this.getPrevLeaf(e,r)}makeChained(e,t,r){return new this.constructor(Object.assign(r||{},{chained:!0,tree:!1,autoTree:!1,masterStore:this,chainedFilterFn:e,chainedFields:t}))}}Store.storeMap={},Store._$name="Store";class TextField extends Field{inputTemplate(){const e=this,t="inputWidth"in e?`style="width:${DomHelper.setLength(e.inputWidth)}"`:"";return TemplateHelper.tpl`<input type="${e.inputType||"text"}"
            reference="input"
            class="${e.inputCls||""}"
            placeholder="${e.placeholder}" 
            autocomplete="${e.autoComplete}"
            name="${e.name||e.id}"
            id="${e.id+"_input"}"
            ${t}/>`}set value(e){super.value="TextField"===this.$name&&null==e?"":e}get value(){return super.value}}TextField._$name="TextField",BryntumWidgetAdapterRegister.register("textfield",TextField),BryntumWidgetAdapterRegister.register("text",TextField);class PickerField extends TextField{static get defaultConfig(){return{editable:!0,pickerAlignElement:"inputWrap",value:null,triggers:{expand:{cls:"bars"}},autoExpand:null,picker:null,inputType:"text",monitorResize:!0}}doDestroy(){const e=this;e.globalTapListener&&e.globalTapListener(),e._picker&&(e.hidePicker(),e._picker.destroy(),e.pickerVisible=!1),super.doDestroy()}finalizeInit(){super.finalizeInit();const e=this,t=e.element;!1===e.editable?(t.classList.add("b-not-editable"),EventHelper.on({element:e.input,click:"onTriggerClick",thisObj:e})):e.globalTapListener=GlobalEvents.on({globaltap:"showKeyboard",thisObj:e})}onEditComplete(){super.onEditComplete(),this.pickerVisible&&this.hidePicker()}onElementResize(e){const t=this;t.pickerVisible&&t.picker.realign(),super.onElementResize(e)}focus(){const e=this.input;DomHelper.isTouchEvent&&this.editable&&(e.readOnly=!0,setTimeout(()=>e.readOnly=!1,500)),super.focus()}onInternalKeyDown(e){const t=this;if(!t.disabled)if(t.pickerVisible){const{picker:r}=t;"Escape"===e.key?(e.stopPropagation(),t.hidePicker()):r.onInternalKeyDown?r.onInternalKeyDown(e):"ArrowDown"===e.key&&r.focusable&&r.focus()}else"ArrowDown"===e.key&&t.onTriggerClick(e)}onFocusIn(e){super.onFocusIn(e),this.autoExpand&&this.onTriggerClick(e)}onFocusOut(e){this.hidePicker(),super.onFocusOut(e)}onTriggerClick(e){this.disabled||this.togglePicker("key"in e)}showKeyboard({event:e}){const t=this.input;DomHelper.isTouchEvent&&document.activeElement===t&&e.target===t&&(GlobalEvents.suspendFocusEvents(),t.blur(),t.focus(),GlobalEvents.resumeFocusEvents())}togglePicker(e){this.pickerVisible?this.hidePicker():this.showPicker(e)}showPicker(e){const t=this,r=t.picker;t.pickerHideShowListenersAdded||(r.on({show:"onPickerShow",hide:"onPickerHide",thisObj:t}),t.pickerHideShowListenersAdded=!0),r.show(),r.isVisible&&e&&t.focusPicker()}onPickerShow(){const e=this;e.pickerVisible=!0,e.element.classList.add("b-open"),e.trigger("togglePicker",{show:!0}),e.pickerTapOutRemover=GlobalEvents.on({globaltap:"onPickerTapOut",thisObj:e}),e.pickerKeyDownRemover=EventHelper.on({element:e.picker.element,keydown:"onPickerKeyDown",thisObj:e})}onPickerHide(){const e=this;e.pickerVisible=!1,e.element.classList.remove("b-open"),e.trigger("togglePicker",{show:!1}),e.pickerTapOutRemover&&e.pickerTapOutRemover(),e.pickerKeyDownRemover&&e.pickerKeyDownRemover()}onPickerTapOut({event:e}){this.owns(e.target)||this.hidePicker()}onPickerKeyDown(e){if("Tab"===e.key){const t=document.activeElement;this.input.dispatchEvent(new KeyboardEvent("keydown",e)),document.activeElement===t?this.input.focus():e.preventDefault(),this.isDestroyed||this.hidePicker()}}hidePicker(){this.pickerVisible&&this.picker.hide()}focusPicker(){}}PickerField._$name="PickerField";class Navigator extends(Events(Base)){static get defaultConfig(){return{ownerCmp:null,target:null,keyEventTarget:null,processEvent:null,itemSelector:null,focusCls:"b-active",keys:null,allowCtrlKey:null,allowShiftKey:null}}set itemSelector(e){this._itemSelector=e}get itemSelector(){return this._itemSelector||`.${this.ownerCmp.itemCls}`}onKeyDown(e){const t=this,r=t.ownerCmp,n=t.activeItem,i=t.target.querySelector(t.itemSelector),s=e.key.trim()||e.code,o=`${e.ctrlKey?"CTRL+":""}${e.shiftKey?"SHIFT+":""}${e.altKey?"ALT+":""}${s}`;if(i&&t.target.offsetParent){if(null==t.inlineFlow){let e=i.parentNode,r=DomHelper.getStyleValue(i,"position"),n=DomHelper.getStyleValue(i,"display"),s=DomHelper.getStyleValue(i,"float");t.inlineFlow="absolute"===r||"inline"===n||"inline-block"===n||"left"===s||"right"===s||"flex"===DomHelper.getStyleValue(e,"display")&&"row"===DomHelper.getStyleValue(e,"flex-direction"),t.inlineFlow?(t.prevKey="ArrowLeft",t.nextKey="ArrowRight"):(t.prevKey="ArrowUp",t.nextKey="ArrowDown")}if(t.processEvent&&!(e=t.processEvent.call(r,e)))return;if(n)switch(s){case t.prevKey:if(t.disabled||e.ctrlKey&&!t.allowCtrlKey)return;if(e.shiftKey&&!t.allowShiftKey)return;e.preventDefault(),t.navigatePrevious(e);break;case t.nextKey:if(t.disabled||e.ctrlKey&&!t.allowCtrlKey)return;if(e.shiftKey&&!t.allowShiftKey)return;e.preventDefault(),t.navigateNext(e);break;default:let n=t.keys&&t.keys[o];n&&!t.disabled?t.callback(n,t.thisObj||r,[e]):r.onInternalKeyDown&&r.onInternalKeyDown(e)}else t.activeItem=t.previousActiveItem||t.getDefaultNavigationItem(e);t.activeItem!==n&&t.trigger("navigate",{event:e,item:t.activeItem})}}getDefaultNavigationItem(e){const{target:t,itemSelector:r,prevKey:n,nextKey:i}=this;return 4&t.compareDocumentPosition(e.target)&&e.key===n?t.querySelector(`${r}:last-of-type`):2&t.compareDocumentPosition(e.target)&&e.key===i?t.querySelector(`${r}`):void 0}navigatePrevious(e){const t=this,r=t.previous;e.preventDefault(),r&&t.ownerCmp.scrollable.scrollIntoView(r,{animate:50}).then(()=>{t.activeItem=r,t.trigger("navigate",{event:e,item:t.activeItem})})}navigateNext(e){const t=this,r=t.next;e.preventDefault(),r&&t.ownerCmp.scrollable.scrollIntoView(r,{animate:50}).then(()=>{t.activeItem=r,t.trigger("navigate",{event:e,item:t.activeItem})})}get owner(){return this.ownerCmp}get previous(){const e=this.treeWalker;if(e.currentNode=this.activeItem,e.previousNode(),e.currentNode!==this.activeItem)return e.currentNode}get next(){const e=this.treeWalker;if(e.currentNode=this.activeItem,e.nextNode(),e.currentNode!==this.activeItem)return e.currentNode}onTargetFocusIn(e){e.target.matches(this.itemSelector)&&(this.activeItem=e.target)}onTargetFocusOut(e){e.relatedTarget&&this.target.contains(e.relatedTarget)||(this.activeItem=null)}onTargetMouseDown(e){this.onFocusGesture(e)}onTargetClick(e){const t=this;t.disabled||(t.processEvent&&(e=t.processEvent.call(t.ownerCmp,e)),e&&(t.activeItem=e.target.closest(t.itemSelector),t.trigger("navigate",{event:e,item:t.activeItem})))}onFocusGesture(e){(e.target===this.ownerCmp.contentElement||e.target.closest(this.itemSelector)&&!1===this.ownerCmp.itemsFocusable)&&e.preventDefault()}acceptNode(e){return e.offsetParent&&e.matches&&e.matches(this.itemSelector)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}get activeItem(){return this._activeItem}set activeItem(e){const t=this,r=t.ownerCmp.scrollable;"number"==typeof e&&(e=t.target.querySelectorAll(t.itemSelector)[e]),e?DomHelper.isFocusable(e)&&e!==document.activeElement?r.scrollIntoView(e,{block:"nearest",focus:!0,silent:t.scrollSilently}):(t.activeItem&&(t.previousActiveItem=t.activeItem,t.activeItem.classList.remove(t.focusCls)),r.scrollIntoView(e,{block:"nearest",silent:t.scrollSilently}),e.classList.add(t.focusCls),t._activeItem=e):(e===document.activeElement?t.ownerCmp.revertFocus():t.activeItem&&t.activeItem.classList.remove(t.focusCls),t.previousActiveItem=t.target.contains(t.activeItem)?t.activeItem:null,t._activeItem=null)}get target(){return this._target}set target(e){const t=this,r={element:e,thisObj:t,focusin:"onTargetFocusIn",focusout:"onTargetFocusOut",click:"onTargetClick"};t._target=e,t.hasOwnProperty("acceptNode")||(t.acceptNode=t.acceptNode.bind(t),t.acceptNode.acceptNode=t.acceptNode),!1===t.ownerCmp.itemsFocusable&&(r.mousedown="onTargetMouseDown"),EventHelper.on(r),t.treeWalker=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,t.acceptNode,!1),t.keyEventTarget||(t.keyEventTarget=e),(t.targetMutationMonitor=new MutationObserver(t.onTargetChildListChange.bind(t))).observe(e,{childList:!0})}onTargetChildListChange(){const e=this.activeItem;e&&!this.target.contains(e)&&(this.activeItem=this.target.querySelector(`${this.itemSelector}[data-id="${e.dataset.id}"]`))}get keyEventTarget(){return this._keyEventTarget}set keyEventTarget(e){this._keyEventTarget=e,EventHelper.on({element:e,keydown:"onKeyDown",thisObj:this})}}Navigator._$name="Navigator";const itemRange=document.createRange();class List extends Widget{static get defaultConfig(){return{itemCls:"b-list-item",selectedCls:"b-selected",items:null,store:null,navigator:!0,scrollable:{x:!1,y:!0},itemsFocusable:!0,multiSelect:!1,itemTpl:e=>e.text,selected:{},activateOnMouseover:null}}construct(e,...t){const r=this;Array.isArray(e)&&(e={items:e}),super.construct(e,...t);const n=r.element,i=n.classList;r.multiSelect&&i.add("b-multiselect"),r.store.count?r.refresh():i.add("b-empty"),EventHelper.on({element:n,delegate:r.itemSelector,mouseover:"onMouseOver",click:"onClick",thisObj:r}),r.storeDetacher=r.store.on({change:"onStoreChange",refresh:"onStoreRefresh",thisObj:r})}doDestroy(){this.storeDetacher&&this.storeDetacher(),super.doDestroy()}contentTpl(){return TemplateHelper.tpl`${this.store.records.map((e,t)=>this.itemWrapperTpl(e,t))}`}itemWrapperTpl(e,t){return TemplateHelper.tpl`<div class="${this.getItemClasses(e,t)}" data-index="${t}" data-id="${e.id}" ${this.itemsFocusable?'tabindex="-1"':""}>
            ${this.itemContentTpl(e,t)}
            </div>`}itemContentTpl(e,t){return TemplateHelper.tpl`${this.multiSelect?'<div class="b-selected-icon b-icon b-icon-check"></div>':""}${this.itemTpl(e,t)}`}getItemClasses(e){const t=this,r=t._navigator&&t._navigator.activeItem,n=r&&r.dataset.id==e.id,i=t.selected.includes(e);return`${t.itemCls} ${e.cls||""} ${i?t.selectedCls:""} ${n?t.navigator.focusCls:""}`}onStoreChange({source:e,action:t,records:r,record:n}){switch(t){case"remove":this.selected.remove(r);break;case"clear":this.selected.clear();break;case"update":return void this.refreshItem(n)}this.refresh()}onStoreRefresh(){this.refresh()}refresh(){const e=this;e.isVisible?(e.clearItems().insertNode(DomHelper.createElementFromTemplate(e.contentTpl(),{fragment:!0})),e.element.classList[e.store.count>0?"remove":"add"]("b-empty")):e.on({paint:()=>e.refresh(),once:!0})}clearItems(){const e=this,t=e.contentElement.querySelector(e.itemSelector),r=e.contentElement.lastChild;return t?(itemRange.setStartBefore(t),itemRange.setEndAfter(e.contentElement.querySelector(`${e.itemSelector}:last-of-type`)),itemRange.deleteContents()):r?(itemRange.setStartAfter(r),itemRange.setEndAfter(r)):(itemRange.setStart(e.contentElement,0),itemRange.setEnd(e.contentElement,0)),itemRange}refreshItem(...e){for(const t of e){const e=this.getItem(t);if(e){const r=this.store.indexOf(t),n=DomHelper.createElementFromTemplate(this.itemWrapperTpl(t,r));DomHelper.sync(n,e)}}}getItem(e){return"number"==typeof e?this.contentElement.querySelector(`[data-index="${e}"]`):(null!=e.id&&(e=e.id),this.contentElement.querySelector(`[data-id="${e}"]`))}getRecord(e){return e.target&&(e=e.target),e=e.closest(this.itemSelector),this.store.getAt(parseInt(e.dataset.index))}set items(e){const t=this;t.store&&t.store.autoCreated&&t.store.destroy(),t.store=Store.getStore(e)}set selected(e){e&&e instanceof Collection||(e=new Collection(e)),this._selected=e,e.on({change:"onSelectionChange",thisObj:this})}get itemSelector(){return`.${this.itemCls}`}get selected(){return this._selected}get store(){return this._thisIsAUsedExpression(this.items),this._store}set store(e){e instanceof Store||(e=new Store(e)),this._store=e}get navigator(){return this._navigator}set navigator(e){const t=this,{element:r}=t;t._navigator=r?new(e.class||Navigator)(Object.assign({ownerCmp:t,target:r,keyEventTarget:r},e)):e}get minHeight(){return super.minHeight}set minHeight(e){super.minHeight=this._minHeight=e}get minAlignHeight(){const e=this.element.lastElementChild,t=this.minHeight;if(null!=t)return this.store.count?Math.min(e.offsetTop+e.offsetHeight,t):0}alignTo(...e){super.minHeight=this.minAlignHeight,super.alignTo(...e)}hide(){this.navigator.activeItem=null,super.hide()}show(){super.minHeight=this._minHeight;let e=this.navigator.previousActiveItem;super.show(),e&&(this.element.contains(e)||(e=this.element.querySelector(`[data-id="${e.dataset.id}"]`)),this.navigator.activeItem=e)}onMouseOver(e){const t=this,r=e.target.closest(t.itemSelector);r&&t.navigator&&t.activateOnMouseover&&(t.navigator.activeItem=r)}onClick(e){const t=e.target.closest(this.itemSelector);t&&this.onItemClick(t,e)}onInternalKeyDown(e){const t=this.navigator.activeItem;switch(e.key){case" ":if(!e.target.readOnly)break;case"Enter":t&&(this.onItemClick(t,e),e.stopImmediatePropagation(),e.preventDefault())}}onItemClick(e,t){const r=this,n=parseInt(e.dataset.index),i=r.store.getAt(n),s=r.selected,o=s.includes(i);r.trigger("item",{item:e,record:i,index:n,event:t}),e.contains(t.target.closest("[data-noselect]"))||(r.multiSelect?s[o?"remove":"add"](i):s.splice(0,s.count,i)),r.lastClicked=i}onSelectionChange({action:e,removed:t,added:r,replaced:n}){const i=this,{selectedCls:s}=i;let o,a;if("clear"===e)for(a of i.element.querySelectorAll(`.${s}`))a.classList.remove(s);else{for(o of t)(a=i.getItem(o))&&a.classList.remove(s);for(o of r)(a=i.getItem(o))&&a.classList.add(s)}}}List.prototype.navigatorClass=Navigator,List._$name="List",BryntumWidgetAdapterRegister.register("list",List);class ChipView extends List{static get defaultConfig(){return{itemCls:"b-chip",closable:!0,iconTpl:null,closeHandler:null}}itemContentTpl(e,t){return TemplateHelper.tpl`${this.iconTpl?this.iconTpl(e):""}
            ${this.itemTpl(e,t)}
            ${this.closable?'<div class="b-icon b-close-icon b-icon-clear" data-noselect></div>':""}`}onInternalKeyDown(e){"Delete"===e.key||"Backspace"===e.key&&this.selected.count?this.callback(this.closeHandler,this.owner,this.selected.values):super.onInternalKeyDown(e)}onClick(e){const t=this,r=e.target.closest(`.${t.itemCls}`);if(t.closable&&e.target.classList.contains("b-close-icon")){const e=t.store.getAt(parseInt(r.dataset.index));t.callback(t.closeHandler,t.owner,[e])}else super.onClick(e)}}ChipView._$name="ChipView",BryntumWidgetAdapterRegister.register("chipview",ChipView);const comboQueryAll=Symbol("Combo.queryAll"),comboQueryLast=Symbol("Combo.queryLast"),fieldRequiredErrorName="fieldRequired",fieldvalidateFilterErrorName="validateFilter";class Combo extends PickerField{static get defaultConfig(){return{items:null,store:null,valueField:null,displayField:"text",pickerWidth:null,minChars:1,selected:null,listItemTpl:null,displayValueRenderer:null,listCls:null,triggers:{expand:{cls:"b-icon-picker",handler:"onTriggerClick"}},overlayAnchor:null,keyStrokeFilterDelay:null,defaultAction:"select",triggerAction:comboQueryAll,filterOperator:"startsWith",caseSensitive:!1,multiSelect:null,hidePickerOnSelect:null,chipView:null,filterSelected:null,emptyText:null,value:null,validateFilter:!0}}afterConfigure(){super.afterConfigure(),"_value"in this||(this._value=this.valueField===this.displayField?"":null)}eachWidget(e,t=!0){for(const r of[this.chipView,this._picker])if(r){if(!1===e(r))return;t&&r.eachWidget&&r.eachWidget(e,t)}}set element(e){const t=this;super.element=e,t.multiSelect&&(t.element.classList.add("b-multiselect"),t.chipView=new MultiSelectChipView(ObjectHelper.assign({parent:t,insertBefore:t.input,store:t.chipStore=new Store({storage:t.valueCollection}),navigator:{class:MultiSelectChipNavigator,keyEventTarget:t.input}},t.chipView)),t.chipView.element.appendChild(t.input),EventHelper.on({element:t.chipView.element,mousedown:"onChipViewMousedown",thisObj:t}))}onChipViewMousedown(e){e.preventDefault(),this.containsFocus||this.focus()}onChipClose(...e){this.valueCollection.remove(e)}get element(){return super.element}set keyStrokeFilterDelay(e){const t=this;e&&(t.filterList=t.buffer(t.doFilter,e)),t._keyStrokeFilterDelay=e}get keyStrokeFilterDelay(){return this._keyStrokeFilterDelay}set items(e){if(null==e&&(e=[]),e instanceof Store)return this.store=e;let t,r,n=this.valueField;const i=this,s=i.displayField;if(Array.isArray(e)?r=e.map(e=>{let r=e;return e instanceof Model?(t=e.constructor,n||(i.valueField=n=t.idField)):"string"==typeof e?(n||(i.valueField=n=i.displayField),r={[n]:e,[s]:e}):(n||(i.valueField=n="value"),Array.isArray(e)&&(r={[n]:e[0],[s]:e[1]})),r.selected&&(i.value=r),r}):(n||(i.valueField=n="value"),r=[],Object.entries(e).forEach(([e,t])=>{r.push({[n]:e,[s]:t})})),i.store)i.store.data=r;else{const e=n===s?{name:"value",dataSource:s}:n;i.store=new Store({data:r,idField:n,modelClass:t||class extends Model{static get idField(){return n}static set idField(e){super.idField=e}static get fields(){return[e,s]}}})}}get items(){return this.store.allRecords}set value(e){const t=this;if(e===t.value){const e=t.highlightExternalChange;return t.highlightExternalChange=!1,t.syncInputFieldValue(),void(t.highlightExternalChange=e)}if(!t.multiSelect&&Array.isArray(e)&&e.length>1)throw new Error("Multiple values cannot be set to a non-multiselect Combo");t._thisIsAUsedExpression(t.items);const{valueField:r,displayField:n,store:i,valueCollection:s}=t;let o;if(i.filtered&&(t.primaryFilter.disabled=!0,i.filter()),null!=e){const a=Array.isArray(e)?e:[e];for(let e=0,t=a.length;e<t;e++){let s=a[e];if(s instanceof Model)i.storage.includes(s)||i.add(s);else{const l=s instanceof Object;l&&(s=s[r]),(o=i.storage.getBy(n,s)||i.storage.getBy(r,s))?(l&&o.set(a[e]),a[e]=o):(a.splice(e,1),t--,e--)}}const l=s.generation;s.splice(0,s.count,a),s.generation===l&&t.syncInputFieldValue(),a.length||(t._value=e)}else if(s.count)s.clear();else{const r=t._value;t._value=null,t.syncInputFieldValue(),t.updateEmpty(),t.isConfiguring||t.trigger("change",{value:e,oldValue:r,userAction:t._isUserAction,valid:t.isValid})}}get value(){const e=this;return e.multiSelect?e.valueCollection.map(t=>t[e.valueField]):e.valueCollection.count?e.valueCollection.first[e.valueField]:e._value}syncInputFieldValue(){this.multiSelect||super.syncInputFieldValue()}get isEmpty(){return 0===this.valueCollection.count}get isValid(){return this.required&&!this.valueCollection.count&&this.setError(fieldRequiredErrorName,!0),super.isValid}get inputValue(){let e=this,t=e.value;return t=e.selected?e.selected[e.displayField]:t,e.displayValueRenderer&&(t=this.displayValueRenderer(e.selected)),null==t?"":t}set displayValueRenderer(e){this._displayValueRenderer=e}get displayValueRenderer(){return this._displayValueRenderer}get valueCollection(){return this._valueCollection||(this._valueCollection=new Collection({listeners:{change:"onValueCollectionChange",prio:-1e3,thisObj:this}})),this._valueCollection}set store(e){const t=this,r=[];if(Array.isArray(e))return t.initialConfig.store=null,t.items=e;if(t.valueField||(t.valueField=e.modelClass.idField),!t.primaryFilter){const e="primary";t.primaryFilter=new CollectionFilter({id:e,property:t.displayField,operator:t.filterOperator,disabled:!0,caseSensitive:t.caseSensitive})}r.push(t.primaryFilter),t.filterSelected&&(t.selectedItemsFilter=(e=>!t.valueCollection.includes(e)),r.push(t.selectedItemsFilter)),e.filter(r),t._store=e,e.storage.addIndex(t.displayField),e.storage.addIndex(t.valueField),t.displayValueRenderer&&(e.on({change:()=>t.syncInputFieldValue()}),t.syncInputFieldValue())}get store(){return this._store}get record(){return this.selected}get records(){return this.valueCollection.values.slice()}get selected(){return this.valueCollection.first}onEditComplete(){const e=this,t=e.valueCollection.count;super.onEditComplete(),t&&(e.clearError(fieldvalidateFilterErrorName),e.syncInputFieldValue()),e.required&&!t&&e.setError(fieldRequiredErrorName)}onTriggerClick(){const e=this;if(e.pickerVisible)e.hidePicker();else if(!e.readOnly&&!e.disabled)switch(e.triggerAction){case comboQueryAll:e.doFilter(null);break;case comboQueryLast:e.doFilter(e.lastQuery);break;default:e.doFilter(e.input.value)}}internalOnInput(e){const t=this,r=t.input.value.length;t.editable&&(t.updateEmpty(),r>=t.minChars?t.filterList(t.input.value):(t.validateFilter&&t[r?"setError":"clearError"](fieldvalidateFilterErrorName),t.hidePicker()),t.trigger("input",{value:t.input.value,event:e}))}filterList(e){this.doFilter(e)}doFilter(e){const t=this,r=t.store,n=null==e||""==e;t.lastQuery=e,t.primaryFilter.setConfig({value:e,disabled:n}),r.filter(),t.showPicker(),r.count?n||(t.picker.navigator.activeItem=0):!n&&t.validateFilter&&t.setError(fieldvalidateFilterErrorName)}onValueCollectionChange({source:e}){const t=this,{multiSelect:r}=t,n="hidePickerOnSelect"in t?t.hidePickerOnSelect:!r,i=r?e.values.slice():e.first,s=e.values.slice(),o=t._isUserAction||n&&t.pickerVisible||!1,a=t._value;n&&t.hidePicker(),!e.count&&t.required?t.setError(fieldRequiredErrorName):(t.clearError(fieldRequiredErrorName),t.clearError(fieldvalidateFilterErrorName)),t.validateFilter&&i&&t.clearError(fieldvalidateFilterErrorName),t.filterSelected&&t.store.filter(),t._value=null;const l=t._value=t.value;t.syncInputFieldValue(),t.updateEmpty(),t.isConfiguring||(t.trigger("change",{value:l,oldValue:a,userAction:o,valid:t.isValid}),t.trigger("select",{record:i,records:s}),"select"===t.defaultAction&&t.trigger("action",{value:l,record:i,records:s}))}get picker(){return this._picker||(this.picker=!0),this._picker}set picker(e){const t=this;t._picker&&t._picker.destroy(),t._picker=e instanceof Widget?e:t.createPicker(e)}showPicker(){const e=this,{picker:t}=e;super.showPicker(),e.overlayAnchor&&!t.align.offset&&(t.align.offset=-t.anchorSize[1],t.realign()),e.selected&&(t.navigator.activeItem=e.store.indexOf(e.selected)),e.input.focus()}createPicker(e){const t=this,{multiSelect:r,pickerWidth:n}=t,i=new List(ObjectHelper.merge({owner:t,floating:!0,scrollAction:"realign",itemsFocusable:!1,activateOnMouseover:!0,store:t.store,selected:t.valueCollection,multiSelect:r,cls:t.listCls,itemTpl:t.listItemTpl||(e=>e[t.displayField]),forElement:t[t.pickerAlignElement],align:{align:"t-b",axisLock:!0,matchSize:null==n,anchor:t.overlayAnchor,target:t[t.pickerAlignElement]},width:n,navigator:{keyEventTarget:t.input},maxHeight:324,scrollable:{overflowY:!0},autoShow:!1,focusOnHover:!1},e));return i.element.dataset.emptyText=t.emptyText||t.L("No results"),i}}Combo.queryAll=comboQueryAll,Combo.queryLast=comboQueryLast;class MultiSelectChipView extends ChipView{static get defaultConfig(){return{cls:"b-combo-chip-list",itemsFocusable:!1,multiSelect:!0,closeHandler:"up.onChipClose",itemTpl:function(e){return e[this.owner.displayField]}}}}class MultiSelectChipNavigator extends Navigator{static get defaultConfig(){return{allowShiftKey:!0}}onTargetClick(e){const t=e.target.closest(this.itemSelector);!t||e.shiftKey||t.contains(e.target.closest("[data-noselect]"))||this.ownerCmp.selected.clear(),super.activeItem=t}onKeyDown(e){"Enter"!==e.key&&super.onKeyDown(e)}set activeItem(e){const t=this.ownerCmp;super.activeItem=e,e&&t.selected.add(t.getRecord(e))}get activeItem(){return super.activeItem}navigatePrevious(e){const t=this.ownerCmp;this.previous&&(t.navigator.activeItem&&!e.shiftKey&&t.selected.clear(),super.navigatePrevious(e))}navigateNext(e){const t=this.ownerCmp;t.navigator.activeItem&&!e.shiftKey&&t.selected.clear(),this.next?super.navigateNext(e):this.activeItem=null}}Combo._$name="Combo",BryntumWidgetAdapterRegister.register("combo",Combo),BryntumWidgetAdapterRegister.register("combobox",Combo),BryntumWidgetAdapterRegister.register("dropdown",Combo);class Month{constructor(e){let{date:t,weekStartDay:r,sixWeeks:n}=e;this.constructor.updateDayNumbers(r),this.sixWeeks=n,this.date=t}set date(e){if(!(e instanceof Date)){if(e=new Date(e),isNaN(e))throw new Error("Month constructor must be passed a Date, or a valid argument to the Date constructor");const t=e.getTimezoneOffset();t&&(e=DateHelper.add(e,t,"minute"))}const t=this,r=DateHelper.getFirstDateOfMonth(e),n=DateHelper.getLastDateOfMonth(r),i=t.dayNumbers[r.getDay()],s=t.dayNumbers[n.getDay()];if(t._date=e,t.startDayOfMonth=1-i,t.endDayOfMonth=n.getDate()+(6-s),t.sixWeeks)for(;t.weekCount<6;)t.endDayOfMonth+=7;t.year=e.getFullYear(),t.month=e.getMonth();const o=new Date(t.year,0,1),a=new Date(t.year,1,31),l=t.month?new Month({date:o,weekStartDay:t.weekStartDay}):t;t.dayNumbers[o.getDay()]>3?t.weekBase=l.startDate:t.weekBase=new Date(t.year,0,l.startDayOfMonth-7),t.has53weeks=a.getDay()<4}get date(){return this._date}get dayCount(){return this.endDayOfMonth+1-this.startDayOfMonth}get weekCount(){return this.dayCount/7}get startDate(){return new Date(this.year,this.month,this.startDayOfMonth)}get endDate(){return new Date(this.year,this.month,this.endDayOfMonth)}eachDay(e){const t=this;for(let r=t.startDayOfMonth;r<=t.endDayOfMonth;r++)e(new Date(t.year,t.month,r))}eachWeek(e){const t=this,{weekCount:r}=t;for(let n=t.startDayOfMonth,i=0;i<r;i++){const r=[],i=t.getWeekNumber(new Date(t.year,t.month,Math.max(n,1)));for(let e=0;e<7;e++,n++)r.push(new Date(t.year,t.month,n));e(i,r)}}getWeekNumber(e){const t=this,{weekStartDay:r}=t;if((e=DateHelper.clearTime(e))<t.startDate||e>t.endDate)return new Month({date:e,weekStartDay:r}).getWeekNumber(e);let n=Math.floor((e-t.weekBase)/864e5/7),i=e.getFullYear();if(!n){const e=new Date(t.year,0,0);return new Month({date:e,weekStartDay:r}).getWeekNumber(e)}return 53!==n||t.has53weeks||(n=1,i++),[i,n]}static applyLocale(){this.updateDayNumbers()}static updateDayNumbers(e=DateHelper.weekStartDay){const t=this.prototype,r=t.dayNumbers=[],n=t.canonicalDayNumbers=[];t.weekStartDay=e;for(let t=0;t<7;t++){const i=(e+t)%7;n[t]=i,r[i]=t}}}LocaleManagerSingelton.on({locale:"applyLocale",thisObj:Month}),Month._$name="Month";class CalendarPanel extends Panel{static get defaultConfig(){return{weekStartDay:null,sixWeeks:!0,showWeekNumber:!1,disabledDates:null,headerRenderer:null,weekRenderer:null,cellRenderer:null,disableWeekends:null,tip:null,cellCls:"b-calendar-cell",disabledCls:"b-disabled-date",otherMonthCls:"b-other-month",weekendCls:"b-weekend",todayCls:"b-today"}}construct(e){LocaleManagerSingelton.on({locale:calculateDayNames}),calculateDayNames(),super.construct(e),this.refresh()}ingestDate(e){if(!(e instanceof Date)){if(e=new Date(e),isNaN(e))throw new Error("CalendarPanel date ingestion must be passed a Date, or a valid argument to the Date constructor");const t=e.getTimezoneOffset();t&&(e=DateHelper.add(e,t,"minute"))}return DateHelper.clearTime(e)}set tip(e){this._tip=new Tooltip(Object.assign({forElement:this.element,forSelector:".b-calendar-cell"},e)),this._tip.on({pointerOver:"onTipOverCell",thisObj:this})}get tip(){return this._tip}get element(){return super.element}set element(e){super.element=e,this.weekElements=Array.from(this.element.querySelectorAll(".b-calendar-week")),this.cellElements=Array.from(this.element.querySelectorAll(".b-calendar-week > div"))}set date(e){const t=this;e=t._date=t.ingestDate(e),t.month&&t.month.month===e.getMonth()||(t.month=new Month({date:e,weekStartDay:t.weekStartDay,sixWeeks:t.sixWeeks})),t.refresh()}get date(){return this._date}set showWeekNumber(e){const t=this;t.element.classList[e?"add":"remove"]("b-show-week-number"),t.floating&&(t.isAligning||t.realign())}refresh(){const e=this,t=DateHelper.clearTime(new Date),{cellElements:r,weekElements:n,date:i,month:s,cellCls:o,disabledCls:a,otherMonthCls:l,weekendCls:d,todayCls:c}=e;if(!i)return e.date=t;for(let e=0,t=r.length;e<t;e++)r[e].className=r[e].innerHTML="";for(let t=0;t<7;t++){const r=e.weekdayCells[t];r.className=r.innerHTML="",e.headerRenderer?e.headerRenderer(r,t):r.innerHTML=shortDayNames[e.canonicalDayNumbers[t]],r.classList.add("b-calendar-day-header")}let u=0,h=0;s.eachWeek((r,i)=>{const g=n[u].children;g[0].className="b-week-number-cell",e.weekRenderer?e.weekRenderer(g[0],r):g[0].innerHTML=r[1];for(let r=0;r<7;r++){const n=i[r],u=n.getDay(),m=g[r+1],p=m.classList;p.add(o),e.isDisabledDate(n)&&p.add(a),n.getMonth()!==s.month&&p.add(l),0!==u&&6!==u||p.add(d),n.getTime()===t.getTime()&&p.add(c),m.dataset.date=DateHelper.format(n,"YYYY-MM-DD"),m.dataset.cellIndex=h,e.cellRenderer?e.cellRenderer(m,n):m.innerHTML=n.getDate(),h++}u++}),e.floating&&(e.isAligning||e.realign())}isDisabledDate(e){const t=e.getDay(),r=this.disabledDates;if(this.disableWeekends&&(0===t||6===t))return!0;if(r){if("function"==typeof r)return r(e);if(Array.isArray(r))return r.some(t=>DateHelper.clearDate(t,!0).getTime()===DateHelper.clearDate(e,!0).getTime())}}get bodyConfig(){const e=super.bodyConfig,t=[];e.children=[{tag:"div",className:"b-calendar-row b-calendar-weekdays",children:this.dayNameCells},{className:"b-weeks-container",children:t}];for(let e=0;e<6;e++){let e={className:"b-calendar-row b-calendar-week",children:[]};for(let t=0;t<8;t++)e.children.push({});t.push(e)}return e}set weekStartDay(e){const t=this,r=t.dayNames=[],n=t.dayNumbers=[],i=t.canonicalDayNumbers=[];t._weekStartDay=e||DateHelper.weekStartDay;for(let e=0;e<7;e++){const s=(t._weekStartDay+e)%7;i[e]=s,n[s]=e,r[e]=shortDayNames[s]}}get weekStartDay(){return this.hasOwnProperty("_weekStartDay")||(this.weekStartDay=void 0),this._weekStartDay}get dayNameCells(){const e=document.createElement("div"),t=[e],r=this.weekdayCells=[];e.className="b-week-number-cell",this._thisIsAUsedExpression(this.weekStartDay);for(let e=0;e<7;e++){const e=document.createElement("div");t.push(e),r.push(e)}return t}onTipOverCell({source:e,target:t}){e.date=DateHelper.parse(t.dataset.date,"YYYY-MM-DD")}}function calculateDayNames(){shortDayNames.length=0;for(let e=2;e<9;e++)d.setDate(e),shortDayNames.push(DateHelper.format(d,"ddd"))}const d=new Date("2000-01-01T00:00:00"),shortDayNames=[];CalendarPanel._$name="CalendarPanel",BryntumWidgetAdapterRegister.register("calendarpanel",CalendarPanel);class DatePicker extends CalendarPanel{static get defaultConfig(){return{focusable:!0,tools:{prevMonth:{align:"start",cls:"b-icon b-icon-angle-left",handler:"gotoPrevMonth"},nextMonth:{align:"end",cls:"b-icon b-icon-angle-right",handler:"gotoNextMonth"}},header:{title:"",titleAlign:"center"},minDate:null,maxDate:null,outOfRangeCls:"b-out-of-range",activeCls:"b-active-date",selectedCls:"b-selected-date",focusDisabledDates:null,multiSelect:!1}}construct(e){const t=this;t.selection=[],t.refresh=t.createOnFrame(t.refresh),super.construct(e),t.element.setAttribute("aria-activedescendant",`${t.id}-active-day`),EventHelper.on({element:t.element,mousedown:"onPickerMousedown",click:{delegate:`.${t.cellCls}:not(.${t.disabledCls}):not(.${t.outOfRangeCls})`,handler:"onCellClick"},keydown:"onPickerKeyDown",thisObj:t})}get focusElement(){return this.element}refresh(){super.refresh(),this.title=DateHelper.format(this.month.date,"MMMM YYYY")}cellRenderer(e,t){const r=this,{activeCls:n,selectedCls:i}=r,s=e.classList;e.innerHTML=t.getDate(),e.setAttribute("aria-label",DateHelper.format(t,"MMMM D, YYYY")),r.isActiveDate(t)&&(s.add(n),e.id=`${r.id}-active-day`),r.isSelectedDate(t)&&s.add(i),r.minDate&&t<r.minDate?s.add(r.outOfRangeCls):r.maxDate&&t>r.maxDate&&s.add(r.outOfRangeCls)}onPickerMousedown(e){e.preventDefault()}onCellClick(e){this.onDateActivate(DateHelper.parse(e.target.dataset.date,"YYYY-MM-DD"),e)}onDateActivate(e,t){const r=this,{lastClickedDate:n,selection:i}=r;r.activeDate=e,r.lastClickedDate=e,r.multiSelect?r.multiRange||n&&e.getTime()===n.getTime()||(n&&t.shiftKey?(i[1]=e,i.sort()):(i.length=0,i[0]=e),r.trigger("selectionChange",{selection:i})):r.value&&r.value.getTime()===e.getTime()?r.hide():r.value=e}onPickerKeyDown(e){const t=this,r=e.key.trim()||e.code,n=t.activeDate;let i=new Date(n);if(n){do{switch(r){case"Escape":t.hide();break;case"ArrowLeft":e.ctrlKey?(e.preventDefault(),i.setMonth(i.getMonth()-1)):i.setDate(i.getDate()-1);break;case"ArrowUp":i.setDate(i.getDate()-7);break;case"ArrowRight":e.ctrlKey?(e.preventDefault(),i.setMonth(i.getMonth()+1)):i.setDate(i.getDate()+1);break;case"ArrowDown":i.setDate(i.getDate()+7);break;case"Enter":t.onDateActivate(n,e)}}while(t.isDisabledDate(i)&&!t.focusDisabledDates);if(t.minDate&&i<t.minDate)return;if(t.maxDate&&i>t.maxDate)return;t.activeDate=i}}set minDate(e){this._minDate=e?this.ingestDate(e):null,this.refresh()}get minDate(){return this._minDate}set maxDate(e){this._maxDate=e?this.ingestDate(e):null,this.refresh()}get maxDate(){return this._maxDate}set activeDate(e){const t=this;t._activeDate=e?t.ingestDate(e):DateHelper.clearTime(new Date),t.month.month!==t._activeDate.getMonth()&&(t.month.date=t._activeDate),t.refresh()}get activeDate(){return this._activeDate}set value(e){const t=this,{selection:r}=t;let n;e?(e=t.ingestDate(e),t.value&&e.getTime()===t.value.getTime()||(r.length=0,r[0]=e,t.date=e,n=!0)):(n=r.length,r.length=0,t.date=new Date),n&&t.trigger("selectionChange",{selection:r})}get value(){return this.selection[this.selection.length-1]}gotoPrevMonth(){const e=this.date;e.setMonth(e.getMonth()-1),this.date=e}gotoNextMonth(){const e=this.date;e.setMonth(e.getMonth()+1),this.date=e}isActiveDate(e){return this.activeDate&&this.ingestDate(e).getTime()===this.activeDate.getTime()}isSelectedDate(e){return this.selection.some(t=>t.getTime()===e.getTime())}}DatePicker._$name="DatePicker",BryntumWidgetAdapterRegister.register("datepicker",DatePicker);class DateField extends PickerField{static get defaultConfig(){return{format:"L",fallbackFormat:"YYYY-MM-DD",pickerFormat:null,triggers:{expand:{cls:"b-icon-calendar",handler:"onTriggerClick",weight:200}},stepTriggers:{back:{cls:"b-icon-angle-left b-step-trigger",handler:"onBackClick",align:"start",weight:100},forward:{cls:"b-icon-angle-right b-step-trigger",handler:"onForwardClick",align:"end",weight:100}},calendarContainerCls:"",min:null,max:null,step:null}}inputTemplate(){const e=this;return TemplateHelper.tpl`<input type="${e.inputType||"text"}"
            reference="input"
            class="${e.inputCls||""}"
            min="${e.min}"
            max="${e.max}"
            placeholder="${e.placeholder}"
            name="${e.name||e.id}"
            id="${e.id+"_input"}"/>`}get picker(){return this._picker||(this.picker=!0),this._picker}set picker(e){const t=this;t._picker&&t._picker.destroy(),t._picker=e=new DatePicker(Object.assign({owner:t,forElement:t[t.pickerAlignElement],floating:!0,scrollAction:"realign",align:{align:"t0-b0",axisLock:!0,anchor:t.overlayAnchor,target:t[t.pickerAlignElement]},value:t.value,minDate:t.min,maxDate:t.max,onSelectionChange:({selection:r})=>{e.isVisible&&(t._isUserAction=!0,t.value=r[0],t._isUserAction=!1,e.hide())}},e)),t.calendarContainerCls&&e.element.classList.add(t.calendarContainerCls)}set triggers(e){super.triggers=ObjectHelper.assign(e,this.stepTriggers)}get triggers(){return super.triggers}onBackClick(){const e=this,{min:t}=e;if(!e.readOnly&&e.value){const r=DateHelper.add(e.value,-1*e._step.magnitude,e._step.unit);(!t||t.getTime()<=r)&&(e.value=r)}}onForwardClick(){const e=this,{max:t}=e;if(!e.readOnly&&e.value){const r=DateHelper.add(e.value,e._step.magnitude,e._step.unit);(!t||t.getTime()>=r)&&(e.value=r)}}showPicker(e){this.picker.value=this.picker.activeDate=this.value,super.showPicker(e)}focusPicker(){this.picker.focus()}get isValid(){const e=this,t=e.min,r=e.max;e.clearError("minimumValueViolation",!0),e.clearError("maximumValueViolation",!0);let n=e.value;if(n){if(n=n.getTime(),t&&t.getTime()>n)return e.setError("minimumValueViolation",!0),!1;if(r&&r.getTime()<n)return e.setError("maximumValueViolation",!0),!1}return super.isValid}transformDateValue(e){return null!=e&&("Date"!==e.constructor.name&&(e="string"==typeof e?DateHelper.parse(e,this.format)||DateHelper.parse(e,this.fallbackFormat):new Date(e)),e&&"Date"===e.constructor.name&&!isNaN(e.valueOf()))?DateHelper.clearTime(e):null}set min(e){const t=this;t._min=t.transformDateValue(e),t.input&&(t.input.min=t._min),t._picker&&(t._picker.minDate=t._min),t.updateInvalid()}get min(){return this._min}set max(e){const t=this;t._max=t.transformDateValue(e),t.input&&(t.input.max=t._max),t._picker&&(t._picker.maxDate=t._max),t.updateInvalid()}get max(){return this._max}set value(e){const t=this,r=t.value,n=t._picker,i=t.transformDateValue(e);!e||i?(t.clearError("invalidDate"),t.hasChanged(r,i)&&(n&&!t.inputting&&(n.value=i),super.value=i)):t.setError("invalidDate")}get value(){return super.value}set step(e){const t=this;t.element.classList[e?"add":"remove"]("b-show-steppers"),"number"==typeof e?e={magnitude:e,unit:t._step?t._step.unit:"day"}:"object"!=typeof e&&(e=DateHelper.parseDuration(e)),e&&e.magnitude&&e.unit&&(e.magnitude=Math.abs(e.magnitude),t._step=e,t.updateInvalid())}get step(){return this._step}hasChanged(e,t){return e&&e.getTime&&t&&t.getTime?e.getTime()!==t.getTime():super.hasChanged(e,t)}get inputValue(){let e=this.value;return e?DateHelper.format(e,this.format):""}set format(e){this._format=e,this.syncInputFieldValue()}get format(){return this._format}internalOnKeyPress(e){super.internalOnKeyPress(e),"Enter"===e.key&&this.isValid&&this.picker.hide()}}DateField._$name="DateField",BryntumWidgetAdapterRegister.register("datefield",DateField),BryntumWidgetAdapterRegister.register("date",DateField);class NumberField extends Field{static get defaultConfig(){return{min:null,max:null,step:1,value:0,triggers:{spin:{type:"spintrigger"}}}}internalOnKeyPress(e){BrowserHelper.isEdge&&"keydown"===e.type&&("ArrowUp"===e.key?(this.doSpinUp(),e.preventDefault()):"ArrowDown"===e.key&&(this.doSpinDown(),e.preventDefault())),super.internalOnKeyPress(e)}inputTemplate(){const e=this,t="inputWidth"in e?`style="width:${e.inputWidth}${"number"==typeof e.inputWidth?"px":""}"`:"";return TemplateHelper.tpl`
            <input type="number"
                reference="input"
                min="${e.min}"
                max="${e.max}"
                step="any"
                value="${e._value}"
                autocomplete="${e.autoComplete}"
                placeholder="${e.placeholder}"
                name="${e.name||e.id}"
                id="${e.id}_input"
                ${t}/>
            `}set step(e){this.element.classList[e?"remove":"add"]("b-hide-spinner"),this._step=e}get step(){return this._step}set min(e){this._min=e,this.input&&(this.input.min=e)}get min(){return this._min}set max(e){this._max=e,this.input&&(this.input.max=e)}get max(){return this._max}doSpinUp(){let e=(this.value||0)+this.step,{min:t,max:r}=this;!isNaN(t)&&e<t&&(e=t),(isNaN(r)||e<=r)&&(this._isUserAction=!0,this.value=e,this._isUserAction=!1)}doSpinDown(){let e=(this.value||0)-this.step,{min:t,max:r}=this;!isNaN(r)&&e>r&&(e=r),(isNaN(t)||e>=t)&&(this._isUserAction=!0,this.value=e,this._isUserAction=!1)}get value(){return super.value}set value(e){e||0===e?"number"!=typeof e&&(e="string"==typeof e?parseFloat(e):Number(e),isNaN(e)&&(e="")):e=this.clearable?void 0:0,this.value!==e&&(super.value=e)}}NumberField._$name="NumberField",BryntumWidgetAdapterRegister.register("numberfield",NumberField),BryntumWidgetAdapterRegister.register("number",NumberField);class Slider extends Widget{static get defaultConfig(){return{text:"",showValue:!0,showTooltip:!1,min:0,max:100,step:1,value:null,thumbSize:20,localizableProperties:["text"]}}construct(e){const t=this;super.construct(e),t.updateLabel(),t.showTooltip&&(t.tip=new Tooltip({forElement:t.input,anchor:!1,align:"b-t",axisLock:!0})),t.input.addEventListener("input",t.onInternalInput.bind(t)),t.input.addEventListener("change",t.onInternalChange.bind(t)),t.input.addEventListener("mouseover",t.onInternalMouseOver.bind(t)),t.input.addEventListener("mouseout",t.onInternalMouseOut.bind(t))}template(e){return TemplateHelper.tpl`
            <div class="${e.text?"b-text b-has-label":""}">
                <input type="range"
                   reference="input"
                   id="${e.id}_input"
                   min="${e.min}"
                   max="${e.max}"
                   step="${e.step}"
                   value="${e.value}">
                <label reference="label" for="${e.id}_input">${e.text}</label>
            </div>
        `}get focusElement(){return this.input}onInternalInput(e){const t=this;t._value=parseInt(t.input.value),t.updateUI(),t.trigger("input",{value:t.value})}onInternalChange(e){this.updateUI(),this.triggerChange(!0),this.trigger("action",{value:this.value})}onInternalMouseOver(e){const t=this;t.updateLabel(),t.tip&&t.tip.showBy({target:t.calcThumbPosition(),offset:5})}onInternalMouseOut(e){this.tip&&this.tip.hide()}triggerChange(e){this.trigger("change",{value:this.value,userAction:e})}get text(){return this._text}set text(e){const t=this;t._text=e,t.label&&(t.showValue&&(e=e?`${e} (${t.value})`:t.value),t.label.innerHTML=e),t.tip&&(t.tip.html=t.value)}get value(){return this.input?parseInt(this.input.value):this._value}set value(e){const t=this;t._value!==e&&(t.input&&(t.input.value=e,t.updateUI(),t.triggerChange(!1)),t._value=e)}get min(){return this.input?this.input.min:this._min}set min(e){const t=this;t.input&&(t.input.min=e,t._value<e&&(t.value=e,t.trigger("input",{value:t.value}))),t._min=e}get max(){return this.input?this.input.max:this._max}set max(e){const t=this;t.input&&(t.input.max=e,t._value>e&&(t.value=e,t.trigger("input",{value:t.value}))),t._max=e}get step(){return this.input?this.input.step:this._step}set step(e){this.input&&(this.input.step=e),this._step=e}updateLabel(){this.text=this._text}updateTooltipPosition(){this.tip&&this.tip.alignTo({target:this.calcThumbPosition(),offset:5})}updateUI(){this.updateLabel(),this.updateTooltipPosition()}calcThumbPosition(){const e=this,t=Rectangle.from(e.input),r=(t.width-e.thumbSize)*e.calcPercentProgress()/100;return new Rectangle(t.x+r,t.y+t.height/2-e.thumbSize/2,e.thumbSize,e.thumbSize)}calcPercentProgress(){return(this.value-this.min)/(this.max-this.min)*100}}Slider._$name="Slider",BryntumWidgetAdapterRegister.register("slider",Slider);const animationClasses=["b-slide-out-left","b-slide-out-right","b-slide-in-left","b-slide-in-right"];class Card extends Layout{static get defaultConfig(){return{containerCls:"b-card-container",itemCls:"b-card-item",animateCardChange:!0}}setActiveItem(e){const t=this,{owner:r}=t,{contentElement:n,items:i}=r,s=e instanceof Widget,o=parseInt(n.dataset.activeIndex),a=i[o],l=r.items[e=s?e=i.indexOf(e):parseInt(e)],d={prevActiveIndex:o,prevActiveItem:a};if(l&&l!==a){const r=a.element,i=l&&l.element;if(d.activeIndex=e,d.activeItem=l,t.animateDetacher){const e=t.animateDetacher.event;t.animateDetacher(),e.prevActiveItem.element.classList.remove(animationClasses),e.activeItem.element.classList.remove("b-active",...animationClasses),t.animateDetacher=null}d.promise=new Promise((s,a)=>{r&&t.animateCardChange?(r.classList.add(e>o?"b-slide-out-left":"b-slide-out-right"),i.classList.add("b-active",e<o?"b-slide-in-left":"b-slide-in-right"),l.triggerPaint(),t.animateDetacher=EventHelper.on({element:i,animationend:()=>{t.animateDetacher=null,i.classList.remove(...animationClasses),r&&r.classList.remove("b-active",...animationClasses),n.dataset.activeIndex=e,l.focus(),s(d)},once:!0}),t.animateDetacher.reject=a,t.animateDetacher.event=d):(r&&r.classList.remove("b-active"),i.classList.add("b-active"),n.dataset.activeIndex=e,l.focus(),l.triggerPaint(),s(d))})}return d}renderChildren(){const{owner:e}=this,t=e.activeIndex;BrowserHelper.isIE11&&(this.animateCardChange=!1),e.items&&null!=t&&e.items[t]&&(e.contentElement.dataset.activeIndex=t,e.items[t].element.classList.add("b-active")),super.renderChildren()}get activeIndex(){return parseInt(this.owner.contentElement.dataset.activeIndex)}get activeItem(){return this.owner.items[parseInt(this.owner.contentElement.dataset.activeIndex)]}}Card._$name="Card",Layout.registerLayout(Card);class TabPanel extends Container{static get defaultConfig(){return{template:e=>TemplateHelper.tpl`
                <div>
                    <div class="b-tabpanel-tabs" reference="tabStrip">
                        ${e.items.map((t,r)=>`\n                        <div tabindex="-1" data-index="${r}" class="b-tabpanel-tab ${r===e.activeIndex?"b-active":""} ${t.cls||""}" style="${e.tabMinWidth?"min-width:"+DomHelper.setLength(e.tabMinWidth)+";":""} ${e.tabMaxWidth?"max-width:"+DomHelper.setLength(e.tabMaxWidth)+";":""}" >\n                            <span class="b-tabpanel-tab-title">${t.title}</span>\n                        </div>\n                        `)}
                    </div>
                    <div class="b-tabpanel-body" reference="tabPanelBody" data-activeIndex="${e.activeIndex}">
                    </div>
                </div>
            `,itemCls:"b-tabpanel-item",defaultType:"container",activeTab:0,tabMinWidth:null,tabMaxWidth:null,animateTabChange:!0,layout:"card",suppressChildHeaders:!0}}construct(e){const t=this;super.construct(e),t.items.forEach((e,r)=>{e.titleElement=t.element.querySelector(`div.b-tabpanel-tab[data-index="${r}"] span`)}),EventHelper.on({element:t.tabStrip,delegate:".b-tabpanel-tab",click:"onTabElementClick",thisObj:t})}set tabMinWidth(e){this._tabMinWidth=e,this.element&&DomHelper.forEachSelector(this.element,".b-tabpanel-tab",t=>{DomHelper.setLength(t,"minWidth",e||null)})}get tabMinWidth(){return this._tabMinWidth}set tabMaxWidth(e){this._tabMaxWidth=e,this.element&&DomHelper.forEachSelector(this.element,".b-tabpanel-tab",t=>{DomHelper.setLength(t,"maxWidth",e||null)})}get tabMaxWidth(){return this._tabMaxWidth}set layout(e){super.layout=e,this.layout.animateCardChange=this.animateTabChange}get layout(){return super.layout}get contentElement(){return this.tabPanelBody}get focusElement(){const e=this.items[this.activeTab||0];return e&&e.focusElement||this.tabStrip.children[this.activeTab]}set activeTab(e){const t=this;if(t.isConfiguring)t._activeTab=e;else{const r=t.layout.setActiveItem(e),{promise:n,activeIndex:i,activeItem:s}=r;if(s){const{tabStrip:e}=t,s=e.children[t._activeTab];t._activeTab=i,s&&s.classList.remove("b-active"),e.children[i].classList.add("b-active"),n.then(()=>{t.trigger("tabchange",r)})}}}get activeIndex(){return this.activeTab}get activeTab(){return this._activeTab}get activeItem(){return this.layout.activeItem}onTabElementClick(e){this.activeTab=e.currentTarget.dataset.index}}TabPanel._$name="TabPanel",BryntumWidgetAdapterRegister.register("tabpanel",TabPanel),BryntumWidgetAdapterRegister.register("tabs",TabPanel);class TextAreaField extends PickerField{static get defaultConfig(){return{triggers:null,inline:!0,resize:"none"}}startConfigure(e){this._thisIsAUsedExpression(this.inline),super.startConfigure(e)}inputTemplate(){const e=this;return e.inline?TemplateHelper.tpl`<textarea
                reference="input"
                class="${e.inputCls||""}"
                placeholder="${e.placeholder}"
                name="${e.name||e.id}"
                style="resize:${e.resize}"
                id="${e.id+"_input"}"></textarea>`:TemplateHelper.tpl`<input type="text"
                readOnly="readonly"
                reference="displayElement"
                placeholder="${e.placeholder}"/>`}get focusElement(){return this.inline||this._picker&&this._picker.isVisible?this.input:this.displayElement}showPicker(){this.picker.width=this.pickerWidth||this[this.pickerAlignElement].offsetWidth,super.showPicker(!0)}focusPicker(){this.input.focus()}onPickerKeyDown(e){const t=this,r=t.input;switch(e.key.trim()||e.code){case"Escape":return void t.picker.hide();case"Enter":e.ctrlKey&&(t.syncInputFieldValue(),t.picker.hide())}t.input=t.displayElement;const n=super.onPickerKeyDown(e);return t.input=r,n}syncInputFieldValue(){this.displayElement&&(this.displayElement.value=this.inputValue),super.syncInputFieldValue()}set value(e){super.value=null==e?"":e}get value(){return super.value}set inline(e){this._inline=e,e||this.triggers||(this.triggers={})}set triggers(e){this.inline||((e||(e={})).expand={cls:"b-icon-picker",handler:"onTriggerClick"}),super.triggers=e}get triggers(){return super.triggers}get inline(){return this._inline}get picker(){return this._picker||(this.picker=!0),this._picker}set picker(e){const t=this;t._picker&&t._picker.destroy(),e.width&&(t.pickerWidth=e.width),t._picker=new Widget(ObjectHelper.merge({cls:"b-textareafield-picker",owner:t,floating:!0,scrollAction:"realign",forElement:t[t.pickerAlignElement],align:{align:"t-b",axisLock:!0,anchor:t.overlayAnchor,target:t[t.pickerAlignElement]},html:`<textarea id="${t.id+"_input"}" style="resize:${t.resize}">${t.value}</textarea>`,autoShow:!1},e));const r=t.input=t.picker.element.querySelector(`#${t.id}_input`);t.inputListenerRemover=EventHelper.on({element:r,thisObj:t,focus:"internalOnInputFocus",change:"internalOnChange",input:"internalOnInput",keydown:"internalOnKeyPress",keypress:"internalOnKeyPress",keyup:"internalOnKeyPress"})}}TextAreaField._$name="TextAreaField",BryntumWidgetAdapterRegister.register("textareafield",TextAreaField),BryntumWidgetAdapterRegister.register("textarea",TextAreaField);class TimePicker extends Popup{static get defaultConfig(){return{items:[{type:"number",ref:"fieldHours",min:0,max:23},{html:"<label>:</label>"},{type:"number",ref:"fieldMinutes",min:0,max:59},{type:"button",text:"AM",toggleGroup:"am-pm",ref:"buttonAM",cls:"b-blue"},{type:"button",text:"PM",toggleGroup:"am-pm",ref:"buttonPM",cls:"b-blue"}],float:"1",autoShow:!1,trapFocus:!0,value:DateHelper.getTime(0),format:null}}construct(e){const t=this;super.construct(e),t._pm=!1,t.fieldHours.on("change",t.onFieldChange,t),t.fieldMinutes.on("change",t.onFieldChange,t),t.buttonAM.on("click",t.onButtonAMClick,t),t.buttonPM.on("click",t.onButtonPMClick,t),EventHelper.on({element:t.element,keydown:"onPickerKeyDown",thisObj:t}),EventHelper.on({element:t.fieldHours.element,keydown:"onPickerKeyDown",thisObj:t}),EventHelper.on({element:t.fieldMinutes.element,keydown:"onPickerKeyDown",thisObj:t}),t.refresh()}onFieldChange(){const e=this;e._time&&(e.value=e.pickerToTime())}onButtonAMClick(){const e=this;e._pm=!1,e._time&&(e.value=e.pickerToTime())}onButtonPMClick(){const e=this;e._pm=!0,e._time&&(e.value=e.pickerToTime())}onPickerKeyDown(e){const t=this;switch(e.key&&e.key.trim()||e.code){case"Escape":t.triggerTimeChange(t._initialValue),t.hide(),e.preventDefault();break;case"Enter":t.value=t.pickerToTime(),t.hide(),e.preventDefault()}}pickerToTime(){const e=this,t=e._pm;let r=e.fieldHours.value,n=new Date(e._time);return e._is24Hour||(t&&r<12&&(r+=12),t||12!==r||(r=0)),n.setHours(r),n.setMinutes(e.fieldMinutes.value),e._min&&(n=DateHelper.max(e._min,n)),e._max&&(n=DateHelper.min(e._max,n)),n}triggerTimeChange(e){this.trigger("timeChange",{time:e})}set value(e){const t=this;let r=!1;e&&t._time?e.getTime()!==t._time.getTime()&&(t._time=e,r=!0):(t._time=TimePicker.defaultConfig.value,r=!0),r&&(t.isVisible&&t.triggerTimeChange(t.value),t.refresh())}get value(){return this._time}set format(e){this._format=e,this._is24Hour=DateHelper.is24HourFormat(this._format),this.refresh()}get format(){return this._format}set min(e){this._min=e}get min(){return this._min}set max(e){this._max=e}get max(){return this._max}set initialValue(e){this.value=e,this._initialValue=e}get initialValue(){return this._initialValue}get buttonAM(){return this.widgetMap.buttonAM}get buttonPM(){return this.widgetMap.buttonPM}get fieldHours(){return this.widgetMap.fieldHours}get fieldMinutes(){return this.widgetMap.fieldMinutes}refresh(){const e=this;if(!e.isConfiguring){const t=e._time,r=e._is24Hour,n=t.getHours(),i=e._pm=n>=12,s=e.fieldHours;e.width=r?"12.8em":"20em",s.min=r?0:1,s.max=r?23:12,s.value=r?n:n%12||12,e.fieldMinutes.value=t.getMinutes(),e.buttonAM.pressed=!i,e.buttonPM.pressed=i,e.buttonAM.visible=e.buttonPM.visible=!r}}}TimePicker._$name="TimePicker",BryntumWidgetAdapterRegister.register("timepicker",TimePicker);class TimeField extends PickerField{static get defaultConfig(){return{format:"LT",triggers:{back:{cls:"b-icon b-icon-angle-left",handler:"onBackClick",align:"start"},expand:{template:()=>`<div class="b-align-${this.align||"end"}"><div class="b-icon-clock-live"></div></div>`,handler:"onTriggerClick",align:"end"},forward:{cls:"b-icon b-icon-angle-right",handler:"onForwardClick",align:"end"}},min:null,max:null,step:"5m"}}get picker(){return this._picker||(this.picker=!0),this._picker}set picker(e){const t=this;t._picker&&t._picker.destroy(),t._picker=new TimePicker(Object.assign({owner:t,floating:!0,forElement:t[t.pickerAlignElement],align:{align:"t0-b0",axisLock:!0,anchor:t.overlayAnchor,target:t[t.pickerAlignElement]},value:t.value,format:t.format,onTimeChange({time:e}){t._isUserAction=!0,t.value=e,t._isUserAction=!1}},e))}onBackClick(){const e=this,{min:t}=e;if(!e.readOnly&&e.value){const r=DateHelper.add(e.value,-1*e._step.magnitude,e._step.unit);(!t||t.getTime()<=r)&&(e._isUserAction=!0,e.value=r,e._isUserAction=!1)}}onForwardClick(){const e=this,{max:t}=e;if(!e.readOnly&&e.value){const r=DateHelper.add(e.value,e._step.magnitude,e._step.unit);(!t||t.getTime()>=r)&&(e._isUserAction=!0,e.value=r,e._isUserAction=!1)}}get isValid(){const e=this;e.clearError("minimumValueViolation",!0),e.clearError("maximumValueViolation",!0);let t=e.value;if(t){if(t=t.getTime(),e._min&&e._min.getTime()>t)return e.setError("minimumValueViolation",!0),!1;if(e._max&&e._max.getTime()<t)return e.setError("maximumValueViolation",!0),!1}return super.isValid}hasChanged(e,t){return e&&e.getTime&&t&&t.getTime?e.getTime()!==t.getTime():super.hasChanged(e,t)}showPicker(e){const t=this,r=t.picker;r.initialValue=t.value,r.format=t.format,r.maxTime=t.max,r.minTime=t.min,t.value=r.value,super.showPicker(e)}onPickerShow(){super.onPickerShow(),this.pickerKeyDownRemover&&this.pickerKeyDownRemover()}focusPicker(){this.picker.focus()}transformTimeValue(e){return null!=e&&("Date"!==e.constructor.name&&(e="string"==typeof e?DateHelper.parse(e,this.format):new Date(e)),e&&"Date"===e.constructor.name&&!isNaN(e.valueOf()))?((e=DateHelper.clone(e)).setFullYear(1970,0,1),e):null}set min(e){const t=this;t._min=t.transformTimeValue(e),t.input&&(t.input.min=t._min),t.updateInvalid()}get min(){return this._min}set max(e){const t=this;t._max=t.transformTimeValue(e),t.input&&(t.input.max=t._max),t.updateInvalid()}get max(){return this._max}set value(e){const t=this,r=t.value,n=t.transformTimeValue(e);!e||n?(t.clearError("invalidTime"),t.hasChanged(r,n)&&(t.triggers.expand&&n&&(t.triggers.expand.element.firstElementChild.style.animationDelay=-(60*n.getHours()+n.getMinutes())/10+"s"),super.value=n)):t.setError("invalidTime")}get value(){return super.value}set step(e){const t=this;"number"==typeof e?e={magnitude:e,unit:t._step.unit}:"object"!=typeof e&&(e=DateHelper.parseDuration(e)),e&&e.magnitude&&e.unit&&(e.magnitude=Math.abs(e.magnitude),t._step=e,t.updateInvalid())}get step(){return this._step}set format(e){this._format=e,this.syncInputFieldValue()}get format(){return this._format}get inputValue(){return DateHelper.format(this.value,this.format)}}TimeField._$name="TimeField",BryntumWidgetAdapterRegister.register("timefield",TimeField),BryntumWidgetAdapterRegister.register("time",TimeField);class BryntumWidgetAdapter{createWidget(e){return BryntumWidgetAdapterRegister.createWidget(e.type,e)}getClass(e){return BryntumWidgetAdapterRegister.getClass(e)}appendWidget(e){return this.createWidget(e)}appendWidgets(e,t){return e.map(e=>this.appendWidget(ObjectHelper.assign({},t||{},e)))}openPopup(e,t){return new Popup(ObjectHelper.assign({forElement:e},"string"==typeof t?{html:t}:t))}showContextMenu(e,t){const r=this;return r.currentContextMenu&&r.currentContextMenu.destroy(),e instanceof HTMLElement?t.forElement=e:Array.isArray(e)?t.forElement={target:new Point(...e)}:e instanceof Point&&(t.forElement={target:e}),r.currentContextMenu=new Menu(t),r.currentContextMenu.on("destroy",()=>{r.currentContextMenu=null}),r.currentContextMenu}attachTooltip(e,t){return"string"==typeof t&&(t={html:t}),new Tooltip(Object.assign({forElement:e},t)),e}hasTooltipAttached(e){return Tooltip.hasTooltipAttached(e)}destroyTooltipAttached(e){return Tooltip.destroyTooltipAttached(e)}mask(e,t="Loading"){if(e)return e instanceof HTMLElement&&(e={element:e,text:t}),Mask.mask(e,e.element)}unmask(e,t=!0){e.mask&&(t?e.mask.close():e.mask.hide())}toast(e){return Toast.show(e)}set defaultStyle(e){this._defaultStyle=e}get defaultStyle(){return this._defaultStyle}}WidgetHelper._adapter||(WidgetHelper.adapter=BryntumWidgetAdapter),BryntumWidgetAdapter._$name="BryntumWidgetAdapter";const processParamEntry=(e,t)=>(Array.isArray(t[1])?t[1].forEach(r=>e.push(t[0]+"="+r)):e.push(t[0]+"="+t[1]),e),immediatePromise$2=new Promise(e=>e());class AjaxStore extends Store{static get defaultConfig(){return{headers:null,fetchOptions:null,sendAsFormData:!1,parentIdParamName:"id",responseDataProperty:"data"}}afterConstruct(e){super.afterConstruct(e),this.autoLoad&&this.load().catch(e=>{})}get isLoading(){return this._isLoading}get isCommitting(){return Boolean(this.commitPromise)}buildQueryString(...e){const t=Object.entries(Object.assign({},...e)).reduce(processParamEntry,[]).join("&");return t?"?"+t:""}internalLoad(e,t,r){const n=this,i=Object.assign({},n.params,e),s={action:"read"+t,params:i};return n.readUrl?new Promise((e,o)=>{if(!1===n.trigger("beforeLoad"+t,s))return o(!1);n._isLoading=!0,n.trigger(`load${t}Start`,s),n.trigger("beforeRequest",s),AjaxHelper.get(n.readUrl+n.buildQueryString(i),Object.assign({headers:n.headers,parseJson:!0},n.fetchOptions)).then(i=>{const a=i.parsedJson,l=Array.isArray(a),d=l||a&&!1!==a.success;n._isLoading=!1,s.response=i,s.json=a,d?(s.data=l?a:a[n.responseDataProperty],r(s),n.trigger("load"+t,s),e(s)):(s.exception=!0,s.exceptionType="server",n.trigger("exception",s),o(s)),n.trigger("afterRequest",s)}).catch(e=>{n._isLoading=!1,s.exception=!0,e instanceof Response?(s.exceptionType=e.ok?"server":"network",s.response=e,s.error=e.error):(s.exceptionType="server",s.error=e),n.trigger("exception",s),o(s),n.trigger("afterRequest",s)})}):null}load(e){const t=this;return t.internalLoad(e,"",e=>{t.data=e.data})}async loadChildren(e){return this.internalLoad({[this.parentIdParamName]:e.id},"Children",t=>{t.parentRecord=e,e.data[e.constructor.childrenField]=t.data,e.processChildren(e.stores)})}commit(){const e=this,t=e.changes,r=[];if(e.commitPromise)return!1;if(!t)return immediatePromise$2;if([...t.added,...t.modified,...t.removed].forEach(e=>e.meta.committing=!0),!e.disabled&&!1!==e.trigger("beforeCommit",{changes:t})){let n={action:"commit",exception:!1,changes:t},i=e.commitRemoved(n);return i&&r.push(i),(i=e.commitAdded(n))&&r.push(i),(i=e.commitModified(n))&&r.push(i),r.length?(i=1===r.length?r[0]:Promise.all(r),e.commitPromise=new Promise((r,s)=>{i.then(()=>{e.commitPromise=null,n.exception?(e.trigger("exception",n),s(n)):(e.trigger("commit",{changes:t}),r(n))}).catch(()=>{e.commitPromise=null,s(n)})})):(e.modified.forEach(e=>e.clearChanges(!1)),e.added.clear(),e.modified.clear(),e.removed.clear(),e.trigger("commit",{changes:t}),immediatePromise$2)}}commitAdded(e){const t=this,r=t.added,n={action:"create",params:t.params};return r.count&&t.createUrl?new Promise(i=>{const s=r.values.map(e=>e.persistableData);e.create=n,t.trigger("beforeRequest",n);let o={data:s};if(t.sendAsFormData){const e=new FormData;e.append("data",JSON.stringify(s)),o=e}AjaxHelper.post(t.createUrl+t.buildQueryString(t.params),o,Object.assign({headers:t.headers,parseJson:!0},t.fetchOptions)).then(s=>{const o=s.parsedJson,a=Array.isArray(o),l=a||o&&!1!==o.success;n.json=o,n.response=s,l?(t.processReturnedData(r.values,a?o:o[t.responseDataProperty]),r.forEach(e=>e.meta.committing=!1),r.clear(),t.trigger("commitAdded"),t.trigger("refresh",n),i(e)):(r.forEach(e=>e.meta.committing=!1),e.exception=n.exception=!0,e.exceptionType=n.exceptionType="server",t.trigger("exception",n),i(e)),t.trigger("afterRequest",n)}).catch(s=>{r.forEach(e=>e.meta.committing=!1),e.exception=n.exception=!0,s instanceof Response?(n.exceptionType=s.ok?"server":"network",n.response=s,n.error=s.error):(n.exceptionType="server",n.error=s),t.trigger("exception",n),i(e),t.trigger("afterRequest",n)})}):null}commitModified(e){let t=this,r=t.modified,n={action:"update",params:t.params};return r.count&&t.updateUrl?new Promise(i=>{const s=r.map(e=>e.modifications);e.update=n,t.trigger("beforeRequest",n);let o={data:s};if(t.sendAsFormData){const e=new FormData;e.append("data",JSON.stringify(s)),o=e}AjaxHelper.post(t.updateUrl+t.buildQueryString(t.params),o,Object.assign({headers:t.headers,parseJson:!0},t.fetchOptions)).then(s=>{const o=s.parsedJson,a=Array.isArray(o),l=a||o&&!1!==o.success;n.json=o,n.response=s,l?(t.processReturnedData(t.modified.values,a?o:o[t.responseDataProperty],!0),r.forEach(e=>e.clearChanges(!1)),r.clear(),t.trigger("commitModified"),t.trigger("refresh",n),i(e)):(r.forEach(e=>e.meta.committing=!1),e.exception=n.exception=!0,n.exceptionType="server",t.trigger("exception",n),i(e)),t.trigger("afterRequest",n)}).catch(s=>{r.forEach(e=>e.meta.committing=!1),e.exception=n.exception=!0,s instanceof Response?(n.exceptionType=s.ok?"server":"network",n.response=s,n.error=s.error):(n.exceptionType="server",n.error=s),t.trigger("exception",n),i(e),t.trigger("afterRequest",n)})}):null}processReturnedData(e,t,r=!1){const n=this.modelClass,i=n.fieldMap.id.dataSource;t.forEach((t,s)=>{e[s].id=t[i],Object.assign(e[s].data,n.processData(t,r))})}commitRemoved(e){const t=this,r=t.removed,n={action:"delete",params:t.params};return r.count&&t.deleteUrl?new Promise(i=>{e.delete=n,t.trigger("beforeRequest",n);let s={ids:r.map(e=>e.id)};if(t.sendAsFormData){const e=new FormData;e.append("id",JSON.stringify(s.ids)),s=e}AjaxHelper.post(t.deleteUrl+t.buildQueryString(t.params),s,Object.assign({headers:t.headers,parseJson:!0},t.fetchOptions)).then(s=>{const o=s.parsedJson,a=Array.isArray(o)||o&&!1!==o.success;n.json=o,n.response=s,a?(r.forEach(e=>e.meta.committing=!1),r.clear(),t.trigger("commitRemoved"),t.trigger("refresh",n),i(e)):(r.forEach(e=>e.meta.committing=!1),e.exception=n.exception=!0,n.exceptionType="server",t.trigger("exception",n),i(e)),t.trigger("afterRequest",n)}).catch(s=>{r.forEach(e=>e.meta.committing=!1),e.exception=n.exception=!0,s instanceof Response?(n.exceptionType=s.ok?"server":"network",n.response=s,n.error=s.error):(n.exceptionType="server",n.error=s),t.trigger("exception",n),i(e),t.trigger("afterRequest",n)})}):null}}AjaxStore._$name="AjaxStore";const throwAbstractMethodCall=()=>{throw new Error("Abstract method call!")},throwInvalidMethodCall=()=>{throw new Error("Method cannot be called at this state!")};class StateBase extends Base{canUndo(e){throwAbstractMethodCall()}canRedo(e){throwAbstractMethodCall()}onUndo(e){throwAbstractMethodCall()}onRedo(e){throwAbstractMethodCall()}onStartTransaction(e){throwAbstractMethodCall()}onStopTransaction(e){throwAbstractMethodCall()}onStopTransactionDelayed(e){throwAbstractMethodCall()}onRejectTransaction(e){throwAbstractMethodCall()}onEnable(e){throwAbstractMethodCall()}onDisable(e){throwAbstractMethodCall()}onAutoRecordOn(e){throwAbstractMethodCall()}onAutoRecordOff(e){throwAbstractMethodCall()}onResetQueue(e){throwAbstractMethodCall()}onModelUpdate(e){throwAbstractMethodCall()}onStoreModelAdd(e){throwAbstractMethodCall()}onStoreModelInsert(e){throwAbstractMethodCall()}onStoreModelRemove(e){throwAbstractMethodCall()}onStoreModelRemoveAll(e){throwAbstractMethodCall()}onModelInsertChild(e){throwAbstractMethodCall()}onModelRemoveChild(e){throwAbstractMethodCall()}}StateBase._$name="StateBase";const STATE_PROP=Symbol("STATE_PROP"),STORES_PROP=Symbol("STORES_PROP"),QUEUE_PROP=Symbol("QUEUE_PROP"),POS_PROP=Symbol("POS_PROP"),TRANSACTION_PROP=Symbol("TRANSACTION_PROP"),TRANSACTION_TIMER_PROP=Symbol("TRANSACTION_TIMER_PROP"),AUTO_RECORD_PROP=Symbol("AUTO_RECORD_PROP"),PROPS=Object.freeze([STATE_PROP,STORES_PROP,QUEUE_PROP,POS_PROP,TRANSACTION_PROP,TRANSACTION_TIMER_PROP,AUTO_RECORD_PROP]),registry=new Map,registerStmState=(e,t)=>{registry.set(e,t)},resolveStmState=e=>("string"==typeof e&&(e=registry.get(e)),e);var Registry={registerStmState:registerStmState,resolveStmState:resolveStmState};const resetQueue=(e,t)=>{const{undo:r,redo:n}=t;let i;return[i=r&&!n?{[QUEUE_PROP]:e[QUEUE_PROP].slice(e.position),[POS_PROP]:0}:n&&!r?{[QUEUE_PROP]:e[QUEUE_PROP].slice(0,e.position)}:{[QUEUE_PROP]:[],[POS_PROP]:0},()=>{e.notifyStoresAboutQueueReset(t)}]};class DisabledStateClass extends StateBase{canUndo(){return!1}canRedo(){return!1}onUndo(){throwInvalidMethodCall()}onRedo(){throwInvalidMethodCall()}onEnable(e){return e.autoRecord?"autoreadystate":"readystate"}onDisable(){throwInvalidMethodCall()}onAutoRecordOn(){return{[AUTO_RECORD_PROP]:!0}}onAutoRecordOff(){return{[AUTO_RECORD_PROP]:!1}}onStartTransaction(){throwInvalidMethodCall()}onStopTransaction(){throwInvalidMethodCall()}onStopTransactionDelayed(){throwInvalidMethodCall()}onRejectTransaction(){throwInvalidMethodCall()}onResetQueue(e,t){return resetQueue(e,t)}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}}const DisabledState=new DisabledStateClass;Registry.registerStmState("disabledstate",DisabledState);const ACTION_QUEUE_PROP=Symbol("ACTION_QUEUE_PROP");class Transaction extends Base{get defaultConfig(){return{title:null}}construct(...e){this[ACTION_QUEUE_PROP]=[],super.construct(...e)}get queue(){return this[ACTION_QUEUE_PROP].slice(0)}get length(){return this[ACTION_QUEUE_PROP].length}addAction(e){this[ACTION_QUEUE_PROP].push(e)}undo(){const e=this[ACTION_QUEUE_PROP];for(let t=e.length-1;t>=0;--t)e[t].undo()}redo(){const e=this[ACTION_QUEUE_PROP];for(let t=0,r=e.length;t<r;++t)e[t].redo()}}Transaction._$name="Transaction";class ReadyStateClass extends StateBase{canUndo(e){return 0<e.position&&e.position<=e.length}canRedo(e){return 0<=e.position&&e.position<e.length}onUndo(e,t){const r=e[QUEUE_PROP];let n=e.position,i=Math.max(0,n-t);return[{[STATE_PROP]:"restoringstate",[POS_PROP]:i},()=>{for(e.notifyStoresAboutStateRestoringStart();n!=i;)r[--n].undo();return[e.autoRecord?"autoreadystate":"readystate",()=>{e.notifyStoresAboutStateRestoringStop()}]}]}onRedo(e,t){const r=e[QUEUE_PROP];let n=e.position,i=Math.min(r.length,n+t);return[{[STATE_PROP]:"restoringstate",[POS_PROP]:i},()=>{e.notifyStoresAboutStateRestoringStart();do{r[n++].redo()}while(n!=i);return[e.autoRecord?"autoreadystate":"readystate",()=>{e.notifyStoresAboutStateRestoringStop()}]}]}onEnable(){throwInvalidMethodCall()}onDisable(){return"disabledstate"}onAutoRecordOn(){return{[STATE_PROP]:"autoreadystate",[AUTO_RECORD_PROP]:!0}}onAutoRecordOff(){throwInvalidMethodCall()}onStartTransaction(e,t){const r=new Transaction({title:t});return[{[STATE_PROP]:"recordingstate",[TRANSACTION_PROP]:r},()=>{e.notifyStoresAboutStateRecordingStart(r)}]}onStopTransaction(){throwInvalidMethodCall()}onStopTransactionDelayed(){throwInvalidMethodCall()}onRejectTransaction(){throwInvalidMethodCall()}onResetQueue(e,t){return resetQueue(e,t)}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}}let ReadyState=new ReadyStateClass;Registry.registerStmState("readystate",ReadyState);class RecordingStateClass extends StateBase{canUndo(){return!1}canRedo(){return!1}onEnable(){}onDisable(e){const t=e[TRANSACTION_PROP];return e.notifyStoresAboutStateRecordingStop(t,{disabled:!0}),{[STATE_PROP]:"disabledstate",[TRANSACTION_PROP]:null}}onAutoRecordOn(e){return[{[STATE_PROP]:"autorecordingstate",[AUTO_RECORD_PROP]:!0},()=>{e[STATE_PROP].onStopTransactionDelayed(e)}]}onAutoRecordOff(){throwInvalidMethodCall()}onStartTransaction(){throwInvalidMethodCall()}onStopTransaction(e,t){const r=e[TRANSACTION_PROP];let n=e[POS_PROP],i=e[QUEUE_PROP];return r.length&&(r.title||t||!e.getTransactionTitle?t&&(r.title=t):r.title=e.getTransactionTitle(r),i[n]=r,i.length=++n),[{[STATE_PROP]:"readystate",[POS_PROP]:n,[TRANSACTION_PROP]:null},()=>{e.notifyStoresAboutStateRecordingStop(r,{stop:!0})}]}onRejectTransaction(e){const t=e[TRANSACTION_PROP];return[{[STATE_PROP]:"restoringstate",[TRANSACTION_PROP]:null},()=>(t.length&&t.undo(),["readystate",()=>{e.notifyStoresAboutStateRecordingStop(t,{rejected:!0})}])]}onStopTransactionDelayed(){throwInvalidMethodCall()}onQueueReset(){throwInvalidMethodCall()}onModelUpdate(e,t,r,n){e[TRANSACTION_PROP].addAction(e.makeModelUpdateAction(t,r,n))}onModelInsertChild(e,t,r,n,i,s){e[TRANSACTION_PROP].addAction(e.makeModelInsertChildAction(t,r,n,i,s))}onModelRemoveChild(e,t,r,n){e[TRANSACTION_PROP].addAction(e.makeModelRemoveChildAction(t,r,n))}onStoreModelAdd(e,t,r,n){e[TRANSACTION_PROP].addAction(e.makeStoreModelAddAction(t,r,n))}onStoreModelInsert(e,t,r,n,i,s){e[TRANSACTION_PROP].addAction(e.makeStoreModelInsertAction(t,r,n,i,s))}onStoreModelRemove(e,t,r,n,i){e[TRANSACTION_PROP].addAction(e.makeStoreModelRemoveAction(t,r,n,i))}onStoreRemoveAll(e,t,r,n){e[TRANSACTION_PROP].addAction(e.makeStoreRemoveAllAction(t,r,n))}}const RecordingState=new RecordingStateClass;Registry.registerStmState("recordingstate",RecordingState);class RestoringStateClass extends StateBase{canUndo(){return!1}canRedo(){return!1}onUndo(){throwInvalidMethodCall()}onRedo(){throwInvalidMethodCall()}onEnable(){throwInvalidMethodCall()}onDisable(){throwInvalidMethodCall()}onAutoRecordOn(){return{[AUTO_RECORD_PROP]:!0}}onAutoRecordOff(){return{[AUTO_RECORD_PROP]:!1}}onStartTransaction(){throwInvalidMethodCall()}onStopTransaction(){throwInvalidMethodCall()}onStopTransactionDelayed(){throwInvalidMethodCall()}onRejectTransaction(){throwInvalidMethodCall()}onQueueReset(){throwInvalidMethodCall()}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}}const RestoringState=new RestoringStateClass;Registry.registerStmState("restoringstate",RestoringState);class AutoReadyStateClass extends ReadyStateClass{onAutoRecordOn(){throwInvalidMethodCall()}onAutoRecordOff(){return{[STATE_PROP]:"readystate",[AUTO_RECORD_PROP]:!1}}onStartTransaction(e,t){const r=new Transaction({title:t});return[{[STATE_PROP]:"autorecordingstate",[TRANSACTION_PROP]:r},()=>{e.notifyStoresAboutStateRecordingStart(r),e.stopTransactionDelayed()}]}onModelUpdate(e,t,r,n){e.startTransaction(),e.onModelUpdate(t,r,n)}onModelInsertChild(e,t,r,n,i){e.startTransaction(),e.onModelInsertChild(t,r,n,i)}onModelRemoveChild(e,t,r,n){e.startTransaction(),e.onModelRemoveChild(t,r,n)}onStoreModelAdd(e,t,r,n){e.startTransaction(),e.onStoreModelAdd(t,r,n)}onStoreModelInsert(e,t,r,n,i,s){e.startTransaction(),e.onStoreModelInsert(t,r,n,s)}onStoreModelRemove(e,t,r,n,i){e.startTransaction(),e.onStoreModelRemove(t,r,n,i)}onStoreRemoveAll(e,t,r,n){e.startTransaction(),e.onStoreRemoveAll(t,r,n)}}const AutoReadyState=new AutoReadyStateClass;Registry.registerStmState("autoreadystate",AutoReadyState);class AutoRecordingStateClass extends(Delayable(RecordingStateClass)){onDisable(e){const t=e[TRANSACTION_PROP],r=e[TRANSACTION_TIMER_PROP];return r&&this.clearTimeout(r),e.notifyStoresAboutStateRecordingStop(t,{disabled:!0}),{[STATE_PROP]:"disabledstate",[TRANSACTION_PROP]:null,[TRANSACTION_TIMER_PROP]:null}}onAutoRecordOn(e){throwInvalidMethodCall()}onAutoRecordOff(e){const t=e[TRANSACTION_TIMER_PROP];return t&&this.clearTimeout(t),{[STATE_PROP]:"recordingstate",[AUTO_RECORD_PROP]:!1,[TRANSACTION_TIMER_PROP]:null}}onStopTransaction(e,t){const r=e[TRANSACTION_PROP],n=e[TRANSACTION_TIMER_PROP];let i=e[POS_PROP],s=e[QUEUE_PROP];return n&&this.clearTimeout(n),r.length&&(r.title||t||!e.getTransactionTitle?t&&(r.title=t):r.title=e.getTransactionTitle(r),s[i]=r,s.length=++i),[{[STATE_PROP]:"autoreadystate",[POS_PROP]:i,[TRANSACTION_PROP]:null,[TRANSACTION_TIMER_PROP]:null},()=>{e.notifyStoresAboutStateRecordingStop(r,{stop:!0})}]}onStopTransactionDelayed(e){let t=e[TRANSACTION_TIMER_PROP];return t&&this.clearTimeout(t),t=this.setTimeout(()=>{e.stopTransaction()},e.autoRecordTransactionStopTimeout),{[STATE_PROP]:AutoRecordingState,[TRANSACTION_TIMER_PROP]:t}}onRejectTransaction(e){const t=e[TRANSACTION_PROP],r=e[TRANSACTION_TIMER_PROP];return r&&this.clearTimeout(r),[{[STATE_PROP]:"restoringstate",[TRANSACTION_PROP]:null,[TRANSACTION_TIMER_PROP]:null},()=>(t.length&&t.undo(),["autoreadystate",()=>{e.notifyStoresAboutStateRecordingStop(t,{rejected:!0})}])]}onModelUpdate(e,...t){super.onModelUpdate(e,...t),e.stopTransactionDelayed()}onModelInsertChild(e,...t){super.onModelInsertChild(e,...t),e.stopTransactionDelayed()}onModelRemoveChild(e,...t){super.onModelRemoveChild(e,...t),e.stopTransactionDelayed()}onStoreModelAdd(e,...t){super.onStoreModelAdd(e,...t),e.stopTransactionDelayed()}onStoreModelInsert(e,...t){super.onStoreModelInsert(e,...t),e.stopTransactionDelayed()}onStoreModelRemove(e,...t){super.onStoreModelRemove(e,...t),e.stopTransactionDelayed()}onStoreRemoveAll(e,...t){super.onStoreRemoveAll(e,...t),e.stopTransactionDelayed()}}const AutoRecordingState=new AutoRecordingStateClass;Registry.registerStmState("autorecordingstate",AutoRecordingState);const throwAbstractMethodCall$1=()=>{throw new Error("Abstract method call!")};class ActionBase extends Base{get type(){return this.constructor.name}undo(){throwAbstractMethodCall$1()}redo(){throwAbstractMethodCall$1()}}ActionBase._$name="ActionBase";const MODEL_PROP=Symbol("MODEL_PROP"),NEW_DATA_PROP=Symbol("NEW_DATA_PROP"),OLD_DATA_PROP=Symbol("OLD_DATA_PROP");class UpdateAction extends ActionBase{static get defaultConfig(){return{model:void 0,newData:void 0,oldData:void 0}}get type(){return"UpdateAction"}get model(){return this[MODEL_PROP]}set model(e){this[MODEL_PROP]=e}get newData(){return this[NEW_DATA_PROP]}set newData(e){this[NEW_DATA_PROP]=Object.assign({},e)}get oldData(){return this[OLD_DATA_PROP]}set oldData(e){this[OLD_DATA_PROP]=Object.assign({},e)}undo(){this.model.set(this.oldData)}redo(){this.model.set(this.newData)}}UpdateAction._$name="UpdateAction";const PARENT_MODEL_PROP=Symbol("PARENT_MODEL_PROP"),CHILD_MODELS_PROP=Symbol("CHILD_MODELS_PROP"),INSERT_INDEX_PROP=Symbol("INSERT_INDEX_PROP"),CONTEXT_PROP=Symbol("CONTEXT_PROP");class InsertChildAction extends ActionBase{static get defaultConfig(){return{parentModel:void 0,childModels:void 0,insertIndex:void 0,context:void 0}}get type(){return"InsertChildAction"}get parentModel(){return this[PARENT_MODEL_PROP]}set parentModel(e){this[PARENT_MODEL_PROP]=e}get childModels(){return this[CHILD_MODELS_PROP]}set childModels(e){this[CHILD_MODELS_PROP]=e.slice(0)}get insertIndex(){return this[INSERT_INDEX_PROP]}set insertIndex(e){this[INSERT_INDEX_PROP]=e}get context(){return this[CONTEXT_PROP]}set context(e){this[CONTEXT_PROP]=e}undo(){const{parentModel:e,context:t,childModels:r}=this;r.sort((e,r)=>{const{lhsParent:n,lhsIndex:i}=t.get(e)||{},{rhsParent:s,rhsIndex:o}=t.get(r)||{};return n&&n===s?i-o:0}),r.forEach(r=>{const{parent:n,index:i}=t.get(r)||{};n?n===e?n.insertChild(r,n.children[i+1]):n.insertChild(r,n.children[i]):e.removeChild(r)})}redo(){this.parentModel.insertChild(this.insertIndex,this.childModels)}}InsertChildAction._$name="InsertChildAction";const PARENT_MODEL_PROP$1=Symbol("PARENT_MODEL_PROP"),CHILD_MODELS_PROP$1=Symbol("CHILD_MODELS_PROP"),CONTEXT_PROP$1=Symbol("CONTEXT_PROP");class RemoveChildAction extends ActionBase{static get defaultConfig(){return{parentModel:void 0,childModels:void 0,context:void 0}}get type(){return"RemoveChildAction"}get parentModel(){return this[PARENT_MODEL_PROP$1]}set parentModel(e){this[PARENT_MODEL_PROP$1]=e}get childModels(){return this[CHILD_MODELS_PROP$1]}set childModels(e){this[CHILD_MODELS_PROP$1]=e.slice(0)}get context(){return this[CONTEXT_PROP$1]}set context(e){this[CONTEXT_PROP$1]=e}undo(){const{parentModel:e,context:t,childModels:r}=this;r.sort((e,r)=>{return t.get(e)-t.get(r)}),r.forEach(r=>{e.insertChild(t.get(r),r)})}redo(){this.parentModel.removeChild(this.childModels)}}RemoveChildAction._$name="RemoveChildAction";const STORE_PROP=Symbol("STORE_PROP"),MODEL_LIST_PROP=Symbol("MODEL_LIST_PROP");class AddAction extends ActionBase{static get defaultConfig(){return{store:void 0,modelList:void 0,silent:!1}}get type(){return"AddAction"}get store(){return this[STORE_PROP]}set store(e){this[STORE_PROP]=e}get modelList(){return this[MODEL_LIST_PROP]}set modelList(e){this[MODEL_LIST_PROP]=e.slice(0)}undo(){this.store.remove(this.modelList,this.silent)}redo(){this.store.add(this.modelList,this.silent)}}AddAction._$name="AddAction";const STORE_PROP$1=Symbol("STORE_PROP"),MODEL_LIST_PROP$1=Symbol("MODEL_LIST_PROP"),INSERT_INDEX_PROP$1=Symbol("INSERT_INDEX_PROP"),CONTEXT_PROP$2=Symbol("CONTEXT_PROP");class InsertAction extends ActionBase{static get defaultConfig(){return{store:void 0,modelList:void 0,insertIndex:void 0,context:void 0,silent:!1}}get type(){return"InsertAction"}get store(){return this[STORE_PROP$1]}set store(e){this[STORE_PROP$1]=e}get modelList(){return this[MODEL_LIST_PROP$1]}set modelList(e){this[MODEL_LIST_PROP$1]=e.slice(0)}get insertIndex(){return this[INSERT_INDEX_PROP$1]}set insertIndex(e){this[INSERT_INDEX_PROP$1]=e}get context(){return this[CONTEXT_PROP$2]}set context(e){this[CONTEXT_PROP$2]=e}undo(){const{store:e,modelList:t,context:r,silent:n}=this;t.sort((e,t)=>{const n=r.get(e),i=r.get(t);return void 0!==n&&void 0!==i?n-i:0}),t.forEach(t=>{const i=r.get(t);void 0!==i?e.insert(i,t,n):e.remove(t,n)})}redo(){this.store.insert(this.insertIndex,this.modelList,this.silent)}}InsertAction._$name="InsertAction";const STORE_PROP$2=Symbol("STORE_PROP"),MODEL_LIST_PROP$2=Symbol("MODEL_LIST_PROP"),CONTEXT_PROP$3=Symbol("CONTEXT_PROP");class RemoveAction extends ActionBase{static get defaultConfig(){return{store:void 0,modelList:void 0,context:void 0,silent:!1}}get type(){return"RemoveAction"}get store(){return this[STORE_PROP$2]}set store(e){this[STORE_PROP$2]=e}get modelList(){return this[MODEL_LIST_PROP$2]}set modelList(e){this[MODEL_LIST_PROP$2]=e.slice(0)}get context(){return this[CONTEXT_PROP$3]}set context(e){this[CONTEXT_PROP$3]=e}undo(){const{store:e,context:t,modelList:r,silent:n}=this;r.sort((e,r)=>{return t.get(e)-t.get(r)}),r.forEach(r=>{const i=t.get(r);e.insert(i,r,n)})}redo(){this.store.remove(this.modelList,this.silent)}}RemoveAction._$name="RemoveAction";const STORE_PROP$3=Symbol("STORE_PROP"),ALL_RECORDS_PROP=Symbol("ALL_RECORDS_PROP");class RemoveAllAction extends ActionBase{static get defaultConfig(){return{store:void 0,allRecords:void 0,silent:!1}}get type(){return"RemoveAllAction"}get store(){return this[STORE_PROP$3]}set store(e){this[STORE_PROP$3]=e}get allRecords(){return this[ALL_RECORDS_PROP]}set allRecords(e){this[ALL_RECORDS_PROP]=e.slice(0)}undo(){const{store:e,allRecords:t,silent:r}=this;e.add(t,r)}redo(){this.store.removeAll(this.silent)}}RemoveAllAction._$name="RemoveAllAction";const makeModelUpdateAction=(e,t,r)=>new UpdateAction({model:e,newData:t,oldData:r}),makeModelInsertChildAction=(e,t,r,n)=>new InsertChildAction({parentModel:e,childModels:r,insertIndex:t,context:n}),makeModelRemoveChildAction=(e,t,r)=>new RemoveChildAction({parentModel:e,childModels:t,context:r}),makeStoreModelAddAction=(e,t,r)=>new AddAction({store:e,modelList:t,silent:r}),makeStoreModelInsertAction=(e,t,r,n,i)=>new InsertAction({store:e,insertIndex:t,modelList:r,context:n,silent:i}),makeStoreModelRemoveAction=(e,t,r,n)=>new RemoveAction({store:e,modelList:t,context:r,silent:n}),makeStoreRemoveAllAction=(e,t,r)=>new RemoveAllAction({store:e,allRecords:t,silent:r}),stateTransition=(e,t,...r)=>{const n=t.call(e[STATE_PROP],e,...r);if("string"==typeof n)e[STATE_PROP]=Registry.resolveStmState(n);else if(n instanceof StateBase)e[STATE_PROP]=n;else if(Array.isArray(n)){const[t,i]=n;"string"==typeof t?e[STATE_PROP]=Registry.resolveStmState(t):t instanceof StateBase?e[STATE_PROP]=t:t&&"object"==typeof t&&((e=Object.assign(e,t))[STATE_PROP]=Registry.resolveStmState(e[STATE_PROP])),"function"==typeof i&&stateTransition(e,i,...r)}else n&&"object"==typeof n&&((e=Object.assign(e,n))[STATE_PROP]=Registry.resolveStmState(e[STATE_PROP]))};class StateTrackingManager extends(Events(Base)){static get defaultConfig(){return{disabled:!0,autoRecord:!1,autoRecordTransactionStopTimeout:100,makeModelUpdateAction:makeModelUpdateAction,makeModelInsertChildAction:makeModelInsertChildAction,makeModelRemoveChildAction:makeModelRemoveChildAction,makeStoreModelAddAction:makeStoreModelAddAction,makeStoreModelInsertAction:makeStoreModelInsertAction,makeStoreModelRemoveAction:makeStoreModelRemoveAction,makeStoreRemoveAllAction:makeStoreRemoveAllAction,getTransactionTitle:null}}construct(...e){Object.assign(this,{[STATE_PROP]:ReadyState,[STORES_PROP]:[],[QUEUE_PROP]:[],[POS_PROP]:0,[TRANSACTION_PROP]:null,[TRANSACTION_TIMER_PROP]:null,[AUTO_RECORD_PROP]:!1}),super.construct(...e)}doDestroy(){super.doDestroy(),this.destroyProperties(STATE_PROP)}get state(){return this[STATE_PROP]}get position(){return this[POS_PROP]}get length(){return this[QUEUE_PROP].length}get stores(){return Array.from(this[STORES_PROP])}hasStore(e){return this[STORES_PROP].includes(e)}addStore(e){this.hasStore(e)||(this[STORES_PROP].push(e),e.stm=this)}removeStore(e){this.hasStore(e)&&(this[STORES_PROP]=this[STORES_PROP].filter(t=>t!==e),e.stm=null)}getStoreById(e){return this[STORES_PROP].find(t=>t.id===e)}forEachStore(e){this[STORES_PROP].forEach(t=>e(t,t.id))}get disabled(){return this.state===DisabledState}set disabled(e){const t=this;t.disabled!=e&&stateTransition(t,e?t.state.onDisable:t.state.onEnable,t)}enable(){this.disabled=!1}disable(){this.disabled=!0}get isReady(){return this.state===ReadyState||this.state===AutoReadyState}get isRecording(){return this.state===RecordingState||this.state===AutoRecordingState}get autoRecord(){return this[AUTO_RECORD_PROP]}set autoRecord(e){const t=this;t.autoRecord!=e&&stateTransition(t,e?t.state.onAutoRecordOn:t.state.onAutoRecordOff,t)}startTransaction(e=null){stateTransition(this,this.state.onStartTransaction,e)}stopTransaction(e=null){stateTransition(this,this.state.onStopTransaction,e)}stopTransactionDelayed(){stateTransition(this,this.state.onStopTransactionDelayed)}rejectTransaction(){stateTransition(this,this.state.onRejectTransaction)}get transaction(){return this[TRANSACTION_PROP]}get queue(){return this[QUEUE_PROP].map(e=>e.title)}get isRestoring(){return this.state===RestoringState}get canUndo(){return this.state.canUndo(this)}get canRedo(){return this.state.canRedo(this)}undo(e=1){stateTransition(this,this.state.onUndo,e)}undoAll(){this.undo(this.length)}redo(e=1){stateTransition(this,this.state.onRedo,e)}redoAll(){this.redo(this.length)}resetQueue(e={undo:!0,redo:!0}){stateTransition(this,this.state.onResetQueue,e)}resetUndoQueue(){this.resetQueue({undo:!0})}resetRedoQueue(){this.resetQueue({redo:!0})}notifyStoresAboutStateRecordingStart(e){this.forEachStore(t=>{t.onStmRecordingStart&&t.onStmRecordingStart(this,e)}),this.trigger("recordingStart",{stm:this,transaction:e})}notifyStoresAboutStateRecordingStop(e,t){this.forEachStore(r=>{r.onStmRecordingStop&&r.onStmRecordingStop(this,e,t)}),this.trigger("recordingStop",{stm:this,transaction:e,reason:t})}notifyStoresAboutStateRestoringStart(){this.forEachStore(e=>{e.onStmRestoringStart&&e.onStmRestoringStart(this)}),this.trigger("restoringStart",{stm:this})}notifyStoresAboutStateRestoringStop(){this.forEachStore(e=>{e.onStmRestoringStop&&e.onStmRestoringStop(this)}),this.trigger("restoringStop",{stm:this})}notifyStoresAboutQueueReset(e){this.forEachStore(t=>{t.onStmQueueReset&&t.onStmQueueReset(this,e)}),this.trigger("queueReset",{stm:this,options:e})}onModelUpdate(e,t,r){stateTransition(this,this.state.onModelUpdate,e,t,r)}onModelInsertChild(e,t,r,n){stateTransition(this,this.state.onModelInsertChild,e,t,r,n)}onModelRemoveChild(e,t,r){stateTransition(this,this.state.onModelRemoveChild,e,t,r)}onStoreModelAdd(e,t,r){stateTransition(this,this.state.onStoreModelAdd,e,t,r)}onStoreModelInsert(e,t,r,n,i){stateTransition(this,this.state.onStoreModelInsert,e,t,r,n,i)}onStoreModelRemove(e,t,r,n){stateTransition(this,this.state.onStoreModelRemove,e,t,r,n)}onStoreRemoveAll(e,t,r){stateTransition(this,this.state.onStoreRemoveAll,e,t,r)}}StateTrackingManager._$name="StateTrackingManager";var DragHelperContainer=e=>(class extends(e||Base){initContainerDrag(){if(this.mode||(this.mode="container"),"container"===this.mode&&!this.containers)throw new Error("Container drag mode must specify containers")}grabContainerDrag(e){const t=this;if(!t.ignoreSelector||!DomHelper.up(e.target,t.ignoreSelector)){const r=DomHelper.getAncestor(e.target,t.containers,t.outerElement);if(r){const n=r.getBoundingClientRect();t.context={element:r,valid:!0,action:"container",offsetX:e.pageX-n.left,offsetY:e.pageY-n.top,originalPosition:{parent:r.parentElement,prev:r.previousElementSibling,next:r.nextElementSibling}}}return!0}return!1}startContainerDrag(e){const t=this.context,r=t.element,n=r.cloneNode(!0),i=r.getBoundingClientRect();n.classList.add(this.dragProxyCls),n.classList.add(this.draggingCls),document.body.appendChild(n),t.dragProxy=n,n.style.width=i.width+"px",n.style.height=i.height+"px",DomHelper.setTranslateXY(t.dragProxy,i.left,i.top),t.dragging=r,r.classList.add(this.dropPlaceholderCls)}updateContainerDrag(e){const t=this,r=t.context;if(!r.started||!r.targetElement)return;const n=DomHelper.getAncestor(r.targetElement,t.containers,"b-grid"),i=r.dragging&&r.dragging.contains(document.activeElement);n&&DomHelper.isDescendant(r.element,n)||(i&&GlobalEvents.suspendFocusEvents(),n&&r.valid?t.moveNextTo(n,e):t.revertPosition(),i&&GlobalEvents.resumeFocusEvents(),e.preventDefault())}finishContainerDrag(e){const t=this,r=t.context,{dragging:n,dragProxy:i,valid:s,draggedTo:o,insertBefore:a,originalPosition:l}=r;n&&(r.valid=s&&o&&(n!==a||l.parent!==o),r.finalize=((e=r.valid)=>{!e&&this.context&&t.revertPosition(),n.classList.remove(t.dropPlaceholderCls),i.remove(),t.reset()}),r.async=!1,t.trigger("drop",{context:r,event:e}),r.async?r.awaitingFinalization=!0:r.finalize())}abortContainerDrag(e=!1,t=null,r=!1){const n=this,i=n.context;i.dragging&&(i.dragging.classList.remove(n.dropPlaceholderCls),i.dragProxy.remove(),n.context={}),r||n.trigger(e?"drop":"abort",{context:i,event:t})}updateContainerProxy(e){const t=this,r=t.context,n=r.dragProxy;let i,s=e.pageX-r.offsetX,o=e.pageY-r.offsetY;if("number"==typeof t.minX&&(s=Math.max(t.minX,s)),"number"==typeof t.maxX&&(s=Math.min(t.maxX-n.offsetWidth,s)),"number"==typeof t.minY&&(o=Math.max(t.minY,o)),"number"==typeof t.maxY&&(o=Math.min(t.maxY-n.offsetHeight,o)),t.lockX?DomHelper.setTranslateY(n,o):t.lockY?DomHelper.setTranslateX(n,s):DomHelper.setTranslateXY(n,s,o),"touchmove"===e.type){let t=e.changedTouches[0];i=document.elementFromPoint(t.clientX,t.clientY)}else i=e.target;r.targetElement=i}moveNextTo(e,t){const r=this.context,n=r.dragging,i=e.parentElement;if(e!==n){const s=e.getBoundingClientRect().left+e.offsetWidth/2;t.pageX<s?(i.insertBefore(n,e),r.insertBefore=e):e.nextElementSibling?e.nextElementSibling!==n?(r.insertBefore=e.nextElementSibling,i.insertBefore(n,e.nextElementSibling)):r.insertBefore||n.parentElement.lastElementChild===n||(r.insertBefore=e.nextElementSibling):(i.appendChild(n),r.insertBefore=null),r.draggedTo=i}}revertPosition(){const e=this.context,t=e.originalPosition;if(t.next){t.next&&t.next.previousSibling===e.dragging||!t.next&&e.dragging===t.parent.lastChild||t.parent.insertBefore(e.dragging,t.next)}else t.parent.appendChild(e.dragging);e.draggedTo=null}});const noScroll={pageXOffset:0,pageYOffset:0};var DragHelperTranslate=e=>(class extends(Delayable(e||Base)){initTranslateDrag(){const e=this;!e.isElementDraggable&&e.targetSelector&&(e.isElementDraggable=(t=>DomHelper.up(t,e.targetSelector)))}grabTranslateDrag(e){const t=this,r=t.getTarget(e);return!!r&&(t.context={valid:!0,action:t.mode,element:r,startPageX:e.pageX,startPageY:e.pageY,startClientX:e.clientX,startClientY:e.clientY},!0)}getTarget(e){return DomHelper.up(e.target,this.targetSelector)}startTranslateDrag(e){const t=this,r=t.context;let n=r.element;if(n&&!r.started){const i=n,s=n.parentElement,o=t.dragWithin=t.dragWithin||t.cloneTarget&&document.body,a=t.outerElement;if(t.cloneTarget){const e=DomHelper.getOffsetX(n,o),r=DomHelper.getOffsetY(n,o),s=n.offsetWidth,a=n.offsetHeight;n=this.createProxy(n),DomHelper.setTranslateXY(n,e,r),n.style.width=`${s}px`,n.style.height=`${a}px`,n.classList.add(t.dragProxyCls),o.appendChild(n),i.classList.add("b-drag-original"),t.hideOriginalElement&&i.classList.add("b-hidden")}Object.assign(t.context,{element:n,grabbed:i,grabbedParent:s,grabbedNextSibling:n.nextElementSibling,elementStartX:DomHelper.getTranslateX(n),elementStartY:DomHelper.getTranslateY(n),elementX:DomHelper.getOffsetX(n,o||a),elementY:DomHelper.getOffsetY(n,o||a),scrollX:0,scrollY:0,scrollManagerElementContainsDragProxy:!t.cloneTarget||o===a}),n.classList.add(t.draggingCls),o&&(r.parentElement=n.parentElement,o!==n.parentElement&&o.appendChild(n),t.updateTranslateProxy(e))}}applyConstraints(e,t,r){const n=this,i=n.dragWithin,{pageXOffset:s,pageYOffset:o}=i===document.body?window:noScroll;return i&&n.constrain&&(t<0&&(t=0),t+e.offsetWidth>i.scrollWidth&&(t=i.scrollWidth-e.offsetWidth),r<0&&(r=0),r+e.offsetHeight>i.scrollHeight&&(r=i.scrollHeight-e.offsetHeight)),"number"==typeof n.minX&&(t=Math.max(n.minX+s,t)),"number"==typeof n.maxX&&(t=Math.min(n.maxX+s,t)),"number"==typeof n.minY&&(r=Math.max(n.minY+o,r)),"number"==typeof n.maxY&&(r=Math.min(n.maxY+o,r)),{constrainedX:t,constrainedY:r}}updateTranslateProxy(e,t){const r=this,n=r.context,i=n.element,s=e.pageX-n.startPageX,o=e.pageY-n.startPageY;n.pageX=e.pageX,n.pageY=e.pageY,n.clientX=e.clientX,n.clientY=e.clientY,n.scrollManagerElementContainsDragProxy&&t&&(n.scrollX=t.scrollRelativeLeft,n.scrollY=t.scrollRelativeTop);const a=n.elementStartX+s+n.scrollX,l=n.elementStartY+o+n.scrollY,{constrainedX:d,constrainedY:c}=r.applyConstraints(i,a,l);"translateX"===r.mode?DomHelper.setTranslateX(i,d):"translateY"===r.mode?DomHelper.setTranslateY(i,c):"translateXY"===r.mode&&DomHelper.setTranslateXY(i,d,c),n.newX=d,n.newY=c}finishTranslateDrag(e){const t=this,r=t.context,n=r.newX!==r.elementStartX,i=r.newY!==r.elementStartY,s=r.element;function o(){s.classList.remove(t.invalidCls),s.classList.remove(t.draggingCls),s.classList.contains("b-aborting")||(t.hideOriginalElement&&r.grabbed.classList.remove("b-hidden"),r.grabbed.classList.remove("b-drag-original"))}if(n||"translateXY"===t.mode&&i){if(!1===r.valid)t.abortTranslateDrag(!0,e);else{const n=Rectangle.from(t.dragWithin||t.outerElement);!t.minX&&e.pageX<n.left||!t.maxX&&e.pageX>n.right||!t.minY&&e.pageY<n.top||!t.maxY&&e.pageY>n.bottom?(r.valid=!1,t.abortTranslateDrag(!0,e)):(r.finalize=((e=r.valid)=>{r.asyncCleanup&&o(),!e&&this.context?t.abortTranslateDrag(!0,null,!0):t.cloneTarget&&s.remove(),t.reset()}),r.async=!1,t.trigger("drop",{context:r,event:e}),r.async?r.awaitingFinalization=!0:r.finalize())}r.asyncCleanup||o()}else t.abortTranslateDrag(!1,e)}abortTranslateDrag(e=!1,t=null,r=!1){const n=this,i=n.context,s=i.element;s&&(s.classList.add("b-aborting"),!n.cloneTarget&&n.dragWithin&&n.dragWithin!==i.grabbedParent&&i.grabbedParent.insertBefore(s,i.grabbedNextSibling),"translateXY"!==n.mode||n.lockX||n.lockY||DomHelper.setTranslateXY(s,i.elementStartX,i.elementStartY),("translateX"===n.mode||n.lockY)&&DomHelper.setTranslateX(s,i.elementStartX),("translateY"===n.mode||n.lockX)&&DomHelper.setTranslateY(s,i.elementStartY),i.started&&n.setTimeout(()=>{i.grabbed.classList.remove("b-hidden"),i.grabbed.classList.remove("b-drag-original"),n.cloneTarget?s.remove():(s.classList.remove("b-aborting"),s.classList.remove(n.draggingCls),s.classList.remove(n.invalidCls))},300,void 0,!0)),r||n.trigger(e?"drop":"abort",{context:i,event:t}),n.reset()}});const documentListeners={down:"onMouseDown",move:"onMouseMove",up:"onMouseUp",docclick:"onDocumentClick",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",keydown:"onKeyDown"};class DragHelper extends(base(Base).mixes(Events,DragHelperContainer,DragHelperTranslate)){static get defaultConfig(){return{dragProxyCls:"b-drag-proxy",invalidCls:"b-drag-invalid",draggingCls:"b-dragging",dropPlaceholderCls:"b-drop-placeholder",resizingCls:"b-resizing",dragThreshold:5,handleSize:10,touchHandleSize:30,minWidth:1,outerElement:document.body,dragWithin:null,constrain:!0,minX:null,maxX:null,minY:null,maxY:null,mode:null,isElementDraggable:null,targetSelector:null,dropTargetSelector:null,cloneTarget:!1,hideOriginalElement:!1,containers:null,ignoreSelector:null,handleSelector:null,startEvent:null,lockX:!1,lockY:!1}}construct(e){const t=this;super.construct(e),t.initListeners(),BrowserHelper.isTouchDevice&&(t.handleSize=t.touchHandleSize),"container"===t.mode?t.initContainerDrag():t.mode.startsWith("translate")&&(t.lockY?t.mode="translateX":t.lockX&&(t.mode="translateY"),t.initTranslateDrag())}doDestroy(){this.abort(!0),super.doDestroy()}initListeners(){const e={element:this.outerElement,mousedown:documentListeners.down,thisObj:this};BrowserHelper.isTouchDevice&&(e.touchstart=documentListeners.touchstart),EventHelper.on(e)}onPointerDown(e){let t=this,r=!1,n="touches"in e;if(t.context)t.context.awaitingFinalization||(t.onMouseUp(e),t.reset());else if(t.startEvent=e,(!t.isElementDraggable||t.isElementDraggable(e.target,e))&&(t.mode&&(r||"container"!==t.mode||(r=t.grabContainerDrag(e)),!r&&t.mode.startsWith("translate")&&(r=t.grabTranslateDrag(e))),r)){const e={element:document,thisObj:t,keydown:documentListeners.keydown};if(n?(e.touchmove={handler:documentListeners.touchmove,passive:!1},e.touchend=e.pointerup=documentListeners.touchend):(e.mousemove=documentListeners.move,e.mouseup=documentListeners.up),t.removeListeners=EventHelper.on(e),t.dragWithin&&t.dragWithin!==t.outerElement){const e=t.dragWithin.getBoundingClientRect();t.minY=e.top,t.maxY=e.bottom,t.minX=e.left,t.maxX=e.right}}}onTouchStart(e){1===e.touches.length&&this.onPointerDown(e)}onMouseDown(e){0===e.button&&this.onPointerDown(e)}internalMove(e){const t=this,r=t.context;if(r&&r.element&&e.target.nodeType===Node.ELEMENT_NODE&&(r.started||EventHelper.getDistanceBetween(t.startEvent,e)>=t.dragThreshold)){if(!r.started&&!1===t.callPreventable("dragStart",{context:r,event:e},()=>{const n=t.lockX?"vertical":t.lockY?"horizontal":"both";r.action.startsWith("translate")?t.startTranslateDrag(e):"container"===r.action&&t.startContainerDrag(e),r.started=!0,t.scrollManager&&t.scrollManager.startMonitoring({direction:n,element:t.dragWithin||t.outerElement,callback:e=>{t.context.element&&t.lastMouseMoveEvent&&(t.lastMouseMoveEvent.isScroll=!0,t.update(t.lastMouseMoveEvent,e))},thisObj:t})}))return t.abort();"touchmove"===e.type&&(e.preventDefault(),e.stopImmediatePropagation()),t.update(e)}}onTouchMove(e){this.internalMove(e)}onMouseMove(e){this.internalMove(e)}update(e,t){const r=this,n=r.context,i=n.dragProxy||n.element;let s=e.target,o=document.scrollingElement||document.body;if("touchmove"===e.type){const t=e.changedTouches[0];s=document.elementFromPoint(t.clientX+o.scrollLeft,t.clientY+o.scrollTop)}n.target=s,r.dropTargetSelector?n.valid=Boolean(s.closest(r.dropTargetSelector)):n.valid=!0,n.action&&("container"===n.action&&r.updateContainerProxy(e,t),n.action.startsWith("translate")&&r.updateTranslateProxy(e,t)),r.trigger("drag",{context:n,event:e}),"container"===n.action&&r.updateContainerDrag(e,t),i.classList[n.valid?"remove":"add"](r.invalidCls),e&&(r.lastMouseMoveEvent=e)}abort(e=!1){const t=this,r=t.context;t.scrollManager&&t.scrollManager.stopMonitoring(t.dragWithin||t.outerElement),r&&(r.element.getBoundingClientRect(),r.valid=!1,"container"===r.action?t.abortContainerDrag(void 0,void 0,e):t.abortTranslateDrag(void 0,void 0,e)),t.reset()}removeListeners(){}reset(){this.removeListeners(),this.trigger("reset"),this.context=this.lastMouseMoveEvent=null}onTouchEnd(e){this.onMouseUp(e)}onDocumentClick(e){e.stopPropagation()}onMouseUp(e){const t=this,r=t.context;if(t.removeListeners(),r)if(t.scrollManager&&t.scrollManager.stopMonitoring(t.dragWithin||t.outerElement),"container"===r.action?t.finishContainerDrag(e):r.started&&r.action.startsWith("translate")&&t.finishTranslateDrag(e),r.started){const e=EventHelper.on({element:document,thisObj:t,click:documentListeners.docclick,capture:!0,once:!0});t.setTimeout(e,50)}else t.reset()}onKeyDown(e){"Escape"===e.key&&this.abort()}createProxy(e){const t=e.cloneNode(!0);return t.removeAttribute("id"),t}}DragHelper._$name="DragHelper";class DomClassList{constructor(...e){"object"==typeof e[0]?Object.assign(this,e[0]):this.process(1,e),this[dirtySymbol]=!0}clone(){return new DomClassList(this)}toString(){return this.length?`${this.value} `:""}trim(){return this.value}isEqual(e){if("string"==typeof e&&(testClassList.value=e,e=testClassList),this.length===e.length){const t=ObjectHelper.getTruthyKeys(e);for(let e=0,r=t.length;e<r;e++)if(!this[t[e]])return!1;return!0}return!1}get value(){const e=this;if(e[dirtySymbol]){const t=ObjectHelper.getTruthyKeys(e);e[lengthSymbol]=t.length,e[valueSymbol]=t.join(" "),e[dirtySymbol]=!1}return e[valueSymbol]}set value(e){const t=this,r=Object.keys(t),n=r.length;for(let e=0;e<n;e++)delete t[r[e]];e?t.process(1,[e]):t[dirtySymbol]=!0}get length(){return this.value?this[lengthSymbol]:0}process(e,t){const r=t.length;for(let n=0;n<r;n++)if(t[n]){const r=t[n],i=r.values?Array.from(r.values()):r.item?Array.from(r):r.split(whiteSpaceRe$2),s=i.length;for(let t=0;t<s;t++)i[t]&&(this[i[t]]=e)}this[dirtySymbol]=!0}add(...e){this.process(1,e)}remove(...e){this.process(0,e)}split(){return ObjectHelper.getTruthyKeys(this)}forEach(e){return ObjectHelper.getTruthyKeys(this).forEach(e)}}const whiteSpaceRe$2=/\s+/,valueSymbol=Symbol("value"),lengthSymbol=Symbol("length"),dirtySymbol=Symbol("dirty"),testClassList=new DomClassList;DomClassList._$name="DomClassList";const documentListeners$1={down:"onMouseDown",move:"onMouseMove",up:"onMouseUp",docclick:"onDocumentClick",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",keydown:"onKeyDown"};class ResizeHelper extends(Events(Base)){static get defaultConfig(){return{resizingCls:"b-resizing",dragThreshold:5,handleSize:10,touchHandleSize:30,minWidth:1,maxWidth:0,outerElement:document.body,allowResize:null,dragWithin:null,isElementResizable:null,targetSelector:null,leftHandle:!0,rightHandle:!0,handleSelector:null,handleContainerSelector:null,startEvent:null,grab:null,invalidCls:"b-resize-invalid",handleVisibilityThreshold:null,skipTranslate:!1}}construct(e){const t=this;super.construct(e),!t.handleSelector&&BrowserHelper.isTouchDevice&&(t.handleSize=t.touchHandleSize),t.handleVisibilityThreshold=t.handleVisibilityThreshold||2*t.handleSize,t.initListeners(),t.initResize()}doDestroy(){this.abort(!0),super.doDestroy()}initResize(){const e=this;if(!e.isElementResizable&&e.targetSelector&&(e.isElementResizable=(t=>DomHelper.up(t,e.targetSelector))),e.grab){const{edge:t,element:r,event:n}=e.grab;e.startEvent=n,e.context={element:r,valid:!0,async:!1,edge:t,elementStartX:DomHelper.getTranslateX(r)||r.offsetLeft,newX:DomHelper.getTranslateX(r)||r.offsetLeft,elementWidth:r.offsetWidth,startX:n.clientX+e.outerElement.scrollLeft,started:!0,finalize:()=>e.reset&&e.reset()},r.classList.add(e.resizingCls),e.internalStartResize(e.isTouch)}}initListeners(){const e=this,t={element:e.outerElement,mousedown:documentListeners$1.down,thisObj:e};BrowserHelper.isTouchDevice?t.touchstart=documentListeners$1.touchstart:e.handleSelector||(t.mousemove={handler:documentListeners$1.move,delegate:e.targetSelector}),e.removeListeners=EventHelper.on(t)}removeListeners(){}internalStartResize(e){const t=this,r={element:document,keydown:documentListeners$1.keydown,thisObj:t};e?(r.touchmove=documentListeners$1.touchmove,r.touchend=r.pointerup=documentListeners$1.touchend):(r.mousemove=documentListeners$1.move,r.mouseup=documentListeners$1.up),t.removeDragListeners=EventHelper.on(r),t.scrollManager&&t.scrollManager.startMonitoring({direction:"horizontal",element:t.dragWithin||t.outerElement,callback:e=>t.context&&t.context.element&&t.lastMouseMoveEvent&&t.update(t.lastMouseMoveEvent,e),thisObj:t})}removeDragListeners(){}reset(){this.removeDragListeners(),this.context=null}onPointerDown(e,t){const r=this;r.startEvent=t,r.isElementResizable&&!r.isElementResizable(t.target,t)||r.grabResizeHandle(e,t)&&(t.stopImmediatePropagation(),r.internalStartResize(e))}onTouchStart(e){e.touches.length>1||this.onPointerDown(!0,e)}onMouseDown(e){0===e.button&&this.onPointerDown(!1,e)}internalMove(e,t){const r=this,n=r.context;n&&n.element&&(n.started||EventHelper.getDistanceBetween(r.startEvent,t)>=r.dragThreshold)?(n.started||(r.trigger("resizeStart",{context:n,event:t}),n.started=!0),r.update(t)):e||r.handleSelector||r.checkResizeHandles(t)}onTouchMove(e){this.internalMove(!0,e)}onMouseMove(e){this.internalMove(!1,e)}internalEnd(e,t){const r=this,n=r.context;r.removeDragListeners(),n&&(r.scrollManager&&r.scrollManager.stopMonitoring(r.dragWithin||r.outerElement),r.finishResize(t),r.context&&EventHelper.on({element:document,thisObj:r,click:documentListeners$1.docclick,capture:!0,once:!0}))}onTouchEnd(e){this.internalEnd(!0,e)}onMouseUp(e){this.internalEnd(!1,e)}onDocumentClick(e){e.stopPropagation()}update(e){const t=this,r=t.context,n=Rectangle.from(t.outerElement);r.currentX=Math.max(Math.min(e.clientX,n.right-1),n.x)+t.outerElement.scrollLeft,t.updateResize(e),t.trigger("resizing",{context:r,event:e}),r.element.classList[!1===r.valid?"add":"remove"](t.invalidCls),e&&(t.lastMouseMoveEvent=e)}abort(e=!1){const t=this;t.scrollManager&&t.scrollManager.stopMonitoring(t.dragWithin||t.outerElement),t.context&&t.abortResize(null,e)}grabResizeHandle(e,t){const r=this,n=r.handleSelector,i="touchstart"===t.type?t.changedTouches[0].clientX:t.clientX;if(r.allowResize&&!r.allowResize(t.target,t))return!1;const s=r.targetSelector?DomHelper.up(t.target,r.targetSelector):t.target;if(s){let o;if(n){if(!t.target.matches(n))return!1;o=t.pageX<DomHelper.getPageX(s)+s.offsetWidth/2?"left":"right"}else if(r.overLeftHandle(t,s))o="left";else{if(!r.overRightHandle(t,s))return r.context=null,!1;o="right"}if("touchstart"===t.type&&t.preventDefault(),!1!==r.trigger("beforeResizeStart",{element:s,event:t}))return r.context={element:s,valid:!0,async:!1,action:"resizeX",isTouch:e,edge:o,elementStartX:DomHelper.getTranslateX(s)||s.offsetLeft,newX:DomHelper.getTranslateX(s)||s.offsetLeft,elementWidth:s.offsetWidth,startX:i+r.outerElement.scrollLeft,finalize:()=>r.reset()},s.classList.add(r.resizingCls),!0}return!1}checkResizeHandles(e){const t=this,r=t.targetSelector?DomHelper.up(e.target,t.targetSelector):e.target;!r||t.allowResize&&!t.allowResize(e.target,e)?t.currentElement&&t.unHighlightHandle():(t.currentElement=t.handleContainerSelector?DomHelper.up(e.target,t.handleContainerSelector):e.target,t.currentElement&&(t.overLeftHandle(e,r)||t.overRightHandle(e,r)?t.highlightHandle():t.unHighlightHandle()))}updateResize(e){const t=this,r=t.context;t.allowEdgeSwitch&&(r.edge=r.currentX>r.startX?"right":"left");let n=r.currentX-r.startX,i=parseInt(DomHelper.getStyleValue(r.element,"minWidth"),10)||t.minWidth,s=parseInt(DomHelper.getStyleValue(r.element,"maxWidth"),10)||t.maxWidth,o="right"===r.edge?1:-1,a=r.elementWidth+n*o,l=Math.max(i,a);s>0&&(l=Math.min(l,s)),r.element.style.flex&&(r.element.style.flex=""),r.element.style.width=Math.abs(l)+"px",r.newWidth=l,"left"===r.edge||l<0?(r.newX=Math.max(Math.min(r.elementStartX+r.elementWidth-t.minWidth,r.elementStartX+n),0),t.skipTranslate||DomHelper.setTranslateX(r.element,r.newX)):"right"===r.edge&&t.allowEdgeSwitch&&!t.skipTranslate&&DomHelper.setTranslateX(r.element,r.elementStartX)}finishResize(e){const t=this,r=t.context,n={context:r,event:e};r.element.classList.remove(t.resizingCls),r.newWidth&&r.newWidth!==r.elementWidth?t.trigger("resize",n):t.trigger("cancel",n),r.async||r.finalize()}abortResize(e=null,t=!1){const r=this,n=r.context;n.element.classList.remove(r.resizingCls),DomHelper.setTranslateX(n.element,n.elementStartX),n.element.style.width=n.elementWidth+"px",!t&&r.trigger("cancel",{context:n,event:e}),r.isDestroyed||r.reset()}highlightHandle(){const e=this.targetSelector?DomHelper.up(this.currentElement,this.targetSelector):this.currentElement;this.currentElement.classList.add("b-resize-handle"),e.classList.add("b-over-resize-handle")}unHighlightHandle(){const e=this.targetSelector?DomHelper.up(this.currentElement,this.targetSelector):this.currentElement;e&&e.classList.remove("b-over-resize-handle"),this.currentElement.classList.remove("b-resize-handle"),this.currentElement=null}overLeftHandle(e,t){if(this.leftHandle&&t.offsetWidth>=this.handleVisibilityThreshold){const r=Rectangle.from(t);return r.width=this.handleSize,r.contains(EventHelper.getPagePoint(e))}return!1}overRightHandle(e,t){if(this.rightHandle&&t.offsetWidth>=this.handleVisibilityThreshold){const r=Rectangle.from(t);return r.x=r.right-this.handleSize,r.contains(EventHelper.getPagePoint(e))}return!1}onKeyDown(e){"Escape"===e.key&&this.abort()}}ResizeHelper._$name="ResizeHelper";class VersionHelper{static setVersion(e,t){this[e=e.toLowerCase()]={version:t,isNewerThan:e=>e<t,isOlderThan:e=>e>t},window.bryntum||(window.bryntum={});let r="";try{r=productName}catch(e){}const n=`${r}.${e}${t.replace(/\./g,"-")}`;if(!0===window.bryntum[n]){if(!window.parent.Siesta)throw new Error("Bundle included twice, check cache-busters and file types (.js)");window.BUNDLE_EXCEPTION=!0}else window.bryntum[n]=!0}static getVersion(e){if(!this[e=e.toLowerCase()])throw new Error("No version specified");return this[e].version}}VersionHelper._$name="VersionHelper";class RandomGenerator{constructor(){this.random100=[46,2,36,46,54,59,18,20,71,55,88,98,13,61,61,40,2,15,3,32,51,45,64,25,81,85,54,13,57,49,64,22,81,94,0,62,17,7,11,2,33,99,85,26,83,83,96,26,20,89,91,38,26,13,11,79,32,30,5,51,70,7,5,56,58,77,37,89,40,80,78,59,26,36,8,51,60,23,86,5,11,96,64,94,87,64,4,78,17,85,35,0,90,86,23,55,53,9,35,59,29,2,64,42,8,49,43,73,6,53,38,9,39,31,32,40,49,13,78,68,20,99,24,78,35,91,73,46,67,76,89,69,30,69,25,3,4,55,1,65,66,76,83,19,67,1,95,24,54,45,56,40,67,92,72,4,69,8,47,50,27,2,38,9,14,83,12,14,62,95,22,47,35,18,38,14,86,64,68,61,52,69,39,93,20,73,32,52,74,6,56,68,99,29,24,92,40,67,6,72,31,41,91,53,80,55,33,97,97,99,18,20,5,27,82,84,61,78,27,67,7,42,75,95,91,25,63,21,70,36,46,0,1,45,84,6,86,15,10,62,96,94,10,23,93,83,94,47,5,29,29,52,51,37,77,96,43,72,43,14,54,14,72,52,4,39,15,26,68,28,25,76,60,50,22,40,72,74,68,58,8,48,40,62,52,24,9,26,47,44,49,96,7,77,90,45,76,47,5,86,1,36,18,42,19,90,34,23,70,32,69,79,0,99,57,80,72,21,19,72,85,68,4,40,86,62,0,63,4,11,69,31,78,31,21,78,29,84,13,53,57,10,26,50,24,30,90,42,51,96,93,21,99,23,81,0,89,43,86,63,93,19,54,71,92,36,4,95,37,99,60,29,23,50,68,95,57,95,77,53,99,78,75,12,92,47,23,14,0,41,98,11,34,64,26,90,50,23,38,31,74,76,16,76,66,23,22,72,48,50,20,36,37,58,5,43,49,64,81,30,8,21,98,75,60,17,50,42,27,38,90,74,45,68,67,27,31,15,58,76,41,99,23,98,53,98,56,19,79,2,4,38,96,24,65,51,43,42,41,60,46,7,90,65,3,27,63,99,51,44,86,1,54,40,15,74,3,81,51,63,87,79,84,72,22,38,96,95,33,41,21,99,21,69,7,49,40,52,41,6,91,19,76,40,54,17,33,11,11,0,1,32,94,33,13,18,45,7,85,61,42,54,45,72,78,96,17,9,80,87,41,96,66,0,8,59,18,21,2,28,64,75,97,32,80,86,97,97,55,2,73,75,11,89,67,58,70,76,12,46,64,17,22,97,25,35,93,57,82,46,57,61,31,74,27,4,32,85,53,86,53,53,42,5,28,50,65,63,70,61,73,37,13,80,7,34,22,3,26,6,62,78,12,56,87,41,58,64,31,27,45,35,18,66,62,43,89,69,94,93,33,74,2,43,85,37,82,41,74,9,15,44,33,42,65,19,1,49,78,12,29,9,78,7,55,12,45,40,33,16,86,14,52,16,73,76,0,98,75,91,78,46,99,95,90,69,78,45,62,55,37,88,49,77,27,83,38,73,39,1,75,40,65,83,54,95,7,73,4,30,26,36,89,21,5,95,11,14,87,45,36,21,77,55,5,66,51,98,48,62,74,58,23,82,30,28,19,53,89,76,98,8,34,70,28,54,16,52,35,93,54,54,72,49,18,93,72,90,71,73,15,60,38,80,76,53,70,39,69,25,5,31,61,46,6,54,34,31,52,33,36,79,76,44,29,28,38,1,66,2,90,91,1,76,78,31,55,37,71,2,3,38,85,0,95,42,2,39,57,87,61,77,98,2,24,80,48,27,47,71,15,7,49,60,86,3,2,29,38,54,36,59,83,27,47,9,36,42,8,73,85,9,16,73,60,39,12,43,25,23,29,28,47,40,77,20,89,22,30,41,59,96,19,56,20,76,73,39,46,72,40,47,37,52,29,79,37,39,50,41,87,66,17,75,31,45,26,88,70,11,90,40,74,9,32,65,72,61,6,93,54,15,84,22,99,47,10,96,4,84,19,85,73,45,25,16,8,94,99,39,28,26,68,87,48,1,65,86,46,86,7,60,82,45,75,38,56,41,35,30,86,91,97,85,45,5,14,69,85,96,37,18,26,16,38,16,1,44,94,85,58,60,20,5,47,52,41,50,71,43,42,67,64,38,65,83,99,78,96,33,20,98,24,6,2,25,16,16,44,63,24,68,56,49,91,15,59,99,27,43,34,28,36,45,1,10,19,54,26,75,17,88,96,63,24,71,93,72,97,66,87,18,86],this.randomCache={},this.rndIndex=0}nextRandom(e){let t,r=this.randomCache;return r[e]?t=r[e]:(t=this.random100.filter(t=>t<e),r[e]=t),t[this.rndIndex++%t.length]}reset(){this.rndIndex=0}fromArray(e){return e[this.nextRandom(e.length)]}}RandomGenerator._$name="RandomGenerator";class DataGenerator{static reset(){this.rnd.reset(),this.rndTime.reset()}static*generate(e,t=!1,r=1){const n=this,i=n.rnd,s=n.rndTime,o=n.firstNames,a=n.surNames,l=n.teams,d=n.foods,c=n.colors,u=n.cities;for(let n=0;n<e;n++){const h=i.fromArray(o),g=i.fromArray(a),m=`${h} ${String.fromCharCode(65+n%25)} ${g}`,p=i.nextRandom(60)+1,f=new Date(2019,0,p),v=new Date(2019,0,p+i.nextRandom(30)+2),y={id:n+r,title:"Row "+n,cls:"row_"+n,name:m,firstName:h,surName:g,city:i.fromArray(u),team:i.fromArray(u)+" "+i.fromArray(l),age:10+i.nextRandom(80),food:i.fromArray(d),color:i.fromArray(c),score:10*i.nextRandom(100),rank:i.nextRandom(100)+1,start:f,finish:v,time:DateHelper.getTime(s.nextRandom(24),5*s.nextRandom(12)),percent:i.nextRandom(100),done:i.nextRandom(100)<50,rating:Math.round(5*Math.random()),relatedTo:Math.min(e-1,n+r+i.nextRandom(10))};t&&(y.rowHeight=5*i.nextRandom(!0===t?20:t)+20),yield y}}static generateData(e,t=!1,r=1,n=!0){n&&this.reset();const i=[],s=DataGenerator.overrideRowCount?DataGenerator.overrideRowCount:e,o=this.generate(s,t,r);for(let e=0;e<s;e++)i.push(o.next().value);return i}}Object.assign(DataGenerator,{rnd:new RandomGenerator,rndTime:new RandomGenerator,rating:0,cities:["Stockholm","Barcelona","Paris","Dubai","New York","San Francisco","Washington","Moscow"],firstNames:["Mike","Linda","Don","Karen","Doug","Jenny","Daniel","Melissa","John","Jane","Theo","Lisa","Adam","Mary","Barbara","James","David"],surNames:["McGregor","Ewans","Scott","Smith","Johnson","Adams","Williams","Brown","Jones","Miller","Davis","More","Wilson","Taylor","Anderson","Thomas","Jackson"],teams:["Lions","Eagles","Tigers","Horses","Dogs","Cats","Panthers","Rats","Ducks","Cougars","Hens","Roosters"],foods:["Pancake","Burger","Fish n chips","Carbonara","Taco","Salad","Bolognese","Mac n cheese","Waffles"],colors:["Blue","Green","Red","Yellow","Pink","Purple","Orange","Teal","Black"]}),DataGenerator._$name="DataGenerator";const knownProps=["action","target","to","deltaX","deltaY","x","y","text"];class DemoBot extends(Events(Delayable())){static get defaultConfig(){return{repeat:!0,outerElement:document.body,callOnFunctions:!0}}construct(e){super.construct(e);const t=this;t.widget&&(t.outerElement=t.widget.element,t.widget.playingDemo=!0),EventHelper.playingDemo=!0,Object.assign(t,{prevTarget:null,currentStep:0,mouse:DomHelper.createElement({parent:t.outerElement,tag:"div",className:"simulated-mouse"}),timeoutId:null,innerIntervalId:null,mouseOutElements:[]}),t.intervalId=t.setInterval(t.nextStep.bind(t),1e3),t.outerElement.classList.add("b-playing-demo"),t.outerElement.addEventListener("click",e=>{e.isTrusted&&t.abort()})}doDestroy(){this.abort()}abort(e=!1){const t=this;t.mouse.style.top="-100px",t.clearInterval(t.intervalId),t.timeoutId&&t.clearTimeout(t.timeoutId),t.innerIntervalId&&t.clearInterval(t.innerIntervalId),t.outerElement.classList.remove("b-playing-demo"),t.widget&&(t.widget.playingDemo=!1),EventHelper.playingDemo=!1,t.trigger(e?"done":"abort")}triggerEvent(e,t,r){if(!e)return null;let n;if(t.startsWith("mouse")){const e=this.mouse.getBoundingClientRect();n=new MouseEvent(t,Object.assign({view:window,bubbles:!0,cancelable:!0,clientX:e.left,clientY:e.top},r||{}))}else(n=document.createEvent("Event")).initEvent(t,!0,!1);return e.dispatchEvent(n),n}handleMouseMove(e,t){const r=this,n=r.mouse;n.classList.add("quick"),r.mouseDown&&n.classList.add("drag");let i=Rectangle.from(n,r.outerElement),s=i.x,o=i.y,a=0,l=0;if(e.to)if("string"==typeof e.to){const t=r.outerElement.querySelector(e.to);if(t){const e=Rectangle.from(t,r.outerElement),n=e.x+e.width/2,i=e.y+e.height/2;a=(n-s)/10,l=(i-o)/10}}else e.to.x?a=(e.to.x-s)/10:(a=e.to[0]/10,l=e.to[1]/10);else e.deltaX?a=e.deltaX/10:e.x&&(a=(e.x-s)/10);e.deltaY&&(l=e.deltaY/10);let d=0;r.innerIntervalId=r.setInterval(()=>{if(r.shouldPause)return;9==d++&&(clearInterval(r.innerIntervalId),e.then&&e.then());const t=s+a*d,i=o+l*d;n.style.left=t+"px",n.style.top=i+"px";const c=n.getBoundingClientRect(),u=c.left,h=c.top,g=document.elementFromPoint(u,h);g!==r.prevTarget&&(r.prevTarget&&(r.mouseOutElements.push(r.prevTarget),DomHelper.isDescendant(r.mouseOutElements[0],g)||(r.mouseOutElements.forEach(e=>r.triggerEvent(e,"mouseout")),r.mouseOutElements.length=0)),r.prevTarget=g,r.triggerEvent(g,"mouseover")),r.triggerEvent(g,e.action,{clientX:u,clientY:h})},50)}getTarget(e){const t=this,r=e.target;return r?"function"==typeof r?r(e):document.querySelector(r):t.prevTarget||t.outerElement}normalizeStep(e){if(e.action)return"function"==typeof e.action?e.action(e):e;if("function"==typeof e)return e(),e;for(let t in e)e.hasOwnProperty(t)&&!knownProps.includes(t)&&(e.action=t.toLowerCase(),e.to=e[t]);return e.target||"string"!=typeof e.to&&"function"!=typeof e.to||(e.target=e.to),e}get isScrolling(){const e=this.outerElement.getBoundingClientRect(),t=this.lastTop&&e.top!==this.lastTop;return this.lastTop=e.top,t}get isInView(){const e=this.outerElement.getBoundingClientRect();return e.top<window.innerHeight&&e.bottom>0}get shouldPause(){return!this.isInView||this.isScrolling||document.hidden||!document.hasFocus()}nextStep(){const e=this;if(e.shouldPause)return;if(e.currentStep===e.steps.length){if(!e.repeat)return e.abort(!0);e.currentStep=0}0===e.currentStep&&e.trigger("initialize");const t=e.mouse,r=e.normalizeStep(e.steps[e.currentStep++]),n=e.getTarget(r),i=r.action;if(n&&i)if(t.className="simulated-mouse","mousemove"===i)e.handleMouseMove(r,n);else{if(n!==e.prevTarget){const r=Rectangle.from(n,e.outerElement);t.style.left=r.x+r.width/2+"px",t.style.top=r.y+r.height/2+"px"}"mousedown"===i&&(e.mouseDown=!0),"mouseup"===i&&(e.mouseDown=!1),e.timeoutId=e.setTimeout(()=>{if(e.prevTarget=n,t.classList.add(i),"type"===i){const e=IdHelper.fromElement(n),t=r.text.split("|");e.value=t[1===t.length||e.value!=t[0]?0:1]}else e.triggerEvent(n,i)},"type"===i?100:550)}}}DemoBot._$name="DemoBot";class Fullscreen{static init(){const e=["fullscreenEnabled","requestFullscreen","exitFullscreen","fullscreenElement"],t=t=>e.map(e=>{let r=t+StringHelper.capitalizeFirstLetter(e);return"moz"===t&&(r=r.replace("screen","Screen"),"mozCancelFullScreen"in document&&"exitFullscreen"===e&&(r="mozCancelFullScreen")),r});this.functions="fullscreenEnabled"in document&&e||"webkitFullscreenEnabled"in document&&t("webkit")||"mozFullScreenEnabled"in document&&t("moz")||"msFullscreenEnabled"in document&&t("ms")||[];const r=["fullscreenchange","fullscreenerror"],n=e=>r.map(t=>e+StringHelper.capitalizeFirstLetter(t));this.events="fullscreenEnabled"in document&&r||"webkitFullscreenEnabled"in document&&n("webkit")||"mozFullscreenEnabled"in document&&n("moz")||"msFullscreenEnabled"in document&&["MSFullscreenChange","MSFullscreenError"]||[]}static get enabled(){return document[this.functions[0]]}static request(e){return e[this.functions[1]](e)}static exit(){return document[this.functions[2]]()}static get isFullscreen(){return!!document[this.functions[3]]}static onFullscreenChange(e){document.addEventListener(this.events[0],e)}static unFullscreenChange(e){document.removeEventListener(this.events[0],e)}}Fullscreen.init(),Fullscreen._$name="Fullscreen";const excludedPropNames={constructor:1,prototype:1,name:1,length:1,arguments:1,caller:1,callee:1,__proto__:1};class Override{static apply(e){if(!e.target)throw new Error("Override must specify what it overrides, using static getter target");if(!e.target.class)throw new Error("Override must specify which class it overrides, using target.class");if(!this.shouldApplyOverride(e))return!1;const t=Object.getOwnPropertyNames(e),r=Object.getOwnPropertyNames(e.prototype);return t.splice(t.indexOf("target"),1),this.internalOverrideAll(e.target.class,t,e),this.internalOverrideAll(e.target.class.prototype,r,e.prototype),!0}static internalOverrideAll(e,t,r){Reflect.ownKeys(r).forEach(n=>{if(t.includes(n)&&!excludedPropNames[n]){const t=Object.getOwnPropertyDescriptor(r,n);let i=e,s=null;for(;!s&&i;)(s=Object.getOwnPropertyDescriptor(i,n))||(i=Object.getPrototypeOf(i));s&&this.internalOverride(i,n,t,s)}})}static internalOverride(e,t,r,n){(e._overridden=e._overridden||{})[t]=e[t],n.get?Object.defineProperty(e,t,{enumerable:!1,configurable:!0,get:r.get}):e[t]=r.value}static shouldApplyOverride(e){const t=e.target;if(!t.maxVersion&&!t.minVersion)return!0;if(!t.product)throw new Error("Override must specify product when using versioning");return(!t.maxVersion||!VersionHelper[t.product].isNewerThan(t.maxVersion))&&(!t.minVersion||!VersionHelper[t.product].isOlderThan(t.minVersion))}}Override._$name="Override";class BooleanCombo extends(Localizable(Combo)){static get type(){return"booleancombo"}static get defaultConfig(){return{positiveValue:!0,positiveText:null,negativeValue:!1,negativeText:null,value:!1}}get store(){return this._store||(this.store=new Store({data:[{id:this.positiveValue,text:this.positiveText||this.L("Yes")},{id:this.negativeValue,text:this.negativeText||this.L("No")}]})),this._store}set store(e){super.store=e}}BooleanCombo._$name="BooleanCombo",BryntumWidgetAdapterRegister.register(BooleanCombo.type,BooleanCombo);class FlagField extends Checkbox{static get type(){return"flagfield"}static get defaultConfig(){return{value:""}}get value(){return this.checked}set value(e){e=Boolean(e),super.value=e,this.inputting||(this.checked=e)}}FlagField._$name="FlagField",BryntumWidgetAdapterRegister.register(FlagField.type,FlagField);class DurationField extends TextField{static get defaultConfig(){return{value:null,step:1,unit:null,useAbbreviation:!1,allowNegative:!1,triggers:{spin:{type:"spintrigger"}}}}get inputValue(){const e=this.value;return null==e?"":this.valueToVisible(e.magnitude,e.unit)}set unit(e){this.value={magnitude:super.value,unit:e}}get unit(){return this._unit}valueToVisible(e,t){if(!isNaN(e)){const r=parseInt(e,10);if(!isNaN(r)){const n=ObjectHelper.toFixed(e,this.decimalPrecision);return String(r==n?r:n)+" "+DateHelper[this.useAbbreviation?"getShortNameOfUnit":"getLocalizedNameOfUnit"](t||this.unit,1!==e)}}return""}parseDuration(e){if(null==e)return null;const t=DateHelper.parseDuration(e,this.allowDecimals,this.unit);return t?(t.unit=t.unit||this.unit,t):null}get isValid(){const e=this;return null==e.value&&e.clearable&&!e.required||null!=e.value&&(e.allowNegative||e.value.magnitude>=0)}internalOnChange(e){const t=this,r=t.value,n=t._lastValue;t.hasChanged(n,r)&&(t._lastValue=r,t.trigger("change",{value:r,event:e,userAction:!0,valid:t.isValid}))}onFocusOut(e){return this.syncInputFieldValue(),super.onFocusOut(e)}set value(e){const t=this;"number"==typeof e?e={magnitude:e,unit:t._unit}:"object"!=typeof e&&(e=t.parseDuration(e)),t.value!==e&&(e?(t._unit=e.unit,super.value=e):(t._unit=t.clearable?null:0,super.value=t.clearable?null:0))}get value(){return super.value}hasChanged(e,t){return t&&!e||!t&&e||t&&e&&(t.magnitude!=e.magnitude||t.unit!=e.unit)}get milliseconds(){const e=this.value;return DateHelper.asMilliseconds(e.magnitude,e.unit)}onInternalKeyDown(e){"ArrowUp"===e.key?this.doSpinUp():"ArrowDown"===e.key&&this.doSpinDown()}doSpinUp(){const e=this,t=e.value;e._isUserAction=!0,e.value={unit:t.unit,magnitude:(t.magnitude||0)+e.step},e._isUserAction=!1}doSpinDown(){const e=this,t=e.value;(e.allowNegative||t.magnitude>0)&&(e._isUserAction=!0,e.value={unit:t.unit,magnitude:(t.magnitude||0)-e.step},e._isUserAction=!1)}}DurationField._$name="DurationField",BryntumWidgetAdapterRegister.register("durationfield",DurationField),BryntumWidgetAdapterRegister.register("duration",DurationField);class Column extends(Events(Localizable(Model))){static get fields(){return["text","field","renderer","width","flex",{name:"editor",defaultValue:{}},{name:"sortable",defaultValue:!0},{name:"searchable",defaultValue:!0},{name:"filterable",defaultValue:!0},{name:"hideable",defaultValue:!0},{name:"draggable",defaultValue:!0},{name:"groupable",defaultValue:!0},{name:"resizable",defaultValue:!0},"groupRenderer","headerRenderer","tooltipRenderer","cellCls","cls","icon","align",{name:"minWidth",defaultValue:60},{name:"hidden",defaultValue:!1},{name:"locked",internal:!0},{name:"region",defaultValue:"normal"},{name:"showColumnPicker",defaultValue:!0},{name:"enableHeaderContextMenu",defaultValue:!0},{name:"enableCellContextMenu",defaultValue:!0},"headerMenuItems","cellMenuItems","sum","summaries","summaryRenderer","responsiveLevels","tags","touchConfig","tree","filterType",{name:"htmlEncode",defaultValue:!0},{name:"autoSyncHtml",defaultValue:!1},"type",{name:"instantUpdate",defaultValue:!1},{name:"repaintOnResize",defaultValue:!1},"editTargetSelector"]}static get autoExposeFields(){return!1}construct(e,t){const r=this;r.masterStore=t,t&&(r._grid=Array.isArray(t)?t[0].grid:t.grid),r.localizableProperties=e.localizableProperties||["text"],e.localeClass&&(r.localeClass=e.localeClass),super.construct(e,t,null,!1),r.processConfiguredListeners(e.listeners),!0===r.data.locked?r.data.region="locked":r.region||(r.data.region="normal"),"field"in r.data||(r.field="_"+(r.type||"")+ ++Column.emptyCount),r.hasComplexMapping=r.field&&r.field.includes("."),r.width||r.flex||r.children||r.set({width:Column.defaultWidth,flex:null},null,!0)}getRawValue(e){const t=this;return t.hasComplexMapping?ObjectHelper.getPath(e,t.field):e[t.field]||e.get(t.field)}get nextVisibleSibling(){let e=this.nextSibling;for(;e&&e.hidden;)e=e.nextSibling;return e}get isLast(){return!this.nextVisibleSibling&&(!this.parent||this.parent.isLast)}get isLastInSubGrid(){return(!this.nextVisibleSibling||this.nextVisibleSibling.region!==this.region)&&(!this.parent||this.parent.isLastInSubGrid)}get element(){return this.grid.getHeaderElement(this)}get textWrapper(){return DomHelper.getChild(this.element,".b-grid-header-text")}get textElement(){return DomHelper.down(this.element,".b-grid-header-text-content")}get contentElement(){return DomHelper.down(this.element,".b-grid-header-children")}get editor(){let e=this.data.editor;return!e||e instanceof Widget||("string"==typeof e&&(e={type:e}),e=this.data.editor=WidgetHelper.createWidget(Object.assign(this.defaultEditor,e))),e}set editor(e){this.data.editor=e}get defaultEditor(){return{type:"textfield",name:this.field}}static get type(){return"column"}static get text(){return this.defaultValues.text}get grid(){return this._grid||this.parent&&this.parent.grid}get locked(){return"locked"===this.data.region}set locked(e){this.region=e?"locked":"normal"}get sortable(){return this.isLeaf&&this.data.sortable}set sortable(e){this.set("sortable",e)}get groupable(){return this.isLeaf&&this.data.groupable}set groupable(e){this.set("groupable",e)}hide(e=!1){const t=this,r=t.parent;if(!t.hidden){if(t.hidden=!0,r){r.children.some(e=>!0!==e.hidden)||r.hidden||(e=!0,r.hide())}t.children&&t.children.forEach(e=>e.hide(!0)),e||t.stores.forEach(e=>e.trigger("hideColumn"))}}show(e=!1){const t=this,r=t.parent;t.hidden&&(t.hidden=!1,r&&r.hidden&&r.show(),t.children&&t.children.forEach(e=>e.show(!0)),e||t.stores.forEach(e=>e.trigger("showColumn")))}toggle(e=null){return this.hidden&&void 0===e||!0===e?this.show():!this.hidden&&void 0===e||!1===e?this.hide():void 0}generateId(){return Column.generatedIdIndex||(Column.generatedIdIndex=0),(this.field?this.field.replace(/\./g,"-"):"col")+ ++Column.generatedIdIndex}get allIndex(){return this.masterStore.indexOf(this)}get width(){return this.data.width}set width(e){const t={width:e};e&&(t.flex=null),this.set(t)}get subGrid(){return this.grid?this.grid.getSubGridFromColumn(this):void 0}measureSize(e){return DomHelper.measureSize(e,this.subGrid?this.subGrid.element:void 0)}calculateMinWidth(){const e=this,t=e.measureSize(e.width),r=e.measureSize(e.minWidth);let n=0;return e.children&&(n=e.children.reduce((e,t)=>e+t.calculateMinWidth(),0)),Math.max(t,r,n)}resizeToFitContent(){const e=this,{grid:t,renderer:r,defaultRenderer:n,element:i}=e,s=t.rowManager,o=t.store,a=o.count,l=r||n;if(a<=0)return;const d=t.element.querySelector(`.b-grid-cell[data-column-id=${e.id}]`),c=d.cssText,u=d.className;let h,g,m,p,f,v=0;if(t.resizeToFitIncludesHeader){const e=window.getComputedStyle(i);v=DomHelper.measureText(i.innerText,i,!1,i.parentElement)+parseInt(e.paddingLeft),i.parentElement.offScreenDiv.parentElement.remove()}for(a>1e3?g=(h=Math.max(Math.min(s.topIndex+s.rowCount/2-500,a-1e3),0))+1e3:(h=0,g=a),m=h;m<g;m++)p=o.getAt(m),f=e.getRawValue(p),l&&(f=null==(f=l.call(e,{cellElement:d,rowElement:d.parentNode,value:f,record:p,column:e,size:{height:p.rowHeight||0},grid:t,row:{},updatingSingleRow:!1}))?d.innerHTML:String(f)),f&&(v=Math.max(v,DomHelper.measureText(f,d,!(e.htmlEncode&&!e.disableHtmlEncode),e.subGrid.element)));return d.className=u,d.cssText=c,e.width=v}getState(){const e=this,t={[e.flex?"flex":"width"]:e.flex?e.flex:e.width,id:e.id,hidden:e.hidden,index:e.allIndex,region:e.region,filterable:e.filterable,text:e.text,locked:e.locked};return e.children&&(t.children=e.children.map(e=>e.getState())),t}applyState(e){const t=this;t.beginBatch(),"locked"in e&&(t.locked=e.locked),"minWidth"in e&&(t.minWidth=e.minWidth),"width"in e&&(t.width=e.width),"flex"in e&&(t.flex=e.flex),"width"in e&&t.flex?t.flex=void 0:"flex"in e&&t.width&&(t.width=void 0),"text"in e&&(t.text=e.text),"region"in e&&(t.region=e.region),"renderer"in e&&(t.renderer=e.renderer),"filterable"in e&&(t.filterable=e.filterable),t.endBatch(),"hidden"in e&&t.toggle(!0!==e.hidden)}clearCell(e){e.innerHTML=""}canEdit(e){return!0}}Column.emptyCount=0,Column.defaultWidth=100,Column.exposeProperties(),Column._$name="Column";class ColumnStore extends(Localizable(Store)){static get defaultConfig(){return{modelClass:Column,tree:!0}}construct(e){const t=this;e.grid&&(e.grid._columnStore=t,t.id=`${e.grid.id}-columns`),super.construct(e),t.on({change:t.clearCaches,scope:t,prio:1})}doDestroy(){const e=[];this.traverse(t=>e.push(t)),super.doDestroy(),e.forEach(e=>e.destroy())}getById(e){return super.getById(e)||this.idRegister[e]}forEach(e,t=this){this.tree?this.rootNode.traverseWhile((r,n)=>e.call(t,r,n),!0):super.forEach(e,t)}get totalFixedWidth(){let e=0;for(let t of this)t.hidden||(t.flex?e+=t.measureSize(Column.defaultWidth):e+=Math.max(t.measureSize(t.width),t.measureSize(t.minWidth)));return e}get visibleColumns(){const e=this;return e._visibleColumns||(e._visibleColumns=e.leaves.filter(e=>!e.hidden)),e._visibleColumns}clearCaches(){this._visibleColumns=null}onMasterDataChanged(e){super.onMasterDataChanged(e),this.clearCaches()}getAdjacentVisibleLeafColumn(e,t=!0,r=!1){let n=this.visibleColumns,i=e instanceof Column?e:this.getById(e),s=n.indexOf(i)+(t?1:-1);if(!n[s]){if(!r)return null;s=t?0:n.length-1}return n[s]}get bottomColumns(){return this.leaves}get(e){return this.findRecord("field",e,!0)}createRecord(e){let t=this.modelClass;if(e.type&&!(t=ColumnStore.getColumnClass(e.type)))throw new Error(this.L("columnTypeNotFound",e));return new t(e,this)}indexOf(e){let t=super.indexOf(e);return t>-1?t:this.records.findIndex(t=>t.field===e)}static registerColumnType(e){ColumnStore.columnTypes||(ColumnStore.columnTypes={}),ColumnStore.columnTypes[e.type]=e}static getColumnClass(e){return ColumnStore.columnTypes&&ColumnStore.columnTypes[e]}}const columnResizeEvent=(e,t)=>({update:({store:r,record:n,changes:i})=>{let s=!0;return("width"in i||"minWidth"in i||"flex"in i)&&(s=e.call(t,{store:r,record:n,changes:i})),s}});ColumnStore.registerColumnType(Column),ColumnStore._$name="ColumnStore";class WidgetColumn extends Column{static get type(){return"widget"}static get fields(){return["widgets"]}static get defaults(){return{filterable:!1,sortable:!1,editor:!1,searchable:!1}}construct(e,t){this.widgetMap={},this.internalCellCls="b-widget-cell",super.construct(...arguments)}doDestroy(){for(const e of Object.values(this.widgetMap))e.destroy&&e.destroy();super.doDestroy()}renderer(e){const t=this,{cellElement:r,column:n,value:i,record:s}=e,o=n.widgets;o&&(r.widgets=o.map((o,a)=>{let l,d;return r.widgets&&(d=(l=r.widgets[a]).element.nextElementSibling,o.recreate&&l&&(delete t.widgetMap[l.id],l.destroy(),r.widgets[a]=null)),l||(t.onBeforeWidgetCreate(o,e),l=WidgetHelper.append(o,d?{insertBefore:d}:r)[0],t.widgetMap[l.id]=l,t.onAfterWidgetCreate(l,e)),l.cellInfo={cellElement:r,value:i,record:s,column:n},t.grid&&(l.readOnly=t.grid.readOnly),!1!==t.onBeforeWidgetSetValue(l,e)&&(o.noValueOnRender||(o.valueProperty?l[o.valueProperty]=i:l.defaultBindProperty?l[l.defaultBindProperty]=i:l.text=l.value=i)),l}))}onBeforeWidgetCreate(e,t){}onAfterWidgetCreate(e,t){}onBeforeWidgetSetValue(e,t){}clearCell(e){e.widgets&&(e.widgets.forEach(e=>{delete this.widgetMap[e.id],e.destroy()}),e.widgets=null)}resizeToFitContent(){}}ColumnStore.registerColumnType(WidgetColumn),WidgetColumn.exposeProperties(),WidgetColumn._$name="WidgetColumn";class CheckColumn extends WidgetColumn{static get type(){return"check"}static get fields(){return["checkCls"]}static get defaults(){return{align:"center",checkCls:null,widgets:[{type:"checkbox",valueProperty:"checked"}]}}constructor(e,t){super(...arguments),this.internalCellCls="b-check-cell"}onBeforeWidgetCreate(e,t){e.cls=this.checkCls}onAfterWidgetCreate(e,t){t.cellElement.widget=e,e.on({beforeChange:"onBeforeCheckboxChange",change:"onCheckboxChange",thisObj:this})}onBeforeWidgetSetValue(e){e.record=e.cellInfo.record}onBeforeCheckboxChange({source:e,checked:t}){return this.trigger("beforeToggle",{record:e.cellInfo.record,checked:t})}onCheckboxChange({source:e,checked:t}){const r=e.cellInfo.record,n=this.field;if(n){const e=`set${StringHelper.capitalizeFirstLetter(n)}`;r[e]?r[e](t):r.set(n,t)}this.trigger("toggle",{record:r,checked:t})}}ColumnStore.registerColumnType(CheckColumn),CheckColumn._$name="CheckColumn";class DateColumn extends Column{static get type(){return"date"}static get fields(){return["format","pickerFormat","step"]}static get defaults(){return{format:"L",pickerFormat:null,step:1,minWidth:85,filterType:"date"}}constructor(e,t){super(...arguments),this.internalCellCls="b-date-cell"}defaultRenderer({value:e}){return e?this.formatValue(e):""}groupRenderer({cellElement:e,groupRowFor:t}){e.innerHTML=this.formatValue(t)}formatValue(e){return"string"==typeof e&&(e=DateHelper.parse(e,this.format)),DateHelper.format(e,this.format)}set format(e){const t=this,r=t.editor;t.set("format",e),r&&(r.format=t.format)}get format(){return this.get("format")}get defaultEditor(){const e=this;return{name:e.field,type:"date",calendarContainerCls:"b-grid-cell-editor-related",format:e.format,pickerFormat:e.pickerFormat||e.format,step:e.step}}}ColumnStore.registerColumnType(DateColumn),DateColumn.exposeProperties(),DateColumn._$name="DateColumn";class PercentColumn extends Column{static get type(){return"percent"}static get fields(){return["lowThreshold"]}static get defaults(){return{editor:{type:"number",min:0,max:100},lowThreshold:20,filterType:"number",htmlEncode:!1,searchable:!1,summaryRenderer:e=>`${e}%`}}constructor(e,t){super(...arguments),this.internalCellCls="b-percent-bar-cell"}renderer({value:e,cellElement:t}){e=e||0,t.percentBarElement||(t.percentBarElement=DomHelper.createElement({tag:"div",className:"b-percent-bar-outer",parent:t,children:[{tag:"div",className:"b-percent-bar",html:"%"}]},!0)[1]);const{percentBarElement:r}=t;r.classList[0===e?"add":"remove"]("b-zero"),r.classList[e<this.lowThreshold?"add":"remove"]("b-low"),r.style.width=e+"%",r.firstChild.data=e+"%"}clearCell(e){e.percentBarElement&&(e.percentBarElement=null),super.clearCell(e)}resizeToFitContent(){}}PercentColumn.sum="average",ColumnStore.registerColumnType(PercentColumn),PercentColumn._$name="PercentColumn";class NumberColumn extends Column{static get type(){return"number"}static get fields(){return["min","max","step","unit"]}static get defaults(){return{filterType:"number"}}constructor(e,t){super(...arguments),this.internalCellCls="b-number-cell"}get defaultEditor(){return{name:this.field,type:"numberfield",max:this.max,min:this.min,step:this.step}}defaultRenderer({value:e=0}){return this.unit?`${e}${this.unit}`:e}}ColumnStore.registerColumnType(NumberColumn),NumberColumn.exposeProperties(),NumberColumn._$name="NumberColumn";class RatingColumn extends NumberColumn{static get type(){return"rating"}static get fields(){return["emptyIcon","filledIcon","editable"]}static get defaults(){return{min:0,max:5,emptyIcon:"b-icon b-icon-star",filledIcon:"b-icon b-icon-star",editable:!0,filterType:"number",searchable:!1,width:"11.2em",htmlEncode:!1,autoSyncHtml:!0,minWidth:"11.2em",editor:!1}}constructor(e,t){super(...arguments),this.internalCellCls="b-rating-cell"}renderer({value:e}){let t=`<div class="b-rating-cell-inner ${this.editable?"":"b-not-editable"}">`;for(let r=0;r<this.max;r++){t+=`<i class="b-rating-icon ${r<e?"b-filled "+this.filledIcon:"b-empty "+this.emptyIcon}"></i>`}return t+="</div>"}onCellClick({grid:e,column:t,record:r,cellSelector:n,target:i,event:s}){if(i.classList.contains("b-rating-icon")&&!e.readOnly&&t.editable){let e=[].indexOf.call(i.parentNode.childNodes,i);i.classList.contains("b-filled")&&(s.metaKey||s.shiftKey)&&(e-=1),1===r.get(t.field)&&0===e&&(e=-1),r.set(t.field,e+1)}}}ColumnStore.registerColumnType(RatingColumn),RatingColumn.exposeProperties(),RatingColumn._$name="RatingColumn";class RowNumberColumn extends Column{static get defaults(){return{groupable:!1,sortable:!1,filterable:!1,searchable:!1,resizable:!1,minWidth:50,width:50,align:"right",text:"#",editor:!1}}construct(e,t){const r=this;super.construct(...arguments),r.grid&&(r.grid.store.on({change:r.resizeToFitContent,thisObj:r}),r.grid.store.count&&r.grid.on({render:r.resizeToFitContent,thisObj:r,once:!0})),r.internalCellCls="b-row-number-cell"}static get type(){return"rownumber"}renderer({record:e,grid:t}){return e.meta.specialRow?"":t.store.indexOf(e,!0)+1}resizeToFitContent(){const e=this.grid,t=e.store.count;if(t&&!this.hidden){const r=e.element.querySelector(`.b-grid-cell[data-column-id=${this.id}]`);if(r){const e=window.getComputedStyle(r),n=parseInt(e["padding-left"]),i=DomHelper.measureText(t,r);this.width=i+2*n}}}set flex(e){}}ColumnStore.registerColumnType(RowNumberColumn),RowNumberColumn._$name="RowNumberColumn";class TemplateColumn extends Column{static get fields(){return["template"]}static get defaults(){return{htmlEncode:!1}}constructor(e,t){super(...arguments);if(!this.template)throw new Error(this.L("noTemplate"));if("function"!=typeof this.template)throw new Error(this.L("noFunction"))}static get type(){return"template"}renderer(e){if(!e.record.meta.specialRow)return this.template({value:e.value,record:e.record,field:e.column.field})}}ColumnStore.registerColumnType(TemplateColumn),TemplateColumn.exposeProperties(),TemplateColumn._$name="TemplateColumn";class TimeColumn extends Column{static get type(){return"time"}static get fields(){return["format"]}static get defaults(){return{format:"LT",minWidth:140,filterType:"time"}}constructor(e,t){super(...arguments),this.internalCellCls="b-time-cell"}defaultRenderer({value:e}){return e?this.formatValue(e):""}groupRenderer({cellElement:e,groupRowFor:t}){e.innerHTML=this.formatValue(t)}formatValue(e){const t=this;return"string"==typeof e&&(e=DateHelper.parse(e,t.format)),DateHelper.format(e,t.format)}set format(e){const t=this,r=t.editor;t.set("format",e),r&&(r.format=t.format)}get format(){return this.get("format")}get defaultEditor(){return{name:this.field,type:"time",format:this.format}}}ColumnStore.registerColumnType(TimeColumn),TimeColumn.exposeProperties(),TimeColumn._$name="TimeColumn";let currentParentHasIcon=!1;class TreeColumn extends Column{static get defaults(){return{tree:!0,hideable:!1,minWidth:150}}static get fields(){return[{name:"expandIconCls",defaultValue:"b-icon b-icon-tree-expand"},{name:"collapseIconCls",defaultValue:"b-icon b-icon-tree-collapse"},{name:"collapsedFolderIconCls"},{name:"expandedFolderIconCls"},{name:"leafIconCls",defaultValue:"b-icon b-icon-tree-leaf"},{name:"editTargetSelector",defaultValue:".b-tree-cell-value"}]}static get type(){return"tree"}constructor(e,t){super(...arguments);const r=this;r.internalCellCls="b-tree-cell",r.shouldHtmlEncode=r.htmlEncode,r.tempDiv=document.createElement("div"),r.setData("htmlEncode",!1),r.renderer&&(r.originalRenderer=r.renderer),r.renderer=r.treeRenderer.bind(r)}treeRenderer(e){const t=this;let r,{cellElement:n,row:i,record:s,value:o}=e,a="",l=s.instanceMeta(e.grid.store),d="";if(t.originalRenderer){const r=t.originalRenderer(e);o=!1===r?n.innerHTML:r}return s.isLeaf?(n.classList.add("b-tree-leaf-cell"),(r=e.iconCls||s.iconCls||t.leafIconCls)&&(d+=r)):(i.addCls&&i.addCls("b-tree-parent-row"),n.classList.add("b-tree-parent-cell"),l.isLoadingChildren&&i.addCls("b-loading-children"),a+=`<div class="b-tree-expander ${l.collapsed?t.expandIconCls+" b-tree-collapsed":t.collapseIconCls+" b-tree-expanded"}"></div>`,currentParentHasIcon=r=e.iconCls||s.iconCls||(l.collapsed?t.collapsedFolderIconCls:t.expandedFolderIconCls),r&&(a+=`<div class="b-tree-icon ${r}"></div>`)),o=null!=o?o:"",t.shouldHtmlEncode&&(t.tempDiv.innerText=o,o=t.tempDiv.innerHTML),a+=`<div class="b-tree-cell-value">${o}</div>`,`<div class="b-tree-cell-inner ${d}" style="padding-left:${1.7*s.childLevel+(s.isLeaf?currentParentHasIcon?1.8:r?.4:.3:0)}em">${a}</div>`}}ColumnStore.registerColumnType(TreeColumn),TreeColumn.exposeProperties(),TreeColumn._$name="TreeColumn";class GridRowModel extends Model{static get fields(){return["iconCls","expanded","cls","rowHeight"]}}GridRowModel.exposeProperties(),GridRowModel._$name="GridRowModel";class GridStorePlugin extends InstancePlugin{construct(e,t){this.store=e,super.construct(e,t)}static get pluginConfig(){return{override:["getNext","getPrev","getAdjacent"],publishAll:!0}}getAdjacent(e,t=!0,r=!1,n=!1){return t?this.getNext(e,r,n):this.getPrev(e,r,n)}getNext(e,t=!1,r=!1){const n=this,i=n.store,s=i.indexOf(e),o=i.storage.values,a=n.overridden.getNext(e,t);return r&&a&&a.meta.specialRow?n.getNext(o[s+1],t):a}getPrev(e,t=!1,r=!1){const n=this,i=n.store,s=i.indexOf(e),o=i.storage.values,a=n.overridden.getPrev(e,t);return r&&a&&a.meta.specialRow?n.getPrev(o[s-1],t):a}}GridStorePlugin._$name="GridStorePlugin";class GridFeatureManager{static registerFeature(e,t=!1,r=null){const n=this;(n.featureTypes||(n.featureTypes={}))[e.$name]=e,t&&(n.defaultFeatures||(n.defaultFeatures=[])).push({featureClass:e,forType:r})}}GridFeatureManager._$name="GridFeatureManager";class Fit extends Layout{static get defaultConfig(){return{containerCls:"b-fit-container",itemCls:"b-fit-item"}}}Fit._$name="Fit",Layout.registerLayout(Fit);class Editor extends Container{static get defaultConfig(){return{positioned:!0,hidden:!0,layout:"fit",inputField:"textfield",blurAction:"complete",completeKey:"Enter",cancelKey:"Escape",allowInvalid:!1}}afterConfigure(){const e=this;super.afterConfigure(),(e.completeKey||e.cancelKey)&&EventHelper.on({element:e.element,keydown:"onKeyDown",thisObj:e}),LocaleManagerSingelton.on({locale:"onLocaleChange",thisObj:e})}onLocaleChange(){const e=this;e.inputField&&e.inputField.syncInputFieldValue()}startEdit({target:e,align:t="t0-t0",matchSize:r=!0,value:n,record:i,field:s=this.inputField.name,focus:o=!0}){const a=this,{inputField:l}=a,d=e instanceof Rectangle?e:Rectangle.inner(e);return!1!==a.trigger("beforestart",{value:n})&&(i&&s&&void 0===n&&(a.record=i,a.dataField=s,n=i[s]),r&&(a.width=d.width,a.height=d.height),l.value=n,a.showBy({target:e,align:t}),o&&a.inputField.focus&&a.inputField.focus(),1===e.nodeType&&e.classList.add("b-editing"),a.trigger("start",{value:l.value}),a.oldValue=l.value,Array.isArray(a.oldValue)&&(a.oldValue=a.oldValue.slice()),!0)}refreshEdit(){if(this.isVisible){const{record:e,dataField:t,inputField:r}=this;if(e&&t){const n=e[t];ObjectHelper.isEqual(r.value,n)||(r.value=n)}}}onKeyDown(e){const t=this;switch(e.key){case t.completeKey:t.completeEdit(),e.stopImmediatePropagation();break;case t.cancelKey:t.cancelEdit(),e.stopImmediatePropagation()}t.trigger("keydown",{event:e})}onFocusOut(e){if(super.onFocusOut(e),!this.isFinishing){const e=this[`${this.blurAction}Edit`];e&&e.call(this)}}completeEdit(){const e=this,{inputField:t,oldValue:r}=e,{value:n}=t;if(!(t.isValid||e.allowInvalid||t.allowInvalid))return t.focus&&t.focus(),!1;if(ObjectHelper.isEqual(n,r))return e.cancelEdit(),!0;{const i={value:n,oldValue:r};if(!1!==e.trigger("beforecomplete",i))return i.async?(i.async.then(r=>{!0===r?e.onEditComplete():(t.setError(r||t.L("invalidValue")),e.allowInvalid||t.allowInvalid||t.focus&&t.focus())}),!1):(e.onEditComplete(),!0);t.focus&&t.focus()}return!1}cancelEdit(){const e=this,{inputField:t,oldValue:r}=e,{value:n}=t;e.isFinishing||!1===e.trigger("beforecancel",{value:n,oldValue:r})||(e.isFinishing=!0,e.hide(),e.trigger("cancel",{value:n,oldValue:r}),e.isFinishing=!1)}onEditComplete(){const e=this,{record:t,dataField:r,inputField:n,oldValue:i,lastAlignSpec:s}=e,{target:o}=s,{value:a}=n;if(!e.isFinishing){if(e.isFinishing=!0,e.hide(),t){const e=`set${StringHelper.capitalizeFirstLetter(r)}`;t[e]?t[e](a):t[r]=a}e.trigger("complete",{value:a,oldValue:i}),1===o.nodeType&&o.classList.remove("b-editing"),e.isFinishing=!1}}doDestroy(){this.createdInputField&&this.inputField.destroy(),super.doDestroy()}set owner(e){this._owner=e}get owner(){return this._owner||IdHelper.fromElement(this.element.parentNode)}get items(){return this._items=[this.inputField]}set inputField(e){const t=this;t._inputField&&t._inputField.destroy(),"string"==typeof e&&(e={type:e}),e instanceof Widget?t._inputField=e:(t._inputField=WidgetHelper.createWidget(e),t.createdInputField=!0),t._inputField.parent=t}get inputField(){return this._inputField}}Editor._$name="Editor",BryntumWidgetAdapterRegister.register("editor",Editor);const validNonEditingKeys={Enter:1,F2:1},validEditingKeys={ArrowUp:1,ArrowDown:1,ArrowLeft:1,ArrowRight:1};class CellEdit extends(Delayable(InstancePlugin)){static get defaultConfig(){return{autoSelect:!0,blurAction:"complete",addNewAtEnd:null,autoEdit:!1,editorClass:Editor}}static get pluginConfig(){return{assign:["startEditing"],before:["onElementKeyDown","onElementMouseDown"],chain:["onElementClick"]}}construct(e,t){const r=this;r.grid=e,super.construct(e,t),r.storeListenerDetacher=e.store.on({update:"onStoreUpdate",thisObj:r}),r.listenerDetacher=e.on({cellclick:"onCellClick",celldblclick:"onCellDblClick",beforerenderrows:"onGridBeforeRenderRows",thisObj:r})}doDestroy(){this.cancelEditing(!0),this.listenerDetacher(),this.storeListenerDetacher(),super.doDestroy()}get isEditing(){return Boolean(this.editorContext)}getEditorForCell({column:e,selector:t}){const r=this,n=r.grid;let i=e._cellEditor;i||(e.editor.autoSelect=r.autoSelect,i=e._cellEditor=new r.editorClass({cls:"b-cell-editor",inputField:e.editor,blurAction:"none",completeKey:!1,cancelKey:!1,owner:n,listeners:r.getEditorListeners()}),e.instantUpdate&&ObjectHelper.wrapProperty(e.editor,"value",null,e=>{r.editorContext&&!ObjectHelper.isEqual(r.editorContext.record[r.editorContext.column.field],e)&&(r.editorContext.record[r.editorContext.column.field]=e)}));const s=i.element.dataset;return s.rowId=t.id,s.columnId=t.columnId,s.field=e.field,r.editor=i}getEditorListeners(){return{focusout:"onEditorFocusOut",focusin:"onEditorFocusIn",start:"onEditorStart",beforecomplete:"onEditorBeforeComplete",complete:"onEditorComplete",cancel:"onEditorCancel",thisObj:this}}onEditorStart({source:e}){const t=this,r=t.editorContext=e.cellEditorContext;if(r){const{grid:e}=t,{cell:n,editor:i,column:s}=r;if(s.editTargetSelector){const e=n.querySelector(s.editTargetSelector);e&&(i.width-=e.offsetLeft,DomHelper.addTranslateX(i.element,e.offsetLeft))}n.classList.add("b-editing"),t.grid.on({cellclick:"onCellClickWhileEditing",viewportResize:"onViewportResizeWhileEditing"},t),t.removeEditingListeners=GlobalEvents.addListener({globaltap:"onTapOut",thisObj:t}),e.trigger("startCellEdit",{grid:e,editorContext:r})}}onEditorBeforeComplete(e){const{grid:t}=this,r=e.source.cellEditorContext;return e.grid=t,e.editorContext=r,t.trigger("beforeFinishCellEdit",e)}onEditorComplete({source:e}){const{grid:t}=this,r=e.cellEditorContext;r.value=e.inputField.value,t.trigger("finishCellEdit",{grid:t,editorContext:r}),this.cleanupAfterEdit(r)}onEditorCancel(){const{editorContext:e,muteEvents:t,grid:r}=this;e&&this.cleanupAfterEdit(e),t||r.trigger("cancelCellEdit",{grid:r})}cleanupAfterEdit(e){const{editor:t}=e;e.cell.classList.remove("b-editing"),t.cellEditorContext=this.editorContext=null,this.grid.un({cellclick:"onCellClickWhileEditing",viewportResize:"onViewportResizeWhileEditing"},this),this.removeEditingListeners(),GlobalEvents.suspendFocusEvents(),t.element.remove(),GlobalEvents.resumeFocusEvents()}getAdjacentEditableCell(e,t){let r=this.addNewAtEnd,n=this.grid,i=n.store,s=n.rowManager,o=e.id,a=e.columnId,l=n.columns,d=l.getAdjacentLeaf(a,t);for(;o;){const n=i.getById(o);if(d){if(a=d.id,!d.hidden&&d.editor&&d.canEdit(n))return{id:o,columnId:d.id};d=l.getAdjacentLeaf(a,t)}else{let n=i.getAdjacent(e.id,t,!1,!0);!n&&t&&r&&(n=i.add("object"==typeof r?ObjectHelper.clone(r):{})[0],s.getRowFor(n)||s.displayRecordAtBottom()),o=n&&n.id,n&&(d=t?l.first:l.leaves[l.leaves.length-1])}}return null}getEditingContext(e){e=this.grid.normalizeCellContext(e);const{grid:t}=this,r=t.columns.getById(e.columnId),n=t.store.getById(e.id),i=t.getCell(e);if(i&&r&&!r.hidden&&r.editor&&n&&!n.meta.specialRow&&r.canEdit(n)){const t=n&&n[r.field];return{column:r,record:n,cell:i,value:void 0===t?null:t,selector:e}}return!1}startEditing(e={}){const t=this;if(!(t.editorContext||t.disabled||t.grid.readOnly||t.grid.disabled)){const{grid:r}=t,n=r.normalizeCellContext(e);r.focusCell(e);const i=t.getEditingContext(n);if(!1===r.trigger("beforeCellEditStart",{grid:r,editorContext:i}))return!1;if(i){DomHelper.focusWithoutScrolling(r.element);const e=i.editor=t.getEditorForCell(i),{cell:n,record:s,column:o}=i;return e.inputField.highlightExternalChange=!1,e.cellEditorContext=i,e.render(t.grid.getSubGridFromColumn(o).element),e.startEdit({target:n,record:s}),!0}}return!1}cancelEditing(e=!1){const t=this,{editorContext:r,editor:n,grid:i}=t;r&&(n.containsFocus&&(t.editorContext=null,n.inputField.owns(document.activeElement)&&i.focus(),t.editorContext=r),t.muteEvents=e,n.cancelEdit(),t.muteEvents=!1)}finishEditing(){const{editorContext:e}=this;return!!e&&e.editor.completeEdit()}onCellClickWhileEditing({event:e,cellSelector:t}){const r=this;r.editorContext.editor.owns(e.target)||(r.getEditingContext(t)?r.finishEditing()?r.startEditing(t):(r.grid.focusCell(r.editorContext.selector),r.editor.inputField.focus()):r.finishEditing())}onViewportResizeWhileEditing(){const{editor:e,column:t}=this.editorContext;e.width=t.element.offsetWidth}onCellClick({source:e,record:t,cellSelector:r,cellElement:n,target:i,event:s}){const o=e.focusedCell||{},a=e.columns.getById(r.columnId);if(a.onCellClick)a.onCellClick({grid:e,column:a,record:t,cellSelector:r,cellElement:n,target:i,event:s});else{if(i.matches(".b-tree-expander"))return this.cancelEditing(),!1;DomHelper.isTouchEvent&&r.id==o.id&&r.columnId==o.columnId&&this.startEditing(r)}}onCellDblClick({cellSelector:e}){this.editorContext&&!this.finishEditing()||this.startEditing(e)}onStoreUpdate({changes:e,record:t}){const{editorContext:r}=this;r&&r.editor.isVisible&&t===r.record&&r.editor.dataField in e&&r.editor.refreshEdit()}onGridBeforeRenderRows(){this.editorContext&&this.editorContext.editor.isVisible&&this.cancelEditing()}onElementKeyDown(e){const t=this;if(!e.handled)if(t.editorContext){if("Enter"===e.key&&(e.preventDefault(),e.stopPropagation(),t.finishEditing()&&!t.isEditing)){if(e.ctrlKey||e.metaKey||e.altKey||t.grid.touch)return;e.shiftKey?t.grid.navigateUp()&&t.startEditing(t.grid.focusedCell):t.grid.navigateDown()&&t.startEditing(t.grid.focusedCell)}if("F2"===e.key&&(e.preventDefault(),t.finishEditing()),"Escape"===e.key&&(e.stopPropagation(),e.preventDefault(),t.cancelEditing()),"Tab"===e.key){e.preventDefault();let r=t.grid.focusedCell;if(r){let n=t.getAdjacentEditableCell(r,!e.shiftKey);n&&t.finishEditing()&&(t.grid.focusCell(n,{animate:100}),t.startEditing(n))}}validEditingKeys[e.key]&&(e.handled=!0)}else{const r=e.key,n=t.autoEdit&&(1===r.length||"Backspace"===r);if((n||validNonEditingKeys[r])&&t.grid.focusedCell){if(e.preventDefault(),!t.startEditing(t.grid.focusedCell))return;const i=t.editor.inputField,s=i.input;n&&s&&(s.value="Backspace"===r?"":r,i.internalOnInput(e),i.moveCaretToEnd())}}}onElementMouseDown(e){2===e.button&&this.editorContext&&e.preventDefault()}onEditorFocusOut(e){const t=this,{grid:r}=t;t.editorContext&&!t.editor.isFinishing&&t.editor.inputField.owns(e.target)&&(e.toWidget!==r||r.isLocationEqual(t.grid.focusedCell,t.editorContext.selector))&&("cancel"===t.blurAction?t.cancelEditing():t.finishEditing())}onEditorFocusIn(e){const t=e.toWidget;t===this.editor.inputField&&this.autoSelect&&t.selectAll&&!t.readOnly&&!t.disabled&&t.selectAll()}onTapOut({event:e}){const t=this;t.grid.bodyContainer.contains(e.target)||t.editor.inputField.owns(e.target)||("cancel"===t.blurAction?t.cancelEditing():t.finishEditing())}onElementClick(e){const t=this;e.target.classList.contains("b-grid-body-container")&&t.editorContext&&t.finishEditing()}}CellEdit.featureClass="b-cell-edit",CellEdit._$name="CellEdit",GridFeatureManager.registerFeature(CellEdit,!0);class ColumnDragToolbar extends(Delayable(InstancePlugin)){static get pluginConfig(){return{after:["render"]}}construct(e,t){if(!e.features.columnReorder)throw new Error("Requires ColumnReorder to work, please enable");e.features.columnReorder.on("beforedestroy",this.onColumnReorderBeforeDestroy,this),this.grid=e,super.construct(e,t)}doDestroy(){const e=this;e.grid.features.columnReorder.isDestroyed||e.deattachFromColumnReorder(),e.element&&e.element.remove(),e.element=null,super.doDestroy()}init(){const e=this,t=e.grid;e.reorderDetacher=t.features.columnReorder.on({gridheaderdragstart({context:r}){const n=t.columns.getById(r.element.dataset.columnId);e.showToolbar(n)},gridheaderdrag:({context:t})=>e.onDrag(t),gridheaderabort:()=>{e.hideToolbar()},gridheaderdrop:({context:t})=>{t.valid?e.hideToolbar():e.onDrop(t)}}),e.initialized=!0}onColumnReorderBeforeDestroy(){this.deattachFromColumnReorder()}deattachFromColumnReorder(){const e=this;e.grid.features.columnReorder.un("beforedestroy",e.onColumnReorderBeforeDestroy,e),e.reorderDetacher&&e.reorderDetacher(),e.reorderDetacher=null}render(){this.initialized||this.init()}showToolbar(e){const t=this,r=t.grid.getColumnDragToolbarItems(e,[]),n=[];t.clearTimeout(t.buttonHideTimer),t.clearTimeout(t.toolbarHideTimer),r.forEach(e=>{let t=n.find(t=>t.text===e.group);t||(t={text:e.group,buttons:[]},n.push(t)),t.buttons.push(e)}),t.element=DomHelper.append(t.grid.element,t.template(n)),t.groups=n,t.buttons=r,t.column=e}hideToolbar(){const e=this;return new Promise(t=>{e.element&&!e.toolbarHideTimer&&(e.element.classList.add("b-remove"),e.toolbarHideTimer=e.setTimeout(()=>{e.toolbarHideTimer=null,e.element&&e.element.remove(),e.element=null,t()},200))})}onDrag(e){const t=this;if(e.dragProxy.getBoundingClientRect().top-t.grid.element.getBoundingClientRect().top>100?t.element.classList.add("b-closer"):t.element.classList.remove("b-closer"),t.hoveringButton&&(t.hoveringButton.classList.remove("b-hover"),t.hoveringButton=null),e.targetElement&&e.targetElement.closest(".b-columndragtoolbar")){t.element.classList.add("b-hover");let r=e.targetElement.closest(".b-columndragtoolbar  .b-target-button:not([data-disabled=true])");r&&(r.classList.add("b-hover"),t.hoveringButton=r)}else t.element.classList.remove("b-hover")}onDrop(e){const t=this;if(e.targetElement&&e.targetElement.matches(".b-columndragtoolbar .b-target-button:not([data-disabled=true])")){const r=e.targetElement,n=t.buttons.find(e=>e.name===r.dataset.name);n&&(r.classList.add("b-activate"),t.buttonHideTimer=t.setTimeout(()=>{t.hideToolbar(),n.onDrop({column:t.column})},100))}else t.hideToolbar()}template(e){return TemplateHelper.tpl`
            <div class="b-columndragtoolbar">     
            <div class="b-title"></div>          
            ${e.map(e=>TemplateHelper.tpl`
                <div class="b-group">
                    <div class="b-buttons">
                    ${e.buttons.map(e=>TemplateHelper.tpl`
                        <div class="b-target-button" data-name="${e.name}" data-disabled="${e.disabled}">
                            <i class="${e.icon}"></i>
                            ${e.text}
                        </div>
                    `)}
                    </div>
                    <div class="b-title">${e.text}</div>
                </div>
            `)}
            </div>`}}ColumnDragToolbar.featureClass="b-hascolumndragtoolbar",ColumnDragToolbar._$name="ColumnDragToolbar",GridFeatureManager.registerFeature(ColumnDragToolbar,BrowserHelper.isTouchDevice);class ColumnPicker extends InstancePlugin{static get defaultConfig(){return{groupByRegion:!1,groupByTag:!1}}static get pluginConfig(){return{chain:["getHeaderMenuItems","getColumnDragToolbarItems"]}}construct(e,t){this.grid=e,super.construct(e,t)}getColumnPickerItems(e){const t=this;if(t.groupByRegion)return t.grid.regions.map(e=>{const r=t.grid.getSubGrid(e).columns.records;return{text:StringHelper.capitalizeFirstLetter(e),menu:t.buildColumnMenu(r),disabled:0===r.length,region:e}});if(t.groupByTag){const r={};return e.forEach(e=>{e.tags&&e.hideable&&e.tags.forEach(e=>{r[e]||(r[e]=1)})}),Object.keys(r).sort().map(e=>({text:StringHelper.capitalizeFirstLetter(e),menu:t.buildColumnMenu(t.getColumnsForTag(e)),tag:e,onBeforeSubMenu:({item:e,itemEl:r})=>{t.refreshTagMenu(e,r)}}))}return t.buildColumnMenu(e.records)}getColumnsForTag(e){return this.grid.columns.records.filter(t=>t.tags&&t.tags.includes(e)&&!1!==t.hideable)}refreshTagMenu(e,t){this.getColumnsForTag(e.tag).forEach(t=>{const r=e.items.find(e=>e.column===t);r&&(r.checked=!0!==t.hidden)})}buildColumnMenu(e){let t=e.length>0&&e[0].region,{grid:r}=this;return e.reduce((e,n)=>{const i=this.grid.columns.visibleColumns.filter(e=>e.region===n.region);if(!1!==n.hideable){const s={grid:r,text:n.text,column:n,name:n.id,checked:!0!==n.hidden,disabled:!0!==n.hidden&&1===i.length,cls:n.region!==t?"b-separator":""};t=n.region,n.children&&(s.menu=this.buildColumnMenu(n.children)),e.push(s)}return e},[])}getHeaderMenuItems(e,t){const r=this,{grid:n}=r,{columns:i}=n;if(!1!==e.showColumnPicker&&i.some(e=>e.hideable)&&t.push({text:r.L("columnsMenu"),name:"columnPicker",icon:"b-fw-icon b-icon-columns",cls:"b-separator",weight:100,menu:r.getColumnPickerItems(i),onToggle:r.onColumnToggle}),!1!==e.hideable){const n=i.visibleColumns.filter(t=>t.region===e.region);t.push({text:r.L("hideColumn"),icon:"b-fw-icon b-icon-hide-column",weight:101,name:"hideColumn",disabled:1===n.length,onItem:()=>e.hide()})}}onColumnToggle({menu:e,item:t,checked:r}){if(!!t.column.hidden!=!r){t.column[r?"show":"hide"]();const{grid:n,column:i}=t,{columns:s}=n,o=e.items,a=s.visibleColumns.filter(e=>e.region===t.column.region),{currentMenu:l}=n.features.contextMenu,d=l.items.find(e=>"hideColumn"===e.name);if(1===a.length){const e=o.find(e=>e.name===a[0].id);e&&(e.disabled=!0),d&&i.region===t.column.region&&(d.disabled=!0)}else a.forEach(e=>{const t=o.find(t=>t.column===e);t&&(t.disabled=!1)}),d&&i.region===t.column.region&&(d.disabled=!1);t.menu&&t.menu.eachWidget(e=>{e.checked=r});const c=e.owner;if(c&&c.column===i.parent){const e=o.some(e=>!0===e.checked);c.checked=e}}}getColumnDragToolbarItems(e,t){const r=this.grid.columns.visibleColumns.filter(t=>t.region===e.region);return!1!==e.hideable&&r.length>1&&t.push({text:this.L("hideColumnShort"),group:this.L("Column"),icon:"b-fw-icon b-icon-hide-column",weight:101,name:"hideColumn",onDrop:({column:e})=>e.hide()}),t}}ColumnPicker._$name="ColumnPicker",GridFeatureManager.registerFeature(ColumnPicker,!0);class ColumnReorder extends(Delayable(InstancePlugin)){construct(e){this.ignoreSelectors=[".b-grid-header-resize-handle",".b-field"],this.grid=e,super.construct(e)}doDestroy(){this.dragHelper&&this.dragHelper.destroy(),super.doDestroy()}init(){const e=this,{grid:t}=e,r=t.element,n=DomHelper.children(r,".b-grid-headers");n.push(...DomHelper.children(r,".b-grid-header-children")),e.dragHelper?e.dragHelper.containers=n:(e.dragHelper=new DragHelper({name:"columnReorder",mode:"container",dragThreshold:10,targetSelector:".b-grid-header",outerElement:r.querySelector("header.b-grid-header-container"),containers:n,isElementDraggable(r){if(Boolean(DomHelper.up(r,e.ignoreSelectors.join(","))))return!1;const n=DomHelper.up(r,this.targetSelector),i=n&&t.columns.getById(n.dataset.columnId),s=i&&0===i.childLevel&&1===t.subGrids[i.region].columns.count;return Boolean(i)&&!1!==i.draggable&&!s},ignoreSelector:".b-filter-icon,.b-grid-header-resize-handle",listeners:{dragstart:e.onDragStart,drag:e.onDrag,drop:e.onDrop,thisObj:e}}),e.relayEvents(e.dragHelper,["dragstart","drag","drop","abort"],"gridheader"))}static get pluginConfig(){return{after:["render","renderContents"]}}onDrag({context:e,event:t}){const r=IdHelper.fromElement(t.target,"header");r&&r.subGrid.sealedColumns?e.valid=!1:this.grid.features.columnDragToolbar||(e.valid=Boolean(t.target.closest(".b-grid-headers")))}onDragStart(){const e=this;if(!e.grid.features.columnDragToolbar){const t=e.grid.element.querySelector(".b-grid-header-container").getBoundingClientRect();e.dragHelper.minY=t.top,e.dragHelper.maxY=t.bottom}this.grid.headerContainer.classList.add("b-dragging-header")}onDrop({context:e}){if(!e.valid)return this.onInvalidDrop({context:e});const t=this,r=t.grid,n=e.dragging,i=DomHelper.up(e.target,".b-grid-header"),s=r.columns.get(i.dataset.column),o=e.draggedTo.dataset.region||s.region,a=e.insertBefore,l=r.columns.getById(n.dataset.columnId),d=a?r.columns.getById(a.dataset.columnId):r.subGrids[o].columns.last.nextSibling,c=d?d.parent:r.columns.rootNode;if(r.headerContainer.classList.remove("b-dragging-header"),o===l.region&&s===l.previousSibling)return void t.dragHelper.abort();const u=l.parent&&1===l.parent.children.length&&l.parent;u&&u.parent.removeChild(u),l.region=o,c.insertChild(l,d)}onInvalidDrop({context:e}){this.grid.headerContainer.classList.remove("b-dragging-header")}renderContents(){this.init()}render(){this.init()}}ColumnReorder.featureClass="b-column-reorder",ColumnReorder._$name="ColumnReorder",GridFeatureManager.registerFeature(ColumnReorder,!0);class ColumnResize extends InstancePlugin{static get defaultConfig(){return{liveResize:"auto"}}construct(e,t){const r=this;r.grid=e,super.construct(e,t),r.resizer=new ResizeHelper({name:"columnResize",targetSelector:".b-grid-header",handleSelector:".b-grid-header-resize-handle",outerElement:e.element,listeners:{resizestart:r.onResizeStart,resizing:r.onResizing,resize:r.onResize,thisObj:r}})}static get pluginConfig(){return[]}set liveResize(e){"auto"===e&&(e=!BrowserHelper.isMobileSafari),this._liveResize=e}get liveResize(){return this._liveResize}doDestroy(){this.resizer&&this.resizer.destroy(),super.doDestroy()}onResizeStart({context:e}){const t=e.column=this.grid.columns.getById(e.element.dataset.columnId);this.resizer.minWidth=t.minWidth,e.element.style.minWidth="",this.grid.element.classList.add("b-column-resizing")}onResizing({context:e}){e.valid&&this.liveResize&&(this.grid.dragResizing=!0,e.column.width=e.newWidth)}onResize({context:e}){const t=this,r=e.column;if(t.grid.element.classList.remove("b-column-resizing"),e.valid&&(t.liveResize?(t.grid.dragResizing=!1,t.grid.afterColumnsResized()):e.column.width=e.newWidth,BrowserHelper.isIE11&&r.parent&&r.parent.flex)){const e=r.parent;t.grid.getHeaderElement(e.id).style.flexBasis=e.children.reduce((e,r)=>e+t.grid.getHeaderElement(r.id).offsetWidth,0)+"px"}}}ColumnResize.featureClass="b-column-resize",ColumnResize._$name="ColumnResize",GridFeatureManager.registerFeature(ColumnResize,!0);class ContextMenu extends InstancePlugin{static get defaultConfig(){return{headerItems:[],processHeaderItems:null,cellItems:[],processCellItems:null}}construct(e,t){this.grid=e,super.construct(e,t)}doDestroy(){this.currentMenu&&this.currentMenu.destroy(),super.doDestroy()}static get pluginConfig(){return{chain:["onElementContextMenu"]}}onElementContextMenu(e){const t=this,r=t.grid,n=e.target,i=DomHelper.up(n,".b-grid-header"),s=r.getEventData(e);i?t.handleHeaderContextMenu(i,e):s&&t.handleCellContextMenu(s,e)}handleHeaderContextMenu(e,t){if(e.dataset.column){const r=this,n=r.grid,i=n.columns.getById(e.dataset.columnId),s=e=>{e.column||(e.column=i);let t=e.menu;t&&(Array.isArray(t)||(t=t.items||t.widgets),t.forEach(s))};if(!1!==i.enableHeaderContextMenu){const o=[...r.headerItems,...i.headerMenuItems||[]],{processHeaderItems:a}=r,l={items:o,column:i,event:t,element:e};n.getHeaderMenuItems(i,o),(!a||!1!==a(l))&&o.length>0&&(t.preventDefault(),o.sort((e,t)=>(e.weight||150)-(t.weight||150)),o.forEach(s),!1!==n.trigger("headerContextMenuBeforeShow",l)&&(r.currentMenu=WidgetHelper.showContextMenu("keydown"===t.type?e:[t.clientX+1,t.clientY+1],{owner:r.client,constrainTo:document,cls:"b-context-menu",items:o,scrollAction:"hide",onItem({source:e,item:t,element:r}){n.trigger("contextMenuItem",{source:n,item:t,column:i,element:r})},onToggle({source:e,item:t,checked:r,element:s}){n.trigger("contextMenuToggleItem",{source:n,item:t,column:i,checked:r,element:s})},onDestroy(){r.currentMenu=null},listeners:{show({source:e}){l.menu=e,n.trigger("headerContextMenuShow",l)}}})))}}}handleCellContextMenu(e,t){const r=this,n=r.grid,i=e.cellElement,s=n.columns.getById(e.columnId);if(!1!==s.enableCellContextMenu){n.focusCell(e.cellSelector,{doSelect:!n.isSelected(e.id),event:t});const o=e.record,a=[...r.cellItems||[],...s.cellMenuItems||[]],{processCellItems:l}=r,d={items:a,column:s,event:t,record:o,element:i};n.getCellMenuItems(s,o,a),(!l||!1!==l(d))&&a.length>0&&(a.forEach(e=>{e.column=s,e.record=o}),t.preventDefault(),a.sort((e,t)=>(e.weight||150)-(t.weight||150)),!1!==n.trigger("cellContextMenuBeforeShow",d)&&(r.currentMenu=WidgetHelper.showContextMenu([t.clientX+1,t.clientY+1],{owner:r.client,items:a,onBeforeItem:e=>{Object.assign(e,d)},onItem({item:e}){n.trigger("contextMenuItem",{source:n,item:e,column:s,record:o,cell:i})},onClose({reason:e}){"outside"!==e&&n.element.focus()},onDestroy(){r.currentMenu=null},listeners:{show({source:e}){d.menu=e,n.trigger("cellContextMenuShow",d)}}})))}}}ContextMenu.featureClass="",ContextMenu._$name="ContextMenu",GridFeatureManager.registerFeature(ContextMenu,!0);class DomDataStore{static get(e,t){const r=e._domData||(e._domData={});return null!=t?r[t]:r}static set(e,t,r){3===arguments.length?(e._domData||(e._domData={}))[t]=r:e._domData=t}static assign(e,t){Object.assign(e._domData||(e._domData={}),t)}}DomDataStore._$name="DomDataStore";class CellTooltip extends InstancePlugin{static get defaultConfig(){return{tooltipRenderer:null}}construct(e,t){const r=this;super.construct(e,r.processConfig(t)),r.tip=new Tooltip(Object.assign({forElement:e.element,forSelector:".b-grid-cell",hoverDelay:1e3,trackMouse:!1,cls:"b-celltooltip-tip",getHtml:r.getTooltipContent.bind(r),listeners:{pointerOver:"onPointerOver",thisObj:r}},t)),r.relayEvents(r.tip,["beforeshow","show"])}onPointerOver({target:e}){return!1!==this.client.getColumnFromElement(e).tooltipRenderer}processConfig(e){return"function"==typeof e?{tooltipRenderer:e}:e}setConfig(e){super.setConfig(this.processConfig(e))}doDestroy(){this.tip.destroy(),super.doDestroy()}getTooltipContent({tip:e,forElement:t,event:r}){const n=this,i=n.client.getRecordFromElement(t),s=n.client.getColumnFromElement(t);let o;return i===n.lastRecord&&s===n.lastColumn?n.tip._html:(s.tooltipRenderer?o=s.tooltipRenderer({cellElement:t,record:i,column:s,event:r,tip:e,cellTooltip:n}):n.tooltipRenderer&&!1!==s.tooltipRenderer&&(o=n.tooltipRenderer({cellElement:t,record:i,column:s,event:r,tip:e,cellTooltip:n})),null!=o&&(n.lastRecord=i,n.lastColumn=s),o)}}CellTooltip._$name="CellTooltip",GridFeatureManager.registerFeature(CellTooltip);class Filter extends InstancePlugin{static get pluginConfig(){return{chain:["renderHeader","getCellMenuItems","getHeaderMenuItems","onElementClick"]}}construct(e,t){const r=this;r.grid=e,r.store=e.store,r.closeFilterEditor=r.closeFilterEditor.bind(r),super.construct(e,t),r.store.on({filter:r.onStoreFilter},r),t&&"object"==typeof t&&r.store.filter(t,null,r.client.isConfiguring)}doDestroy(){const e=this;e.filterTip&&e.filterTip.destroy(),e.store.un({sort:e.onStoreFilter},e),super.doDestroy()}refreshHeaders(e){let t=this,r=t.grid,n=r.headerContainer;if(n){DomHelper.children(n,".b-filter-icon.b-latest").forEach(e=>e.classList.remove("b-latest")),t.filterTip||(t.filterTip=new Tooltip({forElement:n,forSelector:".b-filter-icon",getHtml:({forElement:e})=>e.dataset.filterText}));for(let e of r.columns)if(!1!==e.filterable){let r=t.store.filters.getBy("property",e.field),n=e.element;if(n){let i,s=e.textWrapper,o=s&&s.querySelector(".b-filter-icon");i=r?t.L("filter")+": "+("string"==typeof r?r:`${r.operator} ${r.displayValue||r.value}`):t.L("applyFilter"),o?o.dataset.filterText=i:(o=DomHelper.createElement({parent:s,tag:"div",className:"b-filter-icon",dataset:{filterText:i}}),n.classList.add("b-filterable")),e.field===t.store.latestFilterField&&o.classList.add("b-latest"),n.classList[r?"add":"remove"]("b-filter")}e.meta.isFiltered=!!r}e&&r.refreshRows()}}applyFilter(e){const{store:t}=this,r=this.grid.columns.get(e.property);"function"==typeof r.filterable?t.filter({filterBy:t=>r.filterable(Object.assign({},e,{record:t})),value:e.value,property:e.property,operator:e.operator,displayValue:e.displayValue}):t.filter(e)}getPopupDateItems(e,t,r,n,i,s,o){const a=this,l=s,d=o;function c({source:e,value:t}){null==t?o():(a.applyFilter({property:n,operator:e.operator,value:t,displayValue:e._value}),s())}return[{type:"date",ref:"on",placeholder:a.L("on"),clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:t&&"="===t.operator?t.value:r,operator:"=",onChange:c,onClose:l,onClear:d},{type:"date",ref:"before",placeholder:a.L("before"),clearable:!0,label:'<i class="b-fw-icon b-icon-filter-before"></i>',value:t&&"<"===t.operator?t.value:null,operator:"<",onChange:c,onClose:l,onClear:d},{type:"date",ref:"after",cls:"b-last-row",placeholder:a.L("after"),clearable:!0,label:'<i class="b-fw-icon b-icon-filter-after"></i>',value:t&&">"===t.operator?t.value:null,operator:">",onChange:c,onClose:l,onClear:d}]}getPopupNumberItems(e,t,r,n,i,s,o){const a=this,l=s,d=o;function c({source:e,value:t}){null==t?o():(a.applyFilter({property:n,operator:e.operator,value:t}),s())}return[{type:"number",placeholder:a.L("equals"),clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:t&&"="===t.operator?t.value:r,operator:"=",onChange:c,onEsc:l,onClear:d},{type:"number",placeholder:a.L("lessThan"),clearable:!0,label:'<i class="b-fw-icon b-icon-filter-less"></i>',value:t&&"<"===t.operator?t.value:null,operator:"<",onChange:c,onEsc:l,onClear:d},{type:"number",cls:"b-last-row",placeholder:a.L("moreThan"),clearable:!0,label:'<i class="b-fw-icon b-icon-filter-more"></i>',value:t&&">"===t.operator?t.value:null,operator:">",onChange:c,onEsc:l,onClear:d}]}getPopupStringItems(e,t,r,n,i,s,o){const a=this;return[{type:e,cls:"b-last-row",placeholder:a.L("filter"),clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:t?t.value||t:r,onChange:({value:e})=>{""===e?o():(a.applyFilter({property:n,value:e}),s())},onKeypress:({source:e,event:t})=>{"Enter"===t.key&&(""===e.value?o():(a.applyFilter({property:n,value:e.value}),s()))},onClose:s,onClear:o}]}getPopupItems(e,t,r,n,i,s,o){switch(e){case"date":return this.getPopupDateItems(...arguments);case"number":return this.getPopupNumberItems(...arguments);default:return this.getPopupStringItems(...arguments)}}showFilterEditor(e,t){let r=this,n="string"==typeof e?r.grid.columns.getById(e):e,i=n.element,s=r.store.filters.getBy("property",n.field),o={string:"text",number:"number",date:"date"}[n.filterType||n.type||"string"]||"text";!1!==n.filterable&&(r.filterEditorPopup=WidgetHelper.openPopup(i,{width:"16em",cls:"b-filter-popup",scrollAction:"realign",items:r.getPopupItems(o,s,t,n.field,r.store,r.closeFilterEditor,()=>{r.store.removeFieldFilter(n.field),r.closeFilterEditor()})}))}closeFilterEditor(){this.filterEditorPopup&&this.filterEditorPopup.setTimeout(this.filterEditorPopup.destroy),this.filterEditorPopup=null}getMenuDateItems(e,t){const r=this,n=t[e.field],i=t=>{r.applyFilter({property:e.field,operator:t,value:n,displayValue:e.formatValue?e.formatValue(n):n})};return[{text:r.L("on"),icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",name:"filterDateEquals",onItem:()=>i("=")},{text:r.L("before"),icon:"b-fw-icon b-icon-filter-before",name:"filterDateBefore",onItem:()=>i("<")},{text:r.L("after"),icon:"b-fw-icon b-icon-filter-after",name:"filterDateAfter",onItem:()=>i(">")}]}getMenuNumberItems(e,t){const r=this,n=n=>{r.applyFilter({property:e.field,operator:n,value:t[e.field]})};return[{text:r.L("equals"),icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",name:"filterNumberEquals",onItem:()=>n("=")},{text:r.L("lessThan"),icon:"b-fw-icon b-icon-filter-less",name:"filterNumberLess",onItem:()=>n("<")},{text:r.L("moreThan"),icon:"b-fw-icon b-icon-filter-more",name:"filterNumberMore",onItem:()=>n(">")}]}getMenuStringItems(e,t){return[{text:this.L("equals"),icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",name:"filterStringEquals",onItem:()=>{this.applyFilter({property:e.field,value:t[e.field]})}}]}getCellMenuItems(e,t,r){const n=this,i=t.getFieldDefinition(e.field);if(!1!==e.filterable){let t=[];switch(e.meta.isFiltered&&t.push({text:n.L("removeFilter"),icon:"b-fw-icon b-icon-clear",cls:"b-separator",name:"filterRemove",onItem:()=>{n.store.removeFieldFilter(e.field)}}),e.filterType||e.type||i&&i.type){case"date":t.push(...n.getMenuDateItems(...arguments));break;case"number":t.push(...n.getMenuNumberItems(...arguments));break;default:t.push(...n.getMenuStringItems(...arguments))}e.meta.isFiltered&&t.length>1&&(t[1].cls=""),r.push(...t)}}getHeaderMenuItems(e,t){const r=this;e.meta.isFiltered?(t.push({text:r.L("editFilter"),name:"editFilter",icon:"b-fw-icon b-icon-filter",cls:"b-separator",onItem(){r.showFilterEditor(e)}}),t.push({text:r.L("removeFilter"),name:"removeFilter",icon:"b-fw-icon b-icon-remove",onItem:()=>{r.store.removeFieldFilter(e.field)}})):!1!==e.filterable&&t.push({text:r.L("filter"),name:"filter",icon:"b-fw-icon b-icon-filter",cls:"b-separator",onItem(){r.showFilterEditor(e)}})}onStoreFilter(){this.refreshHeaders(!1)}renderHeader(){this.refreshHeaders(!1)}onElementClick(e){const t=e.target;if(this.filterEditorPopup&&this.closeFilterEditor(),t.classList.contains("b-filter-icon")){const e=DomHelper.up(t,".b-grid-header");return this.showFilterEditor(e.dataset.columnId),!1}}}Filter.featureClass="b-filter",Filter._$name="Filter",GridFeatureManager.registerFeature(Filter);class FilterBar extends InstancePlugin{static get defaultConfig(){return{keyStrokeFilterDelay:300,clearStoreFiltersOnHide:!0}}construct(e,t){const r=this;Object.assign(r,{filterFieldCls:"b-filter-bar-field",filterFieldInputCls:"b-filter-bar-field-input",filterableColumnCls:"b-filter-bar-enabled",filterFieldInputSelector:".b-filter-bar-field-input",filterableColumnSelector:".b-filter-bar-enabled",filterParseRegExp:/^\s*([<>=*])?(.*)$/,storeTrackingSupended:0,store:e.store,grid:e}),r.onColumnFilterFieldChange=r.onColumnFilterFieldChange.bind(r),super.construct(e,Array.isArray(t)?{filter:t}:t),r.store.on({filter:r.onStoreFilter,thisObj:r}),r.filter&&r.store.filter(r.filter),r.gridDetacher=e.on("beforeelementclick",r.onBeforeElementClick,r)}doDestroy(){this.destroyFilterBar(),this.gridDetacher&&this.gridDetacher(),super.doDestroy()}static get pluginConfig(){return{before:["onElementKeyDown"],chain:["renderHeader","getHeaderMenuItems"]}}destroyFilterBar(){const e=this.grid.columns;e&&e.forEach(this.destroyColumnFilterField,this)}hideFilterBar(){const e=this,t=e.grid.columns;e.clearStoreFiltersOnHide&&e.suspendStoreTracking(),t&&t.forEach(t=>e.hideColumnFilterField(t,!0)),e.grid.store.filter(),e.clearStoreFiltersOnHide&&e.resumeStoreTracking(),e.hidden=!0}showFilterBar(){this.renderFilterBar(),this.hidden=!1}toggleFilterBar(){const e=this;e.hidden?e.showFilterBar():e.hideFilterBar()}renderFilterBar(){const e=this;e.grid.columns.visibleColumns.forEach(t=>e.renderColumnFilterField(t))}renderColumnFilterField(e){const t=this,r=t.grid,n=t.getColumnFilterable(e);if(n&&!e.hidden){const i=e.element;let s=t.getColumnFilterField(e);if(s)t.onColumnFilterFieldChange({source:s,value:s.value}),s.render(i),s.show();else{const o=r.store.filters.getBy("property",e.field),a=`${e.filterType||"text"}field`;s=WidgetHelper.append(Object.assign({type:a,owner:t.grid,clearable:!0,column:e,name:e.field,value:o&&t.buildFilterString(o),cls:t.filterFieldCls,inputCls:t.filterFieldInputCls,keyStrokeChangeDelay:t.keyStrokeFilterDelay,onChange:t.onColumnFilterFieldChange,onClear:t.onColumnFilterFieldChange},n.filterField),i)[0],t.setColumnFilterField(e,s)}i.classList.add(t.filterableColumnCls)}}updateColumnFilterFields(){const e=this,t=e.grid;let r,n;for(let i of t.columns)(r=e.getColumnFilterField(i))&&(n=t.store.filters.getBy("property",i.field),r.value=n&&e.buildFilterString(n)||"")}getColumnFilterable(e){if(!e.isRoot&&!1!==e.filterable&&e.field)return"function"==typeof e.filterable&&(e.filterable={filterFn:e.filterable}),e.filterable}destroyColumnFilterField(e){const t=this,r=t.getColumnFilterField(e);r&&(t.hideColumnFilterField(e),r.destroy(),t.setColumnFilterField(e,void 0))}hideColumnFilterField(e,t){const r=this,n=r.grid.store,i=e.element,s=r.getColumnFilterField(e);s&&(s.hide(),r.clearStoreFiltersOnHide&&e.field&&n.removeFieldFilter(e.field,t),i.classList.remove(r.filterableColumnCls))}getColumnFilterField(e){return this._columnFilters&&this._columnFilters[e.data.id]}setColumnFilterField(e,t){this._columnFilters=this._columnFilters||{},this._columnFilters[e.data.id]=t}parseFilterValue(e){const t=String(e).match(this.filterParseRegExp);return{operator:t[1]||"*",value:t[2]}}buildFilterString(e){let t;return e&&!e.initialConfig.filterBy&&(t=("*"===e.operator?"":e.operator)+e.value),t}onStoreFilter(){this.storeTrackingSupended||this.updateColumnFilterFields()}suspendStoreTracking(){this.storeTrackingSupended++}resumeStoreTracking(){this.storeTrackingSupended--}renderHeader(e){this.renderFilterBar()}onElementKeyDown(e){if(!e.handled&&e.target.matches(this.filterFieldInputSelector))switch(e.key){case"ArrowLeft":case"ArrowRight":e.handled=!0}}onBeforeElementClick({event:e}){if(e.target.closest("."+this.filterFieldCls))return!1}onColumnFilterFieldChange({source:e,value:t}){const r=this,n=r.grid.store,i=r.getColumnFilterable(e.column);r.suspendStoreTracking(),null==t||""===t?n.removeFieldFilter(e.name):i.filterFn?n.filter({filterBy:r=>i.filterFn({property:e.name,value:t,record:r}),property:e.name}):n.filter(Object.assign({property:e.name},r.parseFilterValue(t))),r.resumeStoreTracking()}getHeaderMenuItems(e,t){const r=this;t.push({text:r.L(r.hidden?"enableFilterBar":"disableFilterBar"),name:"toggleFilterBar",icon:"b-fw-icon b-icon-filter",cls:"b-separator",onItem:()=>r.toggleFilterBar()})}}FilterBar.featureClass="b-filter-bar",FilterBar._$name="FilterBar",GridFeatureManager.registerFeature(FilterBar);class Group extends InstancePlugin{static get defaultConfig(){return{field:null,renderer:null}}construct(e,t){const r=this;e.features.tree||(r._thisIsAUsedExpression(e.features.groupSummary),t=r.processConfig(t),Object.assign(r,{grid:e,rowManager:e.rowManager,store:e.store}),super.construct(e,t),r.store.on({group:r.onStoreGroup,groupingoff:r.onStoreGroupingOff,thisObj:r}),r.rowManager.on({rendercell:r.renderCell,thisObj:r}))}processConfig(e){return"string"==typeof e?{field:e,ascending:null}:e}setConfig(e){const t=this;null===e?t.store.clearGroupers():super.setConfig(t.processConfig(e))}set renderer(e){this.groupRenderer=e}set field(e){this._field=e,this.store.group(e,this.ascending)}get field(){return this._field}doDestroy(){super.doDestroy()}static get pluginConfig(){return{assign:["collapseAll","expandAll"],chain:["renderHeader","getHeaderMenuItems","getColumnDragToolbarItems","onElementTouchStart","onElementClick","onElementKeyDown"],override:["onStoreDataChange"]}}toggleCollapse(e,t){this.internalToggleCollapse(e,t)}internalToggleCollapse(e,t,r=!1){const n=this,i=n.store,s=i.getById(e),o=s.meta;void 0!==o.groupRowFor&&((t=void 0===t?!o.collapsed:t)?i.excludeGroupRecords(s):i.includeGroupRecords(s),o.collapsed=t,n.grid.trigger("toggleGroup",{groupRecord:s,collapse:t}),r||n.rowManager.renderFromRecord(s))}collapseAll(){const e=this;e.store.isGrouped&&(e.store.groupRecords.forEach(t=>e.internalToggleCollapse(t,!0,!0)),e.grid.refreshRows(!0))}expandAll(){const e=this;e.store.isGrouped&&(e.store.groupRecords.forEach(t=>e.internalToggleCollapse(t,!1,!0)),e.grid.refreshRows())}renderCell(e){const t=this;if(!t.store.isGrouped)return;let{cellElement:r,rowElement:n,column:i}=e,s=t.grid,o=e.record.meta,a=s.columns.visibleColumns[0],l=s.getSubGridFromColumn(i);o.hasOwnProperty("groupRowFor")?(i.clearCell(r),o.collapsed?n.classList.add("b-grid-group-collapsed"):n.classList.remove("b-grid-group-collapsed"),n.classList.add("b-group-row"),i.region===s.regions[0]&&("rownumber"===a.type&&i===l.columns.visibleColumns[1]||"rownumber"!==a.type&&i===l.columns.visibleColumns[0])&&r.classList.add("b-group-title"),t.buildGroupHeader(e)):r===n.firstElementChild&&(n.classList.remove("b-group-row"),n.classList.remove("b-grid-group-collapsed"),r.classList.remove("b-group-title"))}buildGroupHeader(e){const t=this,{record:r,cellElement:n,rowElement:i,column:s,persist:o}=e,a=t.grid,l=r.meta,d=a.columns.visibleColumns[0],c=s&&a.getSubGridFromColumn(s);let u=null;if(o||s&&"rownumber"===d.type&&s===c.columns.visibleColumns[1]||"rownumber"!==d.type&&s===c.columns.visibleColumns[0]){if(o||s.region===a.regions[0]){const s=a.columns.get(l.groupField);if(s&&s.groupRenderer)u=s.groupRenderer({cellElement:n,groupRowFor:l.groupRowFor,record:r,rowElement:i,groupColumn:s});else if(t.groupRenderer)u=t.groupRenderer(Object.assign({},e,{groupRowFor:l.groupRowFor,groupColumn:s}));else{const e=l.childCount-(a.features.groupSummary?1:0);u=`${null==l.groupRowFor?"":l.groupRowFor} (${e})`}}}else t.groupRenderer&&(u=t.groupRenderer(e));return"string"==typeof u&&(n.innerHTML=u),n.innerHTML}renderHeader(e){let t=this.grid,r=this.store.groupers;for(let e of r){const r=t.columns.get(e.field),n=r&&t.getHeaderElement(r.id);n&&(n.classList.add("b-group"),n.classList.add(e.ascending?"b-asc":"b-desc"))}}getHeaderMenuItems(e,t){const r=this,n=r.store;!1!==e.groupable&&t.push({text:r.L("groupAscending"),icon:"b-fw-icon b-icon-group-asc",name:"groupAsc",cls:"b-separator",weight:110,onItem:({item:{column:e}})=>n.group(e.field,!0)},{text:r.L("groupDescending"),icon:"b-fw-icon b-icon-group-desc",name:"groupDesc",weight:110,onItem:({item:{column:e}})=>n.group(e.field,!1)}),n.isGrouped&&t.push({text:r.L("stopGrouping"),icon:"b-fw-icon b-icon-clear",name:"groupRemove",cls:e.groupable?"":"b-separator",weight:110,onItem:({item:{column:e}})=>n.clearGroupers()})}getColumnDragToolbarItems(e,t){const r=this,n=r.store;t.push({text:r.L("groupAscendingShort"),group:r.L("Group"),icon:"b-icon b-icon-group-asc",name:"groupAsc",cls:"b-separator",weight:110,onDrop:({column:e})=>n.group(e.field,!0)}),t.push({text:r.L("groupDescendingShort"),group:r.L("Group"),icon:"b-icon b-icon-group-desc",name:"groupDesc",weight:110,onDrop:({column:e})=>n.group(e.field,!1)});let i=n.groupers&&n.groupers.find(t=>t.field===e.field);return t.push({text:r.L("stopGroupingShort"),group:r.L("Group"),icon:"b-icon b-icon-clear",name:"groupRemove",disabled:!i,weight:110,onDrop:({column:e})=>n.removeGrouper(e.field)}),t}onStoreGroup({groupers:e}){const t=this.grid,r=t.element,n=r&&DomHelper.children(r,".b-grid-header.b-group");if(r){for(let e of n)e.classList.remove("b-group"),e.classList.remove("b-asc"),e.classList.remove("b-desc");for(let r of e){let e=t.getHeaderElementByField(r.field);e&&(e.classList.add("b-group"),e.classList.add(r.ascending?"b-asc":"b-desc"))}}}onStoreGroupingOff(){const e=this.grid,t=DomHelper.children(e.element,".b-grid-header.b-group");for(let e of t)e.classList.remove("b-group"),e.classList.remove("b-asc"),e.classList.remove("b-desc");e.refreshRows()}onElementTouchStart(e){const t=this,r=e.target,n=DomHelper.up(r,".b-grid-header"),i=n&&t.grid.getColumnFromElement(n);e.touches.length>1&&i&&!1!==i.groupable&&t.store.group(i.field)}onElementClick(e){const t=this,r=t.store,n=e.target,i=DomHelper.up(n,".b-group-row"),s=DomHelper.up(n,".b-grid-header"),o=s&&s.dataset.column;if(!n.classList.contains("b-resizer")){if(s&&o){const n=r.groupers.find(e=>e.field===o);if(n&&!e.shiftKey)return r.group(o,!n.ascending),!1;if(e.shiftKey){!1!==t.grid.columns.get(o).groupable&&(e.altKey?r.removeGrouper(o):r.group(o))}e.preventDefault()}return i?(t.internalToggleCollapse(DomDataStore.get(i).id),!1):void 0}}onElementKeyDown(e){const t=this;t.store.isGrouped&&e.target===t.client.element&&" "===e.key&&t.grid.focusedCell&&(e.preventDefault(),t.internalToggleCollapse(t.grid.focusedCell.id))}onStoreDataChange(e){const t=e.source;t.isGrouped&&t.count>0||this.overridden.onStoreDataChange(e)}}Group.featureClass="b-group",Group._$name="Group",GridFeatureManager.registerFeature(Group,!0,["Grid","Scheduler"]);class QuickFind extends InstancePlugin{static get defaultConfig(){return{mode:"header",find:""}}static get pluginConfig(){return{chain:["onElementKeyDown","onElementKeyPress","onCellNavigate"]}}construct(e,t){this.grid=e,this.store=e.store,super.construct(e,t)}showQuickFind(){const e=this,t=e.grid.getHeaderElement(e.columnId);if(t){if(!e.headerField){const[r,n,i]=DomHelper.createElement({tag:"div",className:"b-quick-hit-header",children:[{tag:"div",className:"b-quick-hit-field"},{tag:"div",className:"b-quick-hit-badge"}]},!0);"header"===e.mode?t.appendChild(r):(r.className+=" b-quick-hit-mode-grid",e.grid.element.appendChild(r)),e.headerField={header:r,field:n,badge:i,colHeader:t}}e.headerField.field.innerHTML=e.find,e.headerField.badge.innerHTML=e.found.length,t.classList.add("b-quick-find-header"),e.renderListenerInitialized||(e.grid.rowManager.on({rendercell:e.renderCell,thisObj:e}),e.renderListenerInitialized=!0)}}hideQuickFind(){const e=this;for(let t of e.prevFound||e.found){let r=e.grid.getRowById(t.id);r&&r.renderCell(r.getCell(e.columnId),t.data)}e.headerField&&(e.headerField.header.parentNode.removeChild(e.headerField.header),e.headerField.colHeader.classList.remove("b-quick-find-header"),e.headerField=null),e.renderListenerInitialized&&(e.grid.rowManager.un({rendercell:e.renderCell},e),e.renderListenerInitialized=!1),e.grid.trigger("hideQuickFind")}search(e,t=this.columnId){let r=this,n=r.grid.columns.getById(t)||r.grid.columns.get(t),i=r.store.findByField(n.field,e),s=1,o=r.grid;Object.assign(r,{foundMap:{},prevFound:r.found,found:i,find:e,columnId:n.id}),e?r.showQuickFind():r.hideQuickFind(),r.currentColumn&&r.currentColumn!==n&&(r.currentColumn.disableHtmlEncode=!1);for(let e of DomHelper.children(o.element,".b-quick-hit")){e.classList.remove("b-quick-hit"),e.classList.remove("b-quick-hit-cell"),DomDataStore.get(e).row.renderCell(e)}if(n.disableHtmlEncode=!0,r.currentColumn=n,i){i.length>0&&r.gotoClosestHit(o.focusedCell,i);for(let e of i){r.foundMap[e.id]=s++;let t=o.getRowById(e.data.id);if(t&&t.renderCell(t.getCell(n.id)),s>1e3)break}r.grid.trigger("quickFind",{find:e,found:i})}}clear(){this.found&&this.found.length&&this.search("")}get foundCount(){return this.found?this.found.length:0}gotoHit(e){let t=this,r=t.grid,n=t.found[e];return n&&r.focusCell({columnId:t.columnId,id:n.id}),!!n}gotoClosestHit(e,t){let r=e?this.grid.store.indexOf(e.id):0,n=t.slice().sort((e,t)=>Math.abs(e.index-r)-Math.abs(t.index-r));this.gotoHit(t.indexOf(n[0]))}gotoFirstHit(){this.gotoHit(0)}gotoLastHit(){this.gotoHit(this.found.length-1)}gotoNextHit(){let e=this,t=e.grid,r=t._focusedCell?t._focusedCell.id:t.lastFocusedCell.id,n=t.store.indexOf(r)||0,i=e.found.find(e=>e.index>n);i?t.focusCell({columnId:e.columnId,id:i.id}):e.gotoFirstHit()}gotoPrevHit(){let e,t=this,r=t.grid,n=r._focusedCell?r._focusedCell.id:r.lastFocusedCell.id,i=r.store.indexOf(n)||0,s=t.found;if(s.length){for(let t=s.length-1;t--;t>=0)if(s[t].index<i){e=s[t];break}e?r.focusCell({columnId:t.columnId,id:e.id}):t.gotoLastHit()}}renderCell(e){let t=this,r=e.cellElement,n=t.foundMap&&t.columnId===e.column.id&&t.foundMap[e.record.id];if(n){const i=e.column.htmlEncode||e.column.shouldHtmlEncode;if(r.classList.add("b-quick-hit"),i){let e=DomHelper.down(r,".b-grid-cell-value,.b-tree-cell-value")||r,i=e.innerText,s=i&&i.toLowerCase().indexOf(t.find.toLowerCase());if(s>-1){let r=s+t.find.length,o=i.slice(s,r),a="";" "===i[s-1]&&(a="&nbsp;"),i=i.slice(0,s)+`<span class="b-quick-hit-text">${a}${o}</span>`+i.slice(r),e.innerHTML=i+`<div class="b-quick-hit-cell-badge">${n}</div>`}else r.classList.add("b-quick-hit-cell")}else r.classList.add("b-quick-hit-cell")}}onElementKeyDown(e){const t=this,r=this.grid.features.filter;DomHelper.up(e.target,BrowserHelper.isIE11?".b-widget:not(.b-grid-subgrid):not(.b-grid)":".b-widget:not(.b-grid)")||t.find.length>0&&("Backspace"===e.key?(e.preventDefault(),t.find=t.find.substr(0,t.find.length-1),t.search(t.find)):"Escape"===e.key?(e.preventDefault(),t.find="",t.search(t.find)):"F3"===e.key||"g"===e.key.toLowerCase()&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),e.shiftKey?t.gotoPrevHit():t.gotoNextHit()):r&&t.columnId&&t.foundCount&&e.ctrlKey&&e.shiftKey&&"F"===e.key&&r.showFilterEditor(t.grid.columns.getById(t.columnId),t.find))}onElementKeyPress(e){const t=this;if(!DomHelper.up(e.target,BrowserHelper.isIE11?".b-widget:not(.b-grid-subgrid):not(.b-grid)":".b-widget:not(.b-grid)")&&"Enter"!==e.key&&t.grid._focusedCell){const r=t.grid.columns.getById(t.grid._focusedCell.columnId);r&&!1!==r.searchable&&(t.columnId=t.grid._focusedCell.columnId,e.key&&1===e.key.length&&(t.find+=e.key,t.search(t.find)))}}onCellNavigate(e,t,r,n){const i=this;!(i.prevFound||i.found)||r&&r.columnId===i.columnId||i.clear()}}QuickFind.featureClass="b-quick-find",QuickFind._$name="QuickFind",GridFeatureManager.registerFeature(QuickFind);class Search extends InstancePlugin{construct(e,t){super.construct(e,t),Object.assign(this,{store:e.store,grid:e,find:"",hitEls:[]})}doDestroy(){this.clear(!0),super.doDestroy()}static get pluginConfig(){return{chain:["getCellMenuItems","onElementKeyDown"]}}search(e,t=!0,r=!1){if(!e)return this.clear();if(!r&&e===this.find)return;const n=this,i=n.grid,s=i.columns.visibleColumns.filter(e=>!1!==e.searchable).map(e=>e.field),o=n.store.search(e,s);let a=1;Object.assign(n,{foundMap:{},prevFound:n.found,found:o,find:e});for(let e of DomHelper.children(i.element,".b-search-hit")){e.classList.remove("b-search-hit"),e.classList.remove("b-search-hit-cell"),DomDataStore.get(e).row.renderCell(e)}if(o){n.hitColumns&&n.hitColumns.forEach(e=>e.disableHtmlEncode=!1),n.hitColumns=[];for(let e of o){n.foundMap[e.field+"-"+e.id]=a++;const t=n.grid.columns.get(e.field);if(t&&(t.disableHtmlEncode=!0,n.hitColumns.push(t)),a>1e3)break}return n.listenersInitialized||(n.grid.rowManager.on({rendercell:n.renderCell},n),n.store.on({refresh:n.onStoreRefresh},n),n.listenersInitialized=!0),i.refreshRows(),n.grid.trigger("search",{grid:i,find:e,found:o}),t&&!n.isHitFocused&&n.gotoNextHit(!0),o}}clear(e=!1){const t=this,r=t.grid;t.foundMap&&(delete t.foundMap,delete t.find),DomHelper.forEachSelector(r.element,".b-search-hit",e=>{e.classList.remove("b-search-hit"),e.classList.remove("b-search-hit-cell")}),DomHelper.removeEachSelector(r.element,".b-search-hit-cell-badge,.b-search-hit-text"),t.listenersInitialized&&(r.rowManager.un({rendercell:t.renderCell},t),t.store.un({refresh:t.onStoreRefresh},t),t.listenersInitialized=!1),e||(r.refreshRows(),t.grid.trigger("clearSearch",{grid:r}))}get foundCount(){return this.found&&this.found.length||0}get isHitFocused(){let e=this.grid,t=e.focusedCell?e.store.indexOf(e.focusedCell.id):-1,r=e.focusedCell?e.columns.getById(e.focusedCell.columnId):null;return-1!==t&&this.found.some(e=>e.index===t&&r&&e.field===r.field)}gotoNextHit(e=!1){const t=this;if(!t.found||!t.found.length)return;const r=t.grid,n=r.focusedCell||r.lastFocusedCell,i=n&&!e?r.store.indexOf(n.id):-1,s=t.found.findIndex(e=>e.index>i);-1!==s&&t.gotoHit(s)}gotoPrevHit(){const e=this;if(!e.found||!e.found.length)return;const t=e.grid,r=t.focusedCell||t.lastFocusedCell,n=r?t.store.indexOf(r.id):0,i=e.found;for(let t=i.length-1;t--;t>=0){if(i[t].index<n){e.gotoHit(t);break}}}gotoHit(e){let t=this.grid,r=this.found[e];return r&&t.focusCell({field:r.field,id:r.id}),!!r}gotoFirstHit(){this.gotoHit(0)}gotoLastHit(){this.gotoHit(this.found.length-1)}renderCell({cellElement:e,column:t,record:r,value:n,cellContent:i}){const s=this,o=s.foundMap&&s.foundMap[t.field+"-"+r.id];if(o){e.classList.add("b-search-hit");const t=DomHelper.down(e,".b-grid-cell-value")||e,r=String(s.find).toLowerCase();if(String(n).toLowerCase()===r)t.innerHTML=`<span class="b-search-hit-text">${i}</span><div class="b-search-hit-cell-badge">${o}</div>`;else{const r=String(s.find).toLowerCase(),n=i&&i.toLowerCase().indexOf(r);if(n>-1){let e=n+r.length,s=i.slice(n,e);t.innerHTML=`${i.slice(0,n)}<span class="b-search-hit-text">${s}</span>${i.slice(e)}<div class="b-search-hit-cell-badge">${o}</div>`}else e.classList.add("b-search-hit-cell")}s.hitEls.push(e)}}getCellMenuItems(e,t,r){const n=this;return e.searchable&&r.push({text:n.L("searchForValue"),icon:"b-fw-icon b-icon-search",cls:"b-separator",name:"search",onItem:({item:e})=>{const{column:t,record:r}=e;let i=window.getSelection().toString();i||(i=r[t.field]),n.search(i)}}),r}onElementKeyDown(e){const t=this;t.find&&""!==t.find&&("F3"===e.key||"g"===e.key.toLowerCase()&&(e.ctrlKey||e.metaKey))&&(e.preventDefault(),e.shiftKey?t.gotoPrevHit():t.gotoNextHit())}onStoreRefresh(){this.search(this.find,!1,!0)}}Search.featureClass="b-search",Search._$name="Search",GridFeatureManager.registerFeature(Search);class Sort extends InstancePlugin{static get defaultConfig(){return{multiSort:!0,ignoreRe:new RegExp(["b-grid-header-resize-handle","b-filter-icon"].join("|")),sortableCls:"b-sortable",sortedCls:"b-sort",sortedAscCls:"b-asc",sortedDescCls:"b-desc"}}construct(e,t){const r=this;t=r.processConfig(t),r.store=e.store,r.grid=e,r.store.on({sort:r.syncHeaderSortState,thisObj:r}),super.construct(e,t)}processConfig(e){return"string"==typeof e||Array.isArray(e)?{field:e,ascending:null}:e}setConfig(e){super.setConfig(this.processConfig(e))}set field(e){const t=this.grid.columns.get(e);t&&"object"==typeof t.sortable&&(t.sortable.field=t.sortable.property||e,e=t.sortable),this.store.sort(e,this.ascending)}doDestroy(){super.doDestroy()}static get pluginConfig(){return{chain:["onElementClick","getHeaderMenuItems","getColumnDragToolbarItems","renderHeader"]}}syncHeaderSortState(){const e=this,t={};if(!e.grid.isConfiguring){let r,n=e.store.sorters,i=n.length,s=new DomClassList;for(let e=0;e<i;e++){const r=n[e];r.field&&(t[r.field]={ascending:r.ascending,sortIndex:e+1})}for(const n of e.grid.columns.bottomColumns){const o=n.element;if(o){const a=n.textWrapper&&n.textWrapper.dataset;a&&a.sortIndex&&delete a.sortIndex,s.value=o.classList,!1!==n.sortable?(s.add(e.sortableCls),(r=t[n.field])?(i>1&&a&&(a.sortIndex=r.sortIndex),s.add(e.sortedCls),r.ascending?(s.add(e.sortedAscCls),s.remove(e.sortedDescCls)):(s.add(e.sortedDescCls),s.remove(e.sortedAscCls))):(s.remove(e.sortedCls),s["b-group"]||(s.remove(e.sortedAscCls),s.remove(e.sortedDescCls)))):s.remove(e.sortableCls),DomHelper.syncClassList(o,s)}}}}getHeaderMenuItems(e,t){const r=this;if(!1!==e.sortable&&(t.push({text:r.L("sortAscending"),icon:"b-fw-icon b-icon-sort-asc",name:"sortAsc",cls:"b-separator",weight:105,onItem:({item:{column:e}})=>r.store.sort(e.field,!0)}),t.push({text:r.L("sortDescending"),icon:"b-fw-icon b-icon-sort-desc",name:"sortDesc",weight:105,onItem:({item:{column:e}})=>r.store.sort(e.field,!1)}),r.multiSort&&r.grid.columns.records.filter(e=>e.sortable).length>1)){const n=this.grid.store.sorters.find(t=>t.field===e.field);t.push({text:r.L("multiSort"),icon:"b-fw-icon b-icon-sort",name:"multiSort",weight:105,menu:[{text:n?r.L("toggleSortAscending"):r.L("addSortAscending"),icon:"b-fw-icon b-icon-sort-asc",name:"addSortAsc",disabled:n&&n.ascending,weight:105,onItem:({item:{column:e}})=>r.store.addSorter(e.field,!0)},{text:n?r.L("toggleSortDescending"):r.L("addSortDescending"),icon:"b-fw-icon b-icon-sort-desc",name:"addSortDesc",disabled:n&&!n.ascending,weight:105,onItem:({item:{column:e}})=>r.store.addSorter(e.field,!1)},{text:r.L("removeSorter"),icon:"b-fw-icon b-icon-remove",name:"remove-sorter",weight:105,disabled:!n,onItem:({item:{column:e}})=>r.store.removeSorter(e.field)}]})}return t}getColumnDragToolbarItems(e,t){const r=this,n=r.store;if(!1!==e.sortable){t.push({text:r.L("sortAscendingShort"),group:r.L("Sort"),icon:"b-icon b-icon-sort-asc",name:"sortAsc",cls:"b-separator",weight:105,onDrop:({column:e})=>n.sort(e.field,!0)}),t.push({text:r.L("sortDescendingShort"),group:r.L("Sort"),icon:"b-icon b-icon-sort-desc",name:"sortDesc",weight:105,onDrop:({column:e})=>n.sort(e.field,!1)});const i=n.sorters.find(t=>t.field===e.field);Array.prototype.push.apply(t,[{text:r.L("addSortAscendingShort"),group:r.L("Multisort"),icon:"b-icon b-icon-sort-asc",name:"multisortAddAsc",disabled:i&&i.ascending,weight:105,onDrop:({column:e})=>n.addSorter(e.field,!0)},{text:r.L("addSortDescendingShort"),group:r.L("Multisort"),icon:"b-icon b-icon-sort-desc",name:"multisortAddDesc",disabled:i&&!i.ascending,weight:105,onDrop:({column:e})=>n.addSorter(e.field,!1)},{text:r.L("removeSorterShort"),group:r.L("Multisort"),icon:"b-icon b-icon-remove",name:"multisortRemove",weight:105,disabled:!i,onDrop:({column:e})=>n.removeSorter(e.field)}])}return t}onElementClick(e){const t=this,r=t.store,n=e.target,i=DomHelper.up(n,".b-grid-header.b-sortable"),s=i&&i.dataset.column;if(!t.ignoreRe.test(n.className)&&i&&s){const n=t.grid.columns.getById(i.dataset.columnId);if(r.groupers.find(e=>e.field===s)&&!e.shiftKey)return;if(n.sortable&&!e.shiftKey)if(e.metaKey&&e.altKey)r.removeSorter(n.field);else{let t=n.field;"function"==typeof n.sortable?t={field:n.field,fn:n.sortable}:"object"==typeof n.sortable&&((t=n.sortable).field||(t.field=t.property||n.field)),r.sort(t,null,e.metaKey)}}}renderHeader(){this.syncHeaderSortState()}}Sort.featureClass="b-sort",Sort._$name="Sort",GridFeatureManager.registerFeature(Sort,!0);class RegionResize extends InstancePlugin{construct(e,t){this.grid=e,super.construct(e,t)}doDestroy(){super.doDestroy()}static get pluginConfig(){return{chain:["onElementTouchStart","onElementTouchMove","onElementTouchEnd","onElementMouseDown","onElementMouseMove","onElementDblClick","onElementMouseUp","onSubGridCollapse","onSubGridExpand","render"]}}onElementDblClick(e){const t=this,r=t.grid,n=DomHelper.up(e.target,".b-grid-splitter-collapsed");if(n&&!t.expanding){t.expanding=!0;let e=n.dataset.region,i=r.getSubGrid(e);i.collapsed||(e=r.getLastRegions()[1],i=r.getSubGrid(e)),i.expand().then(()=>t.expanding=!1)}}startMove(e,t){let{grid:r}=this,n=e.dataset.region,i=r.element,s=r.getSubGrid(n),o=r.regions[r.regions.indexOf(n)+1],a=r.getSubGrid(o),l=1;if(null!=s.flex&&null==a.flex&&(s=a,l=-1),e.classList.contains("b-grid-splitter-collapsed"))return;const d=s.element.offsetWidth+a.element.offsetWidth;this.dragContext={element:e,headerEl:s.header.element,subGridEl:s.element,subGrid:s,originalWidth:s.element.offsetWidth,originalX:t,minWidth:s.minWidth||0,maxWidth:Math.min(d,s.maxWidth||d),flip:l},i.classList.add("b-moving-splitter"),e.classList.add("b-moving")}onCollapseClick(e,t){const r=this.grid,n=t.dataset.region,i=r.getLastRegions();if(i[0]===n){const e=r.getSubGrid(i[1]);if(e.collapsed)return void e.expand()}e.collapse()}onExpandClick(e,t){const r=this.grid,n=t.dataset.region,i=r.getLastRegions();if(i[0]!==n||e.collapsed)e.expand();else{r.getSubGrid(i[1]).collapse()}}updateMove(e){const{dragContext:t}=this;if(t){const r=e-t.originalX,n=Math.min(t.maxWidth,t.originalWidth+r*t.flip);t.subGrid.width=Math.max(n,t.minWidth)}}endMove(){const e=this,t=e.dragContext;t&&(e.grid.element.classList.remove("b-moving-splitter"),t.element.classList.remove("b-moving"),e.dragContext=null)}onElementTouchStart(e){const t=this,r=e.target;r.classList.contains("b-grid-splitter")&&(t.startMove(r,e.touches[0].clientX),e.preventDefault())}onElementTouchMove(e){this.dragContext&&(this.updateMove(e.touches[0].clientX),e.preventDefault())}onElementTouchEnd(e){this.dragContext&&(this.endMove(),e.preventDefault())}onElementMouseDown(e){const t=this,r=e.target,n=e.target.closest(".b-grid-splitter"),i=n&&t.grid.getSubGrid(n.dataset.region);0===e.button&&(r.classList.contains("b-grid-splitter")||r.classList.contains("b-grid-splitter-inner")?(t.startMove(n,e.clientX),e.preventDefault()):r.classList.contains("b-icon-collapse-gridregion")?t.onCollapseClick(i,n):r.classList.contains("b-icon-expand-gridregion")&&t.onExpandClick(i,n))}onElementMouseMove(e){this.dragContext&&(this.updateMove(e.clientX),e.preventDefault())}onElementMouseUp(e){this.dragContext&&(this.endMove(),e.preventDefault())}onSubGridCollapse(e){const t=this.grid.resolveSplitter(e);this.grid.getLastRegions()[1]===e.region&&t.classList.add("b-grid-splitter-allow-collapse")}onSubGridExpand(e){this.grid.resolveSplitter(e).classList.remove("b-grid-splitter-allow-collapse")}render(){const{regions:e,subGrids:t}=this.grid;e.length>2&&(t[e[0]].splitterElement.classList.add("b-left-only"),t[e[1]].splitterElement.classList.add("b-right-only"))}}RegionResize.featureClass="b-split",RegionResize._$name="RegionResize",GridFeatureManager.registerFeature(RegionResize);class RowReorder extends(Delayable(InstancePlugin)){construct(e,t){this.grid=e,super.construct(...arguments)}doDestroy(){this.dragHelper&&this.dragHelper.destroy(),super.doDestroy()}init(){const e=this,{grid:t}=e;e.dragHelper=new DragHelper({name:"rowReorder",mode:"translateXY",cloneTarget:!0,dragThreshold:10,targetSelector:".b-grid-row",scrollManager:t.scrollManager,dragWithin:t.verticalScroller,outerElement:t.verticalScroller,createProxy(e){const t=e.cloneNode(!0),r=document.createElement("div");return t.removeAttribute("id"),t.style.transform="",r.appendChild(t),r},listeners:{beforedragstart:e.onBeforeDragStart,dragstart:e.onDragStart,drag:e.onDrag,drop:e.onDrop,reset:e.onReset,thisObj:e}}),e.relayEvents(e.dragHelper,["beforeDragStart","dragStart","drag","drop","abort"],"gridRow")}static get pluginConfig(){return{after:["render"]}}onBeforeDragStart({context:e}){const t=this.grid,r=t.regions[0],n=t.subGrids[r].element;return!(this.disabled||t.readOnly||DomHelper.isTouchEvent||!n.contains(e.element))&&!this.grid.getRecordFromElement(e.element).meta.specialRow}onDragStart({context:e}){const t=this,r=t.grid.getRecordFromElement(e.grabbed);if(!r)throw new Error("Failed to find record for dragged element");t.grid.features.cellEdit&&(t.grid.readOnly=!0,t.grid.features.cellEdit.cancelEditing(!0)),t.grid.element.classList.add("b-row-reordering");const n=e.element.querySelector(".b-focused");n&&n.classList.remove("b-focused"),DomHelper.removeClasses(e.element.firstElementChild,["b-selected","b-hover"]),t.record=r}onDrag({context:e,event:t}){const r=this,{store:n,rowManager:i}=r.grid;if(!r.dragHelper.outerElement.contains(t.target)||!t.target.closest(".b-grid-subgrid"))return void(e.valid=!1);let s,o,a=e.valid,l=(t.isScroll?document.elementFromPoint(t.clientX,t.clientY):t.target).closest(".b-grid-row");if(l){const e=l.getBoundingClientRect().top+l.clientHeight/2;s=Number(l.dataset.index),t.clientY>e&&s++}else s=n.count;(o=i.getRow(Math.min(s,n.count-1)))?(r.shouldInsertBefore=s<n.count,n.tree&&(a=a&&!r.record.contains(n.getById(o.id))),r.targetRow&&r.targetRow.removeCls("b-grid-row-drop-position-before","b-grid-row-drop-position-after"),r.shouldInsertBefore?o.addCls("b-grid-row-drop-position-before"):o.addCls("b-grid-row-drop-position-after"),r.targetRow=o,e.valid=a):e.valid=!1}onDrop({context:e}){const t=this,r=t.grid,n=r.store;e.asyncCleanup=e.async=!0,e.element.classList.add("b-dropping"),t.setTimeout(()=>{if(r.element.classList.remove("b-row-reordering"),e.valid){if(n.tree){const e=n.getById(t.targetRow.id);e.parent.insertChild(t.record,t.shouldInsertBefore?e:void 0)}else n.insert(t.shouldInsertBefore?t.targetRow.dataIndex:n.count,t.record);n.clearSorters(),e.finalize()}},300)}onReset(){const e=this;e.grid.element.classList.remove("b-row-reordering"),e.grid.readOnly=!1,e.targetRow&&e.targetRow.removeCls("b-grid-row-drop-position-before","b-grid-row-drop-position-after"),e.targetRow=null}render(){this.init()}}RowReorder.featureClass="",RowReorder._$name="RowReorder",GridFeatureManager.registerFeature(RowReorder,!0,"Gantt");class Stripe extends InstancePlugin{construct(e,t){this.grid=e,super.construct(e,t),e.rowManager.on({renderrow:this.onRenderRow,thisObj:this})}onRenderRow({row:e}){e.addCls(e.dataIndex%2==0?"b-even":"b-odd")}}Stripe._$name="Stripe",GridFeatureManager.registerFeature(Stripe);class Tree extends(Delayable(InstancePlugin)){static get defaultConfig(){return{expandOnCellClick:!1}}static get pluginConfig(){return{assign:["collapseAll","expandAll","collapse","expand","expandTo","toggleCollapse"],before:["navigateRight","navigateLeft"],chain:["onElementClick","onElementKeyDown"]}}construct(e,t){super.construct(e,t);const r=e.columns.find(e=>e instanceof TreeColumn);Object.assign(this,{grid:e,store:e.store,rowManager:e.rowManager,treeColumn:r})}doDestroy(){super.doDestroy()}async toggleCollapse(e,t,r=!1){const n=this,{store:i,grid:s}=n,o=s.rowManager,a=i.getById(e),l=a.instanceMeta(i);let d=!0,c=o.getRowFor(a);if(!l.isLoadingChildren&&!a.isLeaf&&(void 0===t&&(t=!l.collapsed),Boolean(l.collapsed)!==t)){if(s.trigger("beforeToggleNode",{source:s,record:a,collapse:t}),l.collapsed=t,l.collapsed)i.onNodeCollapse(a);else if(i.onNodeExpand(a),!a.isLoaded){l.isLoadingChildren=!0,c&&c.addCls("b-loading-children");try{await i.loadChildren(a),c=o.getRowFor(a)}catch(e){d=!1,l.collapsed=!0}finally{c&&c.removeCls("b-loading-children"),l.isLoadingChildren=!1}}if(d){if(c){const e=c.getCell(n.treeColumn.id);c.renderCell(e,a)}s.element.classList.add("b-toggling-node"),n.requestAnimationFrame(()=>{s.element.classList.remove("b-toggling-node")}),s.trigger(l.collapsed?"collapseNode":"expandNode",{source:s,record:a}),s.trigger("toggleNode",{source:s,record:a,collapse:t})}}}async collapse(e){return this.toggleCollapse(e,!0)}async expand(e){return this.toggleCollapse(e,!1)}expandOrCollapseAll(e=!0){const{grid:t,store:r}=this,n=[];return t.trigger("beforeToggleAllNodes",{source:t,collapse:e}),r.suspendEvents(),r.traverse(t=>{const i=t.instanceMeta(r);t.isLeaf||(e&&!i.collapsed?n.push(this.toggleCollapse(t,!0,!0)):!e&&i.collapsed&&n.push(this.toggleCollapse(t,!1,!0)))}),r.resumeEvents(),t.refreshRows(!0),t.trigger("toggleAllNodes",{source:t,collapse:e}),Promise.all(n)}async collapseAll(){return this.expandOrCollapseAll(!0)}async expandAll(){return this.expandOrCollapseAll(!1)}async expandTo(e){const t=this,r=t.store.getById(e);if(!1===r.instanceMeta(t.store).hiddenByCollapse)return;let n=!1,i=r.parent,s=[];for(;i&&!i.isRoot;)s.push(i),i=i.parent;await s.reverse().forEach(async e=>{e.instanceMeta(t.store).collapsed&&(n=!0),await t.toggleCollapse(e,!1,!0)}),n&&t.grid.refreshRows(),await t.grid.scrollRowIntoView(r)}onElementClick(e){const t=this,r=e.target,n=t.grid.getEventData(e);(r.classList.contains("b-tree-expander")||t.expandOnCellClick&&n&&n.record.isParent)&&t.toggleCollapse(n.record)}onElementKeyDown(e){e.target===this.client.element&&" "===e.key&&(e.preventDefault(),this.toggleCollapse(this.grid.focusedCell.id))}navigateRight(e){const t=this,r=t.grid,n=r.focusedCell;if(n){const i=r.store.getById(n.id);if(r.columns.getById(n.columnId).tree&&(e.shiftKey||1===r.columns.count))return i.isParent&&i.instanceMeta(r.store).collapsed?t.expand(i):r.navigateDown(e),!1}}navigateLeft(e){const t=this,r=t.grid,n=r.focusedCell;if(n){const i=r.store.getById(n.id);if(r.columns.getById(n.columnId).tree&&(e.shiftKey||1===r.columns.count))return i.isParent&&!i.instanceMeta(r.store).collapsed?t.collapse(i):i.parent&&r.focusCell({id:i.parent.id,columnId:n.columnId}),!1}}}Tree.featureClass="b-tree",Tree._$name="Tree",GridFeatureManager.registerFeature(Tree,!0,"TreeGrid");class ScrollManager extends(Delayable(Base)){static get defaultConfig(){return{zoneWidth:50,scrollSpeed:5,verticalElement:null,direction:"both",monitoring:[]}}startMonitoring(e){const t=this,r=e instanceof HTMLElement?{element:e}:e,n=r.element,i=r.verticalElement||t.verticalElement||n;if(n&&(n.scrollWidth>n.offsetWidth||i.scrollHeight>i.offsetHeight)){if(t.monitoring.find(e=>e.element===n))return;r.direction=r.direction||t.direction,Object.assign(r,{verticalElement:i,scrollManager:t,startScrollLeft:n.scrollLeft,startScrollTop:i.scrollTop,scrollLeft:n.scrollLeft,scrollTop:i.scrollTop,scrollRelativeLeft:0,scrollRelativeTop:0}),t.mouseMoveDetacher=EventHelper.on({mousemove:t.onMouseMove.bind(r),element:n,thisObj:t}),r.scrollWidth=n.scrollWidth,t.monitoring.push(r)}}stopMonitoring(e){const t=this,r=t.monitoring.find(t=>t.element===e);r&&(t.stopScroll(r),t.mouseMoveDetacher&&t.mouseMoveDetacher(),t.monitoring.splice(t.monitoring.indexOf(r),1))}startScroll(e){e.scrolling=!0,this.performScroll(e)}stopScroll(e){e.scrolling=!1,e.scrollRequested&&(this.cancelAnimationFrame(e.frameId),e.scrollRequested=!1)}performScroll(e){if(e.scrolling&&!e.scrollRequested){let t=e.element,r=e.verticalElement;0!==e.scrollDeltaX&&(e.scrollLeft+=e.scrollDeltaX,e.scrollLeft=Math.max(Math.min(e.scrollLeft,e.scrollWidth-t.offsetWidth),0),e.scrollRelativeLeft=e.scrollLeft-e.startScrollLeft,t.scrollLeft=e.scrollLeft),0!==e.scrollDeltaY&&(e.scrollTop+=e.scrollDeltaY,e.scrollTop=Math.max(Math.min(e.scrollTop,r.scrollHeight-r.offsetHeight),0),e.scrollRelativeTop=e.scrollTop-e.startScrollTop,r.scrollTop=e.scrollTop),0===e.scrollRelativeLeft&&0===e.scrollRelativeTop||!e.callback||e.callback.call(e.thisObj||this,e),e.scrollRequested=!0,e.frameId=this.requestAnimationFrame(()=>{e.scrollRequested=!1,this.performScroll(e)})}}onMouseMove(e){const t=this,r=t.scrollManager,n=t.element,i=t.verticalElement,s=n.getBoundingClientRect(),o=i.getBoundingClientRect(),a=r.zoneWidth,l=r.scrollSpeed;t.scrollDeltaX=0,"vertical"!==t.direction&&(e.clientX>s.right-a?t.scrollDeltaX=Math.round((a-(s.right-e.clientX))/l)+1:e.clientX<s.left+a&&(t.scrollDeltaX=-Math.round((a+(s.left-e.clientX))/l)-1)),t.scrollDeltaY=0,"horizontal"!==t.direction&&(e.clientY>o.bottom-a?t.scrollDeltaY=Math.round((a-(o.bottom-e.clientY))/l)+1:e.clientY<o.top+a&&(t.scrollDeltaY=-Math.round((a+(o.top-e.clientY))/l)-1)),0===t.scrollDeltaX&&0===t.scrollDeltaY?r.stopScroll(t):r.startScroll(t)}}ScrollManager._$name="ScrollManager";class Row extends(Delayable(Base)){static get defaultConfig(){return{cls:"b-grid-row"}}construct(e,t){Object.assign(this,{rowManager:e,grid:e.grid,_index:t,_elements:{},_elementsArray:[],_cells:{},_allCells:[],_regions:[],lastHeight:0,lastTop:-1,transitionDuration:500,_dataIndex:0,_top:0,_height:0,_id:null,forceInnerHTML:!1,isGroupFooter:!1}),super.construct()}get index(){return this._index}get dataIndex(){return this._dataIndex}set dataIndex(e){if(this._dataIndex!==e){const t=this._elementsArray;this._dataIndex=e;for(let r=0;r<t.length;r++)t[r].dataset.index=e}}get id(){return this._id}set id(e){const t=this,r={id:e},n=t.rowManager.idMap,i=t._elementsArray,s=t._allCells;if(t._id!=e||n[e]!==t){n[t._id]===t&&delete n[t._id],n[e]=t,t._id=e;for(let e=0;e<i.length;e++)DomDataStore.assign(i[e],r);for(let e=0;e<s.length;e++)DomDataStore.assign(s[e],r)}}addElement(e,t){const r=this;let n=t.firstElementChild;for(r._elements[e]=t,r._elementsArray.push(t),r._regions.push(e),DomDataStore.assign(t,{index:r.index}),r._cells[e]=[];n;)r._cells[e].push(n),r._allCells.push(n),DomDataStore.set(n,{column:n.dataset.column,columnId:n.dataset.columnId,rowElement:n.parentNode,row:r}),n=n.nextElementSibling;t.dataset.index=r.index}getElement(e){return this._elements[e]}eachElement(e){for(let t=0;t<this._elementsArray.length;t++)e(this._elementsArray[t],t)}eachCell(e){this._allCells.forEach(e)}get elements(){return this._elements}get cells(){return this._allCells}getCells(e){return this._cells[e]}getCell(e){return this._allCells.find(t=>{const r=DomDataStore.get(t);return r.columnId===e||r.column===e})}removeElements(e=!1){const t=this;e||t._elementsArray.forEach(e=>e.remove()),t._elements={},t._cells={},t._elementsArray.length=t._regions.length=t._allCells.length=t.lastHeight=t.height=0,t.lastTop=-1}get height(){return this._height}set height(e){this._height=e}get offsetHeight(){return this.height+this.grid._rowBorderHeight}setHeightIfBigger(e){e>this.height&&(this.height=e)}updateElementsHeight(){const e=this;if(e.lastHeight!==e.height){const t=e._elementsArray;for(let r=0;r<t.length;r++)t[r].style.height=`${e.offsetHeight}px`;e.lastHeight=e.height}}addCls(...e){this.eachElement(t=>DomHelper.addClasses(t,e))}removeCls(...e){this.eachElement(t=>DomHelper.removeClasses(t,e))}get isFirst(){return 0===this.dataIndex}get top(){return this._top}get bottom(){return this._top+this._height+this.grid._rowBorderHeight}setTop(e){this._top!==e&&(this._top=e,this.translateElements())}setBottom(e){this.setTop(e-this.offsetHeight)}translateElements(){const e=this,t=e.grid.positionMode;if(e.lastTop!==e.top){const r=e._elementsArray;for(let n=0;n<r.length;n++){const i=r[n].style;"translate"===t?i.transform=`translate(0,${e.top}px)`:"translate3d"===t?i.transform=`translate3d(0,${e.top}px,0)`:"position"===t&&(i.top=`${e.top}px`)}e.rowManager.trigger("translateRow",{row:e}),e.lastTop=e.top}}offset(e){let t=this._top+e;return t<0&&(e-=t,t=0),this.setTop(t),e}render(e,t,r=!0,n=!1){const i=this,s=i._id,o=i._elementsArray,a=i.cells,l=DomDataStore.get(o[0]),d=i.rowManager,c=d._rowHeight,u=i.height,h=r?`${i.cls} b-grid-row-updating`:i.cls;let g,m,p,f=0;t||!1===t||(t=i.grid.store.getById(l.id),e=i.grid.store.indexOf(t));const v=t&&i.grid.isSelected(t.id);for(d.trigger("beforeRenderRow",{row:i,record:t,oldId:s});f<o.length;f++)(g=o[f]).className=h,v&&g.classList.add("b-selected"),t||(l.displayed=!1,g.classList.add("b-grid-row-not-displayed")),t&&(t.cls&&t.cls.split(" ").forEach(e=>g.classList.add(e)),l.displayed=!0);for(r&&i.setTimeout(()=>{o.forEach(e=>{e.classList.remove("b-grid-row-updating")})},i.transitionDuration),i.height=0,t?(i.id=t.id,i.dataIndex=e):(i.id=null,i.dataIndex=null),f=0;f<a.length;f++)m=a[f],p=i.renderCell(m,t,f,r),i.setHeightIfBigger(p&&p.height||c);i.updateElementsHeight(),r&&(u!==i.height&&d.translateFromRow(i,t,n),d.trigger("updateRow",{row:i,record:t,oldId:s})),d.trigger("renderRow",{row:i,record:t,oldId:s}),i.forceInnerHTML=!1}renderCell(e,t,r,n=!0){const i=this,s=DomDataStore.get(e),o=i.grid.columns.getById(s.columnId),a=s.rowElement,l=DomDataStore.get(a),{internalCellCls:d,cellCls:c,align:u,renderer:h,defaultRenderer:g,id:m}=o,p={columnId:m,id:l.id},f=h||g;if(!t){if(null===l.id)return void(e.className="b-grid-cell");if(!(t=i.grid.store.getById(l.id)))return}const v={"b-grid-cell":1,[d]:d,[c]:c,"b-cell-dirty":o.field&&t.meta.modified[o.field],[`b-grid-cell-align-${u}`]:u,"b-selected":i.grid.isSelected(p),"b-focused":i.grid.isFocused(p)};DomHelper.syncClassList(e,v);let y={height:t.get("rowHeight")||0},b=o.getRawValue(t),C=!0,S={cellElement:e,rowElement:a,value:b,record:t,column:o,size:y,grid:i.grid,row:s.row,updatingSingleRow:n};f&&void 0===(b=f.call(o,S))&&(C=!1);const w=S.cellContent=null==b?"":String(b);if(C)if(i.forceInnerHTML)e.innerHTML=w;else if(o.htmlEncode&&!o.disableHtmlEncode)if(BrowserHelper.isLinux)e.innerText=w;else{const t=e.firstChild;t?t.data=w:e.innerText=w}else o.autoSyncHtml&&e.childElementCount?DomHelper.sync(w,e.firstElementChild):e.innerHTML=w;return i.rowManager.trigger("renderCell",S),y}}Row._$name="Row";class RowManager extends InstancePlugin{static get pluginConfig(){return{chain:["getRowById","topRow","bottomRow","getRecordCoords","getRow","getRowFor","getRowFromElement","destroy"],assign:["rowHeight"]}}static get defaultConfig(){return{prependRowBuffer:5,appendRowBuffer:5,rowHeight:null,idMap:{},rowScrollMode:"move",autoHeight:!1,topIndex:0,lastScrollTop:0,_rows:[]}}construct(e){e.grid._rowManager=this,this.scrollTargetRecordId=null,super.construct(e.grid,e)}initWithHeight(e,t=!1){const r=this;return r.autoHeight&&(e=r.store.allCount*r.rowOffsetHeight),r.viewHeight=e,r.calculateRowCount(t),e}reinitialize(e=!1){const t=this,r=t.topRow?t.topRow.top:0;t._rows.length=1,t.scrollTargetRecordId=null,e&&(t.topIndex=0,t.lastScrollTop=0),t.releaseElements(),t.calculateRowCount(!1,!0,!0),!e&&t.topRow&&(t.topRow.dataIndex=t.topIndex,t.topRow.setTop(r)),t.estimateTotalHeight(),t.renderFromRow(t.topRow)}matchRowCount(e=!1){const t=this,r=t._rows,n=r.length,i=n-t.rowCount;if(i)if(i<0){const s=[];for(let e=0;e<-i;e++)s.push(new Row(t,r.length+e));r.push.apply(r,s),t.trigger("addRows",{rows:s}),e||t.renderFromRow(r[Math.max(0,n-1)])}else{const e=r.splice(n-i,i);e.forEach(e=>e.eachElement(e=>e.remove())),t.trigger("removeRows",{rows:e})}}calculateRowCount(e=!1,t=!0,r=!1){const n=this,i=n.store,s=Math.ceil(n.viewHeight/n.rowOffsetHeight),o=s+n.prependRowBuffer+n.appendRowBuffer;return n.grid.columns.count?o<n.rowCount&&!t?n.rowCount:(n.visibleRowCount=s,n.rowCount=Math.min(i.count,o),"all"===n.rowScrollMode&&(n.rowCount=i.allCount),e||(n._rows&&n.rowCount!==n._rows.length?n.matchRowCount(r):n.rowCount||n.trigger("changeTotalHeight",{totalHeight:n.totalHeight}),n.grid.bodyContainer.classList[n.rowCount||i.isLoading?"remove":"add"]("b-grid-empty")),n.rowCount):(n.rowCount=0,0)}releaseElements(){this.forEach(e=>e.removeElements(!0)),this._rows.length=0,this.idMap={}}get store(){return this.client.store}get rows(){return this._rows}getRow(e){return this.rowCount&&this.rows[e-this.topIndex]}getRowById(e){return"string"!=typeof e&&"number"!=typeof e&&(e=e.id),this.idMap[e]}getRowFromElement(e){return(e=e.closest(".b-grid-row"))&&this.getRow(e.dataset.index)}getRowFor(e){return e instanceof HTMLElement?this.getRowFromElement(e):this.getRowById(e)}getNextRow(e){const t="number"==typeof e?e:e.index;return this.getRow((t+1)%this.rowCount)}get topRow(){return this._rows[0]}get bottomRow(){const e=Math.min(this.rowCount,this.store.count);return this.rows[e-1]}offsetRows(e){if(0!==e){const t=this.rows,r=t.length;for(let n=0;n<r;n++)t[n].offset(e)}}get rowHeight(){return this._rowHeight}set rowHeight(e){const t=this,{grid:r}=t,n=t._rowHeight;if(ObjectHelper.assertNumber(e,"rowHeight"),t.trigger("beforeRowHeight",{height:e}),t._rowHeight=e,t.prependBufferHeight=t.prependRowBuffer*t.rowOffsetHeight,t.appendBufferHeight=t.appendRowBuffer*t.rowOffsetHeight,t.rows.length){let i=t.averageRowHeight;const s=i;i-=r._rowBorderHeight,i*=e/n,t.averageRowHeight=i+=r._rowBorderHeight,t.calculateRowCount(!1,!0,!0),t.topRow.setTop(t.topRow.dataIndex*i),t.refresh(),t.ignoreScroll=!0,r.scrollable.y*=i/s}t.trigger("rowHeight",{height:e})}get rowOffsetHeight(){return Math.floor(this.averageRowHeight)||this._rowHeight+this.grid._rowBorderHeight}getRecordCoords(e,t=!1){const r=this,n="string"==typeof e||"number"==typeof e?e:e.id,i=r.getRowById(e);let s=r.client._bodyRectangle;return t||(s=r.client._bodyRectangle=Rectangle.client(r.client.bodyContainer)),i?new Rectangle(s.x,t?Math.round(i.top):Math.round(i.top+s.y-r.client.scrollable.y),s.width,i.offsetHeight):r.getRecordCoordsByIndex(r.store.indexOf(n),t)}getRecordCoordsByIndex(e,t=!1){const r=this,n=r.client._bodyRectangle,i=r.averageRowHeight||r._rowHeight+r.grid._rowBorderHeight,s=r.topRow.dataIndex,o=r.bottomRow.dataIndex,a=e>o?{index:e-o-1,y:r.bottomRow.bottom,from:"bottomRow"}:e>s/2?{index:e-s,y:r.topRow.top,from:"topRow"}:{index:e,y:0,from:"top"},l=Math.floor(a.y+a.index*i),d=new Rectangle(n.x,t?l:l+n.y-r.client.scrollable.y,n.width,i);return d.virtual=!0,d.block=d.bottom<n.y?"start":d.y>n.bottom?"end":"nearest",d}get totalHeight(){return Math.floor(this.store.count*this.rowOffsetHeight)}forEach(e){this.rows.forEach(e)}[Symbol.iterator](){return this.rows[Symbol.iterator]()}returnToTop(){const e=this;e.topIndex=0,e.lastScrollTop=0,e.topRow._top=null,e.topRow.dataIndex=0,e.refresh(),e.grid.scrollable.y=0}renderFromRecord(e){const t=this.getRowById(e.id);t&&this.renderFromRow(t)}renderFromRow(e=null){const t=this,{_rows:r,store:n}=t;if(0===t.calculateRowCount(!1,n.count<r.length,!0))return;let i,s=e?r.indexOf(e):0,o=e&&e.dataIndex||s,a=n.count-o-1,l=Math.min(r.length-1,s+a),d=r.length-l-1,c=s?r[s-1].bottom:e&&e.top||0;for(let e=s;e<=l;e++)(i=r[e]).dataIndex=o,i.setTop(c),i.render(o,n.getAt(o++),!1),c+=i.offsetHeight;for(;d-- >0;)t.displayRecordAtTop();t.averageRowHeight||(t.averageRowHeight=(c-t.topRow.top)/t.rowCount),t.estimateTotalHeight()}translateFromRow(e,t=!1){let r=this,n=e,i=e.index+1,s=e.bottom;for(;n!==r.bottomRow;)(n=r.getRow(i++)).setTop(s),s+=n.offsetHeight;t||r.trigger("changeTotalHeight",{totalHeight:r.totalHeight})}refresh(){const{topRow:e}=this;e&&(this.idMap={},this.renderFromRow(e),this.trigger("refresh"))}jumpToPosition(e,t){const r=this,n=r.rowOffsetHeight,i=r.store.count,s=null==t?Math.floor(e/n)-r.prependRowBuffer:t-Math.floor(r.rowCount/2),o=Math.max(Math.min(s,i-r.rowCount),0),a=r.client.scrollable.y,l=Math.min(r.client._bodyRectangle.height+a+r.appendBufferHeight,r.totalHeight);if(r.lastScrollTop=e,r.topRow.dataIndex=r.topIndex=o,r.topRow.setTop(o*n,!1),r.refresh(),r.bottomRow.bottom<l){for(;r.bottomRow.bottom<l&&r._rows[r.prependRowBuffer].top<a&&r.bottomRow.dataIndex<i-1;)r.displayRecordAtBottom();const e=r.bottomRow.bottom-r.topRow.top;r.averageRowHeight=(r.averageRowHeight*(i-r.rowCount)+e)/i}if(r.estimateTotalHeight(),null!=t){const n=r.getRow(t),i=n&&Rectangle.from(n._elementsArray[0]).center.y,s=r.grid.scrollable.viewport.center.y;n&&(r.grid.scrollable.y=e=Math.floor(r.grid.scrollable.y+(i-s)))}return e}warpIfNeeded(e){const t=this,r={newScrollTop:e,deltaTop:e-t.lastScrollTop};if(Math.abs(r.deltaTop)>t.rowCount*t.rowOffsetHeight*3){let n;t.scrollTargetRecordId&&(n=t.store.indexOf(t.scrollTargetRecordId)),r.newScrollTop=t.jumpToPosition(e,n),r.deltaTop=0}return r}updateRenderedRows(e,t,r){const n=this,i=n.client._bodyRectangle;if(n.ignoreScroll)return n.ignoreScroll=!1,null;if(0===n.rowCount)return 0;let s=n.estimatedTotalHeight;if(t||Math.abs(e-n.lastScrollTop)>n.rowOffsetHeight){const t=n.warpIfNeeded(e);if(n.scrollTargetRecordId=null,n.lastScrollTop=t.newScrollTop,t.deltaTop>0?n.fillBelow(t.newScrollTop):t.deltaTop<0&&n.fillAbove(t.newScrollTop),s=n.estimateTotalHeight(),!r&&(t.deltaTop<0&&e<2*i.height||t.deltaTop>0&&e>n.estimatedTotalHeight-2*i.height-3)){const e=n.topRow.top-n.topIndex*n.rowOffsetHeight;e&&(n.offsetRows(-e),n.grid.scrollable.y=n.lastScrollTop=n.grid.scrollable.y-e)}}return s}fillAbove(e){const t=this,r=e-t.topRow.top-t.prependBufferHeight;let n=0;for(;n>r&&t.topIndex>0;)n-=t.displayRecordAtTop()}fillBelow(e){const t=this,r=e-t.topRow.top-t.prependBufferHeight,n=t.store.count,i=t.rowCount;let s=0;for(;s<r&&t.topIndex+i<n&&t.topRow.top+t.topRow.offsetHeight<e;)s+=t.displayRecordAtBottom()}estimateTotalHeight(){let e=this,t=e.store.count,r=Math.floor(t*(e.averageRowHeight||e.rowOffsetHeight)),{bottomRow:n}=e;if(n){const i=n.bottom;(i>r||e.topIndex+e.rowCount>=t&&r>i)&&(r=i,n.dataIndex<t-1&&(r+=(t-1-n.dataIndex)*e.rowOffsetHeight))}return r!=e.estimatedTotalHeight&&e.trigger("changeTotalHeight",{totalHeight:r}),e.estimatedTotalHeight=r,r}displayRecordAtTop(){const e=this,t=e.topIndex-1,r=e.store.getAt(t),n=e.store.count,i=e.bottomRow,s=i.top;return e.trigger("beforeTranslateRow",{row:i,newRecord:r}),i._top=e.topRow.top-e.rowOffsetHeight,i.estimatedTop=!0,i.render(t,r,!1),i._top=s,i.setBottom(e.topRow.top),i.estimatedTop=!1,e.topIndex--,e._rows.unshift(e._rows.pop()),e.averageRowHeight=(e.averageRowHeight*(n-1)+i.offsetHeight)/n,i.offsetHeight}displayRecordAtBottom(){const e=this,t=e.topIndex+e.rowCount,r=e.store.getAt(t),n=e.store.count,i=e.topRow;return e.trigger("beforeTranslateRow",{row:i,newRecord:r}),i.dataIndex=t,i.setTop(e.bottomRow.bottom),i.render(t,r,!1),e.topIndex++,e._rows.push(e._rows.shift()),e.averageRowHeight=(e.averageRowHeight*(n-1)+i.offsetHeight)/n,i.offsetHeight}}RowManager._$name="RowManager";class Bar extends Widget{static get defaultConfig(){return{scrollable:{}}}construct(e){let t=e.subGrid;t&&(e.grid=t.grid,e.columns=t.columns,t.width?e.width=t.width:t.flex&&(e.flex=t.flex)),super.construct(e)}get columns(){return this._columns}set columns(e){this._columns=e}fixCellWidths(){const e=this;let t,r=!1;e.columns.traverse(n=>{const i=e.getBarCellElement(n.id),s=DomHelper.setLength(n.width),o=DomHelper.setLength(n.minWidth);if(i){if(t=BrowserHelper.isIE11?`calc(${s} - ${e.getLrPadding(i)}px)`:s,r=r||Boolean(n.flex),n.isParent&&null==n.width&&null==n.flex){const e=n.children.reduce((e,t)=>e+=!t.hidden&&t.flex||0,0);i.style.flex=e>0?`${e} 0 auto`:"",e>0&&n.traverse(e=>e.data.minWidth=null)}else if(parseInt(n.minWidth)>=0&&(i.style.minWidth=o),i.style.flex=i.style.flexBasis=i.style.width="",n.flex)!isNaN(parseInt(n.flex))&&n.children?i.style.flex=`${n.flex} 0 auto`:i.style.flex=n.flex;else if(parseInt(n.width)>=0){const r=n.parent;!e.isHeader||r.isRoot||r.width?i.style.flexBasis=t:i.style.width=s}n.height>=0&&(i.style.height=DomHelper.setLength(n.height))}}),e.element.classList[r?"add":"remove"]("b-has-flex")}getLrPadding(e){if(!this.cellLrPadding){const t=e.ownerDocument.defaultView.getComputedStyle(e);this.cellLrPadding=parseInt(t.getPropertyValue("padding-left"))+parseInt(t.getPropertyValue("padding-right"))+parseInt(t.getPropertyValue("border-left-width"))+parseInt(t.getPropertyValue("border-right-width"))}return this.cellLrPadding}getBarCellElement(e){return this.element.querySelector(`[data-column-id="${e}"]`)}}Bar._$name="Bar";class Footer extends Bar{static get defaultConfig(){return{isFooter:!0}}startConfigure(e){e.scrollable.overflowX="hidden-scroll",super.startConfigure(e)}get subGrid(){return this._subGrid}set subGrid(e){this._subGrid=this.owner=e}refreshContent(){this.element.firstElementChild.innerHTML=this.contentTemplate(),this.fixFooterWidths()}render(e){super.render(e),this.refreshContent()}template(){const e=this.subGrid.region;return TemplateHelper.tpl`
            <div class="b-grid-footer-scroller b-grid-footer-scroller-${e}">
                <div reference="footersElement" class="b-grid-footers b-grid-footers-${e}" data-region="${e}"></div>
            </div>
        `}get overflowElement(){return this.footersElement}getFooter(e){return this.getBarCellElement(e)}contentTemplate(){return this.columns.visibleColumns.map(e=>e.hidden?"":TemplateHelper.tpl`
                <div 
                    class="b-grid-footer ${e.align?`b-grid-footer-align-${e.align}`:""} ${e.cls||""}" 
                    data-column="${e.field}" data-column-id="${e.id}" data-all-index="${e.allIndex}"
                    >
                    ${e.footerText||""}
                </div>`).join("")}fixFooterWidths(){this.fixCellWidths()}}Footer._$name="Footer";const xAxis$1={x:1};class GridScroller extends Scroller{addScroller(e){(this.xScrollers||(this.xScrollers=[])).push(e)}addPartner(e,t=xAxis$1){if("string"==typeof t&&(t={[t]:1}),t.x)for(let t=0;t<this.xScrollers.length;t++)this.xScrollers[t].addPartner(e.xScrollers[t],"x");t.y&&super.addPartner(e,"y")}updateOverflowX(e){this.xScrollers&&this.xScrollers.forEach(t=>t.overflowX=e),this.widget.virtualScrollers.classList[e?"remove":"add"]("b-hide-display")}scrollIntoView(e,t){if(1!==e.nodeType)return super.scrollIntoView(e,t);for(const r of this.xScrollers)if(r.element.contains(e))return r.scrollIntoView(e,t)}set x(e){this.xScrollers[0].x=e}get x(){return this.xScrollers[0].x}}GridScroller._$name="GridScroller";class Header extends Bar{static get defaultConfig(){return{isHeader:!0}}startConfigure(e){e.scrollable.overflowX="hidden-scroll",super.startConfigure(e)}get subGrid(){return this._subGrid}set subGrid(e){this._subGrid=e,this.id=e.id+"-header"}get region(){return this.subGrid&&this.subGrid.region}template(){const e=this.region;return TemplateHelper.tpl`
            <div class="b-grid-header-scroller b-grid-header-scroller-${e}">
                <div reference="headersElement" class="b-grid-headers b-grid-headers-${e}" data-region="${e}" data-max-depth="${this.maxDepth}" reference="headersElement"></div>
            </div>
        `}get overflowElement(){return this.headersElement}contentTemplate(e){const t=this;return e.hidden?"":TemplateHelper.tpl`
                <div class="b-grid-header" data-column="${e.field}" data-column-id="${e.id}" ${e.isLeaf?'tabindex="0"':""}>
                    <div class="b-grid-header-text">
                        <div class="b-grid-header-text-content"></div>
                    </div>
                    ${e.children?`\n                    <div class="b-grid-header-children">\n                            ${e.children.map(e=>t.contentTemplate(e)).join("")}\n                    </div>\n                    `:""}
                    <div class="b-grid-header-resize-handle"></div>
                </div>
            `}calculateMinWidthForSafari(){let e=0;return this.columns.visibleColumns.forEach(t=>{e+=t.calculateMinWidth()}),e}fixHeaderWidths(){this.fixCellWidths()}refreshHeaders(){const e=this;e.columns.traverse(t=>{const r=e.getBarCellElement(t.id);if(r){const n=new DomClassList({"b-grid-header":1,"b-grid-header-parent":t.isParent,[`b-level-${t.childLevel}`]:1,[`b-depth-${t.meta.depth}`]:1,[`b-grid-header-align-${t.align}`]:t.align,"b-grid-header-resizable":t.resizable&&t.isLeaf,[t.cls]:t.cls,"b-last-parent":t.isParent&&t.isLastInSubGrid,"b-last-leaf":t.isLeaf&&t.isLastInSubGrid});let i=t.text;r.className=n,t.headerRenderer&&(i=t.headerRenderer.call(t.thisObj||e,{column:t,headerElement:r})),t.icon&&(i=`<i class="${t.icon}"></i>`+(i||""));const s=r.querySelector(".b-grid-header-text-content");s&&(s.innerHTML=i||"")}}),e.fixHeaderWidths()}get columns(){return super.columns}set columns(e){const t=this;t.columnsDetacher&&t.columnsDetacher(),e&&(t.columnsDetacher=e.on({change(){this.initDepths()},thisObj:t})),super.columns=e,t.initDepths()}initDepths(e=this.columns,t=null){let r=this,n=0;t&&t.meta&&t.meta.depth++;for(let i of e)i.meta.depth=0,i.children&&(r.initDepths(i.children,i),i.meta.depth&&t&&(t.meta.depth+=i.meta.depth)),i.meta.depth>n&&(n=i.meta.depth);return t||(this.maxDepth=n),n}getHeader(e){return this.getBarCellElement(e)}get contentElement(){return this.element.firstElementChild}refreshContent(){const e=this;e.content=e.columns.map(t=>e.contentTemplate(t)).join(""),e.refreshHeaders()}render(e){super.render(e),this.refreshContent()}}Header._$name="Header";const domEventHandlers={touchstart:"onElementTouchStart",touchmove:"onElementTouchMove",touchend:"onElementTouchEnd",mouseover:"onElementMouseOver",mouseout:"onElementMouseOut",mousedown:"onElementMouseDown",mousemove:"onElementMouseMove",mouseup:"onElementMouseUp",click:"handleElementClick",dblclick:"onElementDblClick",keydown:"onElementKeyDown",keyup:"onElementKeyUp",keypress:"onElementKeyPress",contextmenu:"onElementContextMenu",focus:"onGridElementFocus"};var GridElementEvents=e=>(class extends(e||Base){static get defaultConfig(){return{longPressTime:400}}initInternalEvents(){const e=Object.keys(domEventHandlers),t=e.length,r={element:this.element,thisObj:this};for(let n=0;n<t;n++)r[e[n]]="handleEvent";EventHelper.on(r)}getEventData(e){const t=this,r=DomHelper.up(e.target,".b-grid-cell");if(r){const e=DomDataStore.get(r),n=e.id,i=e.columnId,s=t.store.getById(n);return s?{cellElement:r,cellData:e,columnId:i,id:n,record:s,cellSelector:{id:n,columnId:i}}:null}}handleEvent(e){this.disabled||(this.event=e,domEventHandlers[e.type]&&this[domEventHandlers[e.type]](e))}onElementTouchStart(e){const t=this;DomHelper.isTouchEvent=!0,1===e.touches.length&&(t.longPressTimeout=setTimeout(()=>{t.onElementLongPress(e),e.preventDefault(),t.longPressPerformed=!0},t.longPressTime))}onElementTouchMove(e){this.longPressTimeout&&(clearTimeout(this.longPressTimeout),this.longPressTimeout=null)}onElementTouchEnd(e){const t=this;t.longPressPerformed&&(e.cancelable&&e.preventDefault(),t.longPressPerformed=!1),t.longPressTimeout&&(clearTimeout(t.longPressTimeout),t.longPressTimeout=null)}onElementLongPress(e){}triggerCellMouseEvent(e,t){const r=this,n=r.getEventData(t);if(n){const i=r.columns.getById(n.columnId);r.trigger("cell"+StringHelper.capitalizeFirstLetter(e),{grid:this,record:n.record,column:i,cellSelector:n.cellSelector,cellElement:n.cellElement,target:t.target,event:t})}}onElementMouseDown(e){const t=this,r=t.getEventData(e);t.skipFocusSelection=!0,t.triggerCellMouseEvent("mousedown",e),e.defaultPrevented||t.onFocusGesture(r,e)}onElementMouseMove(e){}onElementMouseUp(e){}handleElementClick(e){!1!==this.trigger("beforeElementClick",{event:e})&&this.onElementClick(e)}onElementClick(e){const t=this,r=t.getEventData(e);r&&(t.triggerCellMouseEvent("click",e),DomDataStore.get(r.cellElement).row.removeCls("b-hover"))}onFocusGesture(e,t){e&&this.focusCell(e.cellSelector,{doSelect:!0,event:t})}onElementDblClick(e){const t=this,r=e.target;if(t.triggerCellMouseEvent("dblClick",e),r.classList.contains("b-grid-header-resize-handle")){const e=DomHelper.up(r,".b-grid-header");t.columns.getById(e.dataset.columnId).resizeToFitContent()}}onElementMouseOver(e){if(!this.scrolling){const t=DomHelper.up(e.target,".b-grid-cell");if(t){const r=DomDataStore.get(t).row;!r||"number"==typeof e.buttons&&0!==e.buttons||r.addCls("b-hover"),this.triggerCellMouseEvent("mouseOver",e)}this.trigger("mouseOver",{event:e})}}onElementMouseOut(e){const t=this;if(!t.scrolling){const r=DomHelper.up(e.target,".b-grid-cell");if(r){const n=DomDataStore.get(r).row;n&&n.removeCls("b-hover"),t.triggerCellMouseEvent("mouseOut",e)}t.trigger("mouseOut",{event:e})}}onElementKeyDown(e){const t=this;if(!e.handled)if(e.target.matches(".b-grid-header.b-depth-0"))t.handleHeaderKeyDown(e);else if(e.target===this.element||BrowserHelper.isIE11&&e.currentTarget===this.element)t.handleViewKeyDown(e);else if("Escape"===e.key&&t.isActionableLocation){const e=ObjectHelper.clone(t.focusedCell);e.element=null,t.focusCell(e),DomHelper.focusWithoutScrolling(t.element)}}handleViewKeyDown(e){const t=this;switch(e.key){case"ArrowLeft":return e.preventDefault(),t.navigateLeft(e);case"ArrowRight":return e.preventDefault(),t.navigateRight(e);case"ArrowUp":return e.preventDefault(),t.navigateUp(e);case"ArrowDown":return e.preventDefault(),t.navigateDown(e)}}handleHeaderKeyDown(e){const t=this,r=t.columns.getById(e.target.dataset.columnId);switch(r.onKeyDown&&r.onKeyDown(e),e.key){case"ArrowLeft":const n=t.columns.getAdjacentVisibleLeafColumn(r,!1);if(n){t.getHeaderElement(n.id).focus()}break;case"ArrowRight":const i=t.columns.getAdjacentVisibleLeafColumn(r,!0);if(i){t.getHeaderElement(i.id).focus()}break;case"ArrowDown":t.onElementContextMenu(e);break;case"Enter":t.getHeaderElement(r.id).click()}}onElementKeyPress(e){}onElementKeyUp(e){}onElementContextMenu(e){const t=this,r=t.getEventData(e);r&&(t.triggerCellMouseEvent("contextMenu",e),DomHelper.isTouchEvent&&t.onFocusGesture(r,e))}onInternalResize(e,t,r,n,i){const s=this;s._devicePixelRatio&&s._devicePixelRatio!==window.devicePixelRatio&&DomHelper.resetScrollBarWidth(),s._devicePixelRatio=window.devicePixelRatio,s._bodyRectangle=Rectangle.client(s.bodyContainer),super.onInternalResize(...arguments),r!==i&&(s._bodyHeight=s.bodyContainer.offsetHeight,s.rendered&&s.rowManager.initWithHeight(s._bodyHeight)),s.refreshVirtualScrollbars(),t!==n&&s.setTimeout(()=>{s.isDestroyed||s.updateResponsive(t,n)},0)}get widgetClass(){}});let validConfigTypes={string:1,object:1,function:1};var GridFeatures=e=>(class extends(e||Base){isOfType(e){let t=this.constructor;for("string"==typeof e&&(e=[e]);t;){if(e.includes(t.$name))return!0;t=Object.getPrototypeOf(t)}return!1}set features(e){const t=this,r=GridFeatureManager.defaultFeatures;if(e=t._features=ObjectHelper.assign({},e),t.initTouch(),r&&r.forEach(({featureClass:r,forType:n})=>{const i=StringHelper.lowercaseFirstLetter(r.$name);n&&!t.isOfType(n)||i in e||(e[i]=!0)}),e){let r,n,i;for(r of Object.keys(e))if(n=e[r]){if(StringHelper.lowercaseFirstLetter(r)!==r)throw new Error(t.L("invalidFeatureNameFormat",r));if(!(i=GridFeatureManager.featureTypes[StringHelper.capitalizeFirstLetter(r)]))throw new Error(t.L("featureNotFound",r));Reflect.defineProperty(e,r,t.createFeatureInitializer(e,r,i,n))}}}get features(){return this._features}createFeatureInitializer(e,t,r,n){const i=[this],s=r.prototype.construct;return validConfigTypes[typeof n]&&(i[1]=n),{configurable:!0,get:()=>(delete e[t],r.prototype.construct=function(...n){e[t]=this,s.apply(this,n),r.prototype.construct=s},new r(...i))}}initTouch(){const e=this;BrowserHelper.isTouchDevice&&(e.touch=!0,e.columns.forEach(e=>{const t=e.touchConfig;t&&e.applyState(t)}))}hasFeature(e){return!!(this.features&&e in this.features)}get widgetClass(){}});const defaultFocusOptions=Object.freeze({doSelect:!0});var GridNavigation=e=>(class extends(e||Base){get focusedCell(){return this._focusedCell}get isActionableLocation(){const e=this._focusedCell;return Boolean(e&&e.element&&this.getCell(e).contains(e.element))}set focusedCell(e){this.focusCell(e,{doSelect:!1})}get focusedRecord(){if(this._focusedCell)return this.store.getById(this._focusedCell.id)}get cellCSSSelector(){const e=this._focusedCell,t=e&&this.getRowById(e.id);return e&&t?`[data-index=${t.index}] [data-column-id=${e.columnId}]`:""}onGridElementFocus(e){const t=this,r={doSelect:!1,event:e};if(t._focusedCell)t.focusCell(t._focusedCell,r);else{const n=t.element.contains(e.relatedTarget)?null:t.lastFocusedCell;if(n){if(!t.store.getById(n.id))return void t.revertFocus();t.returningFocus=!0,t.focusCell(n,r),t.returningFocus=!1}else!t.skipFocusSelection&&t.store.first&&t.focusCell({id:t.store.first.id,columnId:t.columns.visibleColumns[0].id},r)}t.skipFocusSelection=!1}onFocusOut(e){super.onFocusOut(e),this.clearFocus()}isFocused(e){return Boolean(this._focusedCell)&&this.isLocationEqual(e,this._focusedCell)}focusCell(e,t=defaultFocusOptions){const r=this,n=!1!==t.doSelect,{event:i}=t,s=r.lastFocusedCell=r._focusedCell,o=s&&r.getCell(s);e=r.normalizeCellContext(e);let a=r.getCell(e);if(i&&"mousedown"===i.type)for(let t=i.target;t!==a;t=t.parentElement)if(DomHelper.isFocusable(t))return void(e.element=t);return r.isLocationEqual(e,s)?(i&&r.onCellNavigate&&r.onCellNavigate(r,null,r._focusedCell,i,n),e):(o&&o.classList.remove("b-focused"),r.scrollRowIntoView(e.id,Object.assign({column:e.columnId},t)),(a=r.getCell(e))&&(e.element=a,a.classList.add("b-focused")),r._focusedCell=e,r.onCellNavigate&&r.onCellNavigate(r,s,r._focusedCell,i,n),r.trigger("navigate",{lastFocusedCell:s,focusedCell:r._focusedCell,event:i}),e)}isLocationEqual(e,t){return e&&t&&e.id===t.id&&e.columnId===t.columnId&&(!e.element||!t.element||e.element===t.element)}blurCell(e){const t=this.getCell(e);t&&t.classList.remove("b-focused")}clearFocus(){const e=this;e._focusedCell&&(e.lastFocusedCell=e._focusedCell,e.blurCell(e._focusedCell),e._focusedCell=null)}internalNextPrevCell(e=!0,t){let r=this,n=r._focusedCell;return n?r.focusCell({id:n.id,columnId:r.columns.getAdjacentVisibleLeafColumn(n.columnId,e,!0).id},{doSelect:!0,event:t}):null}navigateRight(e){return this.internalNextPrevCell(!0,e)}navigateLeft(e){return this.internalNextPrevCell(!1,e)}internalNextPrevRow(e,t=!0,r){const n=this,i=n._focusedCell;if(!i)return!1;const s=n.store[`get${e?"Next":"Prev"}`](i.id,!1,t);return!!s&&n.focusCell({id:s.id,columnId:n._focusedCell&&n._focusedCell.columnId},{doSelect:!0,event:r})}navigateDown(e){return this.internalNextPrevRow(!0,!1,e)}navigateUp(e){return this.internalNextPrevRow(!1,!1,e)}get widgetClass(){}}),GridResponsive=e=>(class extends(e||Base){static get defaultConfig(){return{responsiveLevels:Object.freeze({small:400,medium:600,large:"*"})}}getClosestBiggerLevel(e){let t=this,r=null,n=99995,i=null;return Object.keys(t.responsiveLevels).forEach(s=>{let o=t.responsiveLevels[s];if(["number","string"].includes(typeof o)||(o=o.levelWidth),"*"===o)i=s;else if(e<o){const t=o-e;t<n&&(n=t,r=s)}}),r||i}get responsiveLevel(){return this.getClosestBiggerLevel(this.width)}updateResponsive(e,t){const r=this,n=r.getClosestBiggerLevel(t),i=r.getClosestBiggerLevel(e);if(n!==i){const s=r.responsiveLevels[i];["number","string"].includes(typeof s)||r.applyState(s),r.columns.forEach(e=>{const t=e.responsiveLevels;t&&(t[i]?e.applyState(t[i]):t["*"]&&e.applyState(t["*"]))}),r.element.classList.remove("b-responsive-"+n),r.element.classList.add("b-responsive-"+i),r.trigger("responsive",{level:i,width:e,oldLevel:n,oldWidth:t})}}get widgetClass(){}});const validIdTypes={string:1,number:1};var GridSelection=e=>(class extends(e||Base){static get defaultConfig(){return{recordCollection:{}}}afterConfigure(){const e=this;if(e.selectionMode.checkbox){const t=e.checkboxColumn=new CheckColumn({id:`${e.id}-selection-column`,width:"4em",field:null});t.meta.depth=0,t._grid=e;const r=t.renderer;t.renderer=(n=>{n.value=e.isSelected(n.record),r.call(t,n)}),t.on({toggle:"onCheckChange",thisObj:e});const n=e.columns.indexOf(e.columns.findRecord("type","rownumber"))+1;e.columns.insert(n,t)}super.afterConfigure()}onRecordCollectionChange({source:e,action:t,added:r=[],removed:n}){const i=this;i._selectedCell&&!i.isSelectable(i._selectedCell)&&i.deselectCell(i._selectedCell),r=r.filter(e=>i.isSelectable(e)),i.triggerChangeEvent({mode:"row",action:r.length?"select":"deselect",selection:i.selectedRecords,selected:r,deselected:n},i.silent)}onCheckChange({checked:e,record:t}){e?this.selectRow(t,!1,!0):this.deselectRow(t)}onElementKeyDown(e){const t=this,{focusedCell:r,checkboxColumn:n}=t;if(super.onElementKeyDown(e),r&&" "===e.key&&n&&t.columns.getById(r.columnId)===n){const e=t.getCell(r).widget;e&&e.toggle()}}set recordCollection(e){e instanceof Collection||(e=new Collection(e)),this._recordCollection=e,e.on({change:"onRecordCollectionChange",thisObj:this})}get recordCollection(){return this._recordCollection}spliceSelectedRecords(e,t,r){this._recordCollection.splice(e,t,r)}isSelected(e){const t=this;return e instanceof Model&&(e=e.id),validIdTypes[typeof e]?t.recordCollection.includes(e):t._selectedCell&&t._selectedCell.id==e.id&&t._selectedCell.columnId===e.columnId}isSelectable(e){if(!e)return!1;const t=this.store.getById(e.id||e);return t&&!(t.meta&&t.meta.specialRow)}get selectedCell(){return this._selectedCell}set selectedCell(e){this.selectCell(e)}get selectedRecord(){return this.recordCollection.last||null}set selectedRecord(e){this.selectRow(e)}get selectedRecords(){return this.recordCollection.values}set selectedRecords(e){const{recordCollection:t,store:r}=this,n=[];if(e&&e.length)for(let t of e)(t=r.getById(t))&&n.push(t);t.splice(0,t.count,n)}get selectedCellCSSSelector(){const e=this._selectedCell,t=e&&this.getRowById(e.id);return e&&t?`[data-index=${t.dataIndex}] [data-column-id=${e.columnId}]`:""}selectRow(e,t=!0,r=!1){const n=this,i=n.store.getById(e);i?n.selectCell({id:i.id},t,r):n.deselectAll()}selectCell(e,t=!1,r=!1,n=!1){const i=this,{recordCollection:s,selectionMode:o}=i,a=i.normalizeCellContext(e),l=a.record||i.store.getById(a.id);if(i.isSelectable(l)){if(t&&i.scrollRowIntoView(a.id,{column:a.columnId}),o.row&&(n&&(i.silent=(i.silent||0)+1),r?s.add(l):s.splice(0,s.count,l),n&&i.silent--,1===i.recordCollection.count&&(i.startCell=a,i.lastRange=null)),o.cell&&(a.columnId||a.column)&&!i.isSelected(a)){let e=i._selectedCell?[i._selectedCell]:[];i._selectedCell=a,i.triggerChangeEvent({mode:"cell",action:"select",selected:[a],deselected:e,selection:[a]},n)}return a}this.deselectAll()}deselectAll(){const e=this;e.recordCollection.clear(),e._selectedCell&&e.deselectCell(e._selectedCell)}deselectRow(e){const t=e instanceof Model?e:this.store.getById(e);t&&this.recordCollection.remove(t)}deselectCell(e){const t=this,r=t.normalizeCellContext(e),n=t.selectionMode,i=r.record||t.store.getById(r.id),s=t._selectedCell;return n.row&&t.recordCollection.remove(i),n.cell&&r.columnId&&s&&s.id===r.id&&s.columnId===r.columnId&&(t._selectedCell=null,t.triggerChangeEvent({mode:"cell",action:"deselect",selected:[],deselected:[r],selection:[]})),r}selectRange(e,t){const{store:r,recordCollection:n}=this,i=r.indexOf(e),s=r.indexOf(t),o=Math.min(i,s),a=Math.max(i,s);if(-1===o||-1===a)throw new Error("Record not found in selectRange");n.splice(0,n.count,r.getRange(o,a+1,!1))}onStoreRemove(e){super.onStoreRemove&&super.onStoreRemove(e),this.recordCollection.remove(e.records)}onStoreDataChange({action:e,source:t}){if(super.onStoreDataChange&&super.onStoreDataChange(...arguments),["dataset","batch"].includes(e)){const e=this.recordCollection,r=[];e.forEach(e=>{t.includes(e)||r.push(e)}),e.remove(r)}}onStoreRemoveAll(){super.onStoreRemoveAll&&super.onStoreRemoveAll(),this.deselectAll()}handleMouseMultiSelect(e,t){const r=this,n=e.id;(t.metaKey||t.ctrlKey)&&r.isSelected(n)?r.deselectRow(n):r.selectionMode.multiSelect&&(t.shiftKey&&r.startCell?function(e,t){const{store:n,recordCollection:i}=r,s=n.indexOf(e),o=n.indexOf(t),a=Math.min(s,o),l=Math.max(s,o);if(-1===a||-1===l)throw new Error("Record not found in selectRange");const d=n.getRange(a,l+1,!1).filter(e=>r.isSelectable(e));i.splice(0,r.lastRange||0,d),r.lastRange=d}(r.startCell.id,n):(t.ctrlKey||t.metaKey)&&r.selectRow(n,!1,!0))}onCellNavigate(e,t,r,n,i=!0){if(e.columns.getById(r.columnId)===e.checkboxColumn)return;if(!i||e.returningFocus||n&&n.target.classList.contains("b-tree-expander"))return;const s=t&&r.id===t.id,o=n&&"mousedown"===n.type&&n.ctrlKey;!n||n.button&&2!==n.button||!n.shiftKey&&!o?e.selectCell(r,!1,s&&(!n||n.shiftKey||n.ctrlKey)||n&&(o||2===n.button&&e.isSelected(r.id))):e.handleMouseMultiSelect(r,n),e.startCell&&!o||(e.startCell=r,e.lastRange=null)}triggerChangeEvent(e,t){const r=this,{mode:n,selected:i,deselected:s}=e;let o,a,l,d;if("row"===n){for(o=0,a=i.length;o<a;o++)(l=r.getRowFor(i[o]))&&(l.addCls("b-selected"),r.checkboxColumn&&!i[o].meta.specialRow&&(l.getCell(r.checkboxColumn.id).widget.checked=!0));for(o=0,a=s.length;o<a;o++)(l=r.getRowFor(s[o]))&&(l.removeCls("b-selected"),r.checkboxColumn&&!s[o].meta.specialRow&&(l.getCell(r.checkboxColumn.id).widget.checked=!1))}else if("cell"===n){for(o=0,a=i.length;o<a;o++)(d=r.getCell(i[o]))&&d.classList.add("b-selected");for(o=0,a=s.length;o<a;o++)(d=r.getCell(s[o]))&&d.classList.remove("b-selected")}t||r.trigger("selectionChange",e)}get widgetClass(){}}),GridState=e=>(class extends(e||Base){getState(){const e=this,t=e.element.style.cssText,r={rowHeight:e.rowHeight,readOnly:e.readOnly};if(t&&(r.style=t),e.selectedCell){const{id:t,columnId:n}=e.selectedCell;r.selectedCell={id:t,columnId:n}}return r.selectedRecords=e.selectedRecords.map(e=>e.id),r.columns=e.columns.map(e=>e.getState()),r.store=e.store.state,r.scroll=e.storeScroll(),r.width={},r.collapsed={},e.eachSubGrid(e=>{null==e.flex&&(r.width[e.region]=e.width),r.collapsed[e.region]=e.collapsed}),r}applyState(e){const t=this;"readOnly"in e&&(t.readOnly=e.readOnly),"rowHeight"in e&&(t.rowHeight=e.rowHeight),"style"in e&&(t.style=e.style),"selectedCell"in e&&(t.selectedCell=e.selectedCell),"store"in e&&(t.store.state=e.store),"selectedRecords"in e&&(t.selectedRecords=e.selectedRecords),"columns"in e&&(e.columns.forEach(e=>{const r=t.columns.getById(e.id);r&&(r.applyState(e),r.stateSortIndex=e.index)}),t.eachSubGrid(e=>{e.columns.records.sort((e,t)=>e.stateSortIndex-t.stateSortIndex),e.columns.allRecords.sort((e,t)=>e.stateSortIndex-t.stateSortIndex)}),t.columns.sort({fn:(e,t)=>e.stateSortIndex-t.stateSortIndex},!0),t.rendered?t.renderContents():t.render()),"width"in e&&t.eachSubGrid(t=>{t.region in e.width&&(t.width=e.width[t.region])}),"collapsed"in e&&t.eachSubGrid(t=>{t.collapsed=e.collapsed[t.region]}),"scroll"in e&&t.restoreScroll(e.scroll)}get widgetClass(){}});const immediatePromise$3=new Promise(e=>e()),defaultScrollOptions$1={block:"nearest"};class SubGridScroller extends Scroller{scrollIntoView(e,t=defaultScrollOptions$1){const{xDelta:r,yDelta:n}=this.getDeltaTo(e,t),i=r||n?this.scrollBy(r,n,t):immediatePromise$3;return(t.highlight||t.focus)&&i.then(()=>{t.highlight&&(e instanceof Rectangle?e.translate(-r,-n).highlight():DomHelper.highlight(e)),t.focus&&e.focus&&e.focus()}),i}scrollBy(e,t,r){const n=t&&this.yScroller.scrollBy(0,t,r),i=e&&super.scrollBy(e,0,r);if(i&&i.cancel&&n&&n.cancel){const e=i.cancel,t=n.cancel;return i.cancel=n.cancel=(()=>{e(),t()}),Promise.all([i,n])}return i||n}scrollTo(e,t,r){const n=null!=t&&this.yScroller.scrollTo(null,t,r),i=null!=e&&super.scrollTo(e,null,r);if(i&&i.cancel&&n&&n.cancel){const e=i.cancel,t=n.cancel;return i.cancel=n.cancel=(()=>{e(),t()}),Promise.all([i,n])}return i||n}get viewport(){return Rectangle.from(this.element).intersect(Rectangle.from(this.yScroller.element))}set y(e){this.yScroller.y=e}get y(){return this.yScroller?this.yScroller.y:0}}SubGridScroller._$name="SubGridScroller";class SubGrid extends Widget{static get defaultConfig(){return{insertRowsBefore:null,appendTo:null,hideHeaders:null,monitorResize:!0,collapsedStateWidth:5,splitterWidth:1,collapsed:null,scrollable:{overflowX:!0},scrollerClass:SubGridScroller,hasCalculatedWidth:null,sealedColumns:null}}construct(e){super.construct(e),this.initHeader(),this.rowManager.on("addrows",this.onAddRow,this)}doDestroy(){const e=this;e.header&&e.header.destroy(),e.footer&&e.footer.destroy(),e.fakeScroller&&e.fakeScroller.destroy(),e.virtualScrollerElement&&e.virtualScrollerElement.remove(),e.splitterElement&&e.splitterElement.remove(),super.doDestroy()}initHeader(){const e=this,t=Object.assign({subGrid:e,columns:e.columns,hidden:e.hideHeaders,parent:e},e.headerConfig);e.header=new e.headerClass(t)}initElements(){this.footerElement=DomHelper.down(this.grid.element,".b-grid-footer-scroller-"+this.region),this.updateHasFlex()}template(){const{grid:e,region:t}=this,r=!e||t===e.regions[e.regions.length-1],n=`b-grid-splitter${BrowserHelper.isIE11?" b-grid-splitter-transform":""}`;return TemplateHelper.tpl`
            <div class="b-grid-subgrid b-grid-subgrid-${t} b-grid-horizontal-scroller" data-region="${t}">
                <div reference="virtualScrollerElement" class="b-virtual-scroller" data-region="${t}">
                    <div reference="virtualScrollerWidth" class="b-virtual-width"></div>
                </div>
                ${r?"":TemplateHelper.tpl`
                <div reference="splitterElement" data-region="${t}" class="${n}">
                    <div class="b-grid-splitter-inner"></div>
                    <i class="b-icon b-icon-collapse-gridregion"></i>
                    <i class="b-icon b-icon-expand-gridregion"></i>
                </div>`}
            </div>
        `}rowTemplate(){const e=this;return TemplateHelper.tpl`
            <div class="b-grid-row">
                ${e.columns.bottomColumns.map(t=>t.hidden?"":e.cellTemplate(t))}
            </div>
        `}cellTemplate(e){return`<div class="b-grid-cell" data-column="${e.field}" data-column-id="${e.id}"></div>`}onPaint(){const e=this;if(!e.rendered){const{grid:t}=e,r=t&&t.resolveSplitter(e);t&&(t.virtualScrollers.appendChild(e.virtualScrollerElement),e.splitterElement&&t.element.appendChild(e.splitterElement),e.renderHeader(t.headerContainer),e.renderFooter(t.footerContainer),e.initElements()),e.syncSplitter(!0),e.splitterWidth=r&&r.offsetWidth||1,e._collapsed&&e.collapse(),e.rendered=!0}}renderHeader(e){this.header&&this.header.render(e)}renderFooter(e){this.footer&&(this.footer.render(e),this.grid.footerContainer.classList.remove("b-hidden"))}refreshHeader(){this.header.refreshContent()}refreshFooter(){this.footer&&this.footer.refreshContent()}fixCellWidths(e,t=null){t||(t=this.columns.bottomColumns.filter(e=>!e.hidden));let r=e.firstElementChild,n=0;for(;r;){const e=t[n];e.minWidth&&DomHelper.setLength(r,"minWidth",e.minWidth),e.flex?(r.style.flex=e.flex,r.style.width=""):e.width?(r.style.flex="",r.style.width=DomHelper.setLength(e.width),BrowserHelper.isIE11&&(r.style.minWidth=r.style.width)):r.style.flex=r.style.width=r.style.minWidth="",r=r.nextElementSibling,n++}}get totalFixedWidth(){return this.columns.totalFixedWidth}fixWidths(){const e=this,{element:t,header:r,footer:n}=e;if(e.flex)r.flex=e.flex,n&&(n.flex=e.flex),t.style.flex=e.flex;else{if(e.hasCalculatedWidth&&!e.columns.some(e=>!e.hidden&&e.flex)&&e.totalFixedWidth!==e.width)return e.width=e.totalFixedWidth,void(e.hasCalculatedWidth=!0);let i=e.width;if(!i){i=0;for(let t of e.columns)t.flex||t.hidden||(i+=t.width)}t.style.width=`${i}px`,r.width=i,n&&(n.width=i)}e.syncScrollingPartners(!1)}fixRowWidthsInSafariEdge(){if(BrowserHelper.isSafari||BrowserHelper.isEdge){const e=this,{region:t,header:r}=e,n=r.calculateMinWidthForSafari();e.rowManager.forEach(e=>{const r=e.getElement(t);r&&(r.style.width=`${n}px`)}),r.headersElement.style.width=`${n}px`}}set width(e){const t=this;t.hasCalculatedWidth=!1,t.header&&(t.header.width=e),t.footer&&(t.footer.width=e),super.width=e,t.isConfiguring||t.onElementResize()}get width(){return super.width}set flex(e){const t=this;t.hasCalculatedWidth=!1,t.header&&(t.header.flex=e),t.footer&&(t.footer.flex=e),super.flex=e,t.isConfiguring||t.onElementResize()}get flex(){return super.flex}onInternalResize(e,t,r,n,i){const s=this,{grid:o}=s;super.onInternalResize(e,t,r,n,i),o&&t!==n&&(o.trigger("horizontalScroll",{subGrid:s,grid:o,scrollLeft:s.scrollable.x}),s.refreshFakeScroll(),o.rendered&&o.eachSubGrid(e=>e.syncSplitter()),s.fixRowWidthsInSafariEdge(),s.trigger("afterInternalResize",s))}syncSplitter(e=!1){const{element:t,splitterElement:r}=this;r&&(r.style.left=`${t.offsetLeft+(this.collapsed&&!e?0:t.offsetWidth)}px`)}get viewRectangle(){return new Rectangle(this.scrollable.x,this.scrollable.y,this._width,this.rowManager.viewHeight)}updateHasFlex(){const e=this.columns.visibleColumns.some(e=>e.flex);DomHelper.toggleClasses(this.element,["b-has-flex"],e)}refreshFakeScroll(){const e=this,{element:t,virtualScrollerElement:r,virtualScrollerWidth:n}=e,i=e.scrollable;i.scrollWidth=e.store.count?null:e.totalFixedWidth,r.style.width=`${t.offsetWidth}px`,e.totalFixedWidth>i.clientWidth?t.classList.add("b-overflowing-horizontally"):t.classList.remove("b-overflowing-horizontally"),i.scrollWidth>i.clientWidth+(BrowserHelper.isEdge?1:0)?(n.style.width=`${i.scrollWidth}px`,e.header.element.classList.add("b-overflowing"),e.footer&&e.footer.element.classList.add("b-overflowing"),e.overflowingHorizontally=!0,e.grid.virtualScrollers.classList.remove("b-hide-display")):(n.style.width=0,e.header.element.classList.remove("b-overflowing"),e.footer&&e.footer.element.classList.remove("b-overflowing"),e.overflowingHorizontally=!1)}initScroll(){const e=this,t=e.scrollable,r=e.virtualScrollerElement;BrowserHelper.isFirefox&&t.element.addEventListener("wheel",e=>{e.deltaX&&(t.x+=e.deltaX,e.preventDefault())}),t.yScroller=e.grid.scrollable,t.yScroller.addScroller(t),e.fakeScroller=new Scroller({element:r,overflowX:!0}),t.on("scroll",e.createOnFrame(e.syncScrollingPartners)),t.on("scrollend",()=>e.scrolling=!1),t.addPartner(e.fakeScroller,"x"),e.header&&t.addPartner(e.header.scrollable,"x"),e.footer&&t.addPartner(e.footer.scrollable,"x")}set scrolling(e){this._scrolling=e,this.grid.bodyContainer.classList[e?"add":"remove"]("b-scrolling")}get scrolling(){return this._scrolling}syncScrollingPartners(e=!0){const t=this,{grid:r}=t,n=t.scrollable.x;!t.scrolling&&e&&(t.scrolling=!0),r.trigger("horizontalScroll",{subGrid:t,grid:r,scrollLeft:n})}scrollColumnIntoView(e,t){let r,n=this,i="string"==typeof e?n.columns.get(e)||n.columns.getById(e):e,s=n.scrollable,o=n.header.getHeader(i.id),a=s.clientWidth,l=DomHelper.getOffsetX(o,n.header.element)+s.x,d=l+o.offsetWidth;return s.x+a<d?r=d-(s.x+a):s.x>l&&(r=l-s.x),s.scrollBy(r,0,t)}onAddRow({rows:e}){const t=this,r=t.rowTemplate(),n=t.columns.bottomColumns.filter(e=>!e.hidden);e.forEach(e=>{DomHelper.createElementFromTemplate(r,{array:!0}).forEach(r=>{t.insertRowsBefore?t.element.insertBefore(r,t.insertRowsBefore):t.element.appendChild(r),e.addElement(t.region,r),t.fixCellWidths(r,n)})}),t.fixRowWidthsInSafariEdge()}get rowElements(){return this.fromCache(".b-grid-row",!0)}clearRows(){this.emptyCache();const e=this.element.querySelectorAll(".b-grid-row"),t=document.createRange();e.length&&(t.setStartBefore(e[0]),t.setEndAfter(e[e.length-1]),t.deleteContents())}addNewRowElement(){const e=this,t=e.columns.bottomColumns,r=DomHelper.append(e.element,{tag:"div",className:"b-grid-row",html:t.reduce((t,r)=>t+e.cellTemplate(r),"")});return e.fixCellWidths(r),r}toggleTransitionClasses(e=!1){const t=this.grid,r=t.getSubGrid(t.getNextRegion(this.region)),n=t.resolveSplitter(r);r.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),r.header.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),this.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),this.header.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),n.classList[e?"remove":"add"]("b-grid-splitter-animate")}get collapsed(){return this._collapsed}set collapsed(e){this.isConfiguring?this._collapsed=e:e?this.collapse():this.expand()}async collapse(){const e=this,t=e.collapsedStateWidth,r=e.grid,n=r.getSubGrid(r.getNextRegion(e.region));let i=0;return r.eachSubGrid(t=>{t!==e&&!t._collapsed&&++i}),0===i&&await n.expand(),new Promise(i=>{if(!e._beforeCollapseState){e._beforeCollapseState={};let s=!1;e.width!==t&&(s=!0,e.on({afterinternalresize:()=>{i(e)},thisObj:e,once:!0})),e._beforeCollapseState.width=e.width,e._beforeCollapseState.splitterLeft=r.resolveSplitter(e).offsetLeft,""===n.element.style.flex&&(e._beforeCollapseState.nextRegionWidth=n.width,n.width+=e._beforeCollapseState.width),""!==e.element.style.flex&&(e._beforeCollapseState.style=e.element.style.flex,e.header.element.style.flex=e.element.style.flex=""),e.element.classList.add("b-grid-subgrid-collapsed"),e._collapsed=!0,s?(e.width=t,r.resolveSplitter(e).style.left=e.element.offsetLeft):i(!1)}}).then(t=>{!1!==t&&e.grid.trigger("subGridCollapse",e)})}async expand(){const e=this,t=e.grid,r=t.getSubGrid(t.getNextRegion(e.region));return new Promise(n=>{if(null!=e._beforeCollapseState){let i=!1;e.width!==e._beforeCollapseState.width&&(i=!0,e.on({afterinternalresize:()=>{setTimeout(()=>n(e),10)},thisObj:e,once:!0})),""===r.element.style.flex&&(r.width=e._beforeCollapseState.nextRegionWidth),e.element.classList.remove("b-grid-subgrid-collapsed"),e._collapsed=!1,e.width=e._beforeCollapseState.width,e._beforeCollapseState.style&&(e.header.element.style.flex=e.element.style.flex=e._beforeCollapseState.style,e.header.element.style.width=e.element.style.width="",e._width=null),t.resolveSplitter(e).style.left=`${e._beforeCollapseState.splitterLeft}px`,e.element.classList.remove("b-grid-subgrid-collapsed"),e._collapsed=!1,i||n(!1),delete e._beforeCollapseState}}).then(t=>{!1!==t&&e.grid.trigger("subGridExpand",e)})}}SubGrid._$name="SubGrid";var GridSubGrids=e=>(class extends(e||Base){initSubGrids(){const e=this,t=e._regions,r=new Set;let n,i,s,o=!0;for(const t of e.columns.records)t.region&&!e.subGridConfigs[t.region]&&(e.subGridConfigs[t.region]={}),t.locked&&!e.subGridConfigs.locked&&(e.subGridConfigs.locked={}),r.add(t.region);t&&t.forEach(t=>e.subGrids[t].destroy()),e.subGrids={},e._regions=Array.from(r),e._regions.sort(),e.subGridConfigs.normal&&0===Object.keys(e.subGridConfigs.normal).length&&(e.subGridConfigs.normal=Grid.defaultConfig.subGridConfigs.normal);for(const t of e._regions)s=e.columns.makeChained(e=>0===e.childLevel&&e.region===t,["region"]),n=!1,(i=ObjectHelper.assign({},e.subGridConfigs[t],{owner:e,grid:e,store:e.store,rowManager:e.rowManager,region:t,headerClass:e.subGridConfigs[t].headerClass||e.headerClass,columns:s,hideHeaders:e.hideHeaders})).flex||i.width||(i.width=s.totalFixedWidth,n=!0),e.subGrids[t]=new SubGrid(i),e.subGrids[t].hasCalculatedWidth=n,o&&(e.subGrids[t].isFirstRegion=!0,o=!1)}doDestroy(){this.callEachSubGrid("destroy"),super.doDestroy()}eachSubGrid(e,t=null){const r=this;r.regions.forEach((n,i)=>{const s=r.subGrids[n];e.call(t||s,s,i++)})}eachWidget(e,t=!0){const r=this;r.regions.forEach(n=>{const i=r.subGrids[n];!1!==e(i)&&t&&i.eachWidget&&i.eachWidget(e,t)})}callEachSubGrid(e,...t){let r=this,n=null;return r.regions.forEach((i,s)=>{const o=r.subGrids[i];if(o[e]){const r=o[e](...t);0===s&&(n=r)}}),n}getLastRegions(){const e=this.regions.slice(-2);return 2===e.length?e:[e[0],e[0]]}getNextRegion(e){const t=this.regions;return t[t.indexOf(e)+1]||t[t.length-2]}getPreviousRegion(e){return this.regions[this.regions.indexOf(e)-1]}getSubGrid(e){return this.subGrids[e]}getSubGridFromColumn(e){return e=e instanceof Column?e:this.columns.get(e)||this.columns.getById(e),this.getSubGrid(e.region)}get regions(){return this._regions||this.initSubGrids(),this._regions}onSubGridCollapse(e){const t=this.resolveSplitter(e);t.classList.add("b-grid-splitter-collapsed"),t.style.width=`${e.collapsedStateWidth+e.splitterWidth}px`,t.style.left=`${Math.max(e.element.offsetLeft-e.splitterWidth,0)}px`}onSubGridExpand(e){const t=this.resolveSplitter(e);t.classList.remove("b-grid-splitter-collapsed"),t.style.width=""}resolveSplitter(e){const t=this.getLastRegions();let r=e instanceof SubGrid?e.region:e;return t[1]===r&&(r=t[0]),this.subGrids[r].splitterElement}get widgetClass(){}});const resolvedPromise=new Promise(e=>e()),defaultScrollOptions$2={block:"nearest",inline:"nearest"};class Grid extends(base(Widget).mixes(Pluggable,State,GridElementEvents,GridFeatures,GridNavigation,GridResponsive,GridSelection,GridState,GridSubGrids)){static get defaultConfig(){return{rowHeight:null,defaultRowHeight:45,emptyText:"No rows to display",fullRowRefresh:!0,readOnly:null,hideHeaders:null,showRemoveRowInContextMenu:!0,autoHeight:null,store:{},data:null,columns:[],destroyStore:null,selectionMode:{row:!0,cell:!0,multiSelect:!0,checkbox:!1},enableTextSelection:null,loadMask:this.L("loadMask"),columnLines:!0,fillLastColumn:!0,resizeToFitIncludesHeader:!0,animateRemovingRows:!BrowserHelper.isIE11,disableGridRowModelWarning:null,loadMaskErrorIcon:"b-icon b-icon-warning",headerClass:Header,testPerformance:!1,positionMode:"translate",rowScrollMode:"move",monitorResize:!0,features:!0,subGridConfigs:{normal:{flex:1}},scrollable:{overflowY:!0},scrollerClass:GridScroller,showDirty:null,loadMaskHideTimeout:3e3,refreshSuspended:0}}static getLKey(){return"%LICENSE%"}static get properties(){return{_selectedRecords:[],_verticalScrollHeight:0,virtualScrollHeight:0}}finishConfigure(e){const t=this;super.finishConfigure(e),t.scrollManager=new ScrollManager({grid:t,verticalElement:t.scrollable.element}),LocaleManagerSingelton.on({locale:"onLocaleChange",thisObj:t}),GlobalEvents.on({theme:"onThemeChange",thisObj:t}),t.onTransitionEnd=FunctionHelper.createBuffered(t.onTransitionEnd,100,t),EventHelper.on({element:t.bodyContainer,transitionstart:"onTransitionStart",transitioncancel:"onTransitionEnd",transitionend:"onTransitionEnd",thisObj:t}),this._thisIsAUsedExpression(t.regions),t.setGridClassList(t.element.classList)}onLocaleChange(){this.rendered?this.renderContents():this.render()}finalizeInit(){super.finalizeInit(),this.store.isLoading&&this.onStoreLoadStart()}doDestroy(){const e=this;e.storeDetacher&&e.storeDetacher();for(let t of Object.values(e.features))t.destroy&&t.destroy();e.columns&&(e.columns=null),e.store&&(e.store=null),super.doDestroy()}setGridClassList(e){const t=this;e.add(`b-grid-${t.positionMode}`),t.enableTextSelection||e.add("b-grid-notextselection"),t.autoHeight&&e.add("b-autoheight"),t.readOnly&&e.add("b-readonly"),t.fillLastColumn&&e.add("b-fill-last-column"),t.showDirty&&e.add("b-show-dirty");for(let r in t.features){let n,i=t.features[r];(n=i.constructor.hasOwnProperty("featureClass")?i.constructor.featureClass:`b-${i instanceof Base?i.$name:i.constructor.name}`)&&e.add(n.toLowerCase())}}template(e){const t=BrowserHelper.isFirefox?`height:${DomHelper.scrollBarWidth}px`:"";return this._thisIsAUsedExpression(e.regions),TemplateHelper.tpl`
            <div tabindex="-1">
                <header reference="headerContainer" class="b-grid-header-container ${this.hideHeaders?"b-hidden":""}"></header>
                <div reference="bodyContainer" class="b-grid-body-container" data-empty-text="${e.emptyText}">
                    <div reference="verticalScroller" class="b-grid-vertical-scroller"></div>
                </div>
                <div reference="virtualScrollers" class="b-virtual-scrollers ${DomHelper.scrollBarWidth?"":"b-overlay-scrollbar"}" style="${t}"></div>
                <footer reference="footerContainer" class="b-grid-footer-container b-hidden"></footer>
            </div>
        `}get overflowElement(){return this.bodyContainer}get focusElement(){return this.element}set columns(e){const t=this;t._columnStore?e?t._columnStore.data=e:t._columnStore.destroy():(t._columnStore=e instanceof ColumnStore?e:new ColumnStore({grid:t,data:e,listeners:{change:t.onColumnsChanged,thisObj:t}}),t._columnStore.on(columnResizeEvent(t.onColumnsResized,t)))}get columns(){return this._columnStore}onColumnsChanged({action:e,changes:t,record:r}){const n=this;if("update"===e){if("width"in t||"minWidth"in t||"flex"in t){if(n.rendered){const e=r.region;n.columns.visibleColumns.forEach(t=>{t.region===e&&t.repaintOnResize&&n.refreshColumn(t)})}return}if("hidden"in t){const e=n.getSubGridFromColumn(r.id);e.header.fixHeaderWidths(),e.footer&&e.footer.fixFooterWidths(),e.updateHasFlex()}}("dataset"===e||t&&"region"in t&&!n.regions.includes(t.region.value))&&(n.initSubGrids(),n.eachSubGrid(e=>{e.render(n.verticalScroller),e.initScroll()})),n.renderContents()}onColumnsResized({changes:e,record:t}){const r=this,n=e.width&&null==t.flex,i=e.minWidth&&null==t.flex,s=e.flex&&null==t.width,o=DomHelper.setLength(t.width),a=DomHelper.setLength(t.minWidth),l=r.getSubGridFromColumn(t.id);l.header.fixHeaderWidths(),l.footer&&l.footer.fixFooterWidths(),l.updateHasFlex(),r.cellEls&&t===r.lastColumnResized||(r.cellEls=DomHelper.children(r.element,`.b-grid-cell[data-column-id=${t.id}]`),r.lastColumnResized=t);for(let e of r.cellEls)n?(e.style.width=o,e.style.flex="",BrowserHelper.isIE11&&(e.style.minWidth=o)):i?e.style.minWidth=a:s?(e.style.flex=t.flex,e.style.width=""):e.style.flex=e.style.width=e.style.minWidth="";r.dragResizing||r.afterColumnsResized()}afterColumnsResized(){this.refreshVirtualScrollbars(),this.eachSubGrid(e=>{e.fixWidths(),e.fixRowWidthsInSafariEdge(),e.refreshFakeScroll()}),this.lastColumnResized=this.cellEls=null}get rowManager(){const e=this;return e._isRowMeasured||e.measureRowHeight(),e._rowManager||(e._rowManager=new RowManager({grid:e,rowHeight:e.rowHeight,rowScrollMode:e.rowScrollMode||"move",autoHeight:e.autoHeight,listeners:{changetotalheight:e.onRowManagerChangeTotalHeight,requestscrollchange:e.onRowManagerRequestScrollChange,thisObj:e}}))}showEmptyText(){this.bodyContainer&&this.bodyContainer.classList[this.rowManager.rowCount||this.store.isLoading?"remove":"add"]("b-grid-empty")}bindStore(e){const t=this;t.storeDetacher=e.on({refresh:t.onStoreDataChange,update:t.onStoreUpdateRecord,add:t.onStoreAdd,remove:t.onStoreRemove,move:t.onStoreMove,removeall:t.onStoreRemoveAll,loadstart:t.onStoreLoadStart,afterrequest:t.onStoreAfterRequest,clearchanges:t.onStoreDataChange,exception:t.onStoreException},t)}get store(){return this._store}set store(e){const t=this,r=t.initialConfig.features;if(e!==t._store)if(t.storeDetacher&&(t.storeDetacher(),t.storeDetacher=null),e){if(e instanceof Store)e.hasPlugin(GridStorePlugin)||e.addPlugins(GridStorePlugin);else{const n={plugins:GridStorePlugin};t.data&&(n.data=t.data),r&&r.tree&&(n.tree=!0),e.modelClass||(n.modelClass=class extends GridRowModel{}),e=new(e.readUrl?AjaxStore:Store)(Object.assign(n,e))}t._store=e,t.bindStore(e)}else t.destroyStore&&t._store.destroy(),t._store=null}onStoreUpdateRecord({source:e,record:t,data:r}){const n=this;if(n.forceFullRefresh)n.rowManager.refresh(),n.forceFullRefresh=!1;else{const i=n.getRowFor(t);if(!i)return;if(n.fullRowRefresh){const r=e.indexOf(t);-1!==r&&i.render(r,t)}else Object.keys(r).forEach(e=>{let r=i.getCell(e);r&&i.renderCell(r,t)})}}onStoreAdd({records:e,index:t,oldIndex:r,oldParent:n}){if(!this.rendered)return;this.rowManager.calculateRowCount(!1,!0,!0);const i=this,{rowManager:s}=i,{topIndex:o,rows:a,rowCount:l}=s,d=t,c=t+e.length-1;n||r>-1?s.refresh():d>=o&&d<o+l?(s.renderFromRow(a[d-o]),s.trigger("changeTotalHeight",{totalHeight:s.totalHeight}),1===i.store.count&&i.callEachSubGrid("refreshFakeScroll")):c>=o&&c<o+l?s.refresh():s.trigger("changeTotalHeight",{totalHeight:s.totalHeight})}onStoreException(e){const t=this;let r;switch(e.type){case"server":r=e.response.message||"Unspecified failure";break;case"exception":r="network"===e.exceptionType?"Network error":e.error&&e.error.message||"Failed to parse server response";break;default:r=e.response.status+" - "+e.response.statusText||"Unknown error"}const n=`<div class="b-grid-load-failure">\n                <div class="b-grid-load-fail">${t.L("loadFailedMessage")}</div>\n                <div class="b-grid-load-fail">${e.response.url?e.response.url+" responded with":""}</div>\n                <div class="b-grid-load-fail">${r}</div>\n            </div>`;t.activeMask&&(t.activeMask.icon=t.loadMaskErrorIcon,t.activeMask.text=n,t.loadmaskHideTimer=t.setTimeout(()=>{t.unmaskBody()},t.loadMaskHideTimeout))}onStoreDataChange({action:e,changes:t,source:r}){super.onStoreDataChange&&super.onStoreDataChange(...arguments);const n=this,i=r.isGrouped&&t&&n.groupers.find(e=>e.field in t);"dataset"===e&&(n.rowManager.averageRowHeight=null),n.rendered&&!i&&n.renderRows(null,"dataset"===e||"filter"===e),n.showEmptyText()}onStoreLoadStart(){this.loadMask&&this.maskBody(this.loadMask)}onStoreAfterRequest(e){this.activeMask&&!e.exception&&this.unmaskBody()}onStoreRemove({records:e,isCollapse:t,isChild:r}){if(!this.rendered)return;super.onStoreRemove&&super.onStoreRemove(...arguments);let n=2**53-1;const i=this,{rowManager:s}=this,o=e.reduce((e,t)=>{const r=s.getRowById(t.id);return r&&(e.push(r),n=Math.min(n,s.rows.indexOf(r))),e},[]);if(i.animateRemovingRows&&o.length&&!t&&!r){const e=o[0];i.isAnimating=!0,EventHelper.on({element:e._elementsArray[0],transitionend:e=>{"background-color"!==e.propertyName&&"width"!==e.propertyName&&(o.forEach(e=>e.removeCls("b-removing")),s.refresh(),i.trigger("rowRemove"))},once:!0}),o.forEach(e=>e.addCls("b-removing"))}else s.calculateRowCount(!1,!0,!0),s.rows[n]?s.renderFromRow(s.rows[n]):s.trigger("changeTotalHeight",{totalHeight:s.totalHeight}),i.trigger("rowRemove",{isCollapse:t})}onStoreMove({from:e,to:t}){const{rowManager:r}=this,{topIndex:n,rowCount:i}=r,[s,o]=[e,t].sort();s>=n&&s<n+i?r.renderFromRow(r.rows[s-n]):o>=n&&o<n+i&&this.rowManager.refresh()}onStoreRemoveAll(){super.onStoreRemoveAll&&super.onStoreRemoveAll(...arguments),this.rendered&&(this.renderRows(),this.showEmptyText())}get data(){return this._store?this._store.records:this._data}set data(e){this._store?this._store.data=e:this._data=e}getHeaderMenuItems(e,t){const r=this,{subGrids:n,regions:i}=r;let s=!0;Object.entries(n).forEach(([o,a])=>{if(!a.sealedColumns&&e.draggable&&o!==e.region&&(!e.parent&&n[e.region].columns.count>1||e.parent&&e.parent.children.length>1)){const l=a.element.compareDocumentPosition(n[e.region].element)===document.DOCUMENT_POSITION_PRECEDING,d=i.length>2?r.L("Move column to ")+o:r.L(l?"moveColumnRight":"moveColumnLeft");t.push({targetSubGrid:o,text:d,icon:"b-fw-icon "+(l?"b-icon-column-move-right":"b-icon-column-move-left"),name:"moveColumn",cls:s?"b-separator":"",onItem:({item:e})=>{const{column:t}=e;t.traverse(e=>e.region=o),r.columns.insert(r.columns.indexOf(n[e.targetSubGrid].columns.last)+1,t),r.scrollColumnIntoView(t)}}),s=!1}})}getCellMenuItems(e,t,r){const n=this;n.showRemoveRowInContextMenu&&!n.readOnly&&t&&!t.meta.specialRow&&(n.selectedRecords.length>1?r.push({text:n.L("removeRows"),icon:"b-fw-icon b-icon-trash",name:"removeRows",onItem:()=>n.store.remove(n.selectedRecords)}):r.push({text:n.L("removeRow"),icon:"b-fw-icon b-icon-trash",name:"removeRow",onItem:()=>n.store.remove(t)}))}getColumnDragToolbarItems(e,t){return t}normalizeCellContext(e){const{columns:t}=this;if(e instanceof this.store.modelClass)return{record:e,id:e.id,columnId:t.bottomColumns[0].id};if(!("columnId"in e)){if("field"in e){const r=t.get(e.field);e.columnId=r&&r.id}else if("column"in e){const r="number"==typeof e.column?t.bottomColumns[e.column]:e.column;e.columnId=r&&r.id}"columnId"in e||(e.columnId=t.bottomColumns[0].id)}return"id"in e||("row"in e?e.id=this.store.getAt(e.row).id:"record"in e&&(e.id=e.record.id)),e}getCell(e){let t,r=null;return(e=this.normalizeCellContext(e)).id&&(t=this.getRowById(e.id)),t&&e.columnId&&(r=t.getCell(e.columnId)),r}getHeaderElement(e){return"string"!=typeof e&&(e=e.id),this.fromCache(`.b-grid-header[data-column-id="${e}"]`)}getHeaderElementByField(e){const t=this.columns.get(e);return t?this.getHeaderElement(t):null}get bodyHeight(){return this._bodyHeight}get headerHeight(){const e=this;return e.rendered&&!e._headerHeight&&(e._headerHeight=e.headerContainer.offsetHeight),e._headerHeight}getRecordFromElement(e){const t=e.closest(".b-grid-row");return t?this.store.getAt(t.dataset.index):null}getColumnFromElement(e){const t=DomHelper.up(e,".b-grid-cell, .b-grid-header");if(!t)return null;if(t.matches(".b-grid-header"))return this.columns.getById(t.dataset.columnId);const r=DomDataStore.get(t);return this.columns.getById(r.columnId)}get autoHeight(){return this._autoHeight}set autoHeight(e){ObjectHelper.assertBoolean(e,"autoHeight"),this._autoHeight=e}get columnLines(){return this._columnLines}set columnLines(e){ObjectHelper.assertBoolean(e,"columnLines"),DomHelper.toggleClasses(this.element,"b-no-column-lines",!e),this._columnLines=e}set readOnly(e){const t=this;t._readOnly=e,t.rendered&&(t.trigger("readOnly",{readOnly:e}),e?t.element.classList.add("b-readonly"):t.element.classList.remove("b-readonly"))}get readOnly(){return this._readOnly}fixSizes(){this.callEachSubGrid("fixWidths")}onRowManagerChangeTotalHeight({totalHeight:e}){this.refreshTotalHeight(e)}refreshTotalHeight(e=this.rowManager.totalHeight){if(this.renderingRows)return;this.rowManager.bottomRow&&(e=Math.max(e,this.rowManager.bottomRow.bottom));const t=this,r=t.scrollable,n=Math.abs(t.virtualScrollHeight-e),i=t._bodyRectangle.height;if(n){const n=e-i-r.y<2*i||t._verticalScrollHeight&&t._verticalScrollHeight-i<r.y;r.scrollHeight=t.virtualScrollHeight=e,t.scrolling&&!n?t.virtualScrollHeightDirty||(t.virtualScrollHeightDirty=r.on({scrollend:t.fixElementHeights,thisObj:t,once:!0})):(t.virtualScrollHeightDirty&&t.virtualScrollHeightDirty(),t.fixElementHeights(e))}}fixElementHeights(){const e=this,t=e.virtualScrollHeight,r=`${t}px`;e._verticalScrollHeight=t,e.verticalScroller.style.height=r,e.virtualScrollHeightDirty=!1,e.autoHeight&&(e.bodyContainer.style.height=r,e._bodyHeight=t,e._bodyRectangle=Rectangle.client(e.bodyContainer)),e.refreshVirtualScrollbars()}set scrolling(e){this._scrolling=e,this.bodyContainer.classList[e?"add":"remove"]("b-scrolling")}get scrolling(){return this._scrolling}onRowManagerRequestScrollChange({bottom:e}){this.scrollable.y=e-this.bodyHeight}initScroll(){const e=this;if(!e.scrollInitialized){let t,r=e.createOnFrame(()=>{e._scrollTop=t=e.scrollable.y,e.scrolling||(e.scrolling=!0,e.eachSubGrid(e=>e.suspendResizeMonitor=!0)),e.rowManager.updateRenderedRows(t),e.trigger("scroll",{scrollTop:t})});e.scrollInitialized=!0,e.scrollable.on({scroll:r,scrollend(){e.scrolling=!1,e.eachSubGrid(e=>e.suspendResizeMonitor=!1)}}),e.callEachSubGrid("initScroll")}}scrollRowIntoView(e,t=defaultScrollOptions$2){const r=this,n=t.block||"nearest",i=r.rowManager;if(e=r.store.getById(e)){if(-1===r.store.indexOf(e))return resolvedPromise;let s=r.scrollable,o=r.getRecordCoords(e);const a=Rectangle.from(s.element);if(o.virtual){const l=o.block;if(s.scrollIntoView(o,{block:"center"}),i.scrollTargetRecordId=e,i.updateRenderedRows(s.y,!0),o=r.getRecordCoords(e),i.lastScrollTop=s.y,o.virtual)return resolvedPromise;const d="nearest"!==n?t:{block:l};if(t.animate){s.suspendEvents(),"end"===n||"nearest"===n&&"end"===l?s.y-=a.bottom-o.bottom:("start"===n||"nearest"===n&&"start"===l)&&(s.y+=o.y-a.y),i.updateRenderedRows(s.y,!1,!0),"end"===l?s.y-=i.appendRowBuffer*i.rowHeight-1:s.y+=i.prependRowBuffer*i.rowHeight-1;const c=s.scrollIntoView(r.getRecordCoords(e),Object.assign({},t,d));return c.then(()=>s.resumeEvents()),c}return r.scrollRowIntoView(e,Object.assign({},t,d))}{let{column:n}=t;if(n){"string"==typeof n&&(n=r.columns.getById(n)||r.columns.get(n)),s=r.getSubGridFromColumn(n).scrollable;const t=Rectangle.from(i.getRowFor(e).getCell(n.id));o.x=t.x,o.width=t.width}return s.scrollIntoView(o,t)}}}scrollColumnIntoView(e,t){this.getSubGridFromColumn(e).scrollColumnIntoView(e,t)}scrollCellIntoView(e,t){return this.scrollRowIntoView(e.id,Object.assign({column:e.columnId},t))}scrollToBottom(e){this.scrollRowIntoView(this.store.last,e)}scrollToTop(e){this.scrollable.scrollBy(0,-this.scrollable.y,e)}storeScroll(){const e=this.storedScrollState={scrollTop:this.scrollable.y,scrollLeft:{}};return this.eachSubGrid(t=>{e.scrollLeft[t.region]=t.scrollable.x}),e}restoreScroll(e=this.storedScrollState){this.eachSubGrid(t=>{t.scrollable.x=e.scrollLeft[t.region]}),this.scrollable.y=e.scrollTop}measureRowHeight(){const e=this,t=DomHelper.createElement({tag:"div",className:"b-grid "+(e.features.stripe?"b-stripe":""),style:"position: absolute; visibility: hidden",html:'<div class="b-grid-subgrid"><div class="b-grid-row"></div></div>',parent:document.getElementById(e.appendTo)||document.body}),r=t.firstElementChild.firstElementChild,n=parseInt(DomHelper.getStyleValue(r,"height")),i=parseInt(DomHelper.getStyleValue(r,"border-top-width")),s=parseInt(DomHelper.getStyleValue(r,"border-bottom-width"));null!=e.rowHeight&&e.rowHeight!==e._rowHeightFromStyle||(e.rowHeight=!isNaN(n)&&n?n:e.defaultRowHeight,e._rowHeightFromStyle=e.rowHeight),e._rowBorderHeight=i+s,e._isRowMeasured=!0,t.remove()}onThemeChange({theme:e}){this.measureRowHeight(),this.trigger("theme",{theme:e})}refreshRows(e=!1){this.element.classList.add("b-notransition"),e?this.rowManager.returnToTop():this.rowManager.refresh(),this.element.classList.remove("b-notransition")}refreshColumn(e){const t=e.field;this.rowManager.forEach(e=>{const r=e.getCell(t);e.renderCell(r)})}refreshVirtualScrollbars(){const{scrollBarWidth:e}=DomHelper;if(e){const t=this,{headerContainer:r,footerContainer:n,virtualScrollers:i}=t,s=t.virtualScrollHeight>t.bodyHeight;Object.values(t.subGrids).some(e=>e.overflowingHorizontally)?i.classList.remove("b-hide-display"):i.classList.add("b-hide-display"),s?r.classList.contains("b-grid-vertical-overflow")||r.classList.add("b-grid-vertical-overflow"):r.classList.remove("b-grid-vertical-overflow");const o=r.querySelector(".b-grid-header-scroller:last-child");if(o&&s){const i=parseInt(DomHelper.getStyleValue(o,"border-right-width"));r.style.paddingRight=e-i+(t.regions.length>2?1:0)+"px",n.style.paddingRight=`${e}px`}else r.style.paddingRight="0",n.style.paddingRight="0"}}onContentChange(){const e=this,t=e.rowManager;if(e.isVisible){const r=Math.max(t.totalHeight,t.bottomRow?t.bottomRow.bottom:0);e.paintListener=null,e._bodyRectangle=Rectangle.client(e.bodyContainer),e._bodyHeight=e.autoHeight?r:e.bodyContainer.offsetHeight,e.refreshTotalHeight(r),e.callEachSubGrid("refreshFakeScroll")}else e.paintListener||(e.paintListener=e.on({paint:"onContentChange",once:!0,thisObj:e}))}renderHeader(e,t){}renderFooter(e,t){}suspendRefresh(){this.refreshSuspended++}resumeRefresh(e){this.refreshSuspended&&!--this.refreshSuspended&&e&&this.refreshRows()}renderRows(e=!0,t=!1){const r=this,n=e&&r.storeScroll();r.refreshSuspended||(r.trigger("beforeRenderRows"),r.renderingRows=!0,r.element.classList.add("b-grid-refreshing"),r.callEachSubGrid("clearRows"),t&&(r.scrollable.y=0),r.rowManager.reinitialize(t),r.renderingRows=!1,r.onContentChange(),e&&r.restoreScroll(n),r.element.classList.remove("b-grid-refreshing"))}renderContents(){const e=this,t=e.appendTo,r=e.headerContainer,n=e.footerContainer;e.emptyCache(),e.rendered&&(e._headerHeight=null,e.callEachSubGrid("refreshHeader",r),e.callEachSubGrid("refreshFooter",n),e.renderHeader(r,t),e.renderFooter(n,t),e.fixSizes(),e.renderRows(!1))}onPaint(){const e=this,{element:t,headerContainer:r,bodyContainer:n,footerContainer:i}=e;if(e.rendered)return;e.updateResponsive(e.width,0);let s=0;e._bodyRectangle=Rectangle.client(e.bodyContainer),e.eachSubGrid(t=>{t.render(e.verticalScroller)}),e.renderHeader(r,t),e.renderFooter(i,t),e.autoHeight?(e._bodyHeight=e.rowManager.initWithHeight(t.offsetHeight-r.offsetHeight-i.offsetHeight,!0),n.style.height=e.bodyHeight+"px"):(e._bodyHeight=e.bodyContainer.offsetHeight,e.rowManager.initWithHeight(e._bodyHeight,!0)),e.eachSubGrid(e=>{e.header.maxDepth>s&&(s=e.header.maxDepth)}),r.dataset.maxDepth=s,e.fixSizes(),e.renderRows(!1),e.initScroll(),e.initInternalEvents(),e.rendered=!0}render(e){const t=this;t.requireSize=Boolean(t.owner),super.render(e),t.autoHeight||!t.headerContainer.offsetHeight||t.bodyContainer.offsetHeight||console.warn("Grid element not sized correctly, please check your CSS styles and review how you size the widget")}maskBody(e){const t=this;if(t.bodyContainer)return t.unmaskBody(),t.activeMask=WidgetHelper.mask(t.bodyContainer,e),t.activeMask}unmaskBody(){const e=this;e.loadmaskHideTimer&&e.clearTimeout(e.loadmaskHideTimer),e.loadmaskHideTimer=null,e.activeMask&&e.activeMask.destroy(),e.activeMask=null}get isAnimating(){return this._animating}set isAnimating(e){const t=this,{classList:r}=t.element;t.isVisible&&t.rendered&&e!==t._animating&&(e?(r.add("b-animating"),t.requestAnimationFrame(()=>{t._animating||r.remove("b-animating")})):r.remove("b-animating"))}onTransitionStart(e){this._animating=!0}onTransitionEnd(e){const t=this;if(!t.isDestroyed){const e=t._animating;t.isAnimating=!1,t._animating=!1,t.element.classList.remove("b-animating"),e&&t.trigger("transitionend")}}}Grid._$name="Grid",BryntumWidgetAdapterRegister.register("grid",Grid),VersionHelper.setVersion("grid","2.1.0");class TreeGrid extends Grid{set store(e){if(e&&!e.tree){if(e instanceof Store)throw new Error("TreeGrid requires a Store configured with tree : true");e.tree=!0}super.store=e}get store(){return super.store}}TreeGrid._$name="TreeGrid",BryntumWidgetAdapterRegister.register("treegrid",TreeGrid);var AjaxTransport=e=>(class t extends(e||Base){static get defaultMethod(){return{load:"GET",sync:"POST"}}cancelRequest(e){e.abort()}sendRequest(e){let r=this,n=e.data,i=r.transport[e.type]||{},s=i.paramName,o=Object.assign({},i.params),a=i.method||t.defaultMethod[e.type],l=Object.assign({url:i.url,method:a,params:o},i.requestConfig);s?(l.params=l.params||{},l.params[s]=n):l.jsonData=n,r.trigger("beforeSend",{params:o,type:e.type,requestConfig:l,config:e});const d=AjaxHelper.fetch(l.url,{method:a,headers:l.headers,queryParams:o,body:"HEAD"===a||"GET"===a?void 0:l.jsonData});return d.then(t=>{t.ok?t.text().then(t=>{e.success&&e.success.call(e.thisObj||r,t)}).catch(()=>{e.failure&&e.failure&&e.failure.call(e.thisObj||r,t)}):e.failure&&e.failure.call(e.thisObj||r,t)}),d}});function storeSortFn(e,t,r){return e.store&&(e=e.store),t.store&&(t=t.store),(e=e[r]||0)<(t=t[r]||0)?-1:e>t?1:0}function storeLoadSortFn(e,t){return storeSortFn(e,t,"loadPriority")}function storeSyncSortFn(e,t){return storeSortFn(e,t,"syncPriority")}var AbstractCrudManagerMixin=e=>(class extends e{static get crudManagerDefaultConfig(){return{crudRevision:null,crudStores:[],storeIdProperty:"storeId",crudFilterParam:"filter",transport:{},trackResponseType:!1,phantomIdField:"$PhantomId",autoLoad:!1,autoSyncTimeout:100,autoSync:!1,resetIdsBeforeSync:!0,syncApplySequence:[],writeAllFields:!1,crudIgnoreUpdates:0,crudLoaded:!1,createMissingRecords:!1,autoSyncTimerId:null,applyingLoadResponse:!1,applyingSyncResponse:!1,callOnFunctions:!0}}construct(e={}){this._requestId=0,this.activeRequests={},this.crudStoresIndex={},this._crudManagerConfig=e,super.construct(e)}applyCrudManagerMixinConfig(e){const t=this.splitCrudManagerConfig(e);t.crudStores&&(this.crudStores=t.crudStores,delete t.crudStores),Object.assign(this,t)}afterConfigure(){this.initialConfig||this.applyCrudManagerMixinConfig(this._crudManagerConfig)}splitCrudManagerConfig(e){let t=Object.assign({},this.constructor.crudManagerDefaultConfig);for(let r in e)r in t&&(t[r]=e[r],delete e[r]);return t}afterConstruct(){super.afterConstruct(),this.autoLoad&&this.load().catch(e=>{})}getStoreDescriptor(e){return e?e instanceof Store?this.crudStores.find(t=>t.store===e):"object"==typeof e?this.crudStoresIndex[e.storeId]:this.crudStoresIndex[e]||this.getStoreDescriptor(Store.getStore(e)):null}fillStoreDescriptor(e){let t=e.store,r=t.storeIdProperty||this.storeIdProperty,n=t.modelClass&&t.modelClass.prototype;return!e.storeId&&(e.storeId=t[r]),!e.idField&&(e.idField=n.idField),!e.phantomIdField&&(e.phantomIdField=n&&n.phantomIdField),!("writeAllFields"in e)&&(e.writeAllFields=t.writeAllFields),e}updateCrudStoreIndex(){const e=this.crudStoresIndex={};this.crudStores.forEach(t=>t.storeId&&(e[t.storeId]=t))}getCrudStore(e){const t=this.getStoreDescriptor(e);return t&&t.store}forEachCrudStore(e,t=this){e&&this.crudStores.every(r=>!1!==e.call(t,r.store,r.storeId,r))}set crudStores(e){this._crudStores=[],this.addCrudStore(e);for(let e of this._crudStores)e.loadPriority=e.syncPriority=0}get crudStores(){return this._crudStores}set syncApplySequence(e){this._syncApplySequence=[],this.addStoreToApplySequence(e)}get syncApplySequence(){return this._syncApplySequence}addCrudStore(e,t,r){if(!e)return;if(Array.isArray(e)||(e=[e]),!e.length)return;const n=this,i=[];if(e.forEach(e=>{e instanceof Store?e={store:e}:"object"==typeof e?e.stores&&(Array.isArray(e.stores)||(e.stores=[e.stores]),e.stores.forEach((t,r)=>{let n=t;"string"==typeof t&&(n={storeId:t}),n.masterStoreInfo=e,e.stores[r]=n})):e={store:Store.getStore(e)},i.push(n.fillStoreDescriptor(e)),e.store.setCrudManager?e.store.setCrudManager(n):e.store.crudManager=n,n.overrideCrudStoreLoad&&e.store.load&&(e.store.load=e.store.commit=(()=>{})),n.bindCrudStoreListeners(e.store)}),void 0===t)n.crudStores.push.apply(n.crudStores,i);else{let e=t;r&&((r instanceof Store||"object"!=typeof r)&&(r=n.getStoreDescriptor(r)),e+=n.crudStores.indexOf(r)),n.crudStores.splice(e,0,...i)}n.updateCrudStoreIndex()}addPrioritizedStore(e){const t=this;t.hasCrudStore(e)||this.addCrudStore(e,ArrayHelper.findInsertionIndex(e,t.crudStores,storeLoadSortFn)),t.hasApplySequenceStore(e)||this.addStoreToApplySequence(e,ArrayHelper.findInsertionIndex(e,t.syncApplySequence,storeSyncSortFn))}hasCrudStore(e){return this.crudStores.some(t=>t===e||t.store===e||t.storeId===e)}removeCrudStore(e){const t=this,r=t.crudStores;for(let n=0,i=r.length;n<i;n++){const i=r[n];if(i===e||i.store===e||i.storeId===e){t.unbindCrudStoreListeners(i.store),delete t.crudStoresIndex[i.storeId],r.splice(n,1),t.syncApplySequence&&t.removeStoreFromApplySequence(e);break}}}bindCrudStoreListeners(e,t){const r=this,n={update:r.onCrudStoreChange,removeall:r.onCrudStoreChange,detachable:!0,thisObj:r};Object.assign(n,{add:r.onCrudStoreChange,remove:r.onCrudStoreChange}),e.crudDetatcher=e.on(n)}unbindCrudStoreListeners(e){e.crudDetatcher&&e.crudDetatcher()}addStoreToApplySequence(e,t,r){if(!e)return;Array.isArray(e)||(e=[e]);const n=this,i=e.reduce((e,t)=>{let r=n.getStoreDescriptor(t);return r&&e.push(r),e},[]);if(void 0===t)n.syncApplySequence.push.apply(n.syncApplySequence,i);else{let e=t;r&&((r instanceof Store||"object"!=typeof r)&&(r=n.getStoreDescriptor(r)),e+=n.syncApplySequence.indexOf(r)),n.syncApplySequence.splice(e,0,...i)}}removeStoreFromApplySequence(e){const t=this.syncApplySequence.findIndex(t=>t===e||t.store===e||t.storeId===e);t>-1&&this.syncApplySequence.splice(t,1)}hasApplySequenceStore(e){return this.syncApplySequence.some(t=>t===e||t.store===e||t.storeId===e)}onCrudStoreChange(){const e=this;e.crudIgnoreUpdates||(e.crudStoreHasChanges()?(e.trigger("hasChanges"),e.autoSync&&(e.autoSyncTimerId||(e.autoSyncTimerId=setTimeout(()=>{e.autoSyncTimerId=null,e.sync()},e.autoSyncTimeout)))):e.trigger("noChanges"))}async internalOnResponse(e,t,r,n){const i=this;i.activeRequests[e]=null;let s=i.decode(t);return s&&s.success?(!1!==i.trigger("beforeResponseApply",{requestType:e,response:s})&&!1!==i.trigger("before"+StringHelper.capitalizeFirstLetter(e)+"Apply",{response:s,options:n})&&(i.crudRevision=s.revision,await i.applyResponse(e,s,n),i.trigger("requestDone",{requestType:e,response:s,responseOptions:r}),i.trigger(e,{response:s,responseOptions:r,options:n}),"load"!==e&&i.crudStoreHasChanges()||i.trigger("noChanges")),s):(i.trigger("requestFail",{requestType:e,response:s,responseOptions:r}),i.trigger(e+"Fail",{response:s,responseOptions:r,options:n}),"string"!=typeof t&&(t=""+t),i.warn("CrudManager: "+e+" failed, please inspect the server response"),s)}async internalOnLoad(e,t,r){return this.crudLoaded=!0,await this.internalOnResponse("load",e,t,r)}async internalOnSync(e,t,r){return this.internalOnResponse("sync",e,t,r)}suspendChangesTracking(){this.crudIgnoreUpdates++}resumeChangesTracking(e){this.crudIgnoreUpdates&&!--this.crudIgnoreUpdates&&e&&this.onCrudStoreChange()}crudStoreHasChanges(e){if(e){let t=this.getCrudStore(e);return t&&this.isCrudStoreDirty(t)}return this.crudStores.some(this.isCrudStoreDirty)}isCrudStoreDirty(e){return null!=e.store.changes}emitCrudStoreEvents(e,t){const r={action:"read"+t};for(let n of this.crudStores)e.includes(n.storeId)&&n.store.trigger(t,r)}getLoadPackage(e){const t={type:"load",requestId:this.requestId},r=this.crudStores;return t.stores=r.map(t=>{let r=e&&e[t.storeId],n=t.pageSize||t.store&&t.store.pageSize;if(r||n){const e=Object.assign({storeId:t.storeId,page:1,pageSize:n},r);return t.currentPage=e.page,e}return t.storeId}),t}loadCrudStore(e,t,r,n){const i=t&&t.rows;r&&r.append||t.append?e.add(i):e.data=i,e.trigger("load",{source:e,data:i})}loadDataToCrudStore(e,t,r){let n,i=this,s=e.store,o=e.stores,a=e.idField||"id",l=s.tree,d=t&&t.rows;s.__loading=!0,d&&(o&&(n=i.getSubStoresData(d,o,a,l)),i.loadCrudStore(s,t,r,e),n&&n.forEach(e=>{i.loadDataToCrudStore(Object.assign({store:s.getById(e.id).get(e.storeDesc.storeId)},e.storeDesc),e.data)})),s.__loading=!1}loadCrudManagerData(e,t={}){this.suspendChangesTracking(),this.crudStores.forEach(r=>{const n=r.storeId,i=e[n];i&&this.loadDataToCrudStore(r,i,t[n])}),this.resumeChangesTracking()}get isCrudManagerLoading(){return Boolean(this.activeRequests.load||this.applyingLoadResponse)}load(e){const t=this,r=t.getLoadPackage(e);return new Promise((n,i)=>{!1!==t.trigger("beforeLoad",{pack:r})?(t.activeRequests.load&&(t.cancelRequest(t.activeRequests.load.desc),t.trigger("loadCanceled",{pack:r})),t.activeRequests.load={id:r.requestId},t.emitCrudStoreEvents(r.stores,"loadStart"),t.activeRequests.load.desc=t.sendRequest({data:t.encode(r),type:"load",success:async(s,o)=>{const a=await t.internalOnLoad(s,o,e);t.emitCrudStoreEvents(r.stores,"afterRequest"),a&&a.success?n({response:a,rawResponse:s,options:e}):i({cancelled:!1,response:a,rawResponse:s,options:e})},failure:async(n,s)=>{const o=await t.internalOnLoad(n,s);t.emitCrudStoreEvents(r.stores,"afterRequest"),i({cancelled:!1,response:o,rawResponse:n,options:e})},thisObj:t})):(t.trigger("loadCanceled",{pack:r}),i({cancelled:!0}))})}getSubStoresData(e,t,r,n){if(!e)return;let i=[];function s(e,t){t.forEach(t=>{const n=t.storeId;e[n]&&(i.push({id:e[r],storeDesc:t,data:e[n]}),delete e[n])})}return n?e.forEach(e=>{s(e,t);const n=this.getSubStoresData(e.children,t,r,!0);n&&(i=i.concat(n))}):e.forEach(e=>s(e,t)),i}prepareAdded(e,t,r){return e.filter(e=>e.isValid).map(e=>{const n=Object.assign(e.persistableData,{[t]:e.id});return this.resetIdsBeforeSync&&delete n[e.constructor.idField],r&&this.processSubStores(e,n,r),n})}prepareUpdated(e,t,r){let n=r.writeAllFields||!1!==r.writeAllFields&&this.writeAllFields;if(r.store.tree){const t=r.store.rootNode;e=e.filter(e=>e!==t)}return e.filter(e=>e.isValid).reduce((e,r)=>{let i;n?(i=r.persistableData)[r.constructor.idField]=r.id:(i=r.modifications)[r.constructor.idField]=r.id,t&&this.processSubStores(r,i,t);const s=Object.keys(i);return(s.length>1||s[0]!==r.constructor.idField)&&e.push(i),e},[])}prepareRemoved(e){return e.map(e=>({[e.constructor.idField]:e.id}))}processSubStores(e,t,r){r.forEach(r=>{const n=r.storeId,i=e.get(n);if(i){let e=this.getCrudStoreChanges(Object.assign({store:i},r));e?t[n]=Object.assign(e,{$store:!0}):delete t[n]}else delete t[n]})}getCrudStoreChanges(e,t=e.phantomIdField||this.phantomIdField){let r,n=e.store,i=n.added.values,s=n.modified.values,o=n.removed.values,a=e.stores;return i.length&&(i=this.prepareAdded(i,t,a)),s.length&&(s=this.prepareUpdated(s,a,e)),o.length&&(o=this.prepareRemoved(o)),(i.length||s.length||o.length)&&(r={},i.length&&(r.added=i),s.length&&(r.updated=s),o.length&&(r.removed=o)),r}getChangeSetPackage(){let e={type:"sync",requestId:this.requestId,revision:this.crudRevision},t=0;return this.crudStores.forEach(r=>{const n=this.getCrudStoreChanges(r);n&&(t++,e[r.storeId]=n)}),t?e:null}applyChangesToRecord(e,t,r,n){const i=this;let s,o=e.data,a={[i.phantomIdField]:!0},l=!1;for(s in r&&r.forEach(r=>{if(s=r.storeId,t.hasOwnProperty(s)){a[s]=!0;const n=e.get(s);n?i.applyChangesToStore(Object.assign({store:n},r),t[s]):console.log("Can't find store for the response sub-package")}}),t=e.constructor.processData(t,!0))if(t.hasOwnProperty(s)&&!a[s]){let r=t[s];if(!ObjectHelper.isEqual(o[s],r))if(l||(l=!0,e.beginBatch()),"parentId"===s&&n.tree){(r&&n.getById(r)||n.rootNode).appendChild(e),e.clearChanges()}else e[s]=r}i.suspendChangesTracking(),l&&e.endBatch(),i.resumeChangesTracking(),e.clearChanges(!0,!1)}applyRemovals(e,t,r){let n=e.removed,i=r.findByIdFn,s=r.removeRecordFn,o=0;return t.forEach(e=>{let t=!1,r=e.id;if(n.includes(e)&&(n.remove(e),t=!0,o++),!t){let e=i(r);e?(this.suspendChangesTracking(),s(e),n.remove(e),o++,this.resumeChangesTracking()):console.log("Can't find record to remove from the response package")}}),o}getApplyChangesToStoreHelpers(e){return e.tree?{findByPhantomFn:t=>e.getById(t),findByIdFn:t=>e.getById(t),addRecordFn:t=>{return(t.parentId&&e.getById(t.parentId)||e.rootNode).appendChild(t)},removeRecordFn:e=>e.remove()}:{findByPhantomFn:t=>e.getById(t),findByIdFn:t=>e.getById(t),addRecordFn:t=>e.add(t)[0],removeRecordFn:t=>e.remove(t)}}async applyChangesToStore(e,t){const r=this,n=e.phantomIdField||r.phantomIdField,i=e.idField||"id",s=e.store,{findByPhantomFn:o,findByIdFn:a,addRecordFn:l,removeRecordFn:d}=r.getApplyChangesToStoreHelpers(s),{rows:c,removed:u}=t;if(c){const t=e.stores;c.forEach(e=>{const d=e[n],c=e[i];let u=null;null!=d&&null!=d?u=o(d):i&&(u=a(c)),u?r.applyChangesToRecord(u,e,t,s):(r.suspendChangesTracking(),u=l(e),r.resumeChangesTracking(),u.clearChanges())})}u&&r.applyRemovals(s,u,{idField:i,findByIdFn:a,removeRecordFn:d})&&s.trigger("dataChanged",{source:s})}async applySyncResponse(e){const t=this,r=t.syncApplySequence.length?t.syncApplySequence:t.crudStores;t.applyingSyncResponse=!0,r.forEach(async r=>{const n=e[r.storeId];n&&await t.applyChangesToStore(r,n)}),t.applyingSyncResponse=!1}async applyLoadResponse(e,t){this.applyingLoadResponse=!0,this.loadCrudManagerData(e,t),this.applyingLoadResponse=!1}async applyResponse(e,t,r){switch(this.trackResponseType&&(e=t.type||e),e){case"load":await this.applyLoadResponse(t,r);break;case"sync":await this.applySyncResponse(t)}}get requestId(){return Date.now()+""+this._requestId++}sync(){const e=this;return e.activeRequests.sync?(e.trigger("syncDelayed"),this.activeSyncPromise=this.activeSyncPromise.then(()=>this.sync(),()=>this.sync())):e.activeSyncPromise=new Promise((t,r)=>{const n=e.getChangeSetPackage();n?!1!==e.trigger("beforeSync",{pack:n})?(e.activeRequests.sync={id:n.requestId},e.activeRequests.sync.desc=e.sendRequest({data:e.encode(n),type:"sync",success:async function(n,i){const s=e.activeRequests.sync,o=await e.internalOnSync(n,i);o&&o.success?t({response:o,rawResponse:n,request:s}):r({cancelled:!1,response:o,rawResponse:n,request:s})},failure:async function(t,n){const i=e.activeRequests.sync,s=await e.internalOnSync(t,n);r({cancelled:!1,response:s,rawResponse:t,request:i})},thisObj:e})):(e.trigger("syncCanceled",{pack:n}),r({cancelled:!0})):t(null)})}commitCrudStores(){this.crudStores.forEach(e=>e.store.commit())}rejectCrudStores(){this.crudStores.forEach(e=>e.store.clearChanges())}warn(){if("console"in window){let e=console;e.log&&e.log.apply&&e.log.apply(e,arguments)}}doDestroy(){const e=this;for(e.activeRequests.load&&e.cancelRequest(e.activeRequests.load.desc),e.activeRequests.sync&&e.cancelRequest(e.activeRequests.sync.desc);e.crudStores.length>0;)e.removeCrudStore(e.crudStores[0]);clearTimeout(e.autoSyncTimerId),e.destroyed=!0}});class AbstractCrudManager extends(AbstractCrudManagerMixin(Events(Base))){get revision(){return this.crudRevision}set revision(e){this.crudRevision=e}static get defaultConfig(){return Object.assign({},this.crudManagerDefaultConfig,{overrideCrudStoreLoad:!0,stores:null})}construct(e={}){e.stores&&(e.crudStores=e.stores,delete e.stores),super.construct(e)}set stores(e){e!==this.crudStores&&(this.crudStores=e)}get stores(){return this.crudStores}get isLoading(){return this.isCrudManagerLoading}commit(){this.commitCrudStores()}reject(){this.rejectCrudStores()}addStore(...e){return this.addCrudStore(...e)}removeStore(...e){return this.removeCrudStore(...e)}getStore(...e){return this.getCrudStore(...e)}hasChanges(...e){return this.crudStoreHasChanges(...e)}loadData(...e){return this.loadCrudManagerData(...e)}}AbstractCrudManager._$name="AbstractCrudManager";class AssignmentModel extends Model{static get fields(){return[{name:"resourceId"},{name:"eventId"}]}static get relationConfig(){return[{relationName:"resource",fieldName:"resourceId",store:"resourceStore",collectionName:"assignments"},{relationName:"event",fieldName:"eventId",store:"eventStore",collectionName:"assignments"}]}get assignmentStore(){return this.stores&&this.stores[0]}get eventStore(){const{assignmentStore:e}=this;return e&&e.eventStore}get resourceStore(){const{eventStore:e}=this;return e&&e.resourceStore}get eventName(){return this.event&&this.event.name}get resourceName(){return this.resource&&this.resource.name}getResource(e=this.resourceStore){return e&&e.getById(this.resourceId)}get isAssignment(){return!0}get isPersistable(){const{event:e,resource:t}=this;return this.isValid&&!e.hasGeneratedId&&!t.hasGeneratedId}get isValid(){return null!=this.resource&&null!=this.event}fullCopy(){throw new Error("Not implemented")}get eventResourceCompositeKey(){return AssignmentModel.makeAssignmentEventResourceCompositeKey(this.eventId,this.resourceId)}static makeAssignmentEventResourceCompositeKey(e,t){return`event(${e})-resource(${t})`}}AssignmentModel.exposeProperties(),AssignmentModel._$name="AssignmentModel";class AssignmentStore extends AjaxStore{static get defaultConfig(){return{loadPriority:300,syncPriority:300,modelClass:AssignmentModel}}doDestroy(){this.eventStoreDetacher&&this.eventStoreDetacher(),this.resourceStoreDetacher&&this.resourceStoreDetacher(),super.doDestroy()}get eventStore(){return this._eventStore}set eventStore(e){const t=this,r=t._eventStore;t._eventStore=e||null,t.attachToEventStore(t._eventStore),(r||e)&&r!==e&&t.trigger("eventStoreChange",{newEventStore:e,oldEventStore:r})}attachToEventStore(e){const t=this;t.eventStoreDetacher&&t.eventStoreDetacher(),e&&(t.eventStoreDetacher=e.on({remove:t.onEventRemove,resourcestorechange:t.onEventStoreResourceStoreChange,thisObj:t,prio:200})),t.isConfiguring||t.initRelations(!0),t.attachToResourceStore(e&&e.resourceStore)}attachToResourceStore(e){const t=this;t.resourceStore=e,t.resourceStoreDetacher&&t.resourceStoreDetacher(),e&&(t.resourceStoreDetacher=e.on({remove:t.onResourceRemove,removeAll:t.onResourceRemoveAll,thisObj:t,prio:200}),t.isConfiguring||t.initRelations(!0))}onEventStoreResourceStoreChange({newResourceStore:e}){this.attachToResourceStore(e)}onEventRemove({records:e,isMove:t,isCollapse:r}){if(!t&&!r){const t=[];e.forEach(e=>{e.traverse(e=>{t.push(...e.assignments)})}),t.length&&this.remove(t)}}onResourceRemove({records:e,isMove:t,isCollapse:r}){if(!t&&!r){const t=[];e.forEach(e=>{e.traverse(e=>{t.push(...e.assignments)})}),t.length&&this.remove(t)}}onResourceRemoveAll(){this.removeAll()}mapAssignmentsForEvent(e,t,r){const n=Boolean(t),i=Boolean(r),s=Model.asId(e),o=this.relationCache.event&&this.relationCache.event[s];return o?(t=t||(e=>e),r=r||(()=>!0),n||i?o.reduce((e,n)=>{const i=t(n);return r(i)&&e.push(i),e},[]):o):[]}mapAssignmentsForResource(e,t,r){const n=Boolean(t),i=Boolean(r),s=Model.asId(e),o=this.relationCache.resource&&this.relationCache.resource[s];return o?(t=t||(e=>e),r=r||(()=>!0),n||i?o.reduce((e,n)=>{const i=t(n);return r(i)&&e.push(i),e},[]):o):[]}getAssignmentsForEvent(e){return e.assignments}removeAssignmentsForEvent(e){return this.remove(e.assignments)}getAssignmentsForResource(e){return this.mapAssignmentsForResource(e)}removeAssignmentsForResource(e){this.remove(this.getAssignmentsForResource(e))}getResourcesForEvent(e){return this.mapAssignmentsForEvent(e,e=>e.resource,e=>Boolean(e))}getEventsForResource(e){return this.mapAssignmentsForResource(e,e=>e.event,e=>!!e)}assignEventToResource(e,t,r=(e=>e),n=!1){const i=this,s=Array.isArray(t)?t:[t];let o=[];return i.beginBatch(),n&&i.removeAssignmentsForEvent(e),s.forEach(t=>{if(!i.isEventAssignedToResource(e,t)){let n=new i.modelClass({eventId:Model.asId(e),resourceId:Model.asId(t)});n=r(n),o.push(n)}}),o=i.add(o),i.endBatch(),o}unassignEventFromResource(e,t){const r=this;if(!t)return r.removeAssignmentsForEvent(e);if(r.isEventAssignedToResource(e,t)){const n=r.getAssignmentForEventAndResource(e,t);return r.remove(n),n}return null}isEventAssignedToResource(e,t){const r=this.getResourcesForEvent(e),n=Model.asId(t);return r.some(e=>e.id==n)}getAssignmentForEventAndResource(e,t){return e=this.eventStore.getById(e),t=this.resourceStore.getById(t),this.records.find(r=>r.event==e&&r.resource==t)}}AssignmentStore._$name="AssignmentStore";class CalendarDayModel extends Model{static get fields(){return[{name:"date",type:"date",format:"YYYY-MM-DD",persist:!0},{name:"weekday",type:"int"},{name:"overrideStartDate",type:"date",dateFormat:"YYYY-MM-DD"},{name:"overrideEndDate",type:"date",dateFormat:"YYYY-MM-DD"},{name:"type",defaultValue:"DAY"},{name:"isWorkingDay",type:"boolean",defaultValue:!1},{name:"cls"},{name:"name"},{name:"availability",persist:!0}]}set date(e){e&&(e=DateHelper.startOf(e,"day")),this.set("date",e)}get date(){return this.get("date")}clearDate(){this.set("date",null)}get availability(){return this.get("availability")}set availability(e){this.availabilityCache=null,this.set("availability",this.stringifyIntervals(e)),this.getAvailability()}getAvailability(e){const t=this;if(e)return t.get("availability");if(t.availabilityCache)return t.availabilityCache;const r=t.get("availability").map(e=>"string"==typeof e?t.parseInterval(e):e);return t.verifyAvailability(r),t.availabilityCache=r}verifyAvailability(e){const t=this;e.sort((e,t)=>e.startTime-t.startTime),e.forEach((r,n)=>{if(r.startTime>r.endTime)throw new Error(`Start time ${DateHelper.format(r.startTime,"HH:mm")} is greater than end time ${DateHelper.format(r.endTime,"HH:mm")}`);if(n>0&&e[n-1].endTime>r.startTime)throw new Error(`Availability intervals should not intersect: [${t.stringifyInterval(e[n-1])}] and [${t.stringifyInterval(r)}]`)})}stringifyInterval(e){const t=e.startTime,r=e.endTime;return DateHelper.format(t,"HH:mm")+"-"+DateHelper.format(r,"HH:mm")}stringifyIntervals(e){const t=this;return e.map(e=>"string"==typeof e?e:t.stringifyInterval(e))}parseInterval(e){const t=/(\d\d):(\d\d)-(\d\d):(\d\d)/.exec(e);if(!t)throw new Error(`Invalid format for availability string: ${String}. It should have exact format: hh:mm-hh:mm`);return{startTime:new Date(0,0,0,t[1],t[2]),endTime:new Date(0,0,0,t[3],t[4])}}get totalHours(){return this.getTotalMS()/1e3/60/60}get totalMS(){return this.getAvailability().reduce((e,t)=>e+=t.endTime-t.startTime,0)}addAvailabilityInterval(e,t){let r;r=e instanceof Date?{startTime:e,endTime:t}:this.parseInterval(e+(t?"-"+t:""));const n=this.getAvailability().concat(r);this.verifyAvailability(n),this.setAvailability(n)}removeAvailabilityInterval(e){const t=this.getAvailability();t.splice(e,1),this.setAvailability(t)}getAvailabilityIntervalsFor(e){const t=(e="number"==typeof e?new Date(e):e).getFullYear(),r=e.getMonth(),n=e.getDate();return this.getAvailability().map(e=>{const i=e.endTime.getDate();return{startDate:new Date(t,r,n,e.startTime.getHours(),e.startTime.getMinutes()),endDate:new Date(t,r,n+(1==i?1:0),e.endTime.getHours(),e.endTime.getMinutes())}})}getAvailabilityStartFor(e){const t=this.getAvailabilityIntervalsFor(e);return t.length?t[0].startDate:null}getAvailabilityEndFor(e){const t=this.getAvailabilityIntervalsFor(e);return t.length?t[t.length-1].endDate:null}}CalendarDayModel._$name="CalendarDayModel";class TimeSpan extends Model{static get fields(){return[{name:"startDate",type:"date",dateFormat:"YYYY-MM-DDTHH:mm:ssZ"},{name:"endDate",type:"date",dateFormat:"YYYY-MM-DDTHH:mm:ssZ"},{name:"duration",type:"number",allowNull:!0},{name:"durationUnit",type:"string",defaultValue:"d"},{name:"fullDuration"},{name:"cls",defaultValue:""},{name:"style",type:"object"},{name:"name",type:"string"}]}afterConstruct(){super.afterConstruct(),this.normalize()}normalize(){const e=this,{startDate:t,endDate:r,duration:n,durationUnit:i}=e,s=null!=n;t&&r&&!s?e.setData("duration",DateHelper.diff(t,r,i,!0)):t&&!r&&s?e.setData("endDate",DateHelper.add(t,n,i)):!t&&r&&s&&e.setData("startDate",DateHelper.add(r,-n,i)),this.clearCachedValues()}get cls(){return this._cls||(this._cls=new DomClassList(super.get("cls"))),this._cls}set cls(e){const t=this;t._cls?t._cls.value=e:t._cls=new DomClassList(e),t.set("cls",t._cls.value)}get startDate(){return this.get("startDate")}set startDate(e){this.setStartDate(e)}get endDate(){return this.get("endDate")}set endDate(e){this.setEndDate(e)}get duration(){return this.get("duration")}set duration(e){this.setDuration(e,this.durationUnit)}get durationUnit(){return this.get("durationUnit")}setDuration(e,t=this.durationUnit){const r={duration:e=parseFloat(e),durationUnit:t};this.startDate?r.endDate=DateHelper.add(this.startDate,e,t):this.endDate&&(r.startDate=DateHelper.add(this.endDate,-e,t)),this.set(r)}get fullDuration(){return{unit:this.durationUnit,magnitude:this.duration}}set fullDuration(e){this.setDuration(e.magnitude,e.unit)}setStartDate(e,t=!0){const r=this,n={startDate:e};if(e){let i;if(t)i=null!=r.duration;else if(r.endDate){if(n.duration=DateHelper.diff(e,r.endDate,r.durationUnit,!0),n.duration<0)throw new Error("Negative duration")}else i=null!=this.duration;i&&(n.endDate=DateHelper.add(e,r.duration,r.durationUnit))}else n.duration=null;r.set(n)}setEndDate(e,t=!1){const r=this,n={endDate:e};if(e){let i;if(!0===t)i=null!=r.duration;else if(r.startDate){if(n.duration=DateHelper.diff(r.startDate,e,r.durationUnit,!0),n.duration<0)throw new Error("Negative duration")}else i=null!=this.duration;i&&(n.startDate=DateHelper.add(e,-r.duration,r.durationUnit))}r.set(n)}setStartEndDate(e,t){this.set({startDate:e,endDate:t})}get dates(){const e=[],t=DateHelper.startOf(this.startDate,"day"),r=this.endDate;for(let n=t;n<r;n=DateHelper.add(n,1,"day"))e.push(n);return e}get durationMS(){return this.endDate&&this.startDate?this.endDateMS-this.startDateMS:DateHelper.asMilliseconds(this.duration||0,this.durationUnit)}clearCachedValues(){this._startDateMS=null,this._endDateMS=null,this._isMilestone=null}get endDateMS(){const e=this;return e._endDateMS||(e._endDateMS=e.endDate&&e.endDate.getTime()),e._endDateMS}get startDateMS(){const e=this;return e._startDateMS||(e._startDateMS=e.startDate&&e.startDate.getTime()),e._startDateMS}get isMilestone(){const e=this;return e._isMilestone||(e._isMilestone=e.endDateMS===e.startDateMS),e._isMilestone}inSetNormalize(e){if("string"!=typeof e)return"duration"in(e=Object.assign({},e))?(e.startDate&&!e.endDate&&(e.endDate=DateHelper.add(e.startDate,e.duration,e.durationUnit||this.durationUnit,!0,!0)),!e.startDate&&e.endDate&&(e.startDate=DateHelper.add(e.endDate,-e.duration,e.durationUnit||this.durationUnit,!0,!0))):e.startDate&&e.endDate&&(e.duration=DateHelper.diff(e.startDate,e.endDate,e.durationUnit||this.durationUnit,!0)),e}inSet(e,t,r,n){return this.clearCachedValues(),e=this.inSetNormalize(e)||e,super.inSet(e,t,r,n)}forEachDate(e,t){return this.dates.forEach(e.bind(t))}get isScheduled(){return Boolean(this.startDate&&this.endDate&&this.hasValidDates)}get isValid(){let e=this,t=!0;if(t){let r=e.startDate,n=e.endDate;t=!r||!n||n-r>=0}return t}get hasValidDates(){let e=this.startDateMS,t=this.endDateMS;return!e||!t||t-e>=0}shift(e,t=this.durationUnit){if("string"==typeof e){const r=e;e=t,t=r}this.setStartDate(DateHelper.add(this.startDate,e,t,!0),!0)}get wbsCode(){return this.indexPath.join(".")}fullCopy(){return this.copy.apply(this,arguments)}intersects(e){return this.intersectsRange(e.startDate,e.endDate)}intersectsRange(e,t){let r=this.startDate,n=this.endDate;return r&&n&&DateHelper.intersectSpans(r,n,e,t)}split(e=.5){const t=this,r=this.copy(),n=t.firstStore,i=n&&n.assignmentStore,s=t.duration*e,o=t.duration-s;if(e<=0||e>=1)throw new Error("Split point must be > 0 and < 1");return t.duration=s,r.startDate=t.endDate,r.duration=o,n&&n.add(r),i&&i.add(t.assignments.map(e=>{const t=Object.assign({},e.data,{eventId:r.id});return delete t.id,t})),r}}TimeSpan._$name="TimeSpan";class Calendar extends AjaxStore{static get defaultConfig(){return{modelClass:CalendarDayModel,daysPerMonth:30,daysPerWeek:7,hoursPerDay:24,unitsInMs:null,defaultNonWorkingTimeCssCls:"b-nonworkingtime",weekendsAreWorkdays:!1,weekendFirstDay:6,weekendSecondDay:0,holidaysCache:null,availabilityIntervalsCache:null,daysIndex:null,weekAvailability:null,defaultWeekAvailability:null,nonStandardWeeksByStartDate:null,nonStandardWeeksStartDates:null,calendarId:null,parent:null,defaultAvailability:["00:00-24:00"],name:null,suspendCacheUpdate:0,availabilitySearchLimit:1825}}static get allCalendars(){return(Store.stores||[]).filter(e=>e instanceof Calendar)}get calendarId(){return this._calendarId}set parent(e){const t=this,r=Calendar.getCalendar(e);if(e&&!r)throw new Error("Invalid parent specified for the calendar");if(t.parent!=r){const e={calendarchange:t.clearCache,destroy:t.onParentDestroy,thisObj:t},n=t.parent;n&&n.un(e),t._parent=r,r&&r.on(e),t.params=Object.assign(t.params||{},{parentId:r?r.calendarId:null}),t.clearCache(),t.trigger("parentChange",{newParent:r,oldParent:n})}}construct(e){const t=this;super.construct(e),t.unitsInMs={MILLI:1,SECOND:1e3,MINUTE:6e4,HOUR:36e5,DAY:60*t.hoursPerDay*60*1e3,WEEK:t.daysPerWeek*t.hoursPerDay*60*60*1e3,MONTH:t.daysPerMonth*t.hoursPerDay*60*60*1e3,QUARTER:3*t.daysPerMonth*24*60*60*1e3,YEAR:12*t.daysPerMonth*24*60*60*1e3},t.defaultWeekAvailability=t.getDefaultWeekAvailability(),t.on({change:t.clearCache,thisObj:t}),t.clearCache()}static getCalendar(e){return e instanceof Calendar?e:Store.getStore(e)}set calendarId(e){const t=this;t._calendarId=e,t.storeId=null!=e?"GNT_CALENDAR:"+e:null,t.params=Object.assign(t.params||{},{calendarId:e})}getDefaultWeekAvailability(){let e=this.defaultAvailability,t=this.weekendFirstDay,r=this.weekendSecondDay,n=[];for(let i=0;i<7;i++)n.push(this.weekendsAreWorkdays||i!=t&&i!=r?new this.modelClass({type:"WEEKDAY",weekday:i,availability:e&&e.slice()||[],isWorkingDay:!0}):new this.modelClass({type:"WEEKDAY",weekday:i,availability:[]}));return n}removeAll(){Calendar.allCalendars.forEach(e=>{e.storeId=null,e.destroy()})}intersectsWithCurrentWeeks(e,t){let r=!1;return this.forEachNonStandardWeek(n=>{const i=n.startDate,s=n.endDate;if(i<=e&&e<s||i<t&&t<=s)return r=!0,!1}),r}clearCache(){const e=this;if(e.suspendCacheUpdate>0)return;e.holidaysCache={},e.availabilityIntervalsCache={};const t=e.daysIndex={},r=e.weekAvailability=[],n=e.nonStandardWeeksStartDates=[],i=e.nonStandardWeeksByStartDate={};e.forEach(function(e){let s=e.id,o=/^(\d)-(\d\d\d\d\/\d\d\/\d\d)-(\d\d\d\d\/\d\d\/\d\d)$/.exec(s),a=/^WEEKDAY:(\d+)$/.exec(s),l=e.type,d=e.weekday;if("WEEKDAYOVERRIDE"==l||o){let t,r;if("WEEKDAYOVERRIDE"==l&&(t=e.overrideStartDate,r=e.overrideEndDate),o&&(t=DateHelper.parse(o[2],"YYYY/MM/DD"),r=DateHelper.parse(o[3],"YYYY/MM/DD"),d=o[1]),t&&r&&null!=d){const s=t-0;i[s]||(i[s]={startDate:new Date(t),endDate:new Date(r),name:e.getName(),weekAvailability:[],mainDay:null},n.push(s)),d>=0?i[s].weekAvailability[d]=e:i[s].mainDay=e}}else if("WEEKDAY"==l||a){if(a&&(d=a[1]),null!=d){if(d<0||d>6)throw new Error("Incorrect week day index");r[d]=e}}else{const r=e.date;r&&(t[r-0]=e)}}),n.sort((e,t)=>e-t),e.trigger("calendarChange")}addNonStandardWeek(e,t,r,n){if(e=DateHelper.clearTime(e),t=DateHelper.clearTime(t),this.intersectsWithCurrentWeeks(e,t))throw new Error("Can not add intersecting week");const i=this.modelClass,s=[];r.forEach((r,o)=>{if(r instanceof CalendarDayModel)r.type="WEEKDAYOVERRIDE",r.overrideStartDate=e,r.overrideEndDate=t,r.weekday=o,r.name=n||"Week override",s.push(r);else if(Array.isArray(r)){const a=new i;a.type="WEEKDAYOVERRIDE",a.overrideStartDate=e,a.overrideEndDate=t,a.weekday=o,a.name=n||"Week override",a.setAvailability(r),s.push(a)}});const o=new i;o.type="WEEKDAYOVERRIDE",o.overrideStartDate=e,o.overrideEndDate=t,o.weekday=-1,o.name=n||"Week override",s.push(o),this.add(s)}getNonStandardWeekByStartDate(e){return this.nonStandardWeeksByStartDate[DateHelper.clearTime(e)-0]||null}removeNonStandardWeek(e){e=DateHelper.clearTime(e)-0;const t=this.getNonStandardWeekByStartDate(e);t&&this.remove(ArrayHelper.clean(t.weekAvailability).concat(t.mainDay))}getNonStandardWeekByDate(e){e=DateHelper.clearTime(e)-0;const t=this.nonStandardWeeksStartDates,r=this.nonStandardWeeksByStartDate;for(let n=0;n<t.length;n++){const i=r[t[n]];if(i.startDate>e)break;if(i.startDate<=e&&e<=i.endDate)return i}return null}setWeekendsAreWorkDays(e){const t=this;e!==t.weekendsAreWorkdays&&(t.weekendsAreWorkdays=e,t.defaultWeekAvailability=t.getDefaultWeekAvailability(),t.clearCache())}areWeekendsWorkDays(){return this.weekendsAreWorkdays}forEachNonStandardWeek(e,t){const r=this,n=this.nonStandardWeeksStartDates,i=this.nonStandardWeeksByStartDate;for(let s=0;s<n.length;s++)if(!1===e.call(t||r,i[n[s]]))return!1}getCalendarDay(e){return e="number"==typeof e?new Date(e):e,this.getOverrideDay(e)||this.getWeekDay(e.getDay(),e)||this.getDefaultCalendarDay(e.getDay())}getOverrideDay(e){return this.getOwnCalendarDay(e)||this.parent&&this.parent.getOverrideDay(e)||null}getOwnCalendarDay(e){return e="number"==typeof e?new Date(e):e,this.daysIndex[DateHelper.clearTime(e)-0]}getWeekDay(e,t){if(t){const r=this.getNonStandardWeekByDate(t);if(r&&r.weekAvailability[e])return r.weekAvailability[e]}return this.weekAvailability[e]||this.parent&&this.parent.getWeekDay(e,t)||null}isHoliday(e){const t=e-0,r=this.holidaysCache;if(null!=r[t])return r[t];e="number"==typeof e?new Date(e):e;const n=this.getCalendarDay(e);if(!n)throw new Error("Can't find day for "+e);return r[t]=!n.isWorkingDay}getDefaultCalendarDay(e){return this.hasOwnProperty("defaultAvailability")||this.hasOwnProperty("weekendsAreWorkdays")||!this.parent?this.defaultWeekAvailability[e]:this.parent.getDefaultCalendarDay(e)}isWorkingDay(e){return!this.isHoliday(e)}isWeekend(e){const t=e.getDay();return t===this.weekendFirstDay||t===this.weekendSecondDay}convertMSDurationToUnit(e,t){return e/this.unitsInMs[DateHelper.getUnitByName(t)]}convertDurationToMs(e,t){return e*this.unitsInMs[DateHelper.getUnitByName(t)]}forEachAvailabilityInterval(e,t,r){r=r||this;let n=this,i=e.startDate,s=e.endDate,o=!1!==e.isForward;if(o?!i:!s)throw new Error("At least `startDate` or `endDate` is required, depending from the `isForward` option");let a=new Date(o?i:s),l=DateHelper;o?s||(s=l.add(i,e.availabilitySearchLimit||n.availabilitySearchLimit||1825,"day")):i||(i=l.add(s,-(e.availabilitySearchLimit||n.availabilitySearchLimit||1825),"day"));let d=!1;for(;o?a<s:a>i;){let e=n.getAvailabilityIntervalsFor(a-(o?0:1),!!o&&d);for(let n=o?0:e.length-1;o?n<e.length:n>=0;o?n++:n--){let o=e[n],a=o.startDate,l=o.endDate;if(a>=s||l<=i)continue;let d=a<i?i:a,c=l>s?s:l;if(!1===t.call(r,d,c))return!1}a=o?l.getStartOfNextDay(a,!1,d):l.getEndOfPreviousDay(a,d),d=!0}}calculateDuration(e,t,r){let n=0;return this.forEachAvailabilityInterval({startDate:e,endDate:t},(e,t)=>{let r=e.getTimezoneOffset()-t.getTimezoneOffset();n+=t-e+60*r*1e3}),this.convertMSDurationToUnit(n,r)}getHolidaysRanges(e,t,r){if(e>t)throw new Error("startDate can't be bigger than endDate");e=DateHelper.clearTime(e),t=DateHelper.clearTime(t);let n,i,s=[];for(i=e;i<t;i=DateHelper.getNext(i,"day",1))if(this.isHoliday(i)||this.weekendsAreWorkdays&&r&&this.isWeekend(i)){const e=this.getCalendarDay(i),t=e&&e.cls||this.defaultNonWorkingTimeCssCls,r=DateHelper.getNext(i,"day",1);n?n.cls.isEqual(t)?n.endDate=r:(s.push(n),n=new TimeSpan({startDate:i,endDate:r,cls:t})):n=new TimeSpan({startDate:i,endDate:r,cls:t})}else n&&(s.push(n),n=null);return n&&s.push(n),s}calculateEndDate(e,t,r){if(!t)return new Date(e);let n,i=DateHelper,s=0===(t=this.convertDurationToMs(t,r))&&i.clearTime(e,!0)-e==0?i.add(e,-1,"day"):e;return this.forEachAvailabilityInterval({startDate:s},function(e,r){let i=r-e,s=e.getTimezoneOffset()-r.getTimezoneOffset();if(i>=t)return n=new Date(e-0+t),!1;t-=i+60*s*1e3}),n}skipNonWorkingTime(e,t){let r=!1;if(this.forEachAvailabilityInterval(t?{startDate:e}:{endDate:e,isForward:!1},(n,i)=>(e=t?n:i,r=!0,!1)),!r)throw new Error("skipNonWorkingTime: Cannot skip non-working time, please ensure that this calendar has any working period of time specified");return new Date(e)}calculateStartDate(e,t,r){if(!t)return new Date(e);let n;return t=this.convertDurationToMs(t,r),this.forEachAvailabilityInterval({endDate:e,isForward:!1},(e,r)=>{const i=r-e;if(i>=t)return n=new Date(r-t),!1;t-=i}),n}skipWorkingTime(e,t,r){return t>=0?this.calculateEndDate(e,t,r):this.calculateStartDate(e,-t,r)}isChildOf(e){let t=this,r=!1;for(;t&&!r;)r=t===e,t=t.parent;return r}getParentableCalendars(){const e=this;return Calendar.getAllCalendars().reduce((t,r)=>(r===e||r.isChildOf(e)||t.push({id:r.calendarId,name:r.name||r.calendarId}),t),[])}get parent(){return this._parent}getAvailabilityIntervalsFor(e,t){return e=t?e.valueOf():e instanceof Date?new Date(e.getFullYear(),e.getMonth(),e.getDate()).valueOf():DateHelper.clearTime(new Date(e)).valueOf(),this.availabilityIntervalsCache[e]=this.availabilityIntervalsCache[e]||this.getCalendarDay(e).getAvailabilityIntervalsFor(e)}onParentDestroy(){this.parent=null}isAvailabilityIntersected(e,t,r){let n,i,s,o;for(let t=0;t<7;t++)if(n=this.getWeekDay(t)||this.getDefaultCalendarDay(t),s=e.getWeekDay(t)||e.getDefaultCalendarDay(t),n&&s){i=n.getAvailability(),o=s.getAvailability();for(let e=0,t=i.length;e<t;e++)for(let t=0,r=o.length;t<r;t++)if(o[t].startTime<i[e].endTime&&o[t].endTime>i[e].startTime)return!0}let a=!1;return this.forEachNonStandardWeek(e=>!(e.startDate>=r)&&(t<e.endDate?(a=!0,!1):void 0)),a}}Calendar._$name="Calendar";var JsonEncoder=e=>(class extends(e||Base){encode(e){return StringHelper.safeJsonStringify(e)}decode(e){return StringHelper.safeJsonParse(e)}}),ResourceStoreMixin=e=>(class extends(e||Base){get eventStore(){return this._eventStore}set eventStore(e){const t=this;if(t._eventStore!==e){const r=t._eventStore;t._eventStore=e||null,e&&!e.resourceStore&&(e.resourceStore=t),t.trigger("eventStoreChange",{newEventStore:e,oldEventStore:r})}}getScheduledEventsInTimeSpan(e,t,r=this.eventStore){return this.reduce((n,i)=>{n.concat(r.getEventsForResource(i).reduce((r,n)=>{n.intersectsRange(e,t)&&r.push(n)}))})}});class ResourceModel extends GridRowModel{static get fields(){return[{name:"name",type:"string",persist:!0},"eventColor","eventStyle"]}get resourceStore(){return this.stores&&this.stores[0]}get eventStore(){const e=this.resourceStore;return e&&e.eventStore||this.parentNode&&this.parentNode.eventStore}get assignmentStore(){const e=this.eventStore;return e&&e.assignmentStore}get events(){return this.eventStore&&this.eventStore.getEventsForResource(this)}getEvents(e=this.eventStore){return e&&e.getEventsForResource(this)||[]}get isPersistable(){const e=this.parentNode;return!e||!e.phantom||e.isRoot&&e.isRoot()}isAbove(e){let t,r,n,i,s,o=this,a=o.resourceStore;if(o===e)return!1;if(a.tree){for(t=o,r=[];t;)r.push(t),t=t.parentNode;for(t=e,n=[];t;)n.push(t),t=t.parentNode;for(i=0;i<r.length-1&&i<n.length-1&&r[i]==n[i];)++i;return s=r[i],o=r[i+1],e=n[i+1],s.indexOf(o)<s.indexOf(e)}return a.indexOf(o)<a.indexOf(e)}unassignAll(e){this.events&&this.events.slice().forEach(t=>t.unassign(this,e))}}ResourceModel.exposeProperties(),ResourceModel._$name="ResourceModel";class ResourceStore extends(ResourceStoreMixin(AjaxStore)){static get defaultConfig(){return{loadPriority:200,syncPriority:100,modelClass:ResourceModel,storeId:"resources",autoTree:!0}}construct(e){if(super.construct(e),this.modelClass!==ResourceModel&&!(this.modelClass.prototype instanceof ResourceModel))throw new Error("Model for ResourceStore must subclass ResourceModel")}remove(e){e=Array.isArray(e)?e:[e];for(let t of e){this.getById(t).unassignAll(!0)}super.remove(e)}removeAll(){this.traverse(e=>e.unassignAll(!0)),super.removeAll()}}ResourceStore._$name="ResourceStore";class ModelPersistencyManager extends Base{set eventStore(e){const t=this;t.eventStoreDetacher&&t.eventStoreDetacher(),t._eventStore=e,e&&e.autoCommit&&(t.eventStoreDetacher=e.on({beforecommit:t.onEventStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get eventStore(){return this._eventStore}set resourceStore(e){const t=this;t.resourceStoreDetacher&&t.resourceStoreDetacher(),t._resourceStore=e,e&&e.autoCommit&&(t.resourceStoreDetacher=e.on({beforecommit:t.onResourceStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get resourceStore(){return this._resourceStore}set assignmentStore(e){const t=this;t.assignmentStoreDetacher&&t.assignmentStoreDetacher(),t._assignmentStore=e,e&&e.autoSync&&(t.assignmentStoreDetacher=e.on({beforecommit:t.onAssignmentStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get assignmentStore(){return this._assignmentStore}set dependencyStore(e){const t=this;t.dependencyStoreDetacher&&t.dependencyStoreDetacher(),t._dependencyStore=e,e&&e.autoSync&&(t.dependencyStoreDetacher=e.on({beforecommit:t.onDependencyStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get dependencyStore(){return this._dependencyStore}onEventStoreBeforeSync({changes:e}){return this.removeNonPersistableRecordsToCreate(e),this.shallContinueSync(e)}onResourceStoreBeforeSync({changes:e}){return this.removeNonPersistableRecordsToCreate(e),this.shallContinueSync(e)}onAssignmentStoreBeforeSync({changes:e}){return this.removeNonPersistableRecordsToCreate(e),this.shallContinueSync(e)}onDependencyStoreBeforeSync({changes:e}){return this.removeNonPersistableRecordsToCreate(e),this.shallContinueSync(e)}removeNonPersistableRecordsToCreate(e){let t,r,n=e.added||[];for(r=n.length-1;r>=0;--r)(t=n[r]).isPersistable||n.splice(n.indexOf(t),1);0===n.length&&(e.added.length=0)}shallContinueSync(e){return Boolean(e.added&&e.added.length>0||e.modified&&e.modified.length>0||e.removed&&e.removed.length>0)}}ModelPersistencyManager._$name="ModelPersistencyManager";const validResourceIdTypes={string:1,number:1};var EventStoreMixin=e=>(class extends(e||Base){get resourceStore(){return this._resourceStore}set resourceStore(e){const t=this,r=t._resourceStore;r&&(r.eventStore=null,t.modelPersistencyManager&&(t.modelPersistencyManager.resourceStore=null)),t._resourceStore=e||null,e&&(t.modelPersistencyManager&&(t.modelPersistencyManager.resourceStore=t._resourceStore),e.eventStore=t),t.isConfiguring||t.initRelations(!0),(r||e)&&r!==e&&t.trigger("resourceStoreChange",{newResourceStore:e,oldResourceStore:r})}get assignmentStore(){return this._assignmentStore}set assignmentStore(e){const t=this,r=t._assignmentStore;r&&(r.eventStore=null,t.modelPersistencyManager&&(t.modelPersistencyManager.assignmentStore=null)),t._assignmentStore=e||null,e&&(t.modelPersistencyManager&&(t.modelPersistencyManager.assignmentStore=t._assignmentStore),e.eventStore=t),t.isConfiguring||t.initRelations(!0),(r||e)&&r!==e&&t.trigger("assignmentStoreChange",{newAssignmentStore:e,oldAssignmentStore:r})}get dependencyStore(){return this._dependencyStore}set dependencyStore(e){const t=this,r=t._dependencyStore;r&&(r.eventStore=null,t.modelPersistencyManager&&(t.modelPersistencyManager.dependencyStore=null)),t._dependencyStore=e||null,t._dependencyStore&&(t.modelPersistencyManager&&(t.modelPersistencyManager.dependencyStore=t._dependencyStore),t._dependencyStore.eventStore=t),(r||e)&&r!==e&&t.trigger("dependencyStoreChange",{newDependencyStore:e,oldDependencyStore:r})}construct(e){super.construct(e),Object.assign(this,{isEventStore:!0,autoTree:!0,modelPersistencyManager:this.createModelPersistencyManager()})}createModelPersistencyManager(){return new ModelPersistencyManager({eventStore:this,resourceStore:this.resourceStore,assignmentStore:this.assignmentStore,dependencyStore:this.dependencyStore})}getEventsInTimeSpan(e,t,r=!0,n=!1){const i=[];return this.forEachScheduledEvent((s,o,a)=>{(r&&DateHelper.intersectSpans(o,a,e,t)||!r&&o-e>=0&&t-a>=0)&&(!n||s.resources.length>0)&&i.push(s)}),i}getEventsByStartDate(e){const t=[];return this.forEachScheduledEvent((r,n,i)=>{DateHelper.isEqual(n,e,"day")&&t.push(r)}),t}forEachScheduledEvent(e,t=this){this.forEach(r=>{const n=r.startDate,i=r.endDate;if(n&&i)return e.call(t,r,n,i)})}getTotalTimeSpan(){let e=new Date(9999,0,1),t=new Date(0);return this.forEach(r=>{r.startDate&&(e=DateHelper.min(r.startDate,e)),r.endDate&&(t=DateHelper.max(r.endDate,t))}),e=e<new Date(9999,0,1)?e:null,t=t>new Date(0)?t:null,this.lastTotalTimeSpan={startDate:e||null,endDate:t||e||null}}isEventPersistable(e){return!!this.assignmentStore||!e.resource.hasGeneratedId}isDateRangeAvailable(e,t,r,n){if(r instanceof AssignmentModel){const i=r.event,s=i.resources,o=new Set(n.events);return s.forEach(e=>{e.events.forEach(e=>o.add(e))}),o.delete(i),!Array.from(o).some(r=>DateHelper.intersectSpans(e,t,r.startDate,r.endDate))}return!this.getEventsForResource(n).some(n=>!(r===n||!DateHelper.intersectSpans(e,t,n.startDate,n.endDate)))}filterEventsForResource(e,t,r=this){return e.getEvents(this).filter(t.bind(r))}getResourcesForEvent(e){return this.assignmentStore?this.assignmentStore.getResourcesForEvent(e):(e=this.getById(e)).resource&&!e.resource.placeHolder?[e.resource]:[]}getEventsForResource(e){const t=this.assignmentStore;if(t)return t.getEventsForResource(e);validResourceIdTypes[typeof e]||(e=e.id);const r=this.relationCache.resource&&this.relationCache.resource[e];return r?r.slice():[]}getAssignmentsForEvent(e){return this.assignmentStore&&this.assignmentStore.getAssignmentsForEvent(e)||[]}getAssignmentsForResource(e){return this.assignmentStore&&this.assignmentStore.getAssignmentsForResource(e)||[]}assignEventToResource(e,t,r=!1){const n=this,i=n.assignmentStore;i?i.assignEventToResource(e,t,void 0,r):(e=n.getById(e),Array.isArray(t)&&(t=t[0]),t=t instanceof ResourceModel?t.id:t,e&&(e.resourceId=t))}unassignEventFromResource(e,t){const r=this,n=r.assignmentStore;n?n.unassignEventFromResource(e,t):(e=r.getById(e),t=t instanceof ResourceModel?t.id:t,e&&e.resourceId==t&&(e.resourceId=null))}reassignEventFromResourceToResource(e,t,r){const n=this,i=n.assignmentStore,s=Model.asId(r),o=Model.asId(t);if(i){const n=i.getAssignmentForEventAndResource(e,t);n?n.resourceId=s:i.assignEventToResource(e,r)}else(e=n.getById(e)).resourceId==o&&(e.resourceId=s)}isEventAssignedToResource(e,t){let r=this.assignmentStore;return r?r.isEventAssignedToResource(e,t):(e=this.getById(e),t=Model.asId(t),e&&e.resourceId==t||!1)}removeAssignmentsForEvent(e){let t=this,r=t.assignmentStore;r?r.removeAssignmentsForEvent(e):(e=t.getById(e))&&(e.resourceId=null)}removeAssignmentsForResource(e){const t=this,r=t.assignmentStore,n=t.resourceStore;r?r.removeAssignmentsForResource(e):n?e=n.getById(e):(e=Model.asId(e),t.forEach(t=>t.resourceId==e&&(t.resourceId=null)))}});class EventModel extends TimeSpan{static get fields(){return[{name:"iconCls"},{name:"resourceId"},{name:"draggable",type:"boolean",persist:!1,defaultValue:!0},{name:"resizable",persist:!1,defaultValue:!0},"eventStyle","eventColor","milestoneWidth"]}static get relationConfig(){return[{relationName:"resource",fieldName:"resourceId",store:"resourceStore",collectionName:"events"}]}get eventStore(){const e=this;return e._eventStore||(e._eventStore=e.stores&&e.stores.find(e=>e.isEventStore)),e._eventStore}get resourceStore(){const e=this.eventStore;return e&&e.resourceStore}get assignmentStore(){const e=this.eventStore;return e&&e.assignmentStore}get resources(){return this.eventStore&&this.eventStore.getResourcesForEvent(this)||[]}forEachResource(e,t=this){for(let r of this.resources)if(!1===e.call(t,r))return}getResource(e=this.resourceId){let t=this,r=t.eventStore,n=r&&r.resourceStore;if(r&&e){let e=r.getResourcesForEvent(t);if(1==e.length)return e[0];if(e.length>1)throw new Error("Event::getResource() is not applicable for events with multiple assignments, please use Event::resources instead.");return null}if(n)return n?n.getById(e):null}get isEvent(){return!0}get isDraggable(){return this.draggable}get isResizable(){return!this.isMilestone&&this.resizable}get isPersistable(){const e=this.eventStore;return e&&e.isEventPersistable(this)}assign(e){const t=this,r=t.eventStore;e=Model.asId(e),r?r.assignEventToResource(t,e):t.resourceId=e}unassign(e,t){const r=this,n=r.eventStore;e=Model.asId(e),r.meta.removingResource=t,n?n.unassignEventFromResource(r,e):r.resourceId==e&&(r.resourceId=null),r.meta.removingResource=null}reassign(e,t){const r=this,n=r.eventStore;e=Model.asId(e),t=Model.asId(t),n?n.reassignEventFromResourceToResource(r,e,t):r.resourceId=t}isAssignedTo(e){let t=this.eventStore;return e=Model.asId(e),t?t.isEventAssignedToResource(this,e):this.resourceId==e}}EventModel.exposeProperties(),EventModel._$name="EventModel";class EventStore extends(EventStoreMixin(AjaxStore)){static get defaultConfig(){return{loadPriority:100,syncPriority:200,modelClass:EventModel,storeId:"events"}}construct(e){if(super.construct(e,!0),this.modelClass!==EventModel&&!(this.modelClass.prototype instanceof EventModel))throw new Error("The model for the EventStore must subclass EventModel")}append(e){this.add(e)}}EventStore._$name="EventStore";const canonicalDependencyTypes=["SS","SF","FS","FF"];class DependencyBaseModel extends Model{static get Type(){return{StartToStart:0,StartToEnd:1,EndToStart:2,EndToEnd:3}}static get fields(){return[{name:"from"},{name:"to"},{name:"type",type:"int",defaultValue:2},{name:"cls",defaultValue:""},{name:"bidirectional",type:"boolean"},{name:"fromSide",type:"string"},{name:"toSide",type:"string"},{name:"lag",type:"number",allowNull:!0,defaultValue:0},{name:"lagUnit",type:"string",defaultValue:"d"}]}static get relationConfig(){return[{relationName:"sourceEvent",fieldName:"from",store:"eventStore",collectionName:"successors"},{relationName:"targetEvent",fieldName:"to",store:"eventStore",collectionName:"predecessors"}]}construct(e){super.construct(...arguments),e&&(e.from&&e.from instanceof TimeSpan&&(this.setSourceEvent(e.from),delete e.from),e.to&&e.to instanceof TimeSpan&&(this.setTargetEvent(e.to),delete e.to))}get eventStore(){return this.stores[0].eventStore}get lag(){return this.get("lag")}set lag(e){"number"==typeof e?this.set({lag:e}):this.setLag(e)}setLag(e,t){1!==arguments.length?(e=parseFloat(e),this.set({lag:e,lagUnit:t})):"number"==typeof e?this.lag=e:(e=DateHelper.parseDuration(e),this.set({lag:e.magnitude,lagUnit:e.unit}))}getLag(){return this.lag?`${this.lag<0?"-":"+"}${Math.abs(this.lag)}${DateHelper.getShortNameOfUnit(this.lagUnit)}`:""}get fullLag(){return{unit:this.lagUnit,magnitude:this.lag}}set fullLag(e){"string"==typeof e?this.setLag(e):this.setLag(e.magnitude,e.unit)}set sourceEvent(e){this.from=e.id}set targetEvent(e){this.to=e.id}get isPersistable(){const e=this.getSourceEvent(),t=this.getTargetEvent();return e&&!e.hasGeneratedId&&t&&!t.hasGeneratedId}getSourceEvent(e=this.eventStore){return e.getById(this.from)}getTargetEvent(e=this.eventStore){return e.getById(this.to)}getDateRange(e=!1){const t=this.sourceEvent,r=this.targetEvent;if(t&&r&&t.isScheduled&&r.isScheduled){let n,i,s=DependencyBaseModel.Type;switch(this.type){case s.StartToStart:n=t.startDate,i=r.startDate;break;case s.StartToEnd:n=t.startDate,i=r.endDate;break;case s.EndToEnd:n=t.endDate,i=r.endDate;break;case s.EndToStart:n=t.endDate,i=r.startDate}return{start:e?n:DateHelper.min(n,i),end:e?i:DateHelper.max(n,i)}}return null}highlight(e){const t=this.highlighted?this.highlighted.split(" "):[];t.includes(e)||(this.highlighted=t.concat(e).join(" "))}unhighlight(e){const t=this,r=t.highlighted;if(r){const n=r.split(" "),i=n.findIndex(t=>t===e);i>=0&&(n.splice(i,1),t.highlighted=n.join(" "))}}isHighlightedWith(e){const t=this.highlighted;return t&&t.split(" ").includes(e)}getConnectorString(e){const t=canonicalDependencyTypes[this.type];if(e)return t;if(this.type===DependencyBaseModel.Type.EndToStart)return"";const r=LocaleManagerSingelton.locale;if(r){const e=r.Scheduler&&r.Scheduler[t];if(e)return e}return t}toString(){return`${this.from}${this.getConnectorString()}${this.getLag()}`}isValid(e){const{from:t,to:r,type:n}=this;return"number"==typeof n&&t&&""!==t&&null!=r&&""!==r&&t!==r}}DependencyBaseModel.exposeProperties(),DependencyBaseModel._$name="DependencyBaseModel";class DependencyModel extends DependencyBaseModel{getTypeFromSides(e,t,r){const n=DependencyBaseModel.Type,i=r?"right":"left",s=r?"left":"right";return e===i?t===i?n.StartToStart:n.StartToEnd:t===s?n.EndToEnd:n.EndToStart}}DependencyModel.exposeProperties(),DependencyModel._$name="DependencyModel";class DependencyStore extends AjaxStore{static get defaultConfig(){return{loadPriority:400,syncPriority:400,modelClass:DependencyModel,storeId:"dependencies"}}doDestroy(){this.eventStoreDetacher&&this.eventStoreDetacher(),super.doDestroy()}get eventStore(){return this._eventStore}set eventStore(e){const t=this,r=t._eventStore;t._eventStore=e,e&&(t.attachToEventStore(e),t.isConfiguring||t.initRelations(!0)),(r||e)&&r!==e&&t.trigger("eventStoreChange",{newEventStore:e,oldEventStore:r})}attachToEventStore(e){const t=this;t.eventStoreDetacher&&t.eventStoreDetacher(),t.eventStoreDetacher=e.on({remove:t.onEventRemove,thisObj:t,detachable:!0})}onEventRemove({records:e,isMove:t=!1,isCollapse:r=!1}){t||r||e.forEach(e=>{e.traverse(e=>this.removeEventDependencies(e,!1))})}reduceEventDependencies(e,t,r,n=!0,i){return i=i||(e=>this.getEventDependencies(e)),(e=Array.isArray(e)?e:[e]).reduce((e,r)=>{r.children&&!n?r.traverse(r=>{e=i(r).reduce(t,e)}):e=i(r).reduce(t,e)},r),r}reduceEventPredecessors(e,t,r,n){return this.reduceEventDependencies(e,t,r,n,e=>{})}reduceEventSuccessors(e,t,r,n){return this.reduceEventDependencies(e,t,r,n,e=>{})}mapEventDependencies(e,t,r,n,i){return this.reduceEventDependencies(e,(e,t)=>(r(t)&&e.push(t),e),[],n,i)}mapEventPredecessors(e,t,r,n){return this.reduceEventPredecessors(e,(e,t)=>(r(t)&&e.push(t),e),[],n)}mapEventSuccessors(e,t,r,n){return this.reduceEventSuccessors(e,(e,t)=>(r(t)&&e.push(t),e),[],n)}getEventDependencies(e,t=!1){return[].concat(e.predecessors||[],e.successors||[])}getEventPredecessors(e,t=!1){return e.predecessors}getEventSuccessors(e,t=!1){return e.successors}getUnique(e){return[...new Set(e)]}removeEventDependencies(e,t){const r=this.getEventDependencies(e,t);r.length&&this.remove(this.getUnique(r))}removeEventPredecessors(e,t){const r=this.getEventPredecessors(e,t);r.length&&this.remove(this.getUnique(r))}removeEventSuccessors(e,t){const r=this.getEventSuccessors(e,t);r.length&&this.remove(this.getUnique(r))}getBySourceTargetId(e){return this.records.find(e=>DependencyStore.makeDependencySourceTargetCompositeKey(e.from,e.to))}getDependencyForSourceAndTargetEvents(e,t){return e=Model.asId(e),t=Model.asId(t),this.getBySourceTargetId(DependencyStore.makeDependencySourceTargetCompositeKey(e,t))}getEventsLinkingDependency(e,t){return this.getDependencyForSourceAndTargetEvents(e,t)||this.getDependencyForSourceAndTargetEvents(t,e)}isValidDependency(e,t,r){return 1===arguments.length&&(e.type,t=e.to,e=e.from),null!=e&&null!=t&&e!==t}getHighlightedDependencies(e){return this.records.reduce((t,r)=>(r.isHighlightedWith(e)&&t.push(r),t),[])}static makeDependencySourceTargetCompositeKey(e,t){return`source(${e})-target(${t})`}getTimeSpanDependencies(e){return this.getEventDependencies(e)}}DependencyStore._$name="DependencyStore";class CrudManager extends(JsonEncoder(AjaxTransport(AbstractCrudManager))){static get defaultConfig(){return{resourceStoreClass:ResourceStore,eventStoreClass:EventStore,assignmentStoreClass:AssignmentStore,dependencyStoreClass:DependencyStore,resourceStore:{},eventStore:{},assignmentStore:null,dependencyStore:null,addRelatedStores:!0}}construct(e={}){e.scheduler&&(this.scheduler=e.scheduler,this.scheduler._crudManager=this),super.construct(e)}afterConstruct(){const e=this,t=e.scheduler;if(t){const r=t.features;t.store||(t.resourceStore=e.resourceStore,t.eventStore=e.eventStore);let n=r.dependencies,i=r.timeRanges;n&&(e.dependencyStore=n.store),i&&(e.addCrudStore(i.store),e._timeRangesStore=i.store)}super.afterConstruct()}get timeRangesStore(){return this._timeRangesStore}addFeaturedStore(e){this.addPrioritizedStore(e)}static getEventStoreInfo(e,t){e instanceof EventStore||(e="string"==typeof e?Store.getStore(e):e.store);let r={},n=t.assignmentStore,i=t.resourceStore,s=t.dependencyStore;return!n&&(r.assignmentStore=e.assignmentStore),!i&&(r.resourceStore=e.resourceStore),!s&&(r.dependencyStore=e.dependencyStore),r}get resourceStore(){return this._resourceStore&&this._resourceStore.store}set resourceStore(e){const t=this;t.setFeaturedStore("_resourceStore",e,t.resourceStoreClass),t.eventStore.resourceStore=t._resourceStore&&t._resourceStore.store}get eventStore(){return this._eventStore&&this._eventStore.store}set eventStore(e){const t=this;if(t.setFeaturedStore("_eventStore",e,t.eventStoreClass),e=t._eventStore&&t._eventStore.store,t.isConfiguring&&e&&!1!==t.addRelatedStores){let r=CrudManager.getEventStoreInfo(e,t.initialConfig),n=r.assignmentStore,i=r.resourceStore,s=r.dependencyStore;n&&(t.assignmentStore=n),i&&(t.resourceStore=i),s&&(t.dependencyStore=s)}}get assignmentStore(){return this._assignmentStore&&this._assignmentStore.store}set assignmentStore(e){this.setFeaturedStore("_assignmentStore",e,this.assignmentStoreClass)}get dependencyStore(){return this._dependencyStore&&this._dependencyStore.store}set dependencyStore(e){this.setFeaturedStore("_dependencyStore",e,this.dependencyStoreClass)}setFeaturedStore(e,t,r){const n=this,i=n[e];return t=Store.getStore(t,t&&t.storeClass||r),i&&n.removeStore(i),n[e]=t&&{store:t}||null,n.addFeaturedStore(n[e]),n[e]}}CrudManager._$name="CrudManager";class ResourceTimeRangeModel extends TimeSpan{static get fields(){return["resourceId","timeRangeColor"]}static get relationConfig(){return[{relationName:"resource",fieldName:"resourceId",store:"resourceStore",collectionName:"timeRanges",nullFieldOnRemove:!0}]}get isResourceTimeRange(){return!0}}ResourceTimeRangeModel._$name="ResourceTimeRangeModel";class ResourceTimeRangeStore extends AjaxStore{static get defaultConfig(){return{loadPriority:500,syncPriority:500,resourceStore:null,modelClass:ResourceTimeRangeModel,storeId:"resourceTimeRanges"}}set resourceStore(e){this._resourceStore=e,this.isConfiguring||this.initRelations(!0)}get resourceStore(){return this._resourceStore}getResourcesForEvent(e){return[e.resource]}}ResourceTimeRangeStore._$name="ResourceTimeRangeStore";let clonedConfigs=["rowHeight","tickWidth","displayDateFormat","shiftUnit","shiftIncrement","defaultSpan","timeResolution","columnLinesFor","headerConfig"];class ViewPreset extends Base{static get defaultConfig(){return{name:null,rowHeight:24,tickWidth:50,displayDateFormat:"HH:mm",shiftUnit:"hour",shiftIncrement:1,defaultSpan:12,timeResolution:null,headerConfig:null,columnLinesFor:"middle",_headers:null,ptype:""}}construct(e){super.construct(e),this.normalizeUnits()}normalizeUnits(){const e=this;let t=e.headerConfig;Object.keys(t).forEach(e=>{t[e].unit=DateHelper.normalizeUnit(t[e].unit),t[e].splitUnit&&(t[e].splitUnit=DateHelper.normalizeUnit(t[e].splitUnit))});let r=e.timeResolution;r&&(r.unit=DateHelper.normalizeUnit(r.unit)),e.shiftUnit&&(e.shiftUnit=DateHelper.normalizeUnit(e.shiftUnit))}get headers(){const e=this;if(!e._headers){const t=e._headers=[],{top:r,middle:n,bottom:i}=e.headerConfig;r&&t.push(r),n&&t.push(n),i&&t.push(i)}return e._headers}get mainHeader(){return this.headerConfig.middle}get bottomHeader(){return this.headers[this.headers.length-1]}clone(){const e={};return clonedConfigs.forEach(t=>{e[t]=this[t]}),new ViewPreset(e)}get isValid(){const e=this;let t=!0,r={};return Object.keys(e.headerConfig).forEach(n=>{r[n]=!0,t=t&&Boolean(DateHelper.normalizeUnit(e.headerConfig[n].unit))}),e.columnLinesFor in r||(e.columnLinesFor="middle"),e.timeResolution&&(t=t&&DateHelper.normalizeUnit(e.timeResolution.unit)),e.shiftUnit&&(t=t&&DateHelper.normalizeUnit(e.shiftUnit)),t}get timeColumnWidth(){return this.tickWidth}set timeColumnWidth(e){this.tickWidth=e}}ViewPreset._$name="ViewPreset";class PresetManager extends(Localizable()){static get defaultPresets(){return{secondAndMinute:{tickWidth:30,displayDateFormat:"ll LTS",shiftIncrement:10,shiftUnit:"minute",defaultSpan:24,timeResolution:{unit:"second",increment:5},headerConfig:{middle:{unit:"second",increment:10,dateFormat:"ss"},top:{unit:"minute",dateFormat:"llll"}}},minuteAndHour:{tickWidth:100,displayDateFormat:"ll LT",shiftIncrement:1,shiftUnit:"hour",defaultSpan:24,timeResolution:{unit:"minute",increment:30},headerConfig:{middle:{unit:"minute",increment:"30",dateFormat:"mm"},top:{unit:"hour",dateFormat:"ddd MM/DD, hA"}}},hourAndDay:{tickWidth:70,displayDateFormat:"ll LT",shiftIncrement:1,shiftUnit:"day",defaultSpan:24,timeResolution:{unit:"minute",increment:30},headerConfig:{middle:{unit:"hour",dateFormat:"LT"},top:{unit:"day",dateFormat:"ddd DD/MM"}}},dayAndWeek:{tickWidth:100,displayDateFormat:"ll LT",shiftUnit:"day",shiftIncrement:1,defaultSpan:5,timeResolution:{unit:"hour",increment:1},headerConfig:{middle:{unit:"day",dateFormat:"dd DD"},top:{unit:"week",renderer:(e,t,r)=>DateHelper.getShortNameOfUnit("week")+"."+DateHelper.format(e,"WW MMM YYYY")}}},weekAndDay:{tickWidth:100,displayDateFormat:"ll hh:mm A",shiftUnit:"week",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"day",increment:1},columnLinesFor:"bottom",headerConfig:{bottom:{unit:"day",increment:1,dateFormat:"DD MMM"},middle:{unit:"week",dateFormat:"YYYY MMMM DD"}}},weekAndMonth:{tickWidth:100,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:5,defaultSpan:6,timeResolution:{unit:"day",increment:1},headerConfig:{middle:{unit:"week",dateFormat:"DD MMM"},top:{unit:"month",dateFormat:"MMM YYYY"}}},monthAndYear:{tickWidth:110,displayDateFormat:"ll",shiftIncrement:3,shiftUnit:"month",defaultSpan:12,timeResolution:{unit:"day",increment:1},headerConfig:{middle:{unit:"month",dateFormat:"MMM YYYY"},top:{unit:"year",dateFormat:"YYYY"}}},year:{tickWidth:100,resourceColumnWidth:100,displayDateFormat:"ll",shiftUnit:"year",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"month",increment:1},headerConfig:{middle:{unit:"quarter",renderer:(e,t,r)=>DateHelper.getShortNameOfUnit("quarter").toUpperCase()+(Math.floor(e.getMonth()/3)+1)},top:{unit:"year",dateFormat:"YYYY"}}},manyYears:{tickWidth:50,displayDateFormat:"ll",shiftUnit:"year",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"year",increment:1},columnLinesFor:"bottom",headerConfig:{middle:{unit:"year",dateFormat:"YYYY",increment:5},bottom:{unit:"year",dateFormat:"YY",increment:1}}},weekAndDayLetter:{tickWidth:20,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"day",increment:1},columnLinesFor:"bottom",headerConfig:{bottom:{unit:"day",renderer:e=>DateHelper.format(e,"dd").substring(0,1),verticalColumnWidth:25},middle:{unit:"week",dateFormat:"ddd DD MMM YYYY",verticalColumnWidth:115}}},weekDateAndMonth:{tickWidth:30,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"day",increment:1},headerConfig:{middle:{unit:"week",dateFormat:"DD"},top:{unit:"month",dateFormat:"YYYY MMMM"}}},day:{displayDateFormat:"LT",shiftIncrement:1,shiftUnit:"day",defaultSpan:1,timeResolution:{unit:"minute",increment:30},columnLinesFor:"bottom",headerConfig:{bottom:{unit:"hour",renderer:e=>`\n                                <div class="b-sch-calendarcolumn-ct"><span class="b-sch-calendarcolumn-hours">${DateHelper.format(e,"HH")}</span>\n                                <span class="b-sch-calendarcolumn-minutes">${DateHelper.format(e,"mm")}</span></div>\n                            `},middle:{unit:"day",dateFormat:"ddd DD/MM",splitUnit:"day"}}},week:{displayDateFormat:"LT",shiftIncrement:1,shiftUnit:"week",defaultSpan:24,timeResolution:{unit:"minute",increment:30},columnLinesFor:"bottom",headerConfig:{bottom:{unit:"hour",dateFormat:"LT",renderer:e=>`\n                                <div class="sch-calendarcolumn-ct">\n                                <span class="sch-calendarcolumn-hours">${DateHelper.format(e,"HH")}</span>\n                                <span class="sch-calendarcolumn-minutes">${DateHelper.format(e,"mm")}</span>\n                                </div>\n                            `},middle:{unit:"week",dateFormat:"D d",splitUnit:"day"}}}}}static onLocalized(){const e=this;e.presets&&Object.values(e.presets).forEach(t=>{const r=e.L(t.name);r&&(r.displayDateFormat&&(t.displayDateFormat=r.displayDateFormat),r.middleDateFormat&&(t.headerConfig.middle.dateFormat=r.middleDateFormat),r.topDateFormat&&(t.headerConfig.top.dateFormat=r.topDateFormat),r.bottomDateFormat&&(t.headerConfig.bottom.dateFormat=r.bottomDateFormat))})}static registerPreset(e,t){t.name=e;let r=new ViewPreset(t);if(this.presets||(this.presets={}),!r.isValid)throw new Error("Invalid preset, please check your configuration");this.presets[e]=r}static getPreset(e){return"string"==typeof e?e=this.presets[e]:e instanceof ViewPreset||(e=new ViewPreset(e)),e}static normalizePreset(e){let t=this,r=e;if(!(r instanceof ViewPreset))if("string"==typeof r){if(!(r=t.getPreset(r)))throw new Error("You must define a valid view preset. See PresetManager for reference")}else{if("object"!=typeof r)throw new Error("Invalid preset, specify a preset name or config object");{let e=r.name&&t.getPreset(r.name);if(e)r=new ViewPreset(Object.assign(e.config,r));else{let e=r.name||"preset"+Object.keys(t.presets).length;t.registerPreset(e,r),r=t.getPreset(e)}}}return r}static deletePreset(e){delete this.presets[e]}static registerDefaults(){const e=this,t=e.defaultPresets;for(let r in t)e.registerPreset(r,t[r])}}LocaleManagerSingelton.on("locale",PresetManager.onLocalized.bind(PresetManager)),PresetManager.registerDefaults(),PresetManager.onLocalized(),PresetManager._$name="PresetManager";class TimeAxis extends Store{static get defaultConfig(){return{modelClass:TimeSpan,continuous:!0,originalContinuous:null,include:null,autoAdjust:!0,unit:null,increment:null,resolutionUnit:null,resolutionIncrement:null,weekStartDay:null,mainUnit:null,shiftUnit:null,shiftIncrement:1,adjustedStart:null,adjustedEnd:null,visibleTickStart:null,visibleTickEnd:null,defaultSpan:1,tickCache:{},viewPreset:null}}construct(e){const t=this;if(t.generateTicksValidatorFn=(()=>!0),super.construct(e),t.originalContinuous=t.continuous,t.on({change:({action:e})=>{"filter"!==e&&t.trigger("reconfigure",{supressRefresh:!1})},refresh:()=>t.trigger("reconfigure",{supressRefresh:!1}),endreconfigure:e=>t.trigger("reconfigure",e)}),t.startDate)t.internalOnReconfigure(),t.trigger("reconfigure");else if(t.viewPreset){const e=t.getAdjustedDates(new Date);t.startDate=e.startDate,t.endDate=e.endDate}}reconfigure(e,t=!1,r=!1){const n=this,i=n.getAdjustedDates(e.startDate,e.endDate);if(!1!==n.trigger("beforeReconfigure",{startDate:i.startDate,endDate:i.endDate,config:e})){if(n.trigger("beginReconfigure"),n._configuredStartDate=e.startDate,n._configuredEndDate=e.endDate,Object.assign(n,e),!1===n.internalOnReconfigure(r))return!1;n.trigger("endReconfigure",{suppressRefresh:t,config:e})}}internalOnReconfigure(e=!1){const t=this;t.isConfigured=!0;const r=t.getAdjustedDates(t.startDate,t.endDate,!0),n=t.getAdjustedDates(t.startDate,t.endDate),i=n.startDate,s=n.endDate;if(i>=s)throw new Error(`Invalid start/end dates. Start date must less than end date. Start date: ${i}. End date: ${s}.`);const o=t.unit,a=t.increment||1,l=t.generateTicks(i,s,o,a);t.suspendEvents(),t.data=l;const{count:d}=t;if(0===d){if(e)return t.resumeEvents(),!1;throw new Error("Invalid time axis configuration or filter, please check your input data.")}t.startDate=t.first.startDate,t.resumeEvents();let c=t.last.endDate;t.isContinuous?(t.adjustedStart=r.startDate,t.adjustedEnd=DateHelper.getNext(d>1?l[d-1].startDate:r.startDate,o,a,t.weekStartDay)):(t.adjustedStart=t.startDate,t.adjustedEnd=c);do{t.visibleTickStart=(t.startDate-t.adjustedStart)/(DateHelper.asMilliseconds(o)*a),t.autoAdjust&&(t.visibleTickStart=Math.floor(t.visibleTickStart)),t.visibleTickStart>=1&&(t.adjustedStart=DateHelper.getNext(t.adjustedStart,o,a,t.weekStartDay))}while(t.visibleTickStart>=1);do{t.visibleTickEnd=d-(t.adjustedEnd-c)/(DateHelper.asMilliseconds(o)*a),d-t.visibleTickEnd>=1&&(t.adjustedEnd=DateHelper.getNext(t.adjustedEnd,o,-1,t.weekStartDay))}while(d-t.visibleTickEnd>=1);t.updateTickCache(!0)}get viewPreset(){return this._viewPreset}set viewPreset(e){const t=PresetManager.getPreset(e);this._viewPreset=t,Object.assign(this,{unit:t.bottomHeader.unit,increment:t.bottomHeader.increment||1,resolutionUnit:t.timeResolution.unit,resolutionIncrement:t.timeResolution.increment,mainUnit:t.mainHeader.unit,shiftUnit:t.shiftUnit,shiftIncrement:t.shiftIncrement||1,defaultSpan:t.defaultSpan||1,presetName:t.name,headerConfig:t.headerConfig})}get resolution(){return{unit:this.resolutionUnit,increment:this.resolutionIncrement}}set resolution(e){this.resolutionUnit=e.unit,this.resolutionIncrement=e.increment}get resolutionUnit(){return this._resolutionUnit}set resolutionUnit(e){this._resolutionUnit=e}get resolutionIncrement(){return this._resolutionIncrement}set resolutionIncrement(e){this._resolutionIncrement=e||1}set mainUnit(e){this._mainUnit=e}get mainUnit(){return this._mainUnit}set shiftUnit(e){this._shiftUnit=e}get shiftUnit(){return this._shiftUnit||this._mainUnit}set shiftIncrement(e){this._shiftIncrement=e}get shiftIncrement(){return this._shiftIncrement||1}set unit(e){this._unit=e}get unit(){return this._unit}set increment(e){this._increment=e}get increment(){return this._increment}get defaultSpan(){return this._defaultSpan}set defaultSpan(e){this._defaultSpan=e}setTimeSpan(e,t,r=!1){const n=this,{startDate:i,endDate:s}=n.getAdjustedDates(e,t);if(n.startDate-i!=0||n.endDate-s!=0)return n.reconfigure({startDate:i,endDate:s},!1,r)}shift(e,t=this.shiftUnit){const r=this;let{startDate:n,endDate:i}=r;r.isFiltered&&(n=r.allRecords[0].startDate,i=r.allRecords[r.allCount-1].endDate);let s=0;do{n=DateHelper.add(n,e,t),i=DateHelper.add(i,e,t)}while(s++<100&&!1===r.setTimeSpan(n,i,!0))}shiftNext(e=this.shiftIncrement){this.shift(e)}shiftPrevious(e=this.shiftIncrement){this.shift(-e)}filterBy(e,t=this){const r=this;r.filters.clear(),super.filterBy((r,n)=>e.call(t,r.data,n)),0===r.count&&(r.trigger("invalidFilter"),r.clearFilters())}triggerFilterEvent(e){const t=this;e.filters.count?t.continuous=!1:t.continuous=t.originalContinuous,t.updateTickCache(),super.triggerFilterEvent(e)}get isContinuous(){return!1!==this.continuous&&!this.filtered}getAdjustedDates(e,t,r=!1){const n=this;return e=e||n.startDate,t=t||DateHelper.add(e,n.defaultSpan,n.mainUnit),n.autoAdjust||r?{startDate:n.floorDate(e,!1,n.autoAdjust?n.mainUnit:n.unit,1),endDate:n.ceilDate(t,!1,n.autoAdjust?n.mainUnit:n.unit,1)}:{startDate:e,endDate:t}}get startDate(){return this._start||(this.first?new Date(this.first.startDate):null)}set startDate(e){this._start=DateHelper.parse(e)}get endDate(){return this._end||(this.last?new Date(this.last.endDate):null)}set endDate(e){e&&(this._end=DateHelper.parse(e))}get startMS(){return this._startMS}get endMS(){return this._endMS}floorDate(e,t,r,n){const i=this,s=(t=!1!==t)?DateHelper.clone(i.startDate):null,o=n||i.resolutionIncrement,a=r||(t?i.resolutionUnit:i.mainUnit),l=(e,t)=>Math.floor(e/t)*t;if(t){const t=l(DateHelper.diff(s,e,a),o);return DateHelper.add(s,t,a)}let d=DateHelper.clone(e);if("week"===a){let e=d.getDay()||7,t=i.weekStartDay||7;(d=DateHelper.add(DateHelper.startOf(d,"day"),e>=t?t-e:-(7-t+e),"day")).getDay()!==t&&23===d.getHours()&&(d=DateHelper.add(d,1,"hour"))}else{d=DateHelper.startOf(d,a);let e=["day","year"].includes(a)?1:0,t="day"===a?"date":a,r=l(DateHelper.get(d,t)-e,o)+e;d=DateHelper.set(d,t,r)}return d}roundDate(e,t){let r=this,n=DateHelper.clone(e),i=r.resolutionIncrement||1;switch(t=DateHelper.clone(t||r.startDate),r.resolutionUnit){case"week":DateHelper.startOf(n,"day");let e,s=n.getDay()-r.weekStartDay;return s<0&&(s=7+s),e=1===Math.round(s/7)?7-s:-s,DateHelper.add(n,e,"day");case"month":let o=DateHelper.as("month",DateHelper.diff(t,n))+n.getDay()/DateHelper.daysInMonth(n),a=Math.round(o/i)*i;return DateHelper.add(t,a,"month");case"quarter":return DateHelper.startOf(n,"month"),DateHelper.add(n,"month",3-n.getMonth()%3);default:const l=DateHelper.as(r.resolutionUnit,DateHelper.diff(t,n)),d=DateHelper.as(r.resolutionUnit,t.getTimezoneOffset()-n.getTimezoneOffset(),"minute"),c=Math.round((l+d)/i)*i;return DateHelper.add(t,c-d,r.resolutionUnit)}}ceilDate(e,t,r,n){const i=this;t=!1!==t,n=n||(t?this.resolutionIncrement:1);let s=DateHelper.clone(e),o=!1,a=r||(t?i.resolutionUnit:i.mainUnit);switch(a){case"minute":o=!DateHelper.isStartOf(s,"minute");break;case"hour":o=!DateHelper.isStartOf(s,"hour");break;case"day":case"date":o=!DateHelper.isStartOf(s,"day");break;case"week":o=(s=DateHelper.startOf(s,"day")).getDay()!==i.weekStartDay||!DateHelper.isEqual(s,e);break;case"month":o=1!==(s=DateHelper.startOf(s,"day")).getDate()||!DateHelper.isEqual(s,e);break;case"quarter":o=(s=DateHelper.startOf(s,"day")).getMonth()%3!=0||1!==s.getDate()||!DateHelper.isEqual(s,e);break;case"year":o=0!==(s=DateHelper.startOf(s,"day")).getMonth()||1!==s.getDate()||!DateHelper.isEqual(s,e)}return o?DateHelper.getNext(s,a,n,i.weekStartDay):s}get include(){return this._include}set include(e){const t=this;t._include=e,t.continuous=!1,t.isConfiguring||(t.startDate=t._configuredStartDate,t.endDate=t._configuredEndDate,t.internalOnReconfigure())}processExclusion(e,t,r){const{include:n}=this;return!!n&&Object.entries(n).some(([n,i])=>{if(!i)return!1;const{from:s,to:o}=i;if(DateHelper.compareUnits("day",r)>=0&&DateHelper.getLargerUnit(n)===r&&(s&&DateHelper.set(e,n,s),o)){let e=r;"day"===r&&(e="date"),DateHelper.set(t,{[e]:DateHelper.get(t,e)-1,[n]:o})}if(DateHelper.compareUnits(n,r)>=0){const t="day"===n?e.getDay():DateHelper.get(e,n);if(s&&t<s||o&&t>=o)return!0}})}initExclusion(){Object.entries(this.include).forEach(([e,t])=>{if(t){const{from:r,to:n}=t;t.lengthFactor=DateHelper.getUnitToBaseUnitRatio(e,DateHelper.getLargerUnit(e))/(n-r),t.lengthFactorExcl=DateHelper.getUnitToBaseUnitRatio(e,DateHelper.getLargerUnit(e))/(n-r-1),t.center=r+r/(t.lengthFactor-1)}})}generateTicks(e,t,r=this.unit,n=this.increment){const i=this,s=[],o=Boolean(i.include);let a,l,d,c=0,{startDate:u,endDate:h}=i.getAdjustedDates(e,t);for(i.tickCache={},o&&i.initExclusion();u<h;){if(a=DateHelper.getNext(u,r,n,i.weekStartDay),!i.autoAdjust&&a>h&&(a=h),"hour"===r&&n>1&&s.length>0&&0===c){const e=s[s.length-1];0!==(c=(e.startDate.getHours()+n)%24-e.endDate.getHours())&&(a=DateHelper.add(a,c,"hour"))}d=!1,o?(l=new Date(a.getTime()),d=i.processExclusion(u,a,r)):l=a,i.generateTicksValidatorFn(u)&&!d&&(s.push({startDate:u,endDate:a}),i.tickCache[u.getTime()]=s.length-1),u=l}return s}get visibleTickTimeSpan(){return this.isContinuous?this.visibleTickEnd-this.visibleTickStart:this.count}getTickFromDate(e){const t=this,r=t.records;let n,i,s,o,a=0,l=r.length-1;if(!r.length||e<r[0].startDate||e>r[l].endDate)return-1;if(t.isContinuous){for(;a<l;)e>r[n=a+l+1>>1].endDate?a=n+1:e<r[n].startDate?l=n-1:a=n;return s=(i=r[a]).startDate,o=i.endDate,e>s&&(a+=(e-s)/(o-s)),Math.min(Math.max(a,t.visibleTickStart),t.visibleTickEnd)}for(let t=0;t<=l;t++)if(e<=(o=r[t].endDate))return i=t+(e>(s=r[t].startDate)?(e-s)/(o-s):0)}getDateFromTick(e,t){const r=this;if(e===r.visibleTickEnd)return r.endDate;const n=Math.floor(e),i=e-n,s=r.getAt(n);if(!s)return null;let o=0===n?r.adjustedStart:s.startDate,a=n===r.count-1&&r.isContinuous?r.adjustedEnd:s.endDate,l=DateHelper.add(o,i*(a-o),"millisecond");return t&&(l=r[t+"Date"](l)),l}get ticks(){return this.records}updateTickCache(e=!1){const t=this;t.count?(t._start=t.first.startDate,t._end=t.last.endDate,t._startMS=t.startDate.getTime(),t._endMS=t.endDate.getTime()):t._start=t._end=t._startMs=t._endMS=null,e||(t.tickCache={},t.forEach((e,r)=>t.tickCache[e.startDate.getTime()]=r))}dateInAxis(e,t=!1){const r=this,n=r.startDate,i=r.endDate;if(r.isContinuous)return t?DateHelper.betweenLesserEqual(e,n,i):DateHelper.betweenLesser(e,n,i);{let n,i,s,o=r.getCount();for(let a=0;a<o;a++)if(n=(s=r.getAt(a)).startDate,i=s.endDate,t&&e<=i||!t&&e<i)return e>=n}return!1}timeSpanInAxis(e,t){const r=this;return t.getTime()===e.getTime()?this.dateInAxis(e,!0):r.isContinuous?DateHelper.intersectSpans(e,t,r.startDate,r.endDate):e<r.startDate&&t>r.endDate||r.getTickFromDate(e)!==r.getTickFromDate(t)}isTimeSpanInAxis(e){const t=this,r=e.startDateMS,n=e.endDateMS;return!(!r||!n)&&(n===r?this.dateInAxis(e.startDate,!0):t.isContinuous?n>t.startMS&&r<t.endMS:r<t.startMS&&n>t.endMS||t.getTickFromDate(e.startDate)!==t.getTickFromDate(e.endDate))}forEachAuxInterval(e,t=1,r,n=this){let i,s=this.endDate,o=this.startDate,a=0;if(o>s)throw new Error("Invalid time axis configuration");for(;o<s;)i=DateHelper.min(DateHelper.getNext(o,e,t,this.weekStartDay),s),r.call(n,o,i,a),o=i,a++}}TimeAxis._$name="TimeAxis";class ColumnLines extends InstancePlugin{static get properties(){return{tickColor:"#e6e6e6",majorTickColor:"#999",tickStyle:"solid",majorTickStyle:"solid"}}static get pluginConfig(){return{after:["render"]}}construct(e,t){const r=this;e.useBackgroundCanvas=!0,super.construct(e,t),r.timeAxisViewModel=e.timeAxisViewModel,e.on({theme:"onThemeChange",thisObj:r}),r.timeAxisViewModelDetatcher=r.timeAxisViewModel.on({reconfigure:"onTimeAxisViewModelUpdate",update:"onTimeAxisViewModelUpdate",thisObj:r})}doDestroy(){this.timeAxisViewModelDetatcher&&this.timeAxisViewModelDetatcher(),super.doDestroy()}getColorsFromCSS(){const e=this;if(!e.GotColors){const t=DomHelper.createElement({style:"position: absolute; visibility: hidden",html:'<div class="b-column-line"></div><div class="b-column-line-major"></div>',parent:document.body}),r=DomHelper.getStyleValue(t.firstElementChild,"border-left-color"),n=DomHelper.getStyleValue(t.lastElementChild,"border-left-color"),i=DomHelper.getStyleValue(t.firstElementChild,"border-left-style"),s=DomHelper.getStyleValue(t.lastElementChild,"border-left-style");r&&(e.tickColor=r),n&&(e.majorTickColor=n),i&&(e.tickStyle=i),s&&(e.majorTickStyle=s),t.remove(),e.GotColors=!0}}onThemeChange(){this.GotColors=!1,this.render()}render(){this.getColorsFromCSS(),this.drawLines()}drawLines(){const e=this,t=e.client.timeAxis,r=t.startDate;if(r){const n=e.client.backgroundCanvas,i=document.createElement("canvas"),s=i.getContext("2d"),o=e.client.timeAxisViewModel,a=o.tickWidth,l=o.columnLinesFor,d=o.headerConfig[l],c=o.headers,u=c[c.indexOf(d)-1]||c[0],h=c[c.length-1],g=t.floorDate(r,!1,u.unit,"year"===u.unit?1:u.increment||1),m=DateHelper.getNext(g,u.unit,u.increment||1,t.weekStartDay),p=Math.round(DateHelper.getDurationInUnit(g,m,h.unit))/(h.increment||1),f=Math.round(DateHelper.getDurationInUnit(g,m,d.unit))/(d.increment||1),v=p/f,y=c.length>1&&DateHelper.doesUnitsAlign(u.unit,d.unit),b=y?g:t.floorDate(r,!1,d.unit,d.increment),C=t.isContinuous?DateHelper.getDurationInUnit(b,r,h.unit,!0)/t.increment*a:0,S=10,w=20;DomHelper.removeEachSelector(n,".b-column-line-major");let D=!1,E=!0;d!==u&&y&&"day"===h.unit&&-1!==DateHelper.compareUnits(u.unit,"month")&&(E=!1,t.forEachAuxInterval(u.unit,u.increment,(e,t)=>{DomHelper.append(n,{tag:"div",className:"b-column-line-major",style:`left:${o.getPositionFromDate(t)-1}px;`})})),i.width=Math.min(2*p*a,32767),i.height=w,s.translate(-.5,-.5),s.lineWidth=2;for(let r=0;r<f;r++){const n=(D=0===r&&(u!==d&&y&&E&&t.isContinuous))&&e.majorTickStyle||!D&&e.tickStyle;if("solid"!==n)switch(n){case"dashed":s.setLineDash([6,4]);break;case"dotted":s.setLineDash([2,3])}s.beginPath(),s.strokeStyle=D?e.majorTickColor:e.tickColor,s.moveTo(r*v*a*2+S-1,0),s.lineTo(r*v*a*2+S-1,w+2),s.stroke()}n.style.backgroundImage=`url(${i.toDataURL()})`,n.style.backgroundSize=`${i.width/2}px`,n.style.backgroundPositionX=`${-(S/2+C)}px`}}onTimeAxisViewModelUpdate({source:e}){e.tickWidth!==this.columnWidth&&this.drawLines()}}ColumnLines._$name="ColumnLines",GridFeatureManager.registerFeature(ColumnLines,!0,"Scheduler");var DependencyCreation=e=>(class extends(Delayable(e||Base)){static get defaultConfig(){return{showCreationTooltip:!0,creationTooltip:null,terminalCls:"b-sch-terminal",terminalSides:["left","top","right","bottom"]}}construct(e,t){super.construct(e,t);const r=this,n=r.eventName=e.scheduledEventName;r.view=e,r.listenersDetacher=e.on({[`${n}mouseenter`]:r.onTimeSpanMouseEnter,[`${n}mouseleave`]:r.onTimeSpanMouseLeave,thisObj:r})}doDestroy(){const e=this;e.listenersDetacher&&e.listenersDetacher(),e.abort(),e.creationTooltip&&e.creationTooltip.destroy(),super.doDestroy()}onTimeSpanMouseEnter(e){const t=e[`${this.eventName}Record`],r=e[`${this.eventName}Element`];this.showTerminals(t,DomHelper.down(r,e.source.eventInnerSelector))}onTimeSpanMouseLeave(e){const t=this,r=e[`${t.eventName}Element`];t.creationData&&DomHelper.isDescendant(r,t.creationData.sourceTerminal.parentElement)||t.hideTerminals(r)}onTerminalMouseOut(e){const t=this,r=DomHelper.up(e.target,t.view.eventSelector);DomHelper.isDescendant(r,t.showingTerminalsFor)||t.creationData&&r===t.creationData.sourceTerminal.parentElement||(t.hideTerminals(r),t.view.unhover(e))}onTerminalMouseDown(e){if(0===e.button){const t=this,r=t.view,n=r.timeAxisSubGridElement,i=e.target,s=i.parentElement.closest(r.eventSelector),o=Rectangle.from(r.element,document.body);e.preventDefault(),e.stopPropagation(),t.creationData={source:r.resolveTimeSpanRecord(s),sourceTerminal:i,startPoint:Rectangle.from(i,n).center,startX:e.pageX-o.x+r.scrollLeft,startY:e.pageY-o.y+r.scrollTop,valid:!1},r.resolveResourceRecord&&(t.creationData.sourceResource=r.resolveResourceRecord(s)),t.mouseDetacher=EventHelper.on({mouseup:{element:document.body,handler:"onMouseUp"},mousemove:{element:n,handler:"onMouseMove"},thisObj:t})}}onMouseMove(e){const t=this,r=t.view,n=t.creationData,i=Rectangle.from(r.element,document.body),s=e.pageX-i.x+r.scrollLeft-n.startX,o=e.pageY-i.y+r.scrollTop-n.startY,a=Math.round(Math.sqrt(s*s+o*o))-3,l=Math.atan2(o,s);if(!t.connector){if(!1===r.trigger("beforeDependencyCreateDrag",{data:t.creationData}))return void t.abort();t.createConnector(n.startPoint.x,n.startPoint.y),r.trigger("dependencyCreateDragStart",{data:t.creationData})}if(t.connector.style.width=`${a}px`,t.connector.style.transform=`rotate(${l}rad)`,e.target.matches(`.${t.terminalCls}`)&&e.target!==n.sourceTerminal){n.targetTerminal=e.target,n.target=r.resolveTimeSpanRecord(e.target),r.resolveResourceRecord&&(n.targetResource=r.resolveResourceRecord(e.target));const i=n.sourceTerminal.dataset.side,s=n.targetTerminal.dataset.side,o=r=>{n.valid=r,e.target.classList.add(r?"b-valid":"b-invalid"),t.connector.classList.add(r?"b-valid":"b-invalid")};let a;switch(!0){case"left"===i&&"left"===s:a=DependencyBaseModel.Type.StartToStart;break;case"left"===i&&"right"===s:a=DependencyBaseModel.Type.StartToEnd;break;case"right"===i&&"left"===s:a=DependencyBaseModel.Type.EndToStart;break;case"right"===i&&"right"===s:a=DependencyBaseModel.Type.EndToEnd}n.valid=r.dependencyStore.isValidDependency(n.source.id,n.target.id,a),n.valid instanceof Promise?n.valid.then(o):o(n.valid)}else n.target=n.targetTerminal=null,n.valid=!1,t.connector.classList.remove("b-valid"),t.connector.classList.remove("b-invalid");t.lastMouseMoveEvent=e}onMouseUp(e){const t=this,r=t.creationData;r.valid&&e.target.matches(`.${t.terminalCls}`)?(r.targetTerminal=e.target,t.createDependency(),r.valid=!0,t.view.trigger("dependencyCreateDrop",{data:r})):r.valid=!1,t.view.trigger("afterDependencyCreateDrop",{data:r}),t.abort()}abort(){const e=this,{view:t,creationData:r}=e;if(r){const{source:n,sourceResource:i,target:s,targetResource:o}=r;if(n){const r=t.getElementFromEventRecord(n,i);r&&e.hideTerminals(r)}if(s){const r=t.getElementFromEventRecord(s,o);r&&e.hideTerminals(r)}}e.creationData=null,e.mouseDetacher&&e.mouseDetacher(),e.removeConnector()}createConnector(e,t){const r=this,n=r.view;r.connector=DomHelper.createElement({parent:n.timeAxisSubGridElement,className:`${r.baseCls}-connector`,style:`left:${e}px;top:${t}px`}),n.element.classList.add("b-creating-dependency"),r.showCreationTooltip&&(r.creationTooltip?r.creationTooltip.show():r.creationTooltip=new Tooltip(Object.assign({id:`${n.id}-dependency-drag-tip`,cls:"b-sch-dependency-creation-tooltip",autoShow:!0,anchorToTarget:!1,trackMouse:!0,constrainTo:n.timeAxisSubGridElement,onBeforeAlign:e=>r.updateTipContent(e.source,r.creationData),header:{dock:"right"}},r.creationTooltip||{}))),n.scrollManager.startMonitoring({element:n.timeAxisSubGridElement,callback:()=>r.creationData&&r.lastMouseMoveEvent&&r.onMouseMove(r.lastMouseMoveEvent),thisObj:r})}removeConnector(e){const t=this,{connector:r,view:n}=t;r&&(r.classList.add("b-removing"),r.style.width="0",t.setTimeout(()=>{r.remove(),t.connector=null,e&&e.call(t)},200)),n.element.classList.remove("b-creating-dependency"),t.creationTooltip&&t.creationTooltip.hide(),n.scrollManager.stopMonitoring(n.timeAxisSubGridElement)}showTerminals(e,t){const r=this,n=r.terminalCls,i=`${n}s-visible`;(t=DomHelper.down(t,r.view.eventInnerSelector)).classList.contains(i)||this.view.element.classList.contains("b-resizing-event")||r.view.readOnly||(r.terminalSides.forEach(e=>{const i=DomHelper.createElement({parent:t,className:`${n} ${n}-${e}`,dataset:{side:e,feature:!0}});i.detacher=EventHelper.on({element:i,mouseout:"onTerminalMouseOut",mousedown:{handler:"onTerminalMouseDown",capture:!0},thisObj:r})}),t.classList.add(i),e.cls.add(i),r.showingTerminalsFor=t)}hideTerminals(e){const t=this,r=t.client.getTimeSpanMouseEventParams(e)[`${this.eventName}Record`],n=`${t.terminalCls}s-visible`;DomHelper.forEachSelector(e,`.${t.terminalCls}`,e=>{e.detacher&&e.detacher(),e.remove()}),DomHelper.down(e,t.view.eventInnerSelector).classList.remove(n),r.cls.remove(n),t.showingTerminalsFor=null}createDependency(){const e=this.creationData,t=e.source,r=e.target,n=e.sourceTerminal.dataset.side,i=e.targetTerminal.dataset.side,s=("left"===n?0:2)+("right"===i?1:0);this.store.add({from:t.id,to:r.id,type:s,fromSide:n,toSide:i})}updateTipContent(e,t){const r=this;let n,i,{valid:s}=t;Object.assign(t,{fromText:t.source.name,toText:t.target?t.target.name:"",fromSide:t.sourceTerminal.dataset.side,toSide:t.targetTerminal?t.targetTerminal.dataset.side:""}),s instanceof Promise?(e.element.classList.remove("b-invalid"),e.element.classList.add("b-checking"),n="checking",i=r.L("Checking"),s.then(n=>{t.valid=n,e.isDestroyed||r.updateTipContent(e,t)})):!0===s?(e.element.classList.remove("b-invalid"),e.element.classList.remove("b-checking"),n="valid",i=r.L("valid")):(e.element.classList.remove("b-checking"),e.element.classList.add("b-invalid"),n="invalid",i=r.L("invalid")),e.titleElement.innerHTML=`<i class="b-icon b-icon-${n}"></i>${i}`,e.html=`<table class="b-sch-dependency-creation-tooltip">\n                        <tr><td>${r.L("from")}: </td><td>${t.fromText}</td><td><div class="b-sch-box b-${t.fromSide}"></div></td></tr>\n                        <tr><td>${r.L("to")}: </td><td>${t.toText}</td><td><div class="b-sch-box b-${t.toSide}"></div></td></tr>\n                    </table>`}});class WalkHelper{static preWalk(e,t,r){let n,i,s=[e];for(;s.length;)r(n=s.pop()),(i=t(n))&&(s=s.concat(i.slice().reverse()))}static preWalkUnordered(e,t,r){let n,i,s=[e];for(;s.length;)r(n=s[s.length-1]),(i=t(n))?s.splice(s.length-1,1,...i):s.length=s.length-1}static postWalk(e,t,r){let n,i,s=new Map,o=[e];for(;o.length;)n=o[o.length-1],s.has(n)?(r(n),o.pop()):((i=t(n))&&(o=o.concat(i.slice().reverse())),s.set(n,n))}static prePostWalk(e,t,r,n){let i,s,o=new Map,a=[e];for(;a.length;)i=a[a.length-1],o.has(i)?(n(i),a.pop()):(r(i),(s=t(i))&&(a=a.concat(s.slice().reverse())),o.set(i,i))}}WalkHelper._$name="WalkHelper";class RectangularPathFinder extends Base{static get defaultConfig(){return{startSide:"right",startArrowSize:0,startArrowMargin:12,startShift:0,endSide:"left",endArrowSize:0,endArrowMargin:12,endShift:0,verticalMargin:2,horizontalMargin:5,otherBoxes:null}}findPath(e,t){let r,n,i,s,o,a,l,d,c,u,h,g,m,p,f,v,y,b,C,S,w,D,E,x,R,T,M,A,I,H,_,F=this;for(t&&!Array.isArray(t)&&(t=[t]),_=0;e&&!H;)for(n=(r=Object.assign(F.config,e)).startBox,i=r.endBox,s=r.startShift,o=r.endShift,a=r.startSide,l=r.endSide,d=r.startArrowSize,c=r.endArrowSize,u=r.startArrowMargin,h=r.endArrowMargin,g=r.horizontalMargin,m=r.verticalMargin,p=r.hasOwnProperty("startHorizontalMargin")?r.startHorizontalMargin:g,f=r.hasOwnProperty("startVerticalMargin")?r.startVerticalMargin:m,v=r.hasOwnProperty("endHorizontalMargin")?r.endHorizontalMargin:g,y=r.hasOwnProperty("endVerticalMargin")?r.endVerticalMargin:m,b=r.hasOwnProperty("otherHorizontalMargin")?r.otherHorizontalMargin:g,C=r.hasOwnProperty("otherVerticalMargin")?r.otherVerticalMargin:m,S=r.otherBoxes,a=F.normalizeSide(a),l=F.normalizeSide(l),w=F.getConnectionCoordinatesFromBoxSideShift(n,a,s),D=F.getConnectionCoordinatesFromBoxSideShift(i,l,o),M=F.calcGridBaseBoxFromBoxAndDrawParams(n,a,d,u,p,f),A=F.calcGridBaseBoxFromBoxAndDrawParams(i,l,c,h,v,y),S=S&&S.map(e=>F.calcGridBaseBoxFromBoxAndDrawParams(e,!1,0,0,b,C)),E=F.getConnectionCoordinatesFromBoxSideShift(M,a,s),x=F.getConnectionCoordinatesFromBoxSideShift(A,l,o),I=F.buildPathGrid(M,A,E,x,a,l,S),R=F.convertDecartPointToGridPoint(I,E),T=F.convertDecartPointToGridPoint(I,x),H=F.findPathOnGrid(I,R,T,a,l),e=!1;!H&&!e&&t&&_<t.length;_++)e=t[_](r);return H&&(H=F.prependPathWithArrowStaffSegment(H,w,d,a),H=F.appendPathWithArrowStaffSegment(H,D,c,l),H=F.optimizePath(H)),H}getConnectionCoordinatesFromBoxSideShift(e,t,r){let n;switch(t){case"left":n={x:e.start,y:(e.top+e.bottom)/2+r};break;case"right":n={x:e.end,y:(e.top+e.bottom)/2+r};break;case"top":n={x:(e.start+e.end)/2+r,y:e.top};break;case"bottom":n={x:(e.start+e.end)/2+r,y:e.bottom}}return n}calcGridBaseBoxFromBoxAndDrawParams(e,t,r,n,i,s){let o;switch(t){case"left":o={start:e.start-Math.max(r+n,i),end:e.end+i,top:e.top-s,bottom:e.bottom+s};break;case"right":o={start:e.start-i,end:e.end+Math.max(r+n,i),top:e.top-s,bottom:e.bottom+s};break;case"top":o={start:e.start-i,end:e.end+i,top:e.top-Math.max(r+n,s),bottom:e.bottom+s};break;case"bottom":o={start:e.start-i,end:e.end+i,top:e.top-s,bottom:e.bottom+Math.max(r+n,s)};break;default:o={start:e.start-i,end:e.end+i,top:e.top-s,bottom:e.bottom+s}}return o}buildPathGrid(e,t,r,n,i,s,o){let a,l,d,c,u,h,g,m,p,f,v,y,b,C={},S=[];for(a=[e.start,"left"===i||"right"===i?(e.start+e.end)/2:r.x,e.end,t.start,"left"===s||"right"===s?(t.start+t.end)/2:n.x,t.end],l=[e.top,"top"===i||"bottom"===i?(e.top+e.bottom)/2:r.y,e.bottom,t.top,"top"===s||"bottom"===s?(t.top+t.bottom)/2:n.y,t.bottom],o&&o.forEach(e=>{a.push(e.start,(e.start+e.end)/2,e.end),l.push(e.top,(e.top+e.bottom)/2,e.bottom)}),a=[...new Set(a.sort((e,t)=>e-t))],h=0,m=(l=[...new Set(l.sort((e,t)=>e-t))]).length;h<m;++h)for(C[h]=C[h]||{},d=l[h],u=0,g=a.length;u<g;++u){if(y=((c=a[u])<=e.start||c>=e.end||d<=e.top||d>=e.bottom)&&(c<=t.start||c>=t.end||d<=t.top||d>=t.bottom),o)for(p=0,f=o.length;y&&p<f;++p)y=c<=(v=o[p]).start||c>=v.end||d<=v.top||d>=v.bottom||c===r.x&&d===r.y||c===n.x&&d===n.y;b={distance:Math.pow(2,53)-1,permitted:y,x:c,y:d,ix:u,iy:h},C[h][u]=b,S.push(b)}return{width:a.length,height:l.length,xs:a,ys:l,points:C,linearPoints:S}}convertDecartPointToGridPoint(e,t){let r=e.xs.indexOf(t.x),n=e.ys.indexOf(t.y);return e.points[n][r]}findPathOnGrid(e,t,r,n,i){let s=this,o=!1;return t.permitted&&r.permitted&&(e=s.waveForward(e,t,0),o=s.collectPath(e,r,i)),o}getGridPointNeighbors(e,t,r){let n,i=t.ix,s=t.iy,o=[];return s<e.height-1&&(n=e.points[s+1][i],(!r||r(n))&&o.push(n)),s>0&&(n=e.points[s-1][i],(!r||r(n))&&o.push(n)),i<e.width-1&&(n=e.points[s][i+1],(!r||r(n))&&o.push(n)),i>0&&(n=e.points[s][i-1],(!r||r(n))&&o.push(n)),o}waveForward(e,t,r){const n=this;return WalkHelper.preWalkUnordered([t,r],([t,r])=>n.getGridPointNeighbors(e,t,e=>e.permitted&&e.distance>r+1).map(e=>[e,r+1]),([e,t])=>e.distance=t),e}collectPath(e,t,r){let n,i,s,o,a=this,l=!0,d=[];for(;l&&t.distance;)if(l=(n=a.getGridPointNeighbors(e,t,e=>e.permitted&&e.distance==t.distance-1)).length>0){switch(i=(n=n.sort((e,n)=>{let i,s;i=e.ix-t.ix,s=e.iy-t.iy;let o=("left"===r||"right"===r)&&0===s||("top"===r||"bottom"===r)&&0===i?-1:1;i=n.ix-t.ix,s=n.iy-t.iy;let a=("left"===r||"right"===r)&&0===s||("top"===r||"bottom"===r)&&0===i?-1:1;return o>a?1:o<a?-1:o===a?e.y>n.y?-1:1:void 0}))[0],d.push({x1:i.x,y1:i.y,x2:t.x,y2:t.y}),s=i.ix-t.ix,o=i.iy-t.iy,!0){case!o&&s>0:r="left";break;case!o&&s<0:r="right";break;case!s&&o>0:r="top";break;case!s&&o<0:r="bottom"}t=i}return l&&d.reverse()||!1}prependPathWithArrowStaffSegment(e,t,r,n){let i,s;if(e.length>0){switch(i={x2:(s=e[0]).x1,y2:s.y1},n){case"left":i.x1=t.x-r,i.y1=s.y1;break;case"right":i.x1=t.x+r,i.y1=s.y1;break;case"top":i.x1=s.x1,i.y1=t.y-r;break;case"bottom":i.x1=s.x1,i.y1=t.y+r}e.unshift(i)}return e}appendPathWithArrowStaffSegment(e,t,r,n){let i,s;if(e.length>0){switch(i={x1:(s=e[e.length-1]).x2,y1:s.y2},n){case"left":i.x2=t.x-r,i.y2=s.y2;break;case"right":i.x2=t.x+r,i.y2=s.y2;break;case"top":i.x2=s.x2,i.y2=t.y-r;break;case"bottom":i.x2=s.x2,i.y2=t.y+r}e.push(i)}return e}optimizePath(e){let t,r,n=[];if(e.length>0)for(t=e.shift(),n.push(t);e.length>0;)r=e.shift(),t.x1==r.x1&&t.y1==r.y1&&t.x2==r.x2&&t.y2==r.y2?t=r:t.y1-t.y2==0&&r.y1-r.y2==0?t.x2=r.x2:t.x1-t.x2==0&&r.x1-r.x2==0?t.y2=r.y2:(n.push(r),t=r);return n}normalizeSide(e){return RectangularPathFinder.sideToSide[e]||e}static get sideToSide(){return{l:"left",r:"right",t:"top",b:"bottom"}}}RectangularPathFinder._$name="RectangularPathFinder";const fromBoxSide=["left","left","right","right"],toBoxSide=["left","right","left","right"];class Dependencies extends(DependencyCreation(Delayable(InstancePlugin))){static get defaultConfig(){return{pathFinderConfig:null,overCls:"b-sch-dependency-over",baseCls:"b-sch-dependency",store:!1,dependencies:null,highlightDependenciesOnEventHover:!1,showTooltip:!0,tooltip:null,bufferSize:50,cacheGridSize:{x:500,index:25},drawnDependencies:[],drawnLines:[],dependenciesToRefresh:new Map,storeClass:DependencyStore}}static get pluginConfig(){return{chain:["render","renderContents","onElementClick","onElementDblClick","onElementMouseOver","onElementMouseOut"],assign:["getElementForDependency","getDependencyForElement"]}}construct(e,t={}){const r=this;r.scheduler=e,r.doScheduleDraw=r.createOnFrame("draw",[],r,!0),e.dependencyStore&&(t.store=e.dependencyStore),super.construct(e,t),e.store.on({refresh:r.onRowStoreRefresh,thisObj:r}),e.rowManager.on({translaterow:r.onTranslateRow,refresh:r.onRowsRefresh,rerender:r.onRowsRerender,changetotalheight:r.onChangeTotalHeight,thisObj:r}),e.on({horizontalscroll:r.onHorizontalScroll,svgcanvascreated:r.createMarkers,togglenode:r.onToggleNode,scroll:r.onVerticalScroll,timelineviewportresize:r.onViewportResize,thisObj:r}),r.pathFinder=new RectangularPathFinder(r.pathFinderConfig),delete r.pathFinderConfig,r.lineDefAdjusters=r.createLineDefAdjusters(),Object.defineProperty(e,"dependencies",{configurable:!0,get:()=>r.store.records,set:e=>r.store.data=e})}set store(e){const t=this,{client:r}=t;e!==t._store&&(t._store=e||(e=new this.storeClass),t._detachStoreEvents&&t._detachStoreEvents(),r.dependencyStore||(r._dependencyStore=e),e&&(r.dependencies&&(e.add(r.dependencies),delete r.dependencies),t.dependencies&&(e.add(t.dependencies),delete t.dependencies),e.metaMapId=r.id,e.eventStore=r.eventStore,t._detachStoreEvents=e.on({change:t.onDependencyChange,detachable:!0,thisObj:t})))}get store(){return this._store}doDestroy(){this.tooltip&&this.tooltip.destroy(),super.doDestroy()}createMarkers(){const e=this,t=this.client.svgCanvas;if(BrowserHelper.isEdge||BrowserHelper.isIE11){const r=e.startMarker,n=e.endMarker;t.appendChild(r),t.appendChild(n)}else{const r=e.endMarker;r.setAttribute("orient","auto-start-reverse"),t.appendChild(r)}}get startMarker(){return this.initMarkerElement("arrowStart","1","M0,3 L9,6 L9,0 z")}get endMarker(){return this.initMarkerElement("arrowEnd","8","M0,0 L0,6 L9,3 z")}initMarkerElement(e,t,r){return DomHelper.createElement({id:e,tag:"marker",ns:"http://www.w3.org/2000/svg",markerHeight:9,markerWidth:9,refX:t,refY:3,viewBox:"0 0 9 6",orient:"auto",markerUnits:"userSpaceOnUse",children:[{tag:"path",ns:"http://www.w3.org/2000/svg",d:r}]})}createLineDefAdjusters(){const e=this.client;return[function(t){let r=!1;return(t.startArrowMargin>e.barMargin||t.endArrowMargin>e.barMargin)&&(t.startArrowMargin=t.endArrowMargin=e.barMargin,r=!0),r?t:r},function(e){let t=!1;return(e.startArrowMargin>0||e.endArrowMargin>0)&&(e.startArrowMargin=e.endArrowMargin=0,t=!0),t?e:t}]}getElementForDependency(e,t=null){let r=`[depId="${e.id}"]`;return t&&(r+=`[fromId="${t.from.id}"][toId="${t.to.id}"]`),this.client.svgCanvas.querySelector(r)}getDependencyForElement(e){const t="string"==typeof e?e:e.getAttribute("depId");return this.store.getById(t)}onToggleNode(){this.dependencyGridCache=null,this.scheduleDraw(!0)}onViewportResize(){this.scheduleDraw(!0)}onTranslateRow({row:e}){e.lastTop>=0&&e.top!==e.lastTop&&this.scheduleDraw(!0)}onChangeTotalHeight(){this.scheduleDraw(!0)}onHorizontalScroll(){this.isDrawn&&this.scheduleDraw(!1)}onVerticalScroll(){this.isDrawn&&this.scheduleDraw(!1)}onRowsRefresh(){this.scheduleDraw(!0)}onRowsRerender(){this.scheduleDraw(!0)}onRowStoreRefresh({action:e}){switch(e){case"sort":case"filter":return this.dependencyGridCache=null,this.scheduleDraw(!0)}}onDependencyChange({action:e,record:t,records:r}){const n=this;if(n.scheduler.rendered){switch(e){case"dataset":n.dependencyGridCache={};case"add":const i=n._dependencyGridCache;return r.forEach(e=>{i&&n.addToGridCache(e)}),i||n._thisIsAUsedExpression(n.dependencyGridCache),void n.scheduleDraw();case"update":return n.scheduleRefreshDependency(t);case"remove":return r.forEach(e=>{n.releaseDependency(e,!0),n.removeFromCache(e)}),void n.client.trigger("dependenciesDrawn");case"removeall":case"filter":n.dependencyGridCache=null}n.scheduleDraw(!0)}}onEventChange({action:e,record:t}){switch(e){case"filter":return this.scheduleDraw(!0);case"update":return this.drawForTimeSpan(t,!0)}}onAssignmentRefresh({action:e}){"dataset"===e&&(this.resetGridCache(),this.scheduleDraw(!0))}onAssignmentChange({action:e,record:t,records:r}){const n=this;t&&(r=[t]),"add"!==e&&"remove"!==e&&"update"!==e||r.forEach(r=>{(r.event?n.store.getEventDependencies(r.event):[]).forEach(i=>{if("add"===e)n.scheduleRefreshDependency(i);else if("remove"===e){let e;(e=i.from===r.eventId?i.targetEvent.assignments.map(e=>({from:r,to:e})):i.sourceEvent.assignments.map(e=>({from:e,to:r}))).forEach(e=>{n.releaseDependency(i,e),n.removeFromCache(i,e)})}else if("update"===e){n.getDependencyAssignments(i).filter(e=>e&&(e.from===t||e.to===t)).forEach(e=>{n.scheduleRefreshDependency(i,e)})}})})}onElementClick(e){const t=this;if(e.target.matches("."+t.baseCls)){const r=DomDataStore.get(e.target).dependency,n="click"===e.type?"Click":"DblClick";t.client.trigger(`dependency${n}`,{dependency:r,event:e})}}onElementDblClick(e){return this.onElementClick(e)}onElementMouseOver(e){const t=this;if(e.target.matches("."+t.baseCls)){const r=DomDataStore.get(e.target).dependency;t.client.trigger("dependencyMouseOver",{dependency:r,event:e}),t.overCls&&t.highlight(r,t.overCls)}}onElementMouseOut(e){const t=this;if(e.target.matches("."+t.baseCls)){const r=DomDataStore.get(e.target).dependency;t.client.trigger("dependencyMouseOut",{dependency:r,event:e}),t.overCls&&!r.meta.removed&&t.unhighlight(r)}}highlight(e,t=this.overCls){const r=this.getElementForDependency(e);r&&r.classList.add(t),e.highlight(t)}unhighlight(e,t=this.overCls){const r=this.getElementForDependency(e);r&&r.classList.remove(t),e.unhighlight(t)}highlightEventDependencies(e){e.allDependencies.forEach(e=>this.highlight(e))}unhighlightEventDependencies(e){e.allDependencies.forEach(e=>this.unhighlight(e))}isDependencyVisible(e,t=null){const r=e.sourceEvent,n=e.targetEvent;let i,s;if(t){i=t.from.resource,s=t.to.resource;const{eventStore:e}=this.client;if(e.isFiltered&&(-1===e.indexOf(r)||-1===e.indexOf(n)))return!1}else i=r.resource,s=n.resource;return r instanceof Model&&i instanceof ResourceModel&&s instanceof ResourceModel&&!i.instanceMeta(this.scheduler.store).hidden&&!s.instanceMeta(this.scheduler.store).hidden}getBox(e,t,r=null){const n=this.getTimeSpanRecordFromDependency(e,t);let i;return i=r?r[t?"from":"to"].resource:n.resource,this.scheduler.getResourceEventBox(n,i,!0)}getRowRecordFromDependency(e,t,r){return r?r[t?"from":"to"].resource:this.getTimeSpanRecordFromDependency(e,t).resource}getTimeSpanRecordFromDependency(e,t=!0){return e[`${t?"source":"target"}Event`]}getMetaId(e=null){return e?`${this.client.id}-ass${e.from.id}-ass${e.to.id}`:this.client.id}getDependencyBounds(e,t=null){const r=this,n=r.client,i=e.getDateRange();if(!r.isDependencyVisible(e,t))return null;if(!i||!DateHelper.intersectSpans(i.start,i.end,n.startDate,n.endDate))return null;const s=r.getMetaId(t),o=e.instanceMeta(s);if(r._resetBoundsCache||!o.bounds||!o.bounds.layout){const i=r.getBox(e,!0,t),s=r.getBox(e,!1,t);if(!i||!s)return null;const a=r.getTimeSpanRecordFromDependency(e,!0),l=r.getTimeSpanRecordFromDependency(e,!1),d=new Rectangle(i.start,i.top,i.end-i.start,i.bottom-i.top),c=new Rectangle(s.start,s.top,s.end-s.start,s.bottom-s.top),u=Rectangle.union(d,c);[[a,d,i],[l,c,s]].map(([e,t,r])=>{if("default"===n.milestoneLayoutMode&&e.isMilestone){!n.milestoneWidth&&r.eventEl&&(n.milestoneWidth=e.iconCls?r.eventEl.firstElementChild.offsetWidth:parseInt(window.getComputedStyle(r.eventEl,":before").fontSize));const i=n.milestoneWidth||t.height;t.left-=i/2,t.right+=i/2}}),o.bounds={bounds:u,startRectangle:d,endRectangle:c,layout:i.layout&&s.layout}}return e.instanceMeta(s).bounds}get dependencyGridCache(){const e=this;return e._dependencyGridCache||(e._dependencyGridCache={},e.store.forEach(t=>e.addToGridCache(t))),e._dependencyGridCache}getDependencyAssignments(e){if(!this.client.assignmentStore)return[null];const t=e.sourceEvent.assignments,r=e.targetEvent.assignments,n=[];return t.forEach(e=>r.forEach(t=>{n.push({from:e,to:t})})),n}addToGridCache(e){const t=this,{dependencyGridCache:r,cacheGridSize:n}=t,i=t.client.store;t.getDependencyAssignments(e).forEach(s=>{const o=t.getDependencyBounds(e,s);if(o){const a=t.getMetaId(s),l=e.instanceMeta(a).gridCache=[],d=i.indexOf(t.getRowRecordFromDependency(e,!0,s)),c=i.indexOf(t.getRowRecordFromDependency(e,!1,s)),u=Math.min(d,c),h=Math.max(d,c),g=o.bounds,m=Math.floor(Math.max(g.x,0)/n.x),p=Math.floor(g.right/n.x),f=Math.floor(u/n.index),v=Math.floor(h/n.index);let y,b,C,S;for(C=m;C<=p;C++)for(y=r[C]||(r[C]={}),S=f;S<=v;S++)(b=y[S]||(y[S]=[])).push({dependency:e,assignmentData:s,metaId:a}),l.push([C,S])}})}removeFromCache(e,t=null){const r=this;(t?[t]:r.getDependencyAssignments(e)).forEach(t=>{const n=r.getMetaId(t),i=e.instanceMeta(n);i.gridCache&&r._dependencyGridCache&&i.gridCache.forEach(([n,i])=>{if(r._dependencyGridCache.hasOwnProperty(n)&&r._dependencyGridCache[n].hasOwnProperty(i)){const s=r._dependencyGridCache[n][i],o=s.findIndex(r=>r.dependency===e&&(r.assignmentData===t||r.assignmentData.from===t.from&&r.assignmentData.to===t.to));o>-1&&s.splice(o,1)}}),i.bounds=null,i.gridCache=null})}set dependencyGridCache(e){this._dependencyGridCache=e}resetBoundsCache(){this._resetBoundsCache=!0}resetGridCache(){this.dependencyGridCache=null}prepareLineDef(e,t,r=null){const n=this,i=n.getTimeSpanRecordFromDependency(e,!0),s=n.getTimeSpanRecordFromDependency(e,!1),o=e.type;let a=e.fromSide,l=e.toSide;if(!a)switch(!0){case o===DependencyModel.Type.StartToEnd:case o===DependencyModel.Type.StartToStart:a=n.getConnectorStartSide(i);break;case o===DependencyModel.Type.EndToStart:case o===DependencyModel.Type.EndToEnd:a=n.getConnectorEndSide(i);break;default:throw new Error("Invalid dependency type: "+o)}if(!l)switch(!0){case o===DependencyModel.Type.StartToEnd:l=n.getConnectorEndSide(s);break;case o===DependencyModel.Type.StartToStart:case o===DependencyModel.Type.EndToStart:l=n.getConnectorStartSide(s);break;case o===DependencyModel.Type.EndToEnd:l=n.getConnectorEndSide(s);break;default:throw new Error("Invalid dependency type: "+o)}const{startRectangle:d,endRectangle:c}=t;return{startBox:{start:d.x,end:d.right,top:d.y,bottom:d.bottom},endBox:{start:c.x,end:c.right,top:c.y,bottom:c.bottom},startSide:a,endSide:l}}drawLine(e,t,r,n=null){const{client:i}=this,s=this.getMetaId(n);let o=t.instanceMeta(s).lineElement;if(o||((o=t.instanceMeta(s).lineElement=document.createElementNS("http://www.w3.org/2000/svg","polyline")).setAttribute("depId",t.id),n&&(o.setAttribute("fromId",n.from.id),o.setAttribute("toId",n.to.id)),e.appendChild(o)),o.classList.length&&o.classList.remove.apply(o.classList,o.getAttribute("class").split(" ")),o.classList.add(this.baseCls),t.cls&&o.classList.add(t.cls),t.bidirectional&&o.classList.add("b-sch-bidirectional-line"),t.highlighted&&o.classList.add(...t.highlighted.split(" ")),BrowserHelper.isIE11){const e=t.getDateRange(!0),r=i.startDate;e.start<r&&o.classList.add("b-no-start-marker"),e.end<r&&o.classList.add("b-no-end-marker")}o.setAttribute("points",r?r.map((e,t)=>t!==r.length-1?`${e.x1},${e.y1}`:`${e.x1},${e.y1} ${e.x2},${e.y2}`).join(" "):""),DomDataStore.set(o,{dependency:t})}refreshDependency(e){const t=this,r=t.getDependencyAssignments(e);t.releaseDependency(e,null!==r[0]),t.removeFromCache(e),t.addToGridCache(e),r.forEach(r=>t.drawDependency(e,null,r))}refreshDependencyAssignment(e,t){this.releaseDependency(e,t),this.removeFromCache(e,t),this.addToGridCache(e),this.drawDependency(e,null,t)}scheduleRefreshDependency(e,t=null){const r=this.dependenciesToRefresh;t?r.has(e)?!0!==r.get(e)&&r.get(e).add(t):r.set(e,new Set([t])):r.set(e,!0),1===r.size&&this.requestAnimationFrame(()=>{this.refreshDependencyOnFrame()})}refreshDependencyOnFrame(){const e=this,t=e.dependenciesToRefresh;t.forEach((t,r)=>{!0===t?e.refreshDependency(r):t.forEach(t=>{e.refreshDependencyAssignment(r,t)})}),t.clear(),e.client.trigger("dependenciesDrawn",{partial:!0})}drawDependency(e,t=null,r=null){const n=this,i=n.client.svgCanvas,{drawnDependencies:s,oldDrawnDependencies:o}=n,a=t||n.getDependencyBounds(e,r),l=t=>t.dependency===e&&(t.assignmentData===r||t.assignmentData.from===r.from&&t.assignmentData.to===r.to);if(!n.disabled&&a){const t=n.prepareLineDef(e,a),o=n.pathFinder.findPath(t,n.lineDefAdjusters);n.drawLine(i,e,o,r),s.some(l)||s.push({dependency:e,assignmentData:r})}const d=o&&o.findIndex(l);d>=0&&o.splice(d,1)}drawForTimeSpan(e,t=!1){const r=this;r.client.isAnimating?r.client.on({transitionend(){r.drawForTimeSpan(e)},once:!0}):r.store.getTimeSpanDependencies(e).forEach(e=>{t?r.scheduleRefreshDependency(e):r.refreshDependency(e)})}drawForEvent(e){this.drawForTimeSpan(e)}updateDependenciesForTimeSpan(e,t){const r=this,n=e.isAssignment?e.event:e,i=r.store.getTimeSpanDependencies(n),s=r.getMetaId(),{client:o}=r,a=Rectangle.from(t,o.timeAxisSubGridElement);let l;i.forEach(t=>{r.getDependencyAssignments(t).forEach(i=>{const o=a.clone();let d,c,u;i&&i.from!==e&&i.to!==e||r.isDependencyVisible(t,i)&&(r.getTimeSpanRecordFromDependency(t,!0)===n?(d=o,(l=t.instanceMeta(s).bounds)?c=l.endRectangle:(u=r.getBox(t,!1,i))&&(c=new Rectangle(u.start,u.top,u.end-u.start,u.bottom-u.top))):((l=t.instanceMeta(s).bounds)?d=l.startRectangle:(u=r.getBox(t,!0,i))&&(d=new Rectangle(u.start,u.top,u.end-u.start,u.bottom-u.top)),c=o),d&&c&&r.drawDependency(t,{startRectangle:d,endRectangle:c},i))})})}scheduleDraw(e=!1){const t=this;e&&t.resetBoundsCache(),t.client.isAnimating?t.clientTransitionRemover||(t.clientTransitionRemover=t.client.on({transitionend(){t.clientTransitionRemover(),t.clientTransitionRemover=null,t.draw()},once:!0})):t.doScheduleDraw()}draw(e=!1){const t=this,{client:r}=t;if(!t.oldDrawnDependencies&&!t.store.count)return;const n=t.client.timeAxisSubGrid.viewRectangle;if(e&&t.resetBoundsCache(),t.oldDrawnDependencies=t.drawnDependencies,t.drawnDependencies=[],!n.width||!n.height)return[];if(n.inflate(t.bufferSize),!t.disabled&&r.store.count){const e={},{dependencyGridCache:i,cacheGridSize:s}=t,o=Math.floor(Math.max(n.left,0)/s.x),a=Math.floor(n.right/s.x),l=Math.floor(r.rowManager.topRow.dataIndex/s.index),d=Math.floor(r.rowManager.bottomRow.dataIndex/s.index);let c,u,h;for(c=o;c<=a;c++)for(u=l;u<=d;u++){const r=i[c],s=r&&r[u];for(h=0;s&&h<s.length;h++){const{dependency:r,assignmentData:i,metaId:o}=s[h],a=r.id+"-"+o;if(!e[a]){const s=t.getDependencyBounds(r,i);s&&s.bounds.intersect(n,!0)&&t.drawDependency(r,s,i),e[a]=!0}}}}t._resetBoundsCache=!1,t.oldDrawnDependencies.forEach(e=>t.releaseDependency(e.dependency,e.assignmentData)),r.trigger("dependenciesDrawn"),this.isDrawn=!0}releaseDependency(e,t=null){if(!0===t)Object.keys(e.meta.map||{}).filter(e=>e.startsWith(this.client.id)).forEach(t=>{const r=e.meta.map[t];r.lineElement&&(r.lineElement.remove(),r.lineElement=null)});else{const r=this.getMetaId(t),n=e.instanceMeta(r).lineElement;n&&(e.instanceMeta(r).lineElement=null,n.remove())}}render(){const e=this,t=e.scheduler;e.draw(),e.showTooltip&&(e.tooltip=e.createTooltip()),t.timeAxis.on({endreconfigure:e.resetGridCache,thisObj:e}),t.eventStore&&t.eventStore.on({change:e.onEventChange,thisObj:e}),t.assignmentStore&&t.assignmentStore.on({change:e.onAssignmentChange,refresh:e.onAssignmentRefresh,thisObj:e}),e.highlightDependenciesOnEventHover&&(t.on(t.scheduledEventName+"MouseEnter",t=>e.highlightEventDependencies(t.eventRecord||t.taskRecord)),t.on(t.scheduledEventName+"MouseLeave",t=>e.unhighlightEventDependencies(t.eventRecord||t.taskRecord)))}renderContents(){this.draw()}getConnectorStartSide(e){return this.client.currentOrientation.getConnectorStartSide(e)}getConnectorEndSide(e){return this.client.currentOrientation.getConnectorEndSide(e)}createTooltip(){const e=this;return new Tooltip(Object.assign({align:"b-t",id:`${e.client.id}-dependency-tip`,forSelector:`.b-timelinebase:not(.b-eventeditor-editing):not(.b-resizing-event):not(.b-dragcreating):not(.b-dragging-event):not(.b-creating-dependency) .${e.baseCls}`,clippedBy:[e.client.timeAxisSubGridElement,e.client.bodyContainer],forElement:e.client.timeAxisSubGridElement,showOnHover:!0,hoverDelay:0,hideDelay:0,anchorToTarget:!1,trackMouse:!1,getHtml:e.getHoverTipHtml.bind(e)},e.tooltip||{}))}getHoverTipHtml({tip:e,forElement:t}){const r=this.getDependencyForElement(t),n=r.sourceEvent,i=r.targetEvent;return TemplateHelper.tpl`
             <table class="b-sch-dependency-tooltip">
                <tr>
                    <td>${this.L("from")}: </td>
                    <td>${n.name}</td>
                    <td>
                        <div class="b-sch-box b-${fromBoxSide[r.type]}"></div>
                    </td>
                </tr>
                <tr>
                    <td>${this.L("to")}: </td>
                    <td>${i.name}</td>
                    <td><div class="b-sch-box b-${toBoxSide[r.type]}"></div></td>
                </tr>
            </table>
        `}get disabled(){return this._disabled}set disabled(e){this._disabled=e,this.client.rendered&&this.draw()}}Dependencies._$name="Dependencies",GridFeatureManager.registerFeature(Dependencies,!1,"Scheduler"),!document.createElementNS||"classList"in document.createElementNS("http://www.w3.org/2000/svg","g")||function(e){if("Element"in e){var t=e.Element.prototype,r=Object,n=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},i=Array.prototype.indexOf||function(e){for(var t=0,r=this.length;t<r;t++)if(t in this&&this[t]===e)return t;return-1},s=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},o=function(e,t){if(""===t)throw new s("SYNTAX_ERR","The token must not be empty.");if(/\s/.test(t))throw new s("INVALID_CHARACTER_ERR","The token must not contain space characters.");return i.call(e,t)},a=function(e){for(var t=n.call(e.getAttribute("class")||""),r=t?t.split(/\s+/):[],i=0,s=r.length;i<s;i++)this.push(r[i]);this._updateClassName=function(){e.setAttribute("class",this.toString())}},l=a.prototype=[],d=function(){return new a(this)};if(s.prototype=Error.prototype,l.item=function(e){return this[e]||null},l.contains=function(e){return~o(this,e+"")},l.add=function(){var e,t=arguments,r=0,n=t.length,i=!1;do{e=t[r]+"",~o(this,e)||(this.push(e),i=!0)}while(++r<n);i&&this._updateClassName()},l.remove=function(){var e,t,r=arguments,n=0,i=r.length,s=!1;do{for(e=r[n]+"",t=o(this,e);~t;)this.splice(t,1),s=!0,t=o(this,e)}while(++n<i);s&&this._updateClassName()},l.toggle=function(e,t){var r=this.contains(e),n=r?!0!==t&&"remove":!1!==t&&"add";return n&&this[n](e),!0===t||!1===t?t:!r},l.replace=function(e,t){var r=o(e+"");~r&&(this.splice(r,1,t),this._updateClassName())},l.toString=function(){return this.join(" ")},r.defineProperty){var c={get:d,enumerable:!0,configurable:!0};try{r.defineProperty(t,"classList",c)}catch(e){void 0!==e.number&&-2146823252!==e.number||(c.enumerable=!1,r.defineProperty(t,"classList",c))}}else r.prototype.__defineGetter__&&t.__defineGetter__("classList",d)}}(window),function(){var e=document.createElement("_");if(e.classList.add("c1","c2"),!e.classList.contains("c2")){var t=function(e){var t=DOMTokenList.prototype[e];DOMTokenList.prototype[e]=function(e){for(var r=0,n=arguments.length;r<n;r++)e=arguments[r],t.call(this,e)}};t("add"),t("remove")}if(e.classList.toggle("c3",!1),e.classList.contains("c3")){var r=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(e,t){return 1 in arguments&&!this.contains(e)==!t?t:r.call(this,e)}}"replace"in document.createElement("_").classList||(DOMTokenList.prototype.replace=function(e,t){var r=this.toString().split(" "),n=r.indexOf(e+"");~n&&(r=r.slice(n),this.remove.apply(this,r),this.add(t),this.add.apply(this,r.slice(1)))}),e=null}();class DisplayField extends TextField{static get defaultConfig(){return{readOnly:!0,editable:!1,cls:"b-display-field"}}get focusElement(){}set readOnly(e){}get readOnly(){return!0}}DisplayField._$name="DisplayField",BryntumWidgetAdapterRegister.register("display",DisplayField);class DependencyEditor extends Popup{static get defaultConfig(){return{items:[],draggable:{handleSelector:":not(button,.b-field-inner)"},axisLock:"flexible"}}processWidgetConfig(e){const t=this.dependencyEditFeature;return!("lagField"===e.ref&&!t.showLagField)&&(!("deleteButton"===e.ref&&!t.showDeleteButton)&&(Object.assign(e,{}),super.processWidgetConfig(e)))}afterShow(...e){const t=this.widgetMap.deleteButton;t&&(t.visible=this.record.isPartOfStore()),super.afterShow(...e)}onInternalKeyDown(e){this.trigger("keyDown",{event:e}),super.onInternalKeyDown(e)}}DependencyEditor._$name="DependencyEditor";class DependencyEdit extends InstancePlugin{static get defaultConfig(){return{autoClose:!0,saveAndCloseOnEnter:!0,showDeleteButton:!0,triggerEvent:"dependencydblclick",showLagField:!1,dependencyRecord:null,editorConfig:{title:"L{Edit dependency}",localeClass:this,closable:!0,items:[{type:"display",localeClass:this,label:"L{From}",editable:!1,ref:"fromNameField"},{type:"display",localeClass:this,label:"L{To}",ref:"toNameField"},{type:"combo",localeClass:this,label:"L{Type}",name:"type",ref:"typeField",editable:!1,valueField:"id",displayField:"name",items:Object.keys(DependencyModel.Type).map(e=>({id:DependencyModel.Type[e],name:this.L(e)}))},{type:"duration",localeClass:this,label:"L{Lag}",name:"lag",ref:"lagField"}],bbar:[{type:"widget",cls:"b-label-filler"},{color:"b-green",localeClass:this,text:"L{Save}",ref:"saveButton"},{color:"b-gray",localeClass:this,text:"L{Delete}",ref:"deleteButton"},{color:"b-gray",localeClass:this,text:"L{Cancel}",ref:"cancelButton"}]}}}construct(e,t){const r=this;if(e.dependencyEdit=r,r.dependencyStore=e.dependencyStore,super.construct(e,t),!e.features.dependencies)throw new Error("Dependencies feature required when using DependencyEdit");r.clientListenersDetacher=e.on({[r.triggerEvent]:r.onActivateEditor,thisObj:r})}doDestroy(){this.clientListenersDetacher(),this.editor&&this.editor.destroy(),super.doDestroy()}get editorConfig(){return this._editorConfig}set editorConfig(e){const t=this.getDefaultConfiguration().editorConfig;(e=ObjectHelper.assign({},t,e)).items=e.items||[],this._editorConfig=e}get isValid(){return Object.values(this.editor.widgetMap).every(e=>!(e.name&&!e.hidden)||!1!==e.isValid)}get values(){const e={};return this.editor.eachWidget(t=>{t.name&&!t.hidden&&(e[t.name]=t.value)},!0),e}onBeforeSave(e){}onAfterSave(e){}updateRecord(e){const t=this.values;if(e.beginBatch(),e.set(t),this.lagField){const t=this.lagField.value;e.setLag(t.magnitude,t.unit)}e.endBatch()}onPopupKeyDown({event:e}){"Enter"===e.key&&this.saveAndCloseOnEnter&&"input"===e.target.tagName.toLowerCase()&&(e.preventDefault(),this.onSaveClick())}onSaveClick(){this.save()&&this.editor.hide()}onDeleteClick(){this.deleteDependency(),this.editor.hide()}onCancelClick(){this.editor.hide()}internalShowEditor(e){const t=this,r=t.client;if(!1===r.trigger("beforeDependencyEdit",{dependencyEdit:t,dependencyRecord:e}))return;const n=t.getEditor(e);t.loadRecord(e),r.trigger("beforeDependencyEditShow",{dependencyEdit:t,dependencyRecord:e,editor:n}),n.showByPoint(t.lastPointerDownCoordinate)}editDependency(e){this.client.readOnly||this.internalShowEditor(e)}getEditor(){const e=this;let{editor:t}=e;return t||(0===(t=e.editor=new DependencyEditor(ObjectHelper.assign({dependencyEditFeature:e,autoShow:!1,anchor:!0,scrollAction:"realign",clippedBy:[e.client.timeAxisSubGridElement,e.client.bodyContainer],constrainTo:window,autoClose:e.autoClose,cls:e.cls,listeners:{keydown:e.onPopupKeyDown,thisObj:e}},e.editorConfig))).items.length&&console.warn("Editor configured without any `items`"),t.eachWidget(t=>{const r=t.ref||t.id;r&&!e[r]&&(e[r]=t)}),e.saveButton&&e.saveButton.on("click",e.onSaveClick,e),e.deleteButton&&e.deleteButton.on("click",e.onDeleteClick,e),e.cancelButton&&e.cancelButton.on("click",e.onCancelClick,e),e.editor)}loadRecord(e){const t=this;t.fromNameField.value=e.sourceEvent.name,t.toNameField.value=e.targetEvent.name,t.lagField&&(t.lagField.unit=e.lagUnit),t.editor.record=t.dependencyRecord=e}save(){const e=this,{client:t,dependencyRecord:r}=e;if(!r||!e.isValid)return;const n=e.dependencyStore,i=e.values;if(!1!==t.trigger("beforeDependencySave",{dependencyRecord:r,values:i})){if(e.onBeforeSave(r),e.updateRecord(r),n&&!r.stores.length){if(!1===t.trigger("beforeDependencyAdd",{dependencyRecord:r,dependencyEdit:e}))return;n.add(r)}t.project&&t.project.propagate(),t.trigger("afterDependencySave",{dependencyRecord:r}),e.onAfterSave(r)}return r}deleteDependency(){const e=this;return!1!==e.client.trigger("beforeDependencyDelete",{dependencyRecord:e.dependencyRecord})&&(e.editor.containsFocus&&e.editor.revertFocus(),e.client.dependencyStore.remove(e.dependencyRecord),e.client.project&&e.client.project.propagate(),!0)}onActivateEditor({dependency:e,event:t}){this.disabled||(this.lastPointerDownCoordinate=[t.clientX,t.clientY],this.editDependency(e))}get disabled(){return this._disabled}set disabled(e){this._disabled=e}}DependencyEdit._$name="DependencyEdit",GridFeatureManager.registerFeature(DependencyEdit,!1);const applyNamedItems=function(e,t){for(const r in e){let n=e[r];if(n){r in t&&(n=e[r]="object"==typeof n?ObjectHelper.merge(ObjectHelper.clone(t[r]),n):t[r]);const i=n.menu;i&&applyNamedItems("items"in i?i.items:i,t)}}};class TimeSpanRecordContextMenuBase extends InstancePlugin{static get defaultConfig(){return{defaultItems:null,items:null,processItems:null}}static get pluginConfig(){return{chain:["onElementContextMenu"]}}doDestroy(){this.menu&&this.menu.destroy()}onElementContextMenu(e){const t=this,r=t.client,n=e.target,i=DomHelper.up(n,r.eventSelector)||n;if(i){e.preventDefault();const r=t.resolveRecord(i);r&&t.showContextMenuFor(r,{targetElement:i,event:e})}}showContextMenuFor(e,t){}showContextMenu(e){const t=this,r=e.event,n=e.menuType.toLowerCase(),i=StringHelper.lowercaseFirstLetter(n),s=`get${StringHelper.capitalizeFirstLetter(n)}MenuItems`,{client:o,processItems:a,defaultItems:l,namedItems:d}=t,c=r?[r.clientX+1,r.clientY+1]:Rectangle.from(e.targetElement).center,u=e.items=ObjectHelper.isEmpty(t.items)?ObjectHelper.clone(l):ObjectHelper.merge(ObjectHelper.clone(l),t.items);e.namedItems=d,applyNamedItems(u,d),o[s]&&o[s](e,u),a&&!1===a(e)||ObjectHelper.isEmpty(e.items)||!1!==o.trigger(`${i}ContextMenuBeforeShow`,e)&&(t.menu=WidgetHelper.showContextMenu(c,{owner:o,scrollAction:"hide",clippedBy:[o.timeAxisSubGridElement,o.bodyContainer],constrainTo:window,items:u,onDestroy(){t.menu=null},onBeforeItem:t=>{Object.assign(t,e)},onItem:e=>o.trigger(`${i}ContextMenuItem`,e),listeners:{show({source:t}){e.menu=t,o.trigger(`${i}ContextMenuShow`,e)}}}))}set defaultItems(e){this._defaultItems=e}get defaultItems(){return this._defaultItems}}TimeSpanRecordContextMenuBase._$name="TimeSpanRecordContextMenuBase";class EventContextMenu extends TimeSpanRecordContextMenuBase{static get defaultConfig(){return{defaultItems:{deleteEvent:!0,unassignEvent:!0}}}resolveRecord(e){return this.client.resolveEventRecord(e)}showContextMenuFor(e,{targetElement:t,event:r}={}){const{client:n}=this;(t||(t=n.getElementsFromEventRecord(e)[0]))&&this.showContextMenu({menuType:"event",eventElement:t,targetElement:t,eventRecord:e,resourceRecord:n.resolveResourceRecord(t),assignmentRecord:n.resolveAssignmentRecord(t),event:r})}set defaultItems(e){this._defaultItems=e}get defaultItems(){const e=this._defaultItems;return this.client.assignmentStore||(e.unassignEvent=!1),e}get namedItems(){const e=this,{client:t}=e;return e._namedItems||(e._namedItems={deleteEvent:{text:t.L("Delete event"),icon:"b-icon b-icon-trash",weight:-160,onItem:({menu:e,eventRecord:r})=>{const n=e.focusInEvent&&e.focusInEvent.relatedTarget;n&&(n.focus(),t.navigator.activeItem=n),t.removeRecords([r])}},unassignEvent:{text:t.L("Unassign event"),icon:"b-icon b-icon-unassign",weight:-150,name:"unassignEvent",onItem:({menu:e,eventRecord:r,resourceRecord:n})=>{const i=e.focusInEvent&&e.focusInEvent.relatedTarget;i&&(i.focus(),t.navigator.activeItem=i),r.unassign(n)}}}),e._namedItems}}EventContextMenu.featureClass="",EventContextMenu._$name="EventContextMenu",GridFeatureManager.registerFeature(EventContextMenu,!0,"Scheduler");class ClockTemplate extends Base{static get defaultConfig(){return{minuteHeight:8,minuteTop:2,hourHeight:8,hourTop:2,handLeft:10,timeAxisViewModel:null,template:function(e){return`<div class="b-sch-clockwrap b-sch-clock-${this.mode} ${e.cls||""}">\n                    <div class="b-sch-clock">\n                        <div class="b-sch-hour-indicator">${DateHelper.format(e.date,"MMM")}</div>\n                        <div class="b-sch-minute-indicator">${DateHelper.format(e.date,"D")}</div>\n                        <div class="b-sch-clock-dot"></div>\n                    </div>\n                    <span class="b-sch-clock-text">${e.text}</span>\n                </div>`}}}construct(e){super.construct(e),this.timeAxisViewModelDetacher=this.timeAxisViewModel.on({update:this.onTimeAxisViewModelUpdate,thisObj:this})}doDestroy(){this.timeAxisViewModelDetacher&&this.timeAxisViewModelDetacher()}onTimeAxisViewModelUpdate(){delete this._mode}updateDateIndicator(e,t){const r=this,n=e.querySelector(".b-sch-hour-indicator"),i=e.querySelector(".b-sch-minute-indicator");t&&n&&i&&("hour"===r.mode?(n.style.transform=`rotate(${t.getHours()%12*30}deg)`,i.style.transform=`rotate(${6*t.getMinutes()}deg)`):(n.style.transform="none",i.style.transform="none"))}get mode(){return this._mode||(this._mode=DateHelper.compareUnits(this.timeAxisViewModel.timeResolution.unit,"day")>=0?"day":"hour")}set template(e){this._template=e}get template(){return this._template}}ClockTemplate._$name="ClockTemplate";class DragBase extends InstancePlugin{static get defaultConfig(){return{dragTipTemplate:e=>`\n                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">\n                    ${e.startClockHtml}\n                    ${e.endClockHtml}\n                    <div class="b-sch-tip-message">${e.message}</div>\n                </div>\n            `,constrainDragToResource:!0,showTooltip:!0,showExactDropPosition:!1,constrainDragToTimeline:!0,store:null,tooltipCls:null}}static get pluginConfig(){return{chain:["render"]}}render(){const e=this,t=e.client;e.drag&&e.drag.destroy(),e.drag=new DragHelper({name:e.constructor.name,mode:"translateXY",lockY:e.constrainDragToResource,minX:!0,constrain:!1,cloneTarget:!e.constrainDragToTimeline,dragWithin:e.constrainDragToTimeline?null:document.body,hideOriginalElement:!0,outerElement:t.timeAxisSubGridElement,targetSelector:t.eventSelector,isElementDraggable:(r,n)=>!t.readOnly&&e.isElementDraggable(r,n),scrollManager:e.constrainDragToTimeline?t.scrollManager:null,listeners:{beforedragstart:"onBeforeDragStart",dragstart:"onDragStart",drag:"onDrag",drop:"onDrop",abort:"onDragAbort",reset:"onDragReset",thisObj:e}}),e.showTooltip&&(e.clockTemplate=new ClockTemplate({timeAxisViewModel:t.timeAxisViewModel}))}doDestroy(){const e=this;e.drag&&e.drag.destroy(),e.clockTemplate&&e.clockTemplate.destroy(),e.tip&&e.tip.destroy(),super.doDestroy()}onBeforeDragStart({context:e,event:t}){const r=this.client,n=r.scheduledEventName,i=r.resolveEventRecord(e.element);return!(this.disabled||!i||!i.isDraggable)&&!1!==r.trigger(`before${n}Drag`,{eventRecord:i,context:this.dragData})}onDragStart({context:e,event:t}){const r=this,n=r.client,i=n.scheduledEventName;r.currentOverClient=n,r.scrollClients={},r.onMouseOverNewTimeline(n);const s=r.dragData=r.getDragData(e,t);r.showTooltip&&(r.tip?r.tip.showBy(e.element):(r.tip=new Tooltip({id:`${n.id}-event-drag-tip`,align:"b-t",autoShow:!0,clippedBy:r.constrainDragToTimeline?[n.timeAxisSubGridElement,n.bodyContainer]:null,forElement:e.element,getHtml:r.getTipHtml.bind(r),style:"pointer-events:none",cls:r.tooltipCls}),r.tip.on("innerhtmlupdate",r.updateDateIndicator,r))),n.trigger(`${i}DragStart`,{[`${i}Records`]:s.draggedRecords,context:s})}updateDateIndicator(){const{startDate:e,endDate:t}=this.dragData,r=this.tip,n=r.element.querySelector(".b-sch-tooltip-enddate");this.clockTemplate.updateDateIndicator(r.element,e),n&&this.clockTemplate.updateDateIndicator(n,t)}onDrag({context:e,event:t}){const r=this,n=r.dragData,i=n.startDate;let s;if(r.constrainToTimeline)s=r.client;else if(-1!==t.target.tagName.indexOf("-")&&t.composedPath)s=IdHelper.fromElement(t.composedPath()[0],"timelinebase");else{let e=t.target;if(/^touch/.test(t.type)){const t=Rectangle.from(n.context.element,null,!0).center;e=document.elementFromPoint(t.x,t.y)}s=IdHelper.fromElement(e,"timelinebase")}const o=r.client.features.dependencies,a=e.newX,l=e.newY;if(!s)return void(o&&o.updateDependenciesForTimeSpan(n.draggedRecords[0],n.context.element));if(s!==r.currentOverClient&&r.onMouseOverNewTimeline(s),r.updateDragContext(e,t),r.constrainDragToTimeline&&(r.showExactDropPosition||r.client.timeAxisViewModel.snap)){const t=s.getDateFromCoordinate(r.getCoordinate(n.draggedRecords[0],e.element,[a,l]))-n.sourceDate,i=new Date(n.origStart-0+t),o=s.timeAxisViewModel.getDistanceBetweenDates(i,n.startDate);n.startDate>=s.timeAxis.startDate&&null!=o&&DomHelper.addTranslateX(e.element,o)}r.triggerEventDrag(n,i);let d=r.checkDragValidity(n,t);d&&"boolean"!=typeof d&&(e.message=d.message||"",d=d.valid),e.valid=!1!==d,r.showTooltip&&r.tip.realign(),o&&o.updateDependenciesForTimeSpan(n.draggedRecords[0],n.context.element.querySelector(s.eventInnerSelector))}onMouseOverNewTimeline(e){const t=this.scrollClients;if(this.currentOverClient.element.classList.remove("b-dragging-"+this.currentOverClient.scheduledEventName),e.element.classList.add("b-dragging-"+e.scheduledEventName),!(e.id in t)){e.scrollManager.startMonitoring({element:e.timeAxisSubGridElement}),t[e.id]=e}this.currentOverClient=e}onDrop({context:e,event:t}){const r=this,{currentOverClient:n,dragData:i}=r;if(!e.valid)return r.onInvalidDrop({context:e,event:t});let s=!1;r.updateDragContext(e,t),r.tip&&r.tip.hide(),e.valid&&i.startDate&&i.endDate&&(i.finalize=((...t)=>{r.finalize(...t),e.finalize(...t)}),n.trigger(`before${n.capitalizedEventName}DropFinalize`,{context:i,event:t}),e.async=i.async,!e.async&&r.isValidDrop(i)&&(s=i.startDate-i.origStart!=0||i.newResource!==i.resourceRecord)),e.async||r.finalize(i.valid&&e.valid&&s)}onDragAbort({context:e}){this.client.currentOrientation.availableDivs.includes(e.element)&&e.element.classList.add("b-sch-released"),this.tip&&this.tip.hide()}onInvalidDrop(){const e=this;e.dragData.draggedRecords.forEach(t=>t.instanceMeta(e.currentOverClient).retainElement=!1),e.tip&&e.tip.hide()}onDragReset(){const e=this;for(const t in e.scrollClients||{})e.scrollClients[t].scrollManager.stopMonitoring(e.scrollClients[t].timeAxisSubGridElement);if(e.scrollClients=null,e.currentOverClient&&e.currentOverClient.element.classList.remove("b-dragging-"+e.currentOverClient.scheduledEventName),e.dragData&&!e.dragData.context.valid){const t=e.currentOverClient.features.dependencies;t&&t.scheduleDraw(!0)}}onInternalInvalidDrop(){const e=this,{currentOverClient:t}=e;e.tip&&e.tip.hide(),e.drag.abort(),t.trigger(`after${t.capitalizedEventName}Drop`,{[t.scheduledEventName+"Records"]:e.dragData.draggedRecords,valid:!1,context:e.dragData})}async finalize(e){const t=this,{currentOverClient:r,dragData:n}=t,{context:i,newResource:s,draggedRecords:o}=n,a=s&&r.getEventRenderId(o[0],s);let l;return i.element.classList.remove(t.drag.draggingCls),a&&r.currentOrientation.updateElementId(i.element,a),o.forEach(e=>e.instanceMeta(r).retainElement=!1),e?((l=t.updateRecords(n))instanceof Promise&&(i.async=!0,await l),n.valid?(t.drag.reset(),r.trigger(`after${r.capitalizedEventName}Drop`,{[`${r.scheduledEventName}Records`]:o,valid:!0,context:n})):t.onInternalInvalidDrop()):t.onInternalInvalidDrop(),l}updateDragContext(e,t){let r=this,n=r.dragData,i=r.currentOverClient,s=e.newX,o=e.newY,a=e.clientX,l=e.clientY,d=e.element,c=Rectangle.from(d,i.timeAxisSubGridElement),u=n.draggedRecords[0],h=u.isAssignment?u.event:u;if(n.browserEvent=t,i.timeAxis.isContinuous){let e=i.getDateFromCoordinate(r.getCoordinate(h,d,[a,l]),null,!1);if(e)n.timeDiff=e-n.screenSourceDate;else{if(!(e=i.getDateFromCoordinate(r.getCoordinate(h,d,[s+d.offsetWidth,o]))))return void(n.context.valid=!1);e=DateHelper.add(e,-h.duration,h.durationUnit),n.timeDiff=e-n.sourceDate}n.startDate=r.adjustStartDate(n.origStart,n.timeDiff),n.endDate=new Date(n.startDate-0+n.duration)}else{const e=r.resolveStartEndDates(c);n.startDate=e.startDate,n.endDate=e.endDate,n.timeDiff=n.startDate-n.origStart}if(Object.assign(n,r.getProductDragContext(n)),n.valid&&n.endDate>i.timeAxis.startDate&&n.startDate<i.timeAxis.endDate){const e=!t||r.checkDragValidity(n,t);e&&"boolean"!=typeof e?(n.context.valid=!1!==e.valid,n.context.message=e.message):(n.context.valid=!1!==e,n.context.message="")}else n.context.valid=!1}getDragData(e,t){const r=this.client,{record:n,dateConstraints:i,eventBarEls:s,draggedRecords:o}=this.setupProductDragData(e);let a=n.startDate,l=n.endDate,d=r.timeAxis,c=a<d.startDate,u=l>d.endDate;const h=this.getCoordinate(n,e.element,[e.elementStartX,e.elementStartY]),g=this.getCoordinate(n,e.element,[e.startClientX,e.startClientY]);o.forEach(e=>e.instanceMeta(r).retainElement=!0);const m={context:e,dateConstraints:i,eventBarEls:s,getEventBarElements:()=>m.eventBarEls=m.eventBarEls.map(e=>e&&document.getElementById(e.id)),record:n,draggedRecords:o,sourceDate:c?a:r.getDateFromCoordinate(h),screenSourceDate:r.getDateFromCoordinate(g,null,!1),origStart:a,origEnd:l,startDate:a,endDate:l,timeDiff:0,startsOutsideView:c,endsOutsideView:u,duration:l-a,browserEvent:t};return m}getRelatedRecords(e){return[]}setupConstraints(e,t,r,n){const i=this,s=!i.showExactDropPosition&&r>1?r:0;n&&i.setXConstraint(e.left,e.right-t.width,s),i.setYConstraint(e.top,e.bottom-t.height,0)}setXConstraint(e,t,r){const n=this.drag;n.leftConstraint=e,n.rightConstraint=t,n.minX=e,n.maxX=t}setYConstraint(e,t,r){const n=this.drag;n.topConstraint=e,n.bottomConstraint=t,n.minY=e,n.maxY=t}adjustStartDate(e,t){return this.client.timeAxis.roundDate(new Date(e-0+t),!!this.client.snapRelativeToEventStartDate&&e)}resolveStartEndDates(e){let t,r=this.dragData,n=r.origStart,i=r.origEnd;return r.startsOutsideView?r.endsOutsideView||(t=this.client.getStartEndDatesFromRectangle(e,"round"))&&(i=t.end||r.endDate,n=DateHelper.add(i,-r.duration,"ms")):(t=this.client.getStartEndDatesFromRectangle(e,"round"))&&(n=t.start||r.startDate,i=DateHelper.add(n,r.duration,"ms")),{startDate:n,endDate:i}}getTipHtml(e,t,r){let n=this,{startDate:i,endDate:s,draggedRecords:o}=n.dragData,{valid:a,message:l}=n.dragData.context,d=n.client.getFormattedDate(i),c=n.client.getFormattedEndDate(s,i);return void 0===l&&(l=""),n.dragTipTemplate({valid:a,startDate:i,endDate:s,startText:d,endText:c,message:l,[n.client.scheduledEventName+"Record"]:o[0],dragData:n.dragData,startClockHtml:n.clockTemplate.template({date:i,text:d,cls:"b-sch-tooltip-startdate"}),endClockHtml:o[0].isMilestone?"":n.clockTemplate.template({date:s,text:c,cls:"b-sch-tooltip-enddate"})})}get disabled(){return this._disabled}set disabled(e){this._disabled=e}isValidDrop(e){throw new Error("Implement in subclass")}checkDragValidity(e){throw new Error("Implement in subclass")}updateRecords(e){throw new Error("Implement in subclass")}isElementDraggable(e,t){throw new Error("Implement in subclass")}getCoordinate(e,t,r){throw new Error("Implement in subclass")}setupProductDragData(e){throw new Error("Implement in subclass")}getProductDragContext(e){throw new Error("Implement in subclass")}}DragBase._$name="DragBase";class EventDrag extends DragBase{static get defaultConfig(){return{constrainDragToResource:!1,validatorFn:()=>{},validatorFnThisObj:null}}construct(e,t){this.scheduler=e,this.store=e.eventStore,super.construct(e,t)}isElementDraggable(e,t){const{scheduler:r}=this,n=DomHelper.up(e,r.eventSelector),{eventResize:i}=r.features;if(!n)return!1;if(e.matches('[class$="-handle"]'))return!1;const s=r.resolveEventRecord(n);return!(i&&!s.isMilestone&&(i.resize.overLeftHandle(t,n)||i.resize.overRightHandle(t,n)))}triggerEventDrag(e,t){e.startDate-t==0&&e.newResource===e.resourceRecord||this.scheduler.trigger("eventDrag",{eventRecords:e.draggedRecords,startDate:e.startDate,endDate:e.endDate,newResource:e.newResource,context:e})}onDragStart({context:e,event:t}){super.onDragStart({context:e,event:t}),t.ctrlKey||(this.client.selectedEvents=this.dragData.draggedRecords)}isValidDrop(e){const{newResource:t,resourceRecord:r}=e;let n=e.draggedRecords[0];return!t.meta.specialRow&&(r===t||(n instanceof AssignmentModel&&(n=n.event),!n.isAssignedTo(t)))}checkDragValidity(e,t){const r=this.currentOverClient;return this.dragData.context.valid&&(r.allowOverlap||r.isDateRangeAvailable(e.startDate,e.endDate,e.draggedRecords[0],e.newResource))&&this.validatorFn.call(this.validatorFnThisObj||this,e,t)}updateRecords(e){const t=this,r=t.scheduler,n=t.currentOverClient,{eventStore:i,resourceStore:s,assignmentStore:o}=r,{newResource:a,draggedRecords:l,resourceRecord:d,startDate:c,timeDiff:u}=e;i!==n.eventStore&&(i.remove(l),n.eventStore.add(l));const h=l[0],g=l.slice(1);o?t.updateRecordsMultipleAssignmentMode(e,c,u,h,g,d,a,i,s,o,!1):t.updateRecordsSingleAssignmentMode(e,c,u,h,g,d,a,i,s,!1),n.trigger("eventDrop",{eventRecords:l,isCopy:!1,event:e.browserEvent,targetEventRecord:e.targetEventRecord,targetResourceRecord:e.newResource,context:e})}updateRecordsSingleAssignmentMode(e,t,r,n,i,s,o,a,l,d){let c,u=this,h=[];d&&(n=n.fullCopy(null),h.push(n));const g=n.generation;n.beginBatch(),!d&&o!==s&&s instanceof ResourceModel&&o instanceof ResourceModel?n.reassign(s,o):o!==s&&s instanceof ResourceModel&&o instanceof ResourceModel&&n.assign(o),n.setStartDate(t,!0,a.skipWeekendsDuringDragDrop),n.endBatch(),c=n.generation!==g;let m=u.constrainDragToResource?0:l.indexOf(s)-l.indexOf(o);if(i.forEach(e=>{let t=e.resources;d&&(e=e.fullCopy(null),h.push(e));const n=e.generation;e.beginBatch(),e.setStartDate(u.adjustStartDate(e.startDate,r),!0,a.skipWeekendsDuringDragDrop),0!==m&&t.length&&t.forEach(t=>{let r,n=l.indexOf(t)-m;n<0?n=0:n>=l.getCount()&&(n=l.getCount()-1),r=l.getAt(n),e.reassign(t,r)}),e.endBatch(),e.generation!==n&&(c=!0)}),h.length){const e=a.count;a.add(h),a.count!==e&&(c=!0)}c||(e.valid=!1)}updateRecordsMultipleAssignmentMode(e,t,r,n,i,s,o,a,l,d,c){let u,h=this,g={};[].concat(n,i).forEach(e=>{const t=e.event,n=t.generation;g[t.id]||(g[t.id]=!0,t.setStartDate(h.adjustStartDate(t.startDate,r),!0,a.skipWeekendsDuringDragDrop),s!==o&&(c?t.assign(o):t.isAssignedTo(o)?t.unassign(e.resource):t.reassign(e.resource,o)),u=u||e.resource!==s||t.generation!==n)}),u||(e.valid=!1)}getProductDragContext(e){const t=this.scheduler.resolveEventRecord(e.browserEvent.target);let r;return r=this.constrainDragToResource?e.resourceRecord:this.constrainDragToTimeline?this.resolveResource()||e.newResource||e.resourceRecord:this.resolveResource(),{valid:Boolean(r),newResource:r,targetEventRecord:t}}setupProductDragData(e){const t=this,r=t.scheduler,n=e.grabbed,i=r.resolveEventRecord(n),s=r.resolveResourceRecord(n),o=r.resolveAssignmentRecord(n),a=Rectangle.from(n),l=t.getRelatedRecords(o||i)||[];let d=r.getElementsFromEventRecord(i,s,null,!0);if(t.constrainDragToResource&&!s)throw new Error("Resource could not be resolved for event: "+i.id);const c=r.getDateConstraints(t.constrainDragToResource?s:null,i);t.constrainDragToTimeline&&t.setupConstraints(r.getScheduleRegion(t.constrainDragToResource?s:null,i),a,r.timeAxisViewModel.snapPixelAmount,Boolean(c)),l.forEach(e=>{d=e instanceof AssignmentModel?d.concat(r.getElementsFromEventRecord(e.event,e.resource,null,!0)):d.concat(r.getElementsFromEventRecord(e,null,null,!0))}),d=[...new Set(d)];const u=[o||i].concat(l);return{record:i,dateConstraints:c,eventBarEls:d,draggedRecords:u}}getDragData(e,t){return Object.assign(super.getDragData(e,t),{resourceRecord:this.scheduler.resolveResourceRecord(e.grabbed)})}getRelatedRecords(e){return[]}getCoordinate(e,t,r){const n=this.currentOverClient;if(n.isHorizontal){let i=r[0];if("default"!==n.milestoneLayoutMode&&e.isMilestone)switch(n.milestoneAlign){case"center":i+=t.offsetWidth/2;break;case"end":i+=t.offsetWidth}return i}}resolveResource(){const e=this.dragData.context.clientX,t=Rectangle.from(this.dragData.context.element,null,!0).center.y,r=document.elementFromPoint(e,t);return r?this.currentOverClient.resolveResourceRecord(r):null}adjustStartDate(e,t){const r=this.currentOverClient;return r.timeAxis.roundDate(new Date(e-0+t),!!r.snapRelativeToEventStartDate&&e)}resolveStartEndDates(e){const t=this.currentOverClient,r=this.dragData;let n,i=r.origStart,s=r.origEnd;if(r.startsOutsideView)r.endsOutsideView||(n=t.getStartEndDatesFromRectangle(e,"round"))&&(s=n.end||r.endDate,i=DateHelper.add(s,-r.duration,"ms"));else if(n=t.getStartEndDatesFromRectangle(e,"round")){if(n.start&&!t.timeAxis.dateInAxis(n.start,!1)){const e=t.timeAxis.getTickFromDate(n.start);e&&(n.start=t.timeAxis.getDateFromTick(e))}i=n.start||r.startDate,s=DateHelper.add(i,r.duration,"ms")}return{startDate:i,endDate:s}}}EventDrag._$name="EventDrag",GridFeatureManager.registerFeature(EventDrag,!0,"Scheduler");class DragCreateBase extends InstancePlugin{static get defaultConfig(){return{disabled:!1,showTooltip:!0,dragTolerance:2,preventMultiple:!1,validatorFn:()=>{},validatorFnThisObj:null,proxyCls:"b-sch-dragcreator-proxy",tipTemplate:e=>`\n                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">\n                    ${e.startClockHtml}\n                    ${e.endClockHtml}\n                    <div class="b-sch-tip-message">${e.message}</div>\n                </div>\n            `}}static get pluginConfig(){return{chain:["onElementMouseDown","onElementMouseMove"],before:["onElementContextMenu"]}}doDestroy(){this.tip&&this.tip.destroy(),this.resize&&this.resize.destroy(),super.doDestroy()}addProxy(e){const t=this.client,r=t.currentOrientation.getRowRegion(e.rowRecord),n=r.height-2*t.barMargin,i="currentX"in e?Math.min(e.startX,e.currentX+1):e.startX,s=e.width||this.dragTolerance;return t.element.classList.add("b-dragcreating"),t.element.classList.add("b-dragcreating-proxy-sizing"),this.proxy=DomHelper.createElement({parent:t.foregroundCanvas,className:this.proxyCls,style:`transform:translate(${i}px, ${r.y+t.barMargin}px);width:${s}px;height:${n}px`})}removeProxy(){const e=this;e.proxy&&(e.proxy.remove(),e.resize.destroy(),e.proxy=e.resize=null,e.client.element.classList.remove("b-dragcreating"),e.client.element.classList.remove("b-dragcreating-proxy-sizing"),e.tip&&e.tip.hide())}initResizer(e,t){const r=this;r.resize&&r.resize.destroy(),r.resize=new ResizeHelper({name:r.constructor.name,isTouch:e.type.startsWith("touch"),grab:{element:r.proxy,edge:t.currentX>t.startX?"right":"left",event:t.startEvent},allowEdgeSwitch:!0,outerElement:r.client.timeAxisSubGridElement,scrollManager:r.client.scrollManager,listeners:{resizing:r.onResizing,resize:r.onResize,cancel:r.onCancel,thisObj:r}}),r.resize.context.resource=t.resource}initTooltip(){const e=this,t=e.client;e.showTooltip&&(e.tip?e.tip.showBy(e.getTooltipTarget()):(e.clockTemplate=new ClockTemplate({timeAxisViewModel:t.timeAxisViewModel}),e.tip=new Tooltip({id:`${t.id}-drag-create-tip`,autoShow:!0,trackMouse:!1,getHtml:e.getTipHtml.bind(e),align:"b100-t100",hideDelay:0,axisLock:!0}),e.tip.on("innerhtmlupdate",e.updateDateIndicator,e)))}updateDateIndicator(){const e=this,{startDate:t,endDate:r}=e.createContext,n=e.tip,i=n.element.querySelector(".b-sch-tooltip-enddate");t&&r&&(e.clockTemplate.updateDateIndicator(n.element,t),i&&e.clockTemplate.updateDateIndicator(i,r))}getTipHtml(){if(!this.resize.context)return;const{edge:e,newX:t,elementStartX:r,elementWidth:n,newWidth:i,valid:s,message:o}=this.resize.context,a=this.client,l="left"===e?t:r,d=Math.min(Math.max(l+(i||n)-1,0),a.timeAxisViewModel.totalWidth-1),c=a.getDateFromCoordinate(l,"round",!0),u=a.getDateFromCoordinate(d,"round",!0),h=DateHelper.min(c,u),g=DateHelper.max(c,u),m=h&&a.getFormattedDate(h),p=g&&u&&a.getFormattedEndDate(g,h);return this.tipTemplate({valid:s,startDate:h,endDate:g,startText:m,endText:p,message:o,startClockHtml:this.clockTemplate.template({date:h,text:m,cls:"b-sch-tooltip-startdate"}),endClockHtml:this.clockTemplate.template({date:a.getDisplayEndDate(g,h),text:p,cls:"b-sch-tooltip-enddate"})})}finalize(e){const t=this;e&&t.finalizeDragCreate(t.createContext),t.client.trigger("afterDragCreate",{proxyElement:t.proxy}),t.reset()}onElementMouseDown(e){const t=this;if(0===e.button&&e.target.matches(".b-sch-timeaxis-cell")&&!t.disabled&&!t.client.readOnly){const r=t.client.getRecordFromElement(e.target);if(r.meta.specialRow)return;if(t.preventMultiple&&!t.isRowEmpty(r))return;t.monitorMove=!0,t.createContext={startEvent:e,startScreenX:e.screenX,startX:e.offsetX,cellElement:e.target,rowRecord:r},t.mouseUpDetacher=EventHelper.on({element:document.body,mouseup:"onMouseUp",once:!0,thisObj:this})}}onElementMouseMove(e){const t=this;if(t.monitorMove&&Math.abs(t.createContext.startScreenX-e.screenX)>t.dragTolerance){const r=t.client,n=r.getDateFromDomEvent(e),i=Rectangle.from(r.timeAxisSubGridElement,null,!0);if(!1===t.handleBeforeDragCreate(n,e))return void(t.monitorMove=!1);t.createContext.currentX=Math.max(e.clientX-i.x+r.timeAxisSubGrid.scrollable.x,0),t.addProxy(t.createContext),t.initResizer(e,t.createContext),t.initTooltip(),t.monitorMove=!1,r.trigger("dragCreateStart",{proxyElement:t.proxy})}t.proxy&&t.showTooltip&&t.resize.context&&t.tip.alignTo(t.getTooltipTarget())}getTooltipTarget(){const e=Rectangle.from(this.proxy,null,!0);return"right"===this.resize.context.edge&&(e.x=e.right-1),e.width=this.tip.anchorSize[0]/2,{target:e}}onMouseUp(e){this.client.element.classList.remove("b-dragcreating-proxy-sizing"),this.monitorMove=!1}onElementContextMenu(){if(this.proxy)return!1}onResizing({context:e,event:t}){const r=this,n=r.client,i="left"===e.edge?e.newX:e.elementStartX,s=Math.min(i+Math.max((e.newWidth||e.elementWidth)-1,0),n.timeAxisViewModel.totalWidth-1),o=n.getDateFromCoordinate(i,"round",!0),a=n.getDateFromCoordinate(s,"round",!0),l=r.dateConstraints;let d=DateHelper.min(o,a),c=DateHelper.max(o,a);l&&(c=DateHelper.constrain(c,l.start,l.end),d=DateHelper.constrain(d,l.start,l.end)),Object.assign(r.createContext,{startDate:d,endDate:c,start:d,end:c}),e.valid=r.checkValidity(r.createContext,t),e.message="",e.valid&&"boolean"!=typeof e.valid&&(e.message=e.valid.message,e.valid=e.valid.valid),e.valid=!1!==e.valid}onResize({context:{valid:e},event:t}){const r=this,{startDate:n,endDate:i}=r.createContext;(!n||!i||i-n<=0)&&(e=!1),Object.assign(r.createContext,{event:t,async:!1,finalize:e=>r.finalize(e)}),e&&r.client.trigger("beforeDragCreateFinalize",{context:r.createContext,event:t,proxyElement:r.proxy}),r.createContext&&(r.resize.context.async=r.createContext.async,r.createContext.async?r.resize.removeListeners():r.finalize(e))}get dragging(){return this.resize}onCancel(){this.cancel()}cancel(){this.reset(),this.mouseUpDetacher&&this.mouseUpDetacher()}reset(){this.removeProxy(),this.createContext=null,this.monitorMove=!1}checkValidity(e,t){throw new Error("Implement in subclass")}triggerDragCreateEnd(e,t){throw new Error("Implement in subclass")}handleBeforeDragCreate(e,t){throw new Error("Implement in subclass")}isRowEmpty(e){throw new Error("Implement in subclass")}}DragCreateBase._$name="DragCreateBase";class EventDragCreate extends DragCreateBase{static get defaultConfig(){return{preventMultiple:!1,validatorFn:()=>{}}}construct(e,t){this.scheduler=e,this.store=e.eventStore,super.construct(e,t)}finalizeDragCreate(e){const t=new this.store.modelClass({startDate:e.startDate,endDate:e.endDate});this.scheduler.trigger("dragCreateEnd",{newEventRecord:t,resourceRecord:e.rowRecord,event:e.event,proxyElement:this.proxy})}handleBeforeDragCreate(e,t){const r=this,n=r.scheduler.trigger("beforeDragCreate",{resourceRecord:r.createContext.rowRecord,date:e,event:t});if(n){const e=r.scheduler.features.scheduleTooltip;e&&e.hoverTip&&e.hoverTip.hide()}return r.dateConstraints=r.scheduler.getDateConstraints(r.createContext.rowRecord,e),n}checkValidity(e,t){const r=this.client;return e.resourceRecord=e.rowRecord,(r.allowOverlap||r.isDateRangeAvailable(e.startDate,e.endDate,null,e.resourceRecord))&&this.validatorFn.call(this.validatorFnThisObj||this,e,t)}isRowEmpty(e){const t=this.store.getEventsForResource(e);return!t||!t.length}}EventDragCreate._$name="EventDragCreate",GridFeatureManager.registerFeature(EventDragCreate,!0,"Scheduler");class EventDragSelect extends(Delayable(InstancePlugin)){construct(e,t){if(this.timeline=e,e.multiEventSelect=!0,e.features.eventDragCreate||e.features.pan)throw new Error("Cannot combine this feature with Pan or EventDragCreate features");this.targetSelector=[".b-grid-cell",".b-timeline-subgrid"].join(","),super.construct(e,t)}static get pluginConfig(){return{chain:["onElementMouseDown","onElementMouseMove","onElementMouseUp"]}}onElementMouseDown(e){const t=this,r=t.client;e.touches||0!==e.button||e.target.matches(t.targetSelector)&&(t.startX=e.clientX,t.startY=e.clientY,t.element=DomHelper.createElement({tag:"div",className:"b-dragselect-rect"},!0)[0],Widget.floatRoot.appendChild(t.element),r.element.classList.add("b-dragselecting"),t.eventRectangles=Array.from(r.element.querySelectorAll(r.eventSelector)).map(e=>({rectangle:Rectangle.from(e),record:r.resolveEventRecord(e)})),r.clearEventSelection(),t.subGridElementRect=Rectangle.from(r.timeAxisSubGrid.element),r.navigator.disabled=!0)}onElementMouseMove(e){const t=this;if(0!==e.buttons||BrowserHelper.isSafari||BrowserHelper.isIE11&&!e.isTrusted){if("number"==typeof t.startX){const r=Math.max(e.clientX,t.subGridElementRect.left),n=Math.max(e.clientY,t.subGridElementRect.top),i=Math.min(t.startX,r),s=Math.min(t.startY,n),o=Math.abs(t.startX-r),a=Math.abs(t.startY-n),l=new Rectangle(i,s,o,a).constrainTo(t.subGridElementRect);DomHelper.setTranslateXY(t.element,l.left,l.top),t.element.style.width=l.width+"px",t.element.style.height=l.height+"px",t.rectangle=l,t.updateSelection()}}else t.onElementMouseUp(e)}onElementMouseUp(e){const t=this;"number"==typeof t.startX&&(t.element&&t.element.remove(),t.client.element.classList.remove("b-dragselecting"),t.startX=t.startY=null,t.setTimeout(()=>t.client.navigator.disabled=!1,100))}updateSelection(){const e=this,t=e.eventRectangles,r=e.rectangle;for(let n=0,i=t.length;n<i;n++){const i=t[n],s=r.intersect(i.rectangle,!0);s&&!i.selected?(i.selected=!0,e.client.selectEvent(i.record,!0)):!s&&i.selected&&(i.selected=!1,e.client.deselectEvent(i.record))}}}EventDragSelect._$name="EventDragSelect",GridFeatureManager.registerFeature(EventDragSelect,!1,"Scheduler");const DH=DateHelper,makeDate=e=>{if(1===e.length)return e[0].value;if(2===e.length){const[t,r]=e[0]instanceof DateField?e:e.reverse(),n=DH.parse(t.value);return n.setHours(r.value.getHours(),r.value.getMinutes(),r.value.getSeconds(),r.value.getMilliseconds()),n}return null},copyTime=(e,t)=>{let r=new Date(e.getTime());return r.setHours(t.getHours(),t.getMinutes()),r},adjustEndDate=(e,t,r)=>{if(e&&t){const e=DH.add(copyTime(r.startDateField.value,r.startTimeField.value),r.eventRecord.durationMS,"milliseconds");r.endDateField.value=e,r.endTimeField.value=DH.clone(e)}};class EditBase extends InstancePlugin{static get defaultConfig(){return{autoClose:!0,saveAndCloseOnEnter:!0,triggerEvent:null,showDeleteButton:!0,showNameField:!0,startTimeConfig:null,startDateConfig:null,endTimeConfig:null,endDateConfig:null,dateFormat:"L",timeFormat:"LT",editorConfig:null,extraItems:null,extraWidgets:null}}construct(e,t){const r=this;e.eventEdit=r,super.construct(e,t),r.clientListenersDetacher=e.on({[r.triggerEvent]:r.onActivateEditor,dragcreateend:r.onDragCreateEnd,thisObj:r})}doDestroy(){this.clientListenersDetacher(),this.editor&&this.editor.destroy(),super.doDestroy()}get editorConfig(){return this._editorConfig}set editorConfig(e){const t=this.getDefaultConfiguration().editorConfig;(e=ObjectHelper.assign({},t,e)).items=e.items||[],this.insertExtraWidgetsIntoDefaultWidgets(e),this._editorConfig=e}get extraWidgets(){return this._skipWarn||console.warn("`extraWidgets` was deprecated in 2.1, please change your code to use `extraItems`"),this._extraItems}set extraWidgets(e){console.warn("`extraWidgets` was deprecated in 2.1, please change your code to use `extraItems`"),this._extraItems=e}get extraItems(){const e=this;return e._skipWarn=!0,e._thisIsAUsedExpression(e.extraWidgets),e._skipWarn=!1,e._extraItems}set extraItems(e){this._extraItems=e}insertExtraWidgetsIntoDefaultWidgets(e){if(!this.extraItems||!this.extraItems.length)return;let t,r=e.items.findIndex(e=>"extraItems"===e.type);r>-1&&(e.items.splice(r,1),t=e.items.splice(r));let n=this.extraItems.filter(e=>e.index>=0),i=this.extraItems.filter(e=>!(e.index>=0));e.items=e.items.concat(i),n.sort((e,t)=>e.index-t.index),n.forEach(t=>e.items.splice(t.index,0,t)),t&&t.length&&(e.items=e.items.concat(t))}onDatesChange(e){const t=this,r=e.source,n=e.value;switch(r.ref){case"startDateField":t.startTimeField&&adjustEndDate(n,t.startTimeField.value,t);break;case"startTimeField":t.startDateField&&adjustEndDate(t.startDateField.value,n,t)}t.endTimeField&&(DH.isEqual(DH.clearTime(t.startDateField.value),DH.clearTime(t.endDateField.value))?t.endTimeField.min=t.startTimeField.value:t.endTimeField.min=null)}save(){throw new Error("Implement in subclass")}get isValid(){return Object.values(this.editor.widgetMap).every(e=>!(e.name&&!e.hidden)||!1!==e.isValid)}get values(){const e=[],t=[],r={};return this.editor.eachWidget(n=>{const i=n.name;i&&!n.hidden&&("startDate"===i?e.push(n):"endDate"===i?t.push(n):r[i]=n.value)},!0),r.startDate=makeDate(e),r.endDate=makeDate(t),r.duration=DH.diff(r.startDate,r.endDate,this.editor.record.durationUnit,!0),r}onBeforeSave(e){}onAfterSave(e){}updateRecord(e){const{values:t}=this;this.scheduler.assignmentStore&&delete t.resource,e.set(t)}onPopupBeforeHide(){this.client.element.classList.remove("b-eventeditor-editing"),this.dragProxyElement&&this.dragProxyElement.remove(),this.dragProxyElement=null}onPopupKeyDown({event:e}){"Enter"===e.key&&this.saveAndCloseOnEnter&&"input"===e.target.tagName.toLowerCase()&&(e.preventDefault(),"startDate"===e.target.name&&adjustEndDate(this.startDateField.value,this.startTimeField.value,this),this.onSaveClick())}onSaveClick(){this.save()&&this.editor.hide()}onDeleteClick(){this.deleteEvent(),this.editor.hide()}onCancelClick(){this.editor.hide()}}EditBase._$name="EditBase";class EventEditor extends Popup{static get defaultConfig(){return{items:[],draggable:{handleSelector:":not(button,.b-field-inner)"},axisLock:"flexible"}}processWidgetConfig(e){const t=this,r=t.eventEditFeature;if("extraItems"===e.type)return!1;let n={};if("resourceField"===e.ref){if(!r.showResourceField)return!1;t.resourceStore=e.store=new r.resourceStore.constructor({chained:!0,chainAllRecords:!0,masterStore:r.resourceStore,chainedFilterFn:e=>!e.meta.specialRow}),e.multiSelect=Boolean(r.scheduler.assignmentStore),r.resourceFieldConfig&&(n=r.resourceFieldConfig)}return!("nameField"===e.ref&&!r.showNameField)&&(!("deleteButton"===e.ref&&!r.showDeleteButton)&&("startDate"!==e.name&&"endDate"!==e.name||"date"!==e.type||(n.format=r.dateFormat),"startDate"!==e.name&&"endDate"!==e.name||"time"!==e.type||(n.format=r.timeFormat),r.startDateConfig&&"startDate"===e.name&&"date"===e.type&&(n=r.startDateConfig),r.startTimeConfig&&"startDate"===e.name&&"time"===e.type&&(n=r.startTimeConfig),r.endDateConfig&&"endDate"===e.name&&"date"===e.type&&(n=r.endDateConfig),r.endTimeConfig&&"endDate"===e.name&&"time"===e.type&&(n=r.endTimeConfig),Object.assign(e,n),super.processWidgetConfig(e)))}show(...e){this.resourceStore&&this.resourceStore.fillFromMaster(),super.show(...e)}afterShow(...e){const t=this.widgetMap.deleteButton;t&&(t.visible=this.record.stores.length),super.afterShow(...e)}onInternalKeyDown(e){this.trigger("keyDown",{event:e}),super.onInternalKeyDown(e)}}EventEditor._$name="EventEditor";class EventEdit extends EditBase{static get defaultConfig(){return{triggerEvent:"eventdblclick",showResourceField:!0,resourceFieldConfig:null,typeField:"eventType",eventRecord:null,editorConfig:{title:"L{Edit Event}",localeClass:this,closable:!0,items:[{type:"text",localeClass:this,label:"L{Name}",clearable:!0,name:"name",ref:"nameField"},{type:"combo",localeClass:this,label:"L{Resource}",name:"resource",ref:"resourceField",editable:!1,valueField:"id",displayField:"name"},{type:"date",cls:"b-inline",clearable:!1,required:!0,localeClass:this,label:"L{Start}",name:"startDate",ref:"startDateField",flex:"1 0 60%"},{type:"time",clearable:!1,required:!0,name:"startDate",ref:"startTimeField",cls:"b-match-label",flex:"1 0 40%"},{type:"date",cls:"b-inline",clearable:!1,required:!0,localeClass:this,label:"L{End}",name:"endDate",ref:"endDateField",flex:"1 0 60%"},{type:"time",clearable:!1,required:!0,name:"endDate",ref:"endTimeField",cls:"b-match-label",flex:"1 0 40%"},{type:"extraItems"}],bbar:[{type:"widget",cls:"b-label-filler"},{color:"b-green",localeClass:this,text:"L{Save}",ref:"saveButton"},{color:"b-gray",localeClass:this,text:"L{Delete}",ref:"deleteButton"},{color:"b-gray",localeClass:this,text:"L{Cancel}",ref:"cancelButton"}]}}}static get pluginConfig(){return{chain:["getEventMenuItems","onEnterKey"],assign:["editEvent"]}}get resourceStore(){return this._resourceStore}set resourceStore(e){this._resourceStore=e,this.resourceField&&(this.resourceField.store=e)}construct(e,t){this.scheduler=e,this.eventStore=e.eventStore,this.resourceStore=e.resourceStore,super.construct(e,t)}internalShowEditor(e,t,r=null){const n=this,i=n.scheduler,s=r||DomHelper.down(i.getElementFromEventRecord(e,t),i.eventInnerSelector),o=e.get(n.typeField);if(s||!e.isPartOfStore(i.eventStore)){if(!1===i.trigger("beforeEventEdit",{eventEdit:n,eventRecord:e,resourceRecord:t,eventElement:s}))return i.element.classList.remove("b-eventeditor-editing"),n.dragProxyElement&&n.dragProxyElement.remove(),void(n.dragProxyElement=null);n.resourceRecord=t;const r=n.getEditor(e);r.element.dataset.eventType=o||"",r.eachWidget(e=>e.dataset&&e.dataset.eventType&&(e.hidden=e.dataset.eventType!==o)),i.trigger("beforeEventEditShow",{eventEdit:n,eventRecord:e,resourceRecord:t,eventElement:s,editor:r}),n.loadRecord(e,t),s?(s.classList.add("b-editing"),r.anchor=!0,r.showBy(s)):(r.anchor=!1,r.showBy({target:i.element,align:"c-c"}));const a=i.timeAxisViewModel.timeResolution;"hour"!==a.unit&&"minute"!==a.unit||(n.startTimeField.step=n.endTimeField.step=`${a.increment}${a.unit}`)}}editEvent(e,t,r=null){const n=this,i=n.scheduler;i.readOnly||(i.element.classList.add("b-eventeditor-editing"),t||(e.resource?t=e.resource:e.resourceId&&(t=i.resourceStore.getById(e.resourceId))),r||i.eventStore.indexOf(e)<0?n.internalShowEditor(e,t,r):i.scrollResourceEventIntoView(t,e,null,{animate:!0,edgeOffset:0,extendTimeAxis:!1}).then(()=>n.internalShowEditor(e,t),()=>i.element.classList.remove("b-eventeditor-editing")))}getEditor(){const e=this;let{editor:t}=e;return t||(0===(t=e.editor=new EventEditor(ObjectHelper.assign({eventEditFeature:e,align:"b-t",id:`${e.scheduler.id}-event-editor`,autoShow:!1,anchor:!0,scrollAction:"realign",clippedBy:[e.scheduler.timeAxisSubGridElement,e.scheduler.bodyContainer],constrainTo:window,autoClose:e.autoClose,cls:e.cls,listeners:{beforehide:e.onPopupBeforeHide,keydown:e.onPopupKeyDown,thisObj:e}},e.editorConfig))).items.length&&console.warn("Event Editor configured without any `items`"),Object.values(t.widgetMap).forEach(t=>{const r=t.ref||t.id;if(r&&!e[r])switch(e[r]=t,t.name){case"startDate":case"endDate":t.on("change",e.onDatesChange,e)}}),e.saveButton&&e.saveButton.on("click",e.onSaveClick,e),e.deleteButton&&e.deleteButton.on("click",e.onDeleteClick,e),e.cancelButton&&e.cancelButton.on("click",e.onCancelClick,e),e.editor)}loadRecord(e,t,r=!1){const n=this,{eventStore:i}=n.client;if(n.eventRecord=e,n.resourceRecord=t,n.editor.record=e,n.resourceField){const t=i.getResourcesForEvent(e);!i.storage.includes(e,!0)&&n.resourceRecord?n.resourceField.value=n.resourceRecord[n.resourceField.valueField]:n.scheduler.assignmentStore&&(n.resourceField.value=t.map(e=>e[n.resourceField.valueField]))}}get values(){const e=super.values;return this.scheduler.assignmentStore&&delete e.resourceId,e}save(){const e=this,{scheduler:t,eventRecord:r}=e;if(!r||!e.isValid)return;const n=e.eventStore,i=e.values,s=e.resourceField&&e.resourceField.records||[e.resourceRecord];if(!e.scheduler.allowOverlap&&n){if(s.some(e=>!n.isDateRangeAvailable(i.startDate,i.endDate,r,e)))return}if(!1!==t.trigger("beforeEventSave",{eventRecord:r,resourceRecords:s,resourceRecord:s[0],values:i})){if(e.onBeforeSave(r),r.beginBatch(),e.updateRecord(r),r.endBatch(),n&&!r.stores.length){if(!1===t.trigger("beforeEventAdd",{eventRecord:r,resources:s}))return;if(e.dragProxyElement){const n=t.generateTplData(r,s[0]);n&&(DomHelper.syncClassList(e.dragProxyElement,n.wrapperCls),DomHelper.createElement({tag:"div",parent:e.dragProxyElement,className:n.cls.toString()}),e.dragProxyElement.classList.add("b-sch-dragcreator-proxy"),e.dragProxyElement.id=n.id,t.currentOrientation.releaseTimeSpanDiv(e.dragProxyElement,!0),e.dragProxyElement=null,r.instanceMeta(t).fromDragProxy=!0)}if(e.eventStore.add(r),e.eventStore.assignEventToResource(r,s),!e.eventStore.includes(r)){const e=t.element.querySelector(".b-sch-dragcreator-proxy");e&&(t.currentOrientation.availableDivs.remove(e),e.remove())}}else t.assignmentStore&&e.eventStore.assignEventToResource(r,s,!0);t.trigger("afterEventSave",{eventRecord:r}),e.onAfterSave(r)}return r}deleteEvent(){const e=this,t=e.eventRecord;return!1!==e.scheduler.trigger("beforeEventDelete",{eventRecord:t})&&(e.editor.containsFocus&&e.editor.revertFocus(),e.scheduler.removeRecords([t]),!0)}onActivateEditor({eventRecord:e,resourceRecord:t}){this.editEvent(e,t)}onDragCreateEnd({newEventRecord:e,resourceRecord:t,proxyElement:r}){this.scheduler.onEventCreated(e);const n=r.cloneNode(!0);n.removeAttribute("id"),r.parentElement.appendChild(n),this.dragProxyElement=n,this.editEvent(e,t,n)}onEnterKey({assignmentRecord:e,eventRecord:t}){e?this.editEvent(t,e.resource):t&&this.editEvent(t,t.resource)}getEventMenuItems({eventRecord:e,resourceRecord:t,items:r}){this.scheduler.readOnly||(r.editEvent={text:this.L("Edit event"),icon:"b-icon b-icon-edit",weight:-200,onItem:()=>{this.editEvent(e,t)}})}}EventEdit._$name="EventEdit",GridFeatureManager.registerFeature(EventEdit,!0,"Scheduler");class EventFilter extends InstancePlugin{static get pluginConfig(){return{chain:["getHeaderMenuItems"]}}construct(e,t){super.construct(e,t),this.scheduler=e}getHeaderMenuItems(e,t){const r=this;"timeAxis"===e.type&&t.push({text:r.L("filterEvents"),icon:"b-fw-icon b-icon-filter",menu:{type:"popup",items:[{type:"textfield",cls:"b-eventfilter b-last-row",clearable:!0,keyStrokeChangeDelay:300,label:r.L("byName"),width:200,listeners:{change:r.onEventFilterChange,thisObj:r}}],onBeforeShow({source:e}){const[t]=e.items,n=r.scheduler.eventStore.filters.getBy("property","name");t.value=n&&n.value}}})}onEventFilterChange({value:e}){const t=this;""!==e?t.scheduler.eventStore.filter("name",e):t.scheduler.eventStore.removeFieldFilter("name")}}EventFilter.featureClass="b-event-filter",EventFilter._$name="EventFilter",GridFeatureManager.registerFeature(EventFilter,!0,["Scheduler","Gantt"]);class ResizeBase extends InstancePlugin{static get defaultConfig(){return{showTooltip:!0,showExactResizePosition:!1,validatorFn:()=>{},validatorFnThisObj:null,tip:null,tipTemplate:e=>`\n                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">\n                    ${e.startClockHtml}\n                    ${e.endClockHtml}\n                    <div class="b-sch-tip-message">${e.message}</div>\n                </div>\n            `}}static get pluginConfig(){return{chain:["render"]}}render(){const e=this,t=e.client;e.resize&&e.resize.destroy(),e.resize=e.createResizeHelper(),e.showTooltip&&(e.clockTemplate=new ClockTemplate({timeAxisViewModel:t.timeAxisViewModel}))}doDestroy(){const e=this;e.tip&&e.tip.destroy(),e.clockTemplate&&e.clockTemplate.destroy(),e.resize&&e.resize.destroy(),super.doDestroy()}isElementResizable(e,t){const{client:r,resize:n}=this,i=r.resolveTimeSpanRecord(e);if(r.readOnly)return!1;let s=i&&i.isResizable;const o=(e=DomHelper.up(t.target,r.eventSelector))?e.firstElementChild:e,a=t.target.closest('[class$="-handle"]');if(!s||a&&a!==o)return!1;let l=e.classList.contains("b-sch-event-startsoutside"),d=e.classList.contains("b-sch-event-endsoutside");if(!0===s){if(l&&d)return!1;if(l)s="end";else{if(!d)return n.overLeftHandle(t,e)||n.overRightHandle(t,e);s="start"}}return!(l&&"start"===s||d&&"end"===s)&&!!(n.overLeftHandle(t,e)&&"start"===s||n.overRightHandle(t,e)&&"end"===s)}onBeforeResizeStart({element:e,event:t}){const{client:r}=this,n=r.scheduledEventName,i=r.resolveTimeSpanRecord(e);return!1!==r.trigger(`before${r.capitalizedEventName}Resize`,{[n+"Record"]:i,event:t})}onResizeStart({context:e,event:t}){const r=this,n=r.client,i=n.resolveTimeSpanRecord(e.element),s=n.scheduledEventName;n.element.classList.add("b-resizing-event"),this.setupProductResizeContext(e,t),r.showTooltip&&(r.tip?(r.tip.align="right"===e.edge?"b100-t100":"b0-t0",r.tip.showBy(r.getTooltipTarget())):(r.tip=new Tooltip({id:`${n.id}-event-resize-tip`,autoShow:!0,axisLock:!0,trackMouse:!1,getHtml:r.getTipHtml.bind(r),align:"right"===e.edge?"b100-t100":"b0-t0",hideDelay:0}),r.tip.on("innerhtmlupdate",r.updateDateIndicator,r))),i.instanceMeta(n).retainElement=!0,n.trigger(`${s}ResizeStart`,{[`${s}Record`]:i,event:t})}updateDateIndicator(){const{edge:e,startDate:t,endDate:r}=this.resize.context,n=this.tip;(t||r)&&("right"===e?this.clockTemplate.updateDateIndicator(n.element.querySelector(".b-sch-tooltip-enddate"),r):this.clockTemplate.updateDateIndicator(n.element,t))}getTooltipTarget(){const e=Rectangle.from(this.resize.context.element,null,!0);return"right"===this.resize.context.edge&&(e.x=e.right-1),e.width=this.tip.anchorSize[0]/2,{target:e}}onResizing({context:e,event:t}){const r=this,n=r.client,i=n.features.dependencies,s=r.getTimespanRecord(e),o=n.scheduledEventName;let a,l;if("left"===e.edge){let t=[DomHelper.getTranslateX(e.element),0];l=s.endDate,n.snapRelativeToEventStartDate?(a=n.getDateFromXY(t,null,!0),a=n.timeAxis.roundDate(a,s.startDate)):a=n.getDateFromXY(t,"round",!0)}else{let t=[DomHelper.getTranslateX(e.element)+e.element.offsetWidth,0];a=s&&s.startDate,n.snapRelativeToEventStartDate?(l=n.getDateFromXY(t,null,!0),l=n.timeAxis.roundDate(l,s.endDate)):l=n.getDateFromXY(t,"round",!0)}if(a=a||e.startDate,l=l||e.endDate,e.dateConstraints&&(a=DateHelper.constrain(a,e.dateConstraints.start,e.dateConstraints.end),l=DateHelper.constrain(l,e.dateConstraints.start,e.dateConstraints.end)),r.showExactResizePosition||n.timeAxisViewModel.snap){let t,r=e.element;"left"===e.edge?(t=n.timeAxisViewModel.getDistanceBetweenDates(a,s.endDate),DomHelper.setTranslateX(r,e.elementStartX+e.elementWidth-t),r.style.width=t+"px"):(t=n.timeAxisViewModel.getDistanceBetweenDates(s.startDate,l),r.style.width=t+"px")}const d=e.endDate-l!=0||e.startDate-a!=0;e.endDate=l,e.startDate=a,d&&(e.valid=r.checkValidity(e,t)),n.trigger(`${o}PartialResize`,{[`${o}Record`]:s,element:e.element,startDate:a,endDate:l,context:e}),i&&i.updateDependenciesForTimeSpan(s,e.element),r.showTooltip&&r.tip.alignTo(r.getTooltipTarget())}checkValidity(e,t){let r=e.startDate&&e.endDate>e.startDate&&this.validatorFn.call(this.validatorFnThisObj||this,e,t);return r&&"boolean"!=typeof r&&(e.message=r.message||"",r=r.valid),!1!==r}onFinishResize({source:e,context:t,event:r}){const n=this,i=n.getTimespanRecord(t),s=i.startDate,o=i.endDate,a=t.startDate||s,l=t.endDate||o,d=n.client;let c=!1;i.instanceMeta(d).retainElement=!1;const u=t.finalize;t.finalize=((...e)=>{t.async&&n.finalize(...e),u.call(t,e)}),t.valid=a&&l&&l-a>0&&(a-s!=0||l-o!=0)&&!1!==t.valid,t.valid&&(d.trigger(`before${d.scheduledEventName}ResizeFinalize`,{context:t,event:r}),c=!0),t.async||n.finalize(c)}onCancelResize({context:e}){const t=this.getTimespanRecord(e);t&&(t.instanceMeta(this.client).retainElement=!1),this.finalize(!1)}finalize(e){const t=this,{client:r}=t,n=t.resize.context,i=t.getTimespanRecord(n),s=r.scheduledEventName;let o=!1;if(t.tip&&t.tip.hide(),n.started&&(e&&(o=t.internalUpdateRecord(n,i)),!e||!o)){const e=r.features.dependencies;e&&e.scheduleDraw(!0),r.repaintEventsForResource(t.getRowRecord(n))}r.element.classList.remove("b-resizing-event"),r.trigger(`${s}ResizeEnd`,{changed:o,[`${s}Record`]:i})}getTipHtml({tip:e}){let t=this,{startDate:r,endDate:n,valid:i,message:s}=t.resize.context;if(!r||!n)return e.html;void 0===s&&(s=""),n=this.client.getDisplayEndDate(n,r);let o=t.client.getFormattedDate(r),a=t.client.getFormattedDate(n);return t.tipTemplate({valid:i,startDate:r,endDate:n,startText:o,endText:a,message:s,startClockHtml:t.clockTemplate.template({date:r,text:o,cls:"b-sch-tooltip-startdate"}),endClockHtml:t.clockTemplate.template({date:n,text:a,cls:"b-sch-tooltip-enddate"})})}getRowRecord(e){throw new Error("Implement in subclass")}getTimespanRecord(e){throw new Error("Implement in subclass")}setupProductResizeContext(e,t){throw new Error("Implement in subclass")}get store(){throw new Error("Implement in subclass")}}ResizeBase._$name="ResizeBase";class EventResize extends ResizeBase{createResizeHelper(){const e=this,t=e.client;return new ResizeHelper({name:e.constructor.name,isElementResizable:(t,r)=>e.isElementResizable(t,r),targetSelector:t.eventSelector,handleContainerSelector:t.eventInnerSelector,resizingCls:"b-sch-event-wrap-resizing",allowResize:e.isElementResizable.bind(e),outerElement:t.timeAxisSubGridElement,scrollManager:t.scrollManager,dragThreshold:0,listeners:{beforeresizestart:e.onBeforeResizeStart,resizestart:e.onResizeStart,resizing:e.onResizing,resize:e.onFinishResize,cancel:e.onCancelResize,thisObj:e}})}get store(){return this.client.eventStore}getTimespanRecord(e){return e.eventRecord}getRowRecord(e){return e.resourceRecord}setupProductResizeContext(e,t){const r=this.client,n=r.resolveEventRecord(e.element),i=r.resolveResourceRecord(e.element);Object.assign(e,{eventRecord:n,resourceRecord:i,dateConstraints:r.getDateConstraints(i,n)})}onResizeStart({context:e,event:t}){super.onResizeStart({context:e,event:t});const{client:r}=this;r.features.dependencies&&r.features.dependencies.hideTerminals(e.element),e.element.querySelector(".b-sch-event").classList.add("b-sch-event-resizing")}checkValidity(e,t){return(this.client.allowOverlap||this.client.isDateRangeAvailable(e.startDate,e.endDate,e.eventRecord,e.resourceRecord))&&super.checkValidity(e,t)}onFinishResize({source:e,context:t,event:r}){super.onFinishResize({source:e,context:t,event:r});const{client:n}=this;n.features.dependencies&&n.features.dependencies.showTerminals(t.eventRecord,t.element)}internalUpdateRecord(e,t){let r=!1;const n=this.store,i=()=>r=!0;return n.on("update",i),"left"===e.edge?t.setStartDate(e.startDate,!1,n.skipWeekendsDuringDragDrop):t.setEndDate(e.endDate,!1,n.skipWeekendsDuringDragDrop),n.un("update",i),r||this.client.repaintEventsForResource(e.resourceRecord),r}finalize(e){this.resize.context.element.querySelector(".b-sch-event").classList.remove("b-sch-event-resizing"),super.finalize(e)}}EventResize._$name="EventResize",GridFeatureManager.registerFeature(EventResize,!0,"Scheduler");class TooltipBase extends InstancePlugin{static get defaultConfig(){return{autoUpdate:!1,template:null,cls:null,align:"b-t",clockTemplate:null}}static get pluginConfig(){return{chain:["render"]}}construct(e,t){const r=this;t=r.processConfig(t),super.construct(e,t),r.forSelector||(r.forSelector=`${e.eventInnerSelector}:not(.b-dragproxy)`),r.clockTemplate=new ClockTemplate({timeAxisViewModel:e.timeAxisViewModel}),e.on({[`before${e.scheduledEventName}drag`]:()=>{r.tooltip&&r.tooltip.hide()}})}processConfig(e){return"function"==typeof e?{template:e}:e}setConfig(e){super.setConfig(this.processConfig(e))}doDestroy(){this.clockTemplate&&this.clockTemplate.destroy(),this.tooltip&&this.tooltip.destroy(),super.doDestroy()}render(){const e=this,t=e.client,r=[".b-dragselecting",".b-eventeditor-editing",".b-resizing-event",".b-dragcreating",`.b-dragging-${t.scheduledEventName}`,".b-creating-dependency",".b-dragproxy"].map(e=>`:not(${e})`).join("");e.tooltip&&e.tooltip.destroy(),e.tooltip=new Tooltip(Object.assign({axisLock:"flexible",id:e.tipId||`${e.client.id}-event-tip`,cls:e.tipCls,forSelector:`.b-timelinebase${r} ${e.forSelector}`,scrollAction:"realign",clippedBy:[t.timeAxisSubGridElement,t.bodyContainer],forElement:t.timeAxisSubGridElement,showOnHover:!0,hoverDelay:0,hideDelay:100,anchorToTarget:!0,allowOver:!0,getHtml:e.getTipHtml.bind(e)},e.config)),e.tooltip.on("innerhtmlupdate",e.updateDateIndicator,e)}updateDateIndicator(){const e=this.client,t=this.tooltip,r=t.activeTarget&&e.resolveTimeSpanRecord(t.activeTarget),n=t.element.querySelector(".b-sch-tooltip-enddate");r&&(this.clockTemplate.updateDateIndicator(t.element,r.startDate),n&&this.clockTemplate.updateDateIndicator(n,r.endDate))}resolveTimeSpanRecord(e){return this.client.resolveTimeSpanRecord(e)}getTipHtml({tip:e,forElement:t}){const r=this,n=r.client,i=r.recordType||`${n.scheduledEventName}Record`,s=r.resolveTimeSpanRecord(t);if(s){const{startDate:t,endDate:o}=s,a=n.getFormattedDate(t),l=n.getDisplayEndDate(o,t),d=n.getFormattedDate(l);return e.eventRecord=s,e.title=s.name,r.template({tip:e,[`${i}`]:s,startDate:t,endDate:o,startText:a,endText:d,startClockHtml:r.clockTemplate.template({date:t,text:a,cls:"b-sch-tooltip-startdate"}),endClockHtml:s.isMilestone?"":r.clockTemplate.template({date:l,text:d,cls:"b-sch-tooltip-enddate"})})}return e.hide(),""}}TooltipBase._$name="TooltipBase";class EventTooltip extends TooltipBase{static get defaultConfig(){return{template:e=>`\n                ${e.eventRecord.name?`<div class="b-sch-event-title">${e.eventRecord.name}</div>`:""}\n                ${e.startClockHtml}\n                ${e.endClockHtml}`,cls:"b-sch-event-tooltip"}}}EventTooltip._$name="EventTooltip",GridFeatureManager.registerFeature(EventTooltip,!0,"Scheduler");var SummaryFormatter=e=>(class extends(e||Base){generateHtml(e,t,r){const n=this.store;let i=`<table class="${r}">`;return(e.summaries||(e.sum?[{sum:e.sum,renderer:e.summaryRenderer}]:[])).forEach(r=>{let s=r.sum,o=null;switch(!0===s&&(s="sum"),s){case"sum":case"add":o=n.sum(e.field,t);break;case"max":o=n.max(e.field,t);break;case"min":o=n.min(e.field,t);break;case"average":case"avg":o=n.average(e.field,t);break;case"count":o=t.length;break;case"countNotEmpty":o=t.reduce((t,r)=>{const n=r[e.field];return t+(null!==n&&void 0!==n?1:0)},0)}if("function"==typeof s&&(o=t.reduce(s,"seed"in r?r.seed:0)),null!==o){const e="b-grid-summary-value",t=r.renderer?r.renderer({config:r,sum:o}):o,n=r.label?`<td class="b-grid-summary-label">${r.label}</td>`:"";let s;s=String(t).includes("<td>")?t:n?`${n}<td class="${e}">${t}</td>`:`<td colspan="2" class="${e}">${t}</td>`,i+=`<tr>${s}</tr>`}}),i+"</table>"}});class GroupSummary extends(SummaryFormatter(InstancePlugin)){construct(e,t){const r=this;if(Object.assign(r,{grid:e,store:e.store}),r.store.useGroupFooters=!0,super.construct(e,t),!e.features.group)throw new Error("Requires Group feature to work, please enable");r.store.on({update:r.onStoreUpdate,prio:1,thisObj:r}),r.grid.rowManager.on({beforerenderrow:r.onBeforeRenderRow,rendercell:r.renderCell,thisObj:r})}static get pluginConfig(){return{}}onBeforeRenderRow({row:e,record:t}){e.isGroupFooter&&!t.meta.hasOwnProperty("groupFooterFor")&&(e.isGroupFooter=!1,e.removeCls("b-group-footer"),e.forceInnerHTML=!0)}renderCell({column:e,cellElement:t,rowElement:r,row:n,record:i,size:s}){const o=this;if(o.store.isGrouped&&i.meta.hasOwnProperty("groupFooterFor")){r.classList.add("b-group-footer"),n.isGroupFooter=!0;const a=o.updateSummaryHtml(t,e,i.meta.groupRecord.groupChildren),l="number"==typeof a?a:a.count;l>1&&(s.height=o.grid.rowHeight+l*o.grid.rowHeight*.1),a.height&&(s.height+=a.height)}}updateSummaryHtml(e,t,r){(r=r.slice()).pop();const n=this.generateHtml(t,r,"b-grid-group-summary");return e.children.length?DomHelper.sync(n,e.firstElementChild):e.innerHTML=n,t.summaries?t.summaries.length:t.sum?1:0}onStoreUpdate({source:e,changes:t}){if(t&&e.groupers.find(e=>e.field in t))return;Object.keys(t).some(e=>{const t=this.grid.columns.get(e);return Boolean(t)&&(Boolean(t.sum)||Boolean(t.summaries))})&&(this.grid.forceFullRefresh=!0)}}GroupSummary.featureClass="b-group-summary",GroupSummary._$name="GroupSummary",GridFeatureManager.registerFeature(GroupSummary);const refreshActions={add:1,remove:1,update:1,removeAll:1,filter:1};class GroupSummary$1 extends GroupSummary{static get defaultConfig(){return{showTooltip:!0,summaries:null,renderer:null}}static get pluginConfig(){return{chain:["render"]}}construct(e,t){const r=this;r.scheduler=e,super.construct(e,t),!r.summaries&&r.renderer&&(r.summaries=[{renderer:r.renderer}]),e.eventStore.on({change:r.onEventStoreChange,thisObj:r}),e.timeAxis.on({reconfigure:r.onTimeAxisChange,thisObj:r}),e.timeAxisViewModel.on({update:r.onTimeAxisChange,thisObj:r})}doDestroy(){this._tip&&this._tip.destroy(),super.doDestroy()}onTimeAxisChange(){this.rerenderGroupSummaries()}onEventStoreChange({action:e}){refreshActions[e]&&this.rerenderGroupSummaries()}rerenderGroupSummaries(){this.scheduler.rowManager.rows.forEach(e=>{e.isGroupFooter&&e.render()})}onBeforeRenderRow({row:e,record:t}){if(e.isGroupFooter&&!t.meta.hasOwnProperty("groupFooterFor")){const t=e.elements.normal.querySelector(".b-sch-timeaxis-cell");t&&(t.innerHTML="")}super.onBeforeRenderRow(...arguments)}generateHtml(e,t,r){if("timeAxis"===e.type){const e=this,r=e.scheduler,n=r.timeAxisViewModel.tickWidth;let i="";return r.timeAxis.forEach(s=>{const o=r.eventStore.getEventsInTimeSpan(s.startDate,s.endDate,!0,!0).filter(e=>e.resources.some(e=>t.includes(e))),a=e.summaries.map(e=>{return`<div class="b-timeaxis-summary-value">${e.renderer({startDate:s.startDate,endDate:s.endDate,eventStore:r.eventStore,resourceStore:r.resourceStore,events:o})}</div>`}).join("");i+=`<div class="b-timeaxis-tick" style="width: ${n}px">${a}</div>`}),`<div class="b-timeaxis-group-summary">${i}</div>`}return super.generateHtml(e,t,r)}updateSummaryHtml(e,t,r){const n=super.updateSummaryHtml(e,t,r);if("timeAxis"===t.type){let e={count:0,height:0};return this.summaries.forEach(t=>{t.height?e.height+=t.height:e.count++}),e}return n}getTipHtml({forElement:e}){const t=this,r=Array.from(e.parentElement.children).indexOf(e),n=t.scheduler.timeAxis.getAt(r);let i=`<header>${t.L("Summary for")} ${t.scheduler.getFormattedDate(n.startDate)}</header>`,s=!1;return DomHelper.forEachSelector(e,".b-timeaxis-summary-value",(e,r)=>{const n=t._labels[r],o=e.innerText.trim();i+=`<label>${n||""}</label><div class="b-timeaxis-summary-value">${o}</div>`,e.innerHTML&&(s=!0)}),s?i:null}render(){const e=this,{scheduler:t}=e;e.summaries&&e.summaries.some(e=>e.label)&&e.showTooltip&&!e._tip&&(e._labels=e.summaries.map(e=>e.label||""),e._tip=new Tooltip({id:`${t.id}-groupsummary-tip`,cls:"b-timeaxis-summary-tip",hoverDelay:0,hideDelay:0,forElement:t.timeAxisSubGridElement,anchorToTarget:!0,forSelector:".b-timeaxis-group-summary .b-timeaxis-tick",clippedBy:[t.timeAxisSubGridElement,t.bodyContainer],getHtml:e.getTipHtml.bind(e)}))}}GroupSummary$1._$name="GroupSummary",GroupSummary$1._$name="GroupSummary",GridFeatureManager.registerFeature(GroupSummary$1,!1,"Scheduler");class HeaderContextMenu extends InstancePlugin{static get defaultConfig(){return{extraItems:null,processItems:null}}static get pluginConfig(){return{chain:["getHeaderMenuItems"]}}construct(e,t){super.construct(e,t),this.scheduler=e}getHeaderMenuItems(e,t){const r=this,n=r.client.timeAxis,i={magnitude:n.shiftIncrement,unit:n.shiftUnit};if("timeAxis"!==e.type)return;t.push({text:r.L("pickZoomLevel"),icon:"b-fw-icon b-icon-search-plus",disabled:!r.scheduler.zoomLevels.length,menu:{type:"popup",items:[{type:"slider",showValue:!1,listeners:{input:r.onZoomSliderChange,thisObj:r},minWidth:130}],onBeforeShow({source:e}){const[t]=e.items;t.min=r.scheduler.minZoomLevel,t.max=r.scheduler.maxZoomLevel,t.value=r.scheduler.zoomLevel}}}),r.startDateField=new DateField({label:r.L("startText"),labelWidth:"6em",required:!0,step:i,listeners:{change:r.onRangeDateFieldChange,thisObj:r}}),r.endDateField=new DateField({label:r.L("endText"),labelWidth:"6em",required:!0,step:i,listeners:{change:r.onRangeDateFieldChange,thisObj:r}}),t.push({text:r.L("activeDateRange"),icon:"b-fw-icon b-icon-calendar",menu:{type:"popup",width:"20em",items:[r.startDateField,r.endDateField,{type:"button",cls:"b-left-nav-btn",icon:"b-icon b-icon-prev",color:"b-blue b-raised",flex:1,margin:0,listeners:{click:r.onLeftShiftBtnClick,thisObj:r}},{type:"button",cls:"b-today-nav-btn",color:"b-blue b-raised",text:r.L("todayText"),flex:4,margin:"0 8",listeners:{click:r.onTodayBtnClick,thisObj:r}},{type:"button",cls:"b-right-nav-btn",icon:"b-icon b-icon-next",color:"b-blue b-raised",flex:1,listeners:{click:r.onRightShiftBtnClick,thisObj:r}}],onBeforeShow:()=>r.initDates()}}),r.extraItems&&t.push.apply(t,r.extraItems);let s={items:t},{processItems:o}=r;o&&o(s)}onZoomSliderChange({value:e}){this.scheduler.zoomLevel=e}initDates(){const e=this;e.startDateField.suspendEvents(),e.endDateField.suspendEvents(),e.startDateField.value=e.scheduler.startDate,e.endDateField.value=e.scheduler.endDate,e.startDateField.resumeEvents(),e.endDateField.resumeEvents()}onRangeDateFieldChange(){const e=this,{client:t}=e,{timeResolution:r}=t,{scrollable:n}=t.timeAxisSubGrid,i=e.startDateField.value,s=t.getDateFromX(n.x);let o=e.endDateField.value;o-i||(o=DateHelper.add(o,r.increment,r.unit)),e.scheduler.timeAxis.setTimeSpan(i,o),n.x=t.getCoordinateFromDate(s,!0),e.initDates()}onLeftShiftBtnClick(){this.scheduler.timeAxis.shiftPrevious(),this.initDates()}onTodayBtnClick(){const e=DateHelper.clearTime(new Date);this.scheduler.timeAxis.setTimeSpan(e,DateHelper.add(e,1,"day")),this.initDates()}onRightShiftBtnClick(){this.scheduler.timeAxis.shiftNext(),this.initDates()}}HeaderContextMenu.featureClass="",HeaderContextMenu._$name="HeaderContextMenu",GridFeatureManager.registerFeature(HeaderContextMenu,!0,["Scheduler","Gantt"]);const sides=["top","left","right","bottom"],editorAlign={top:"b-b",right:"l-l",bottom:"t-t",left:"r-r"},topBottom={top:1,bottom:1};class Labels extends InstancePlugin{static get defaultConfig(){return{labelCls:"b-sch-label",top:null,right:null,bottom:null,left:null,thisObj:null,blurAction:"cancel"}}static get pluginConfig(){return{}}construct(e,t){const r=this;r.scheduler=e,r.labelElements={},super.construct(e,t);const{top:n,bottom:i,left:s,right:o}=r;(n||i||s||o)&&(r.schedulerDetatcher=e.on({eventpaint:"onEventPaint",eventrepaint:"onEventPaint",taskpaint:"onEventPaint",taskrepaint:"onEventPaint",thisObj:r}),r.updateHostClasslist())}updateHostClasslist(){const{top:e,bottom:t}=this,{classList:r}=this.scheduler.element;r.remove("b-labels-topbottom"),r.remove("b-labels-top"),r.remove("b-labels-bottom"),(e||t)&&(r.add("b-labels-topbottom"),e&&r.add("b-labels-top"),t&&r.add("b-labels-bottom"))}onEventDblClick(e){const t=this,{event:r}=e,n=r.target.closest(".b-sch-label");if(n&&!t.scheduler.readOnly){const{side:i}=n.dataset,s=t[i],{editor:o,field:a,recordType:l}=s;if(o)return o instanceof Editor||(s.editor=new Editor({appendTo:t.scheduler.element,blurAction:t.blurAction,inputField:o,scrollAction:"realign"})),s.editor.startEdit({target:n,align:editorAlign[i],matchSize:!1,record:e[`${l}Record`],field:a}),r.stopImmediatePropagation(),!1}}set top(e){this._top=this.processLabelSpec(e,"top"),this.updateHostClasslist()}get top(){return this._top}set right(e){this._right=this.processLabelSpec(e,"right"),this.updateHostClasslist()}get right(){return this._right}set bottom(e){this._bottom=this.processLabelSpec(e,"bottom"),this.updateHostClasslist()}get bottom(){return this._bottom}set left(e){this._left=this.processLabelSpec(e,"left"),this.updateHostClasslist()}get left(){return this._left}processLabelSpec(e,t){if("function"==typeof e)e={renderer:e};else if("string"==typeof e)e={field:e};else{if(!e)return;e=Object.setPrototypeOf({},e)}const{scheduler:r}=this,{eventStore:n,resourceStore:i,taskStore:s,id:o}=r,{field:a,editor:l}=e;if(topBottom[t]&&(r.milestoneWidth=null),a){let t;n&&!s&&((t=n.modelClass.fieldMap[a])?(e.fieldDef=t,e.recordType="event"):Reflect.has(n.modelClass.prototype,a)&&(e.recordType="event")),!t&&s&&((t=s.modelClass.fieldMap[a])?(e.fieldDef=t,e.recordType="task"):Reflect.has(i.modelClass.prototype,a)&&(e.recordType="task")),!t&&i&&((t=i.modelClass.fieldMap[a])?(e.fieldDef=t,e.recordType="resource"):Reflect.has(i.modelClass.prototype,a)&&(e.recordType="resource")),l&&("boolean"==typeof l?r.editor={type:"textfield"}:"string"==typeof l&&(r.editor={type:l}),r.on({eventdblclick:"onEventDblClick",taskdblclick:"onEventDblClick",thisObj:this}))}return e}doDestroy(){this.schedulerDetatcher&&this.schedulerDetatcher(),super.doDestroy()}get disabled(){return this._disabled}set disabled(e){this._disabled=e,this.client.rendered&&this.client.refresh()}onEventPaint(e){if(DomHelper.removeEachSelector(e.element,".b-sch-label"),!this.disabled)for(const t of sides)this[t]&&this.appendLabel(t,e.element,e)}appendLabel(e,t,r){this.labelElements[e]=DomHelper.createElement({tag:"label",dataset:{side:e},parent:t}),this.updateLabel(e,r)}updateLabel(e,t){const r=this,{field:n,fieldDef:i,recordType:s,renderer:o,thisObj:a}=r[e],l=r.labelElements[e];let d;l.className=`${r.labelCls} ${r.labelCls}-${e}`,o?d=o.call(a||r.thisObj||r,Object.assign({labelElement:l},t)):(d=t[`${s}Record`][n],i&&"date"===i.type&&!o&&(d=DateHelper.format(d,r.scheduler.displayDateFormat))),l.innerHTML=d||""}}Labels.featureClass="b-sch-labels",Labels._$name="Labels",GridFeatureManager.registerFeature(Labels,!1,"Scheduler");class AbstractTimeRanges extends(Delayable(InstancePlugin)){static get defaultConfig(){return{rangeCls:"b-sch-range",lineCls:"b-sch-line",store:{modelClass:TimeSpan},enableResizing:!1,showTooltip:!0,showHeaderElements:!0,dragTipTemplate:e=>`\n                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">\n                    <div class="b-sch-tip-name">${e.name||""}</div>\n                    ${e.startClockHtml}\n                    ${e.endClockHtml||""}\n                </div>\n            `,baseCls:"b-sch-timerange",cls:""}}static get pluginConfig(){return{chain:["render","getHeaderMenuItems"]}}construct(e,t){const r=this;super.construct(e,t),r.cls=r.cls||`b-timerange-${r.constructor.$name}`,r.baseSelector=`.${r.baseCls}.${r.cls}`,r.enableResizing&&(r.showHeaderElements=!0)}doDestroy(){const e=this;e.storeDetacher&&e.storeDetacher(),e.timeAxisViewModelDetacher&&e.timeAxisViewModelDetacher(),e.clockTemplate&&e.clockTemplate.destroy(),e.tip&&e.tip.destroy(),e.drag&&e.drag.destroy(),e.resize&&e.resize.destroy(),super.doDestroy()}render(){const e=this;e.timeAxisViewModel=e.client.timeAxisViewModel,e.timeAxisViewModelDetacher=e.timeAxisViewModel.on({reconfigure:e.onTimeAxisViewModelUpdate,update:e.onTimeAxisViewModelUpdate,detachable:!0,thisObj:e}),e.enableResizing&&(e.drag=new DragHelper({name:"rangeDrag",mode:"translateX",constrain:!0,outerElement:e.headerContainerElement,targetSelector:`${e.baseSelector}`,isElementDraggable:(t,r)=>!e.client.readOnly&&e.isElementDraggable(t,r),listeners:{dragstart:e.onDragStart,drag:e.onDrag,drop:e.onDrop,abort:e.onInvalidDrop,thisObj:e}}),e.resize=new ResizeHelper({targetSelector:`${e.baseSelector}.b-sch-range`,outerElement:e.headerContainerElement,listeners:{resizestart:e.onResizeStart,resizing:e.onResizeDrag,resize:e.onResize,thisObj:e}})),e.renderRanges()}renderRanges(){const e=this,t=e.client.foregroundCanvas;if(t){const{headerContainerElement:r,store:n}=e;if(DomHelper.removeEachSelector(t,e.baseSelector),DomHelper.removeEachSelector(r,e.baseSelector),!e.disabled)for(let t of n)e.renderRange(t,!0)}}renderRange(e,t){const r=this,n=r.client;if(n.rendered&&(e.duration&&n.timeAxis.timeSpanInAxis(e.startDate,e.endDate)||e.startDate&&n.timeAxis.dateInAxis(e.startDate))){let i;const s=n.getCoordinateFromDate(DateHelper.max(e.startDate,n.timeAxis.startDate)),o=e.duration&&n.getCoordinateFromDate(DateHelper.min(e.endDate,n.timeAxis.endDate)),a=`<label>${e.name||"&nbsp;"}</label>`,l={className:`${r.baseCls} ${r.cls} ${o?r.rangeCls:r.lineCls} ${e.cls||""}`,dataset:{id:e.id},style:`transform: translateX(${s}px); ${o?`width:${o-s}px`:""};`},d=DomHelper.createElement(Object.assign({},l,{parent:t&&n.foregroundCanvas,style:l.style+(e.style||""),html:r.showHeaderElements?"":a}));r.showHeaderElements&&(i=DomHelper.createElement(Object.assign({parent:t&&r.headerContainerElement,html:e.name?a:""},l)));const c={bodyElement:d,headerElement:i};return t&&r.rotateLabel(c),c}}rotateLabel({bodyElement:e,headerElement:t}){const r=e.firstChild;r&&(r.classList.remove("b-vertical"),r.classList[r.offsetWidth>e.offsetWidth?"add":"remove"]("b-vertical"))}getElementsByRecord(e){const t="string"==typeof e?e:e.id,r=this.client.foregroundCanvas.querySelector(`${this.baseSelector}[data-id="${t}"]`),n=this.headerContainerElement.querySelector(`${this.baseSelector}[data-id="${t}"]`);return r?{bodyElement:r,headerElement:n}:null}getBodyElementByRecord(e){const t="string"==typeof e?e:e.id;return this.client.foregroundCanvas.querySelector(`${this.baseSelector}[data-id="${t}"]`)}getRecordByElement(e){return this.store.getById(e.dataset.id)}get headerContainerElement(){return this.client.timeAxisColumn.element.parentElement}get showHeaderElements(){return this._showHeaderElements}set showHeaderElements(e){this._showHeaderElements=e,this.client.element&&(e?this.client.element.classList.add("b-sch-timeranges-with-headerelements"):this.client.element.classList.remove("b-sch-timeranges-with-headerelements"),this.renderRanges())}getHeaderMenuItems(e,t){return[]}get disabled(){return super.disabled}set disabled(e){super.disabled=e,this.renderRanges()}get store(){return this._store}set store(e){const t=this;t._store=Store.getStore(e,Store);let r=!1;t.storeDetacher&&(t.storeDetacher(),r=!0),t.storeDetacher=t._store.on({change:t.onStoreChanged,thisObj:t}),r&&this.renderRanges()}onTimeAxisViewModelUpdate(){this.renderRanges()}onStoreChanged(e){const t=this;if(!t.isConfiguring)if("update"===e.action){const r=t.getElementsByRecord(e.record),n=t.renderRange(e.record,!r);if(r&&!n&&(r.bodyElement.remove(),r.headerElement&&r.headerElement.remove()),!r||!n)return;t.client.runWithTransition(()=>{DomHelper.sync(n.bodyElement,r.bodyElement),t.showHeaderElements&&DomHelper.sync(n.headerElement,r.headerElement),t.rotateLabel(r)})}else t.renderRanges()}showTip(e){const t=this;t.showTooltip&&(t.clockTemplate=new ClockTemplate({timeAxisViewModel:t.client.timeAxisViewModel}),t.tip=new Tooltip({id:`${t.client.id}-time-range-tip`,cls:"b-interaction-tooltip",align:"b-t",autoShow:!0,forElement:e.element,getHtml:()=>t.getTipHtml(e.record,e.element)}))}isElementDraggable(e,t){return(e=e.closest(this.baseSelector))&&!this.resize.overLeftHandle(t,e)&&!this.resize.overRightHandle(t,e)}onDragStart({context:e,event:t}){const r=this,n=r.getRecordByElement(e.element.closest(r.baseSelector)),i=r.getBodyElementByRecord(n),s=r.drag;Object.assign(e,{record:n,rangeBodyEl:i,originRangeX:DomHelper.getTranslateX(i)}),s.minX=0,s.maxX=r.timeAxisViewModel.totalWidth-e.rangeBodyEl.offsetWidth,r.showTip(e)}onDrag({context:e,event:t}){DomHelper.setTranslateX(e.rangeBodyEl,DomHelper.getTranslateX(e.element)),this.showTooltip&&this.tip.realign()}onDrop({source:e,context:t,event:r}){if(!t.valid)return this.onInvalidDrop({context:t});const n=this,i=t.record,s=t.rangeBodyEl.getBoundingClientRect(),o=n.client.getDateFromCoordinate(s.left,"round",!1);i.startDate-o!=0?i.setStartDate(o):n.onInvalidDrop(),n.tip&&(n.tip.destroy(),n.tip=null)}onInvalidDrop(){const e=this;e.drag.reset(),e.renderRanges(),e.tip&&(e.tip.destroy(),e.tip=null)}onResizeStart({context:e,event:t}){const r=this.getRecordByElement(e.element.closest(this.baseSelector)),n=this.getBodyElementByRecord(r);Object.assign(e,{record:r,rangeBodyEl:n}),this.showTip(e)}onResizeDrag({context:e,event:t}){const r=this;"left"===e.edge&&DomHelper.setTranslateX(e.rangeBodyEl,e.newX),e.rangeBodyEl.style.width=e.newWidth+"px",r.showTooltip&&r.tip.realign()}onResize({source:e,context:t,event:r}){if(!t.valid)return this.onInvalidDrop({context:t});const n=this,i=t.record,s=t.element.getBoundingClientRect(),o=n.client.getDateFromCoordinate(s.left,"round",!1),a="left"===e.context.edge,l=n.client.getDateFromCoordinate(s.right,"round",!1);(a&&i.startDate-o!=0||l&&i.endDate-l!=0)&&l>o?a?i.setStartDate(o,!1):i.setEndDate(l,!1):n.onInvalidResize(),n.tip&&(n.tip.destroy(),n.tip=null)}onInvalidResize(){const e=this;e.resize.reset(),e.renderRanges(),e.tip&&(e.tip.destroy(),e.tip=null)}getTipHtml(e,t){const r=this,n=t.getBoundingClientRect(),i=r.client.getDateFromCoordinate(n.left,"round",!1),s=e.endDate&&r.client.getDateFromCoordinate(n.right,"round",!1),o=r.client.getFormattedDate(i),a=s&&r.client.getFormattedEndDate(s,i);return r.dragTipTemplate({name:e.name||"",startDate:i,endDate:s,startText:o,endText:a,startClockHtml:r.clockTemplate.template({date:i,text:o,cls:"b-sch-tooltip-startdate"}),endClockHtml:a&&r.clockTemplate.template({date:s,text:a,cls:"b-sch-tooltip-enddate"})})}}AbstractTimeRanges._$name="AbstractTimeRanges";class NonWorkingTime extends AbstractTimeRanges{static get defaultConfig(){return{highlightWeekends:!0,showHeaderElements:!0,cls:"b-sch-nonworkingtime"}}construct(e,t){const r=this;super.construct(e,t),r.calendar&&e.calendar||(r.calendar=new Calendar),r.bindCalendar(r.calendar)}doDestroy(){this.bindCalendar(null),super.doDestroy()}bindCalendar(e){const t=this;t.calendarDetacher&&t.calendarDetacher(),e&&(t.calendarDetacher=e.on({change:t.renderRanges,thisObj:t,delay:1})),t.calendar=e,t.renderRanges()}renderRanges(){const e=this;if(e.store&&!e.store.isDestroyed){const t=DateHelper.as(e.client.timeAxis.unit,1,"week")>=1;e.store.removeAll(!0),e.calendar&&e.highlightWeekends&&t&&e.store.add(e.calendar.getHolidaysRanges(e.client.timeAxis.startDate,e.client.timeAxis.endDate,!0),!0)}super.renderRanges()}}NonWorkingTime._$name="NonWorkingTime",GridFeatureManager.registerFeature(NonWorkingTime,!1,"Scheduler");class Pan extends InstancePlugin{static get defaultConfig(){return{vertical:!0}}construct(e,t){if(this.timeline=e,e.features.eventDragCreate)throw new Error("Cannot combine Pan and eventDragCreate features");this.targetSelector=[".b-grid-cell",".b-timeline-subgrid"].join(","),super.construct(e,t)}static get pluginConfig(){return{chain:["onElementMouseDown","onElementMouseMove","onElementMouseUp"]}}onElementMouseDown(e){const t=this,r=t.timeline,n=Object.values(r.features).find(e=>e instanceof DragBase),i=r.readOnly||!n||n.disabled;e.touches||0!==e.button||(e.target.matches(t.targetSelector)||i&&e.target.closest(r.eventSelector))&&(t.mouseX=e.clientX,t.mouseY=e.clientY)}onElementMouseMove(e){const t=this;if(0!==e.buttons||BrowserHelper.isSafari||BrowserHelper.isIE11&&!e.isTrusted){if("number"==typeof t.mouseX){const r=t.timeline.subGrids.normal.scrollable,n=t.timeline.scrollable,i=e.clientX,s=e.clientY;e.preventDefault(),t.vertical&&n.scrollBy(0,t.mouseY-s),r.scrollBy(t.mouseX-i),t.mouseX=i,t.mouseY=s}}else t.onElementMouseUp()}onElementMouseUp(e){this.mouseX=this.mouseY=null}}Pan._$name="Pan",GridFeatureManager.registerFeature(Pan,!1,"Scheduler");class ResourceTimeRanges extends InstancePlugin{static get defaultConfig(){return{idPrefix:"resourcetimerange",rangeCls:"b-sch-resourcetimerange",store:!1,resourceTimeRanges:null}}static get pluginConfig(){return{chain:["getEventsToRender","onEventDataGenerated"]}}construct(e,t){const r=this;r.scheduler=e,super.construct(e,t),Object.defineProperty(e,"resourceTimeRanges",{get:()=>r.store.records,set:e=>r.store.data=e})}set store(e){const t=this,{scheduler:r}=t;t._store=e=e||new ResourceTimeRangeStore,r.resourceTimeRangeStore||(r.resourceTimeRangeStore=e),r.resourceTimeRanges&&(e.add(r.resourceTimeRanges),delete r.resourceTimeRanges),e.resourceStore||(e.resourceStore=r.resourceStore),t.storeDetacher&&t.storeDetacher(),t.storeDetacher=t.store.on({change:t.onStoreChange,thisObj:t})}get store(){return this._store}getEventsToRender(e,t){return e.timeRanges&&t.push(...e.timeRanges),t}onEventDataGenerated(e){const t=this,r=e.event;r.isResourceTimeRange&&(e.top=0,e.fillHeight=!0,e.id=`${t.scheduler.id}-${t.idPrefix}-${r.id}`,e.eventId=`${t.idPrefix}-${r.id}`,e.wrapperCls[t.rangeCls]=1,e.wrapperCls[`b-sch-color-${r.timeRangeColor}`]=r.timeRangeColor,e.body=document.createDocumentFragment(),e.body.textContent=r.name)}onStoreChange(e){this.scheduler.onInternalEventStoreChange(e)}}ResourceTimeRanges.featureClass="",ResourceTimeRanges._$name="ResourceTimeRanges",GridFeatureManager.registerFeature(ResourceTimeRanges,!1,"Scheduler");class ScheduleTooltip extends InstancePlugin{static get defaultConfig(){return{messageTemplate:e=>`<div class="b-sch-hovertip-msg">${e.message}</div>`}}static get pluginConfig(){return{chain:["render"]}}render(){const e=this,t=e.client;let r;e.hoverTip&&e.hoverTip.destroy();const n=e.hoverTip=new Tooltip({id:`${t.id}-schedule-tip`,cls:"b-sch-scheduletip",allowOver:!0,hoverDelay:0,hideDelay:100,showOnHover:!0,forElement:t.timeAxisSubGridElement,anchorToTarget:!1,trackMouse:!0,forSelector:".b-scheduler:not(.b-animating):not(.b-dragging-event):not(.b-dragcreating) .b-timeline-subgrid > :not(.b-sch-foreground-canvas):not(.b-group-footer):not(.b-group-row) *",getHtml:e.getHoverTipHtml.bind(e),onDocumentMouseDown(e){n.forElement.contains(e.event.target)&&(r=EventHelper.on({element:t.timeAxisSubGridElement,mousemove:e=>n.internalOnPointerOver(e),capture:!0}));const i=n.hideAnimation;n.hideAnimation=!1,n.constructor.prototype.onDocumentMouseDown.call(n,e),n.hideAnimation=i},listeners:{pointerover:({event:e})=>{const n="buttons"in e?e.buttons>0:e.which>0;return!n&&r&&r(),!t.readOnly&&!n}}}),i=n.onMouseMove;n.onMouseMove=(t=>{i.call(n,t),e.onTipMove(n,t)}),e.clockTemplate=new ClockTemplate({timeAxisViewModel:t.timeAxisViewModel})}doDestroy(){this.clockTemplate&&this.clockTemplate.destroy(),this.hoverTip&&this.hoverTip.destroy(),super.doDestroy()}onTipMove(e,t){this.clockTemplate.updateDateIndicator(e.element,this.lastTime)}getHoverTipHtml({tip:e,event:t}){let r=this,n=r.client,i=t&&n.getDateFromCoordinate(t.offsetX,"floor",!0),s=r.lastHtml;if(i){const e=n.resolveResourceRecord(t.target);i-r.lastTime==0&&e===r.lastResource||(r.lastResource=e,s=r.lastHtml=r.updateHoverTip(i,t))}else e.hide(),r.lastTime=null,r.lastResource=null;return s}updateHoverTip(e,t){if(e){const r=this,n=r.clockTemplate.template({date:e,text:r.client.getFormattedDate(e)}),i=r.messageTemplate({message:r.getText(e,t)||""});return r.lastTime=e,n+i}}getText(e,t){}}ScheduleTooltip.featureClass="b-scheduletip",ScheduleTooltip._$name="ScheduleTooltip",GridFeatureManager.registerFeature(ScheduleTooltip,!0,"Scheduler");class SimpleEventEdit extends InstancePlugin{static get defaultConfig(){return{triggerEvent:"eventdblclick",eventRecord:null,field:"name",editorConfig:null}}static get pluginConfig(){return{chain:["onEnterKey"],assign:["editEvent"]}}construct(e,t){const r=this;r.scheduler=e,r.eventStore=e.eventStore,e.eventEdit=r,super.construct(e,t),r.clientListenersDetacher=e.on({[r.triggerEvent]:({eventRecord:e,eventElement:t})=>r.editEvent(e,e.resource,t),dragcreateend:r.onDragCreateEnd,thisObj:r})}doDestroy(){this.clientListenersDetacher(),this.editor&&this.editor.destroy(),super.doDestroy()}editEvent(e,t,r){const n=this,i=n.scheduler;i.readOnly||(e=e instanceof AssignmentModel?e.event:e,n.resource=t,n.event=e,n.element=r,i.element.classList.add("b-eventeditor-editing"),n.editor||(n.editor=new Editor(Object.assign({appendTo:n.scheduler.element,scrollAction:"realign",listeners:{complete:n.onEditorComplete,cancel:n.onEditorCancel,thisObj:n}},n.editorConfig)),n.relayEvents(n.editor,["beforestart","start","beforecomplete","complete","beforecancel","cancel"])),n.editor.startEdit({target:r,record:e,field:n.field}))}onEditorComplete(){const e=this;0===e.event.stores.length&&(e.eventStore.add(e.editor.record),e.event.assign(e.resource),e.element.remove()),e.scheduler.element.classList.remove("b-eventeditor-editing")}onEditorCancel(){0===this.event.stores.length&&this.element.remove(),this.scheduler.element.classList.remove("b-eventeditor-editing")}onEnterKey({assignmentRecord:e,eventRecord:t}){const r=e?this.scheduler.getElementFromAssignmentRecord(e):this.scheduler.getElementFromEventRecord(t),n=(e||t).resource;this.editEvent(t,n,r)}onDragCreateEnd({newEventRecord:e,resourceRecord:t,proxyElement:r}){this.scheduler.onEventCreated(e);const n=r.cloneNode(!0);n.removeAttribute("id"),r.parentElement.appendChild(n),this.element=n,this.editEvent(e,t,n)}}SimpleEventEdit._$name="SimpleEventEdit",GridFeatureManager.registerFeature(SimpleEventEdit,!1,"Scheduler");class Summary extends(SummaryFormatter(InstancePlugin)){construct(e,t){const r=this;Object.assign(r,{grid:e,store:e.store}),super.construct(e,t),r.store.on({change:r.onStoreChanged,thisObj:r}),r.grid.eachSubGrid(e=>{e.footer||(e.footer=new Footer({subGrid:e,parent:e}))})}doDestroy(){super.doDestroy()}static get pluginConfig(){return{chain:["renderRows"]}}renderRows(){this.updateSummaries()}updateSummaries(){const e=this,t=DomHelper.children(e.grid.element,".b-grid-footer"),r=e.store.storage.values.filter(e=>!e.meta.specialRow);e.grid.columns.forEach(e=>{e.summaries&&e.summaries.forEach(e=>{"seed"in e&&("initialSeed"in e||(e.initialSeed=e.seed),["number","string","date"].includes(typeof e.initialSeed)?e.seed=e.initialSeed:e.seed=Object.assign({},e.initialSeed))})}),t.forEach(t=>{const n=e.grid.columns.get(t.dataset.column),i=e.generateHtml(n,r,"b-grid-footer-summary");(n.summaries?n.summaries.length:!!n.sum)&&(t.children.length?DomHelper.sync(i,t.firstElementChild):t.innerHTML=i)})}onStoreChanged({action:e,changes:t}){let r=!0;"update"===e&&(r=Object.keys(t).some(e=>{const t=this.grid.columns.get(e);return Boolean(t)&&(Boolean(t.sum)||Boolean(t.summaries))})),r&&this.updateSummaries()}}Summary.featureClass="b-summary",Summary._$name="Summary",GridFeatureManager.registerFeature(Summary);class Header$1 extends Header{refreshContent(){this.headersElement&&0===this.headersElement.childNodes.length&&super.refreshContent()}}Header$1._$name="Header";class TimeAxisViewModel extends(Events()){static get defaultConfig(){return{timeAxis:null,availableWidth:null,tickWidth:100,snap:!1,forceFit:!1,headerConfig:null,calendar:null,mode:"horizontal",suppressFit:!1,columnConfig:{},viewPreset:null,columnLinesFor:"middle",eventStore:null,originalTickWidth:null,headersDatesCache:{}}}construct(e){const t=this;t.unitToPixelsCache={},super.construct(e);let r=t.timeAxis.viewPreset||t.viewPreset;if(r)if(r instanceof ViewPreset)t.consumeViewPreset(r);else{let e=PresetManager.getPreset(r);e&&t.consumeViewPreset(e)}t.timeAxis.on("reconfigure",t.onTimeAxisReconfigure,t),t.configured=!0}doDestroy(){this.timeAxis.un("reconfigure",this.onTimeAxisReconfigure,this)}get columnConfig(){return this._columnConfig}set columnConfig(e){this._columnConfig=e}get isHorizontal(){return"horizontal"===this.mode}set forceFit(e){e!==this._forceFit&&(this._forceFit=e,this.update())}reconfigure(e){this._headers=null,Object.assign(this,e),this.trigger("reconfigure")}onTimeAxisReconfigure({source:e,suppressRefresh:t}){this.viewPreset!==e.viewPreset&&this.consumeViewPreset(e.viewPreset),t||this.update()}update(e,t=!1,r=!1){const n=this,i=n.timeAxis,s=n.headerConfig;if(n.isConfiguring||n._availableWidth===e)return void(r&&n.trigger("update"));if(n._availableWidth=Math.max(e||n.availableWidth,0),"number"!=typeof n.availableWidth)throw new Error("Invalid available width provided to TimeAxisModel");if(n.availableWidth<=0)return;n.columnConfig={};const o=n._tickWidth=n.calculateTickWidth(n.originalTickWidth);if("number"!=typeof o||o<=0)throw new Error("Invalid timeAxis tick width");n.unitToPixelsCache={},n._totalWidth=null;for(let e in s)s[e].cellGenerator?n.columnConfig[e]=s[e].cellGenerator.call(n,i.startDate,i.endDate):n.columnConfig[e]=n.createHeaderRow(e,s[e]);t||n.trigger("update")}getDistanceBetweenDates(e,t){return Math.round(this.getPositionFromDate(t)-this.getPositionFromDate(e))}getDistanceForDuration(e){let t=this.timeAxis.getAt(0);return this.tickWidth/(t.endDate-t.startDate)*e}getPositionFromDate(e,t={}){const r=this.getScaledTick(e,t);return-1===r?-1:Math.round(this.tickWidth*(r-this.timeAxis.visibleTickStart))}getScaledTick(e,{respectExclusion:t,snapToNextIncluded:r,isEnd:n,min:i,max:s}){const{timeAxis:o}=this,{include:a,unit:l,weekStartDay:d}=o;let c=o.getTickFromDate(e);if(-1!==c&&t&&a){let t=!1;if(a.hour&&DateHelper.compareUnits(l,"hour")>0&&"day"!==l){const{from:n,to:i,lengthFactor:s,center:o}=a.hour,l=e.getHours(),d=Math.min(Math.max(l,n),i);if(!r&&d!==l)return-1;const c=o-(o-(d+e.getMinutes()/60))*s;e=DateHelper.add(e,c-l,"h"),t=!0}if(a.day&&DateHelper.compareUnits(l,"day")>0){const{from:o,to:l,lengthFactor:c,center:u}=a.day;let h=e.getDay();n&&0===e.getHours()&&0===e.getMinutes()&&0===e.getSeconds()&&0===e.getMilliseconds()&&--h<0&&(h=6);let g=0;if(h<o||h>=l){if(!r)return-1;if(g=n?(l-h-8)%7:(o-h+7)%7,e=DateHelper.add(e,g,"d"),e=DateHelper.startOf(e,"d",!1),s&&e.getTime()>=s||i&&e.getTime()<=i)return-1}const m=0===e.getDay()?0:u,p=e.getDay()+e.getHours()/24,f=m-(m-p)*c;e=DateHelper.add(e,f-p+d,"d"),t=!0}t&&(e=DateHelper.constrain(e,o.startDate,o.endDate),c=o.getTickFromDate(e))}return c}getDateFromPosition(e,t){const r=this.timeAxis,n=this.getScaledPosition(e)/this.tickWidth+r.visibleTickStart;return n<0||n>r.count?null:r.getDateFromTick(n,t)}getScaledPosition(e){const{include:t,unit:r,weekStartDay:n}=this.timeAxis;if(t){const i=this.getSingleUnitInPixels("day");if(t.day&&DateHelper.compareUnits(r,"day")>0){const{from:r,lengthFactor:s}=t.day,o=e%(7*i);e=o/s+(r-n)*i+(e-o)}if(t.hour&&DateHelper.compareUnits(r,"hour")>0&&"day"!==r){const{from:r,lengthFactorExcl:n}=t.hour,s=e%i;e=s/n+r*this.getSingleUnitInPixels("hour")+(e-s)}}return e}getSingleUnitInPixels(e){const t=this;return t.unitToPixelsCache[e]||(t.unitToPixelsCache[e]=DateHelper.getUnitToBaseUnitRatio(t.timeAxis.unit,e,!0)*t.tickWidth/t.timeAxis.increment)}get snapPixelAmount(){if(this.snap){const{resolution:e}=this.timeAxis;return(e.increment||1)*this.getSingleUnitInPixels(e.unit)}return 1}get tickWidth(){return this._tickWidth}set tickWidth(e){this.setTickWidth(e,!1)}setTickWidth(e,t){this._tickWidth=this.originalTickWidth=e,this.update(void 0,t)}get timeResolution(){return this.timeAxis.resolution}calculateTickWidth(e){let t=this.forceFit,r=this.timeAxis,n=0,i=r.unit,s=1;if(this.snap){const e=r.resolution;s=DateHelper.getUnitToBaseUnitRatio(i,e.unit)*e.increment}if(this.suppressFit)n=e;else{let i=r.visibleTickTimeSpan,o=Math[t?"floor":"round"](this.availableWidth/i);if(n=t||e<o?o:e,s>0&&(!t||s<1)){let e=t?"floor":"round";n=Math.round(Math.max(1,Math[e](s*n))/s)}}return n}get totalWidth(){return this._totalWidth||(this._totalWidth=Math.round(this.tickWidth*this.timeAxis.visibleTickTimeSpan))}get availableWidth(){return this._availableWidth}set availableWidth(e){const t=this;if(t._availableWidth=Math.max(0,e),t._availableWidth>0){const e=t.calculateTickWidth(t.originalTickWidth);e>0&&e!==t.tickWidth&&t.update()}}getDates(e=this.columnLinesFor,t=!1,r=!1){const n=this,i=[],s=t?n.lowestHeader:e,o=n.majorHeaderName,a=n.headerConfig&&n.headerConfig[e].unit,l=o&&n.headerConfig&&n.headerConfig[o].unit,d=o&&DateHelper.doesUnitsAlign(l,a);if(!(!n.headerConfig||!n.headerConfig[s].cellGenerator)){const e=n.columnConfig[s];for(let t=1,r=e.length;t<r;t++)i.push({date:e[t].startDate})}else n.forEachInterval(s,(t,s)=>{i.push({date:r?s:t,isMajor:o!==e&&d&&n.isMajorTick(r?s:t)})});return i}get forceFit(){return this._forceFit}fitToAvailableWidth(e){const t=Math.floor(this.availableWidth/this.timeAxis.visibleTickTimeSpan);this.setTickWidth(t,e)}get snap(){return this._snap}set snap(e){e!==this._snap&&(this._snap=e,this.configured&&this.update())}createHeaderRow(e,t){const r=this,n=[],i=t.align,s=DateHelper.clearTime(new Date),o=t.headerCellCls||"";return r.headersDatesCache[e]={},r.forEachInterval(e,(a,l,d)=>{let c=DateHelper.format(a,t.dateFormat),u={align:i,start:a,end:l,value:c,headerCellCls:o,width:this.getDistanceBetweenDates(a,l)};0!==u.width&&(r.headersDatesCache[e][a.getTime()]=1,t.renderer&&(c=t.renderer.call(t.thisObj||r,a,l,u,d,r.eventStore),u.value=null==c?"":c),"day"!==t.unit||t.increment&&1!==t.increment||(u.headerCellCls+=" b-sch-dayheadercell-"+a.getDay(),r.calendar&&r.calendar.isWeekend(a)&&(u.headerCellCls+=" b-sch-dayheadercell-nonworking"),DateHelper.clearTime(a,!0)-s==0&&(u.headerCellCls+=" b-sch-dayheadercell-today")),n.push(u))}),n}get headers(){const e=this;if(!e._headers){const t=e._headers=[],{top:r,middle:n,bottom:i}=e.headerConfig;r&&t.push(r),n&&t.push(n),i&&t.push(i)}return e._headers}get mainHeader(){return this.headerConfig.middle}get bottomHeader(){return this.headers[this.headers.length-1]}get lowestHeader(){return"bottom"in this.headerConfig?"bottom":"middle"}get majorHeaderName(){const e=this.headerConfig;return e.bottom?"middle":e.top?"top":null}isMajorTick(e){const t=this.majorHeaderName;return t&&this.headersDatesCache[t]&&this.headersDatesCache[t][e.getTime()]||!1}forEachInterval(e,t,r=this){const{headerConfig:n}=this;if(n)if("top"===e||"middle"===e&&n.bottom){const i=n[e];this.timeAxis.forEachAuxInterval(i.unit,i.increment,t,r)}else this.timeAxis.forEach((e,n)=>t.call(r,e.startDate,e.endDate,n))}forEachMainInterval(e,t){this.forEachInterval("middle",e,t)}consumeViewPreset(e){const t=this;t._headers=null,t._thisIsAUsedExpression(t.tickWidth),t._viewPreset=e,Object.assign(t,{headerConfig:e.headerConfig,columnLinesFor:e.columnLinesFor||"middle",_tickWidth:e.tickWidth}),t.originalTickWidth=t.tickWidth}}TimeAxisViewModel._$name="TimeAxisViewModel";const tempDate=new Date;var TimelineDateMapper=e=>(class extends(e||Base){getDateFromCoordinate(e,t,r=!0){return r||(e=this.currentOrientation.translateToScheduleCoordinate(e)),this.timeAxisViewModel.getDateFromPosition(e,t)}getDateFromX(e,t,r=!0){return this.getDateFromCoordinate(e,t,r)}getDateFromXY(e,t,r=!0){return this.currentOrientation.getDateFromXY(e,t,r)}get displayDateFormat(){return this._displayDateFormat}set displayDateFormat(e){this._displayDateFormat=e,this.trigger("displayDateFormatChange",{format:e})}getFormattedDate(e){return DateHelper.format(e,this.displayDateFormat)}getDisplayEndDate(e,t){const r=this.displayDateFormat;return 0!==e.getHours()||0!==e.getMinutes()||t&&e.getYear()===t.getYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()||/([gGhHisucUOPZ]|MS)/.test(r.replace(/(\\.)/g,""))||(e=DateHelper.add(e,-1,"day")),e}getFormattedEndDate(e,t){return this.getFormattedDate(this.getDisplayEndDate(e,t))}getCoordinateFromDate(e,t=!0){const r=this,{timeAxisViewModel:n}=r,{isContinuous:i,startMS:s,endMS:o,startDate:a,unit:l}=r.timeAxis,d=e.valueOf();let c;if(!0===t?t={local:!0}:t?"local"in t||(t.local=!0):t={local:!1},e instanceof Date||(tempDate.setTime(e),e=tempDate),i&&e.getTimezoneOffset()===a.getTimezoneOffset()&&-1!==DateHelper.getUnitToBaseUnitRatio(l,"day")){if(d<s||d>o)return-1;c=Math.round((d-s)/(o-s)*n.totalWidth)}else c=n.getPositionFromDate(e,t);return t.local||(c=r.currentOrientation.translateToPageCoordinate(c)),c}getDateFromDomEvent(e,t,r=!0){const n=r?e.offsetX:e.x,i=r?e.offsetY:e.y;return this.getDateFromXY([n,i],t,r)}getTimeSpanDistance(e,t){return this.timeAxisViewModel.getDistanceBetweenDates(e,t)}get viewportCenterDate(){const e=this,t=e.timeAxis,r=e.timeAxisSubGrid,n=r.scrollable,i=n.x+r.width/2,s=n.y+r.height/2;if(t.isContinuous){const r=e.isHorizontal?i/n.scrollWidth:s/n.scrollHeight,o=t.startMS+(t.endMS-t.startMS)*r;return new Date(o)}{const t=e.isHorizontal?[i,0]:[0,s];return e.getDateFromXY(t,null,!0)}}get viewportCenterDateCached(){return this.cachedCenterDate||(this.cachedCenterDate=this.viewportCenterDate)}get timeResolution(){return this.timeAxis.resolution}set timeResolution(e){this.timeAxis.resolution={increment:e,unit:this.timeAxis.resolution.unit}}set snap(e){this.isConfiguring?this._snap=e:this.timeAxisViewModel.snap=e}get snap(){return this.isConfiguring?this._snap:this.timeAxisViewModel.snap}onSchedulerHorizontalScroll({subGrid:e,scrollLeft:t}){this.scrollingToCenter||(this.cachedCenterDate=null)}get widgetClass(){}});const eventNameMap={mousedown:"MouseDown",mouseup:"MouseUp",click:"Click",dblclick:"DblClick",contextmenu:"ContextMenu",mouseover:"MouseOver",mouseout:"MouseOut"};var TimelineDomEvents=e=>(class extends(e||Base){static get defaultConfig(){return{scheduledBarEvents:{mousedown:"handleScheduledBarEvent",mouseup:"handleScheduledBarEvent",click:"handleScheduledBarEvent",dblclick:"handleScheduledBarEvent",contextmenu:"handleScheduledBarEvent",mouseover:"handleScheduledBarEvent",mouseout:"handleScheduledBarEvent"},schedulerEvents:{click:"handleScheduleEvent",dblclick:"handleScheduleEvent",contextmenu:"handleScheduleEvent"}}}initDomEvents(){const e=this;e.scheduledBarEvents.element=e.schedulerEvents.element=e.timeAxisSubGridElement,e.scheduledBarEvents.thisObj=e.schedulerEvents.thisObj=e,EventHelper.on(e.scheduledBarEvents),EventHelper.on(e.schedulerEvents)}getTimeSpanMouseEventParams(e,t){throw new Error("Implement in subclass")}getScheduleMouseEventParams(e){throw new Error("Implement in subclass")}handleScheduledBarEvent(e){const t=this,r=DomHelper.up(e.target,t.eventSelector),n=eventNameMap[e.type]||StringHelper.capitalizeFirstLetter(e.type);r&&t.trigger(t.scheduledEventName+n,t.getTimeSpanMouseEventParams(r,e))}handleScheduleEvent(e){const t=this,r=!DomHelper.up(e.target,t.eventSelector)&&DomHelper.up(e.target,"."+t.timeCellCls),n=eventNameMap[e.type]||StringHelper.capitalizeFirstLetter(e.type);if(r){const i=t.getDateFromDomEvent(e,"floor"),s=DomDataStore.get(r),o=s.row.dataIndex;t.trigger("schedule"+n,Object.assign({date:i,row:s.row,index:o,event:e},t.getScheduleMouseEventParams(s)))}}onElementMouseOver(e){super.onElementMouseOver(e);const t=this,r=e.target;if(r.closest(t.eventInnerSelector)){const n=r.closest(t.eventSelector);if(n.classList.add(t.overScheduledEventClass),n!==t.hoveredEventNode&&!t.preventOverCls){t.hoveredEventNode=n;const r=t.getTimeSpanMouseEventParams(n,e);r&&t.trigger(t.scheduledEventName+"MouseEnter",r)}}else t.hoveredEventNode=null}onElementMouseOut(e){super.onElementMouseOut(e);const t=this;if(e.target.closest(t.eventInnerSelector)&&t.hoveredEventNode){if(e.relatedTarget&&DomHelper.isDescendant(e.target.closest(t.eventInnerSelector),e.relatedTarget))return;t.unhover(e)}}unhover(e){const t=this,r=t.hoveredEventNode;r&&(r.classList.remove(t.overScheduledEventClass),t.trigger(t.scheduledEventName+"MouseLeave",t.getTimeSpanMouseEventParams(r,e)),t.hoveredEventNode=null)}get widgetClass(){}}),TimelineViewPresets=e=>(class extends(e||Base){static get defaultConfig(){return{viewPreset:"weekAndDayLetter",displayDateFormat:null}}get viewPreset(){return this._viewPreset}set viewPreset(e){this._viewPreset!==e&&this.setViewPreset(e)}setViewPreset(e,t,r,n,i={}){const s=this;n=n||s.isConfiguring;let o=i.centerDate,a=s._timeAxis;if(e=PresetManager.normalizePreset(e),n||!1!==s.trigger("beforePresetChange",{preset:e,startDate:t,endDate:r})){s._viewPreset=e,s.displayDateFormat=s.config.displayDateFormat||e.displayDateFormat;const l=s.isHorizontal;if(a){if(s.suspendRefresh(),!n||!a.isConfigured){const i={weekStartDay:s.weekStartDay,startTime:s.startTime,endTime:s.endTime};n?(0===a.count||t)&&(i.startDate=t||new Date,i.endDate=r):t?(i.startDate=t,i.endDate=r,!o&&r&&(o=new Date((t.getTime()+r.getTime())/2))):(i.startDate=a.startDate,i.endDate=r||a.endDate,o||(o=s.viewportCenterDate)),a.isConfigured=!1,a.viewPreset=e,a.reconfigure(i,!0),s.timeAxisViewModel.reconfigure({viewPreset:s.viewPreset,headerConfig:e.headerConfig,columnLinesFor:e.columnLinesFor||"middle",rowHeightHorizontal:s.readRowHeightFromPreset?e.rowHeight:s.rowHeight,tickWidth:l?e.tickWidth:e.timeRowHeight||e.timeColumnWidth||60}),s.resumeRefresh()}if(s.refresh(),!i.notScroll&&s.rendered)if(o){s.cachedCenterDate=o;let e=null;e=Math.max(Math.floor(s.getCoordinateFromDate(o,!0)-s.timeAxisSubGrid.width/2),0),s.viewPresetActiveScroll={left:e},s.scrollingToCenter=!0,s.scrollHorizontallyTo(e,!1),s.setTimeout(()=>{s.scrollingToCenter=!1},100)}else s.scrollHorizontallyTo(0,!1);s.trigger("presetChange",{preset:e,startDate:t,endDate:r})}}}get widgetClass(){}}),TimelineZoomable=e=>(class extends(e||Base){static get defaultConfig(){return{zoomOnMouseWheel:!0,zoomOnTimeAxisDoubleClick:!0,preventScrollZoom:!1,zoomLevels:[{width:40,increment:1,resolution:1,preset:"manyYears",resolutionUnit:"YEAR"},{width:80,increment:1,resolution:1,preset:"manyYears",resolutionUnit:"YEAR"},{width:30,increment:1,resolution:1,preset:"year",resolutionUnit:"MONTH"},{width:50,increment:1,resolution:1,preset:"year",resolutionUnit:"MONTH"},{width:100,increment:1,resolution:1,preset:"year",resolutionUnit:"MONTH"},{width:200,increment:1,resolution:1,preset:"year",resolutionUnit:"MONTH"},{width:100,increment:1,resolution:7,preset:"monthAndYear",resolutionUnit:"DAY"},{width:30,increment:1,resolution:1,preset:"weekDateAndMonth",resolutionUnit:"DAY"},{width:50,increment:1,resolution:1,preset:"weekAndMonth",resolutionUnit:"DAY"},{width:20,increment:1,resolution:1,preset:"weekAndDayLetter"},{width:54,increment:1,resolution:1,preset:"weekAndDay",resolutionUnit:"HOUR"},{width:100,increment:1,resolution:1,preset:"weekAndDay",resolutionUnit:"HOUR"},{width:64,increment:6,resolution:30,preset:"hourAndDay",resolutionUnit:"MINUTE"},{width:100,increment:6,resolution:30,preset:"hourAndDay",resolutionUnit:"MINUTE"},{width:64,increment:2,resolution:30,preset:"hourAndDay",resolutionUnit:"MINUTE"},{width:64,increment:1,resolution:30,preset:"hourAndDay",resolutionUnit:"MINUTE"},{width:30,increment:15,resolution:5,preset:"minuteAndHour"},{width:60,increment:15,resolution:5,preset:"minuteAndHour"},{width:130,increment:15,resolution:5,preset:"minuteAndHour"},{width:60,increment:5,resolution:5,preset:"minuteAndHour"},{width:100,increment:5,resolution:5,preset:"minuteAndHour"},{width:30,increment:10,resolution:5,preset:"secondAndMinute"},{width:60,increment:10,resolution:5,preset:"secondAndMinute"},{width:130,increment:5,resolution:5,preset:"secondAndMinute"}],minZoomLevel:!0,maxZoomLevel:!0,visibleZoomFactor:5,zoomKeepsOriginalTimespan:!1}}construct(e){const t=this;super.construct(e),t.zoomOnMouseWheel&&EventHelper.on({element:t.timeAxisSubGridElement,wheel:"onWheel",thisObj:t,capture:!0,passive:!1}),t.zoomOnTimeAxisDoubleClick&&t.on("timeaxisheaderdblclick",({startDate:e,endDate:r})=>{t.isVertical||t.zoomToSpan({startDate:e,endDate:r})})}getZoomLevelUnit(e){return PresetManager.getPreset(e.preset).bottomHeader.unit}get maxZoomLevel(){return this._maxZoomLevel}set maxZoomLevel(e){if("number"!=typeof e&&(e=this.zoomLevels.length-1),e<0||e>=this.zoomLevels.length)throw new Error("Invalid range for `setMinZoomLevel`");this._maxZoomLevel=e}get minZoomLevel(){return this._minZoomLevel}set minZoomLevel(e){if("number"!=typeof e&&(e=0),e<0||e>=this.zoomLevels.length)throw new Error("Invalid range for `minZoomLevel`");this._minZoomLevel=e}presetToZoomLevel(e){const t=PresetManager.getPreset(e);return{preset:e,increment:t.bottomHeader.increment||1,resolution:t.timeResolution.increment,resolutionUnit:t.timeResolution.unit,width:t.tickWidth}}calculateCurrentZoomLevel(){let e=this,t=e.presetToZoomLevel(e.viewPreset.name),r=Number.MAX_VALUE,n=e.timeAxisViewModel,i=n.tickWidth;t.width=i,t.increment=n.bottomHeader.increment||1;for(let n=0,s=e.zoomLevels.length;n<s;n++){const s=e.zoomLevels[n];if(s.preset!==t.preset)continue;const o=Math.abs(s.width-i);o<r&&(r=o,t.actualWidth=s.actualWidth,t.width=s.width)}return t}get zoomLevel(){const e=this,t=e.calculateCurrentZoomLevel(),r=e.getMilliSecondsPerPixelForZoomLevel(t),n=e.zoomLevels;for(let t=0;t<n.length;t++){const i=e.getMilliSecondsPerPixelForZoomLevel(n[t]);if(i===r)return t;if(0===t&&r>i)return-.5;if(t===n.length-1&&r<i)return n.length-1+.5;const s=e.getMilliSecondsPerPixelForZoomLevel(n[t+1]);if(i>r&&r>s)return t+.5}throw new Error("Can't find current zoom level index")}set zoomLevel(e){this.zoomToLevel(e)}getMilliSecondsPerPixelForZoomLevel(e,t){return Math.round((DateHelper.add(new Date(1,0,1),e.increment,this.getZoomLevelUnit(e))-new Date(1,0,1))/(t?e.width:e.actualWidth||e.width))}zoomTo(e){const t=this;if("object"==typeof e)if(e.preset){const r=t.presetToZoomLevel(e.preset);this.internalZoomToLevel(r,e)}else null!=e.level?t.zoomToLevel(e.level,e):t.zoomToSpan(e);else if("number"==typeof e)t.zoomToLevel(e);else{const r=t.presetToZoomLevel(e);this.internalZoomToLevel(r)}}zoomToLevel(e,t={}){const r=this;e=Math.min(Math.max(e,r.minZoomLevel),r.maxZoomLevel);let n=r.calculateCurrentZoomLevel(),i=r.getMilliSecondsPerPixelForZoomLevel(n),s=r.zoomLevels[e];return i!==r.getMilliSecondsPerPixelForZoomLevel(s)||t.startDate||t.endDate?(r.internalZoomToLevel(s,t),e):null}internalZoomToLevel(e,t={}){const r=this;r.trigger("beforeZoomChange",{level:e});let n=r.isVertical,i=t.startDate,s=t.endDate,o=i&&s?{startDate:i,endDate:s}:null,a=t.centerDate||(o?new Date((i.getTime()+s.getTime())/2):r.viewportCenterDateCached),l=r.timeAxisSubGrid.width,d=PresetManager.getPreset(e.preset).clone(),c=d.bottomHeader;o=o||r.calculateOptimalDateRange(a,l,e),d.name=e.preset,d[n?"timeRowHeight":"tickWidth"]=t.width||e.width,c.increment=e.increment,r.isZooming=!0,d.increment=e.increment,d.timeResolution.unit=DateHelper.getUnitByName(e.resolutionUnit||d.timeResolution.unit||c.unit),d.timeResolution.increment=e.resolution,r.setViewPreset(d,o.startDate||r.startDate,o.endDate||r.endDate,!1,{centerDate:a}),e.actualWidth=r.timeAxisViewModel.tickWidth,r.isZooming=!1,r.trigger("zoomChange",{level:e})}zoomToFit(e){const t=this.eventStore.getTotalTimeSpan();(e=Object.assign({leftMargin:0,rightMargin:0},e,t)).startDate&&e.endDate&&this.zoomToSpan(e)}zoomToSpan(e={}){if((e.leftMargin||e.rightMargin)&&(e.adjustStart=0,e.adjustEnd=0),e.leftMargin||(e.leftMargin=0),e.rightMargin||(e.rightMargin=0),!e.startDate||!e.endDate)throw new Error("zoomToSpan: must provide startDate + endDate dates");let t=this,r=e.startDate,n=e.endDate,i=e.adjustStart>=0||e.adjustEnd>=0;if(i&&(r=DateHelper.add(r,-e.adjustStart,t.timeAxis.mainUnit),n=DateHelper.add(n,e.adjustEnd,t.timeAxis.mainUnit)),r<=n){const s=t.timeAxisViewModel.availableWidth;let o=Math.floor(t.zoomLevel);-1===o&&(o=0);const a=t.zoomLevels;let l,d=n-r||1,c=t.getMilliSecondsPerPixelForZoomLevel(a[o],!0),u=d/c+e.leftMargin+e.rightMargin>s?-1:1,h=o+u,g=null;for(;h>=0&&h<=a.length-1;){l=a[h];const r=d/(c=t.getMilliSecondsPerPixelForZoomLevel(l,!0))+e.leftMargin+e.rightMargin;if(-1===u){if(r<=s){g=h;break}}else{if(!(r<=s))break;o!==h-u&&(g=h)}h+=u}l=a[g=null!=g?g:h-u];const m=PresetManager.getPreset(l.preset).bottomHeader.unit;(e.leftMargin||e.rightMargin)&&(r=new Date(r.getTime()-c*e.leftMargin),n=new Date(n.getTime()+c*e.rightMargin));const p=DateHelper.getDurationInUnit(r,n,m,!0)/l.increment;if(0===p)return null;let f,v=Math.floor(s/p),y=e.centerDate||new Date((r.getTime()+n.getTime())/2);return f=i?{startDate:r,endDate:n}:t.calculateOptimalDateRange(y,s,l),t.zoomToLevel(g,Object.assign(f,{width:v,centerDate:y}))}return null}zoomIn(e=1){const t=this.zoomLevel;return t>=this.zoomLevels.length-1?null:this.zoomToLevel(Math.floor(t)+e)}zoomOut(e=1){const t=this.zoomLevel;return t<=0?null:this.zoomToLevel(Math.ceil(t)-e)}zoomInFull(){return this.zoomToLevel(this.maxZoomLevel)}zoomOutFull(){return this.zoomToLevel(this.minZoomLevel)}calculateOptimalDateRange(e,t,r,n){if(n)return n;const i=this.timeAxis;if(this.zoomKeepsOriginalTimespan)return{startDate:i.startDate,endDate:i.endDate};const s=this.getZoomLevelUnit(r),o=Math.ceil(t/r.width*r.increment*this.visibleZoomFactor/2),a=DateHelper.add(e,-o,s),l=DateHelper.add(e,o,s);return{startDate:i.floorDate(a,!1,s,r.increment),endDate:i.ceilDate(l,!1,s,r.increment)}}onWheel(e){const t=this;e.ctrlKey&&(e.preventDefault(),t.preventScrollZoom||(e.deltaY>0?t.zoomOut():e.deltaY<0&&t.zoomIn(),t.preventScrollZoom=!0,t.setTimeout(()=>t.preventScrollZoom=!1,30)))}setTimeSpan(e,t){this.timeAxis.setTimeSpan(e,t)}shift(e,t){this.timeAxis.shift(e,t)}shiftNext(e){this.timeAxis.shiftNext(e)}shiftPrevious(e){this.timeAxis.shiftPrevious(e)}get widgetClass(){}}),TimelineEventRendering=e=>(class extends(e||Base){static get defaultConfig(){return{barMargin:10,managedEventSizing:!0,generatedIdCls:"b-sch-dirty-new",dirtyCls:"b-sch-dirty",committingCls:"b-sch-committing",endsOutsideViewCls:"b-sch-event-endsoutside",startsOutsideViewCls:"b-sch-event-startsoutside",fixedEventCls:"b-sch-event-fixed",eventStyle:"plain",eventColor:"green"}}get barMargin(){return this._barMargin}set barMargin(e){const t=this;ObjectHelper.assertNumber(e,"barMargin"),t.rowHeight&&(e=Math.min(Math.ceil(t.rowHeight/2),e)),t._barMargin!==e&&(t._barMargin=e,t.currentOrientation.onBeforeRowHeightChange(),t.refreshWithTransition())}set tickWidth(e){ObjectHelper.assertNumber(e,"tickWidth"),this.timeAxisViewModel.tickWidth=e}get tickWidth(){return this.timeAxisViewModel.tickWidth}static get eventColors(){return["red","pink","purple","violet","indigo","blue","cyan","teal","green","lime","yellow","orange","gray"]}static get eventStyles(){return["plain","border","hollow","colored","line","dashed","minimal"]}get widgetClass(){}}),TimelineScroll=e=>(class extends(e||Base){scrollToDate(e,t={}){const r=this,n=r.timeAxisSubGrid.scrollable.viewport,i=r.getCoordinateFromDate(e,!0),s=new Rectangle(r.getCoordinateFromDate(e,!1),n.y,r.timeAxisViewModel.tickWidth,n.height);return r.scrollToCoordinate(i,s,e,t)}scrollToNow(e={}){return this.scrollToDate(new Date,e)}scrollToCoordinate(e,t,r,n={}){const i=this;if(!(e<0)||i.isWeekView)return i.timeAxisSubGrid.scrollable.scrollIntoView(t,n);if(i.infiniteScroll)view.shiftToDate(r,centered);else{const e=(i.timeAxis.endDate-i.timeAxis.startDate)/2,t=new Date(r.getTime()-e),s=new Date(r.getTime()+e);if(t-i.startDate!=0&&s-i.endDate!=0)return i.setTimeSpan(t,s),n.centered?i.scrollToDateCentered(r,n):i.scrollToDate(r,n)}}set scrollLeft(e){this.timeAxisSubGrid.scrollable.x=e}set scrollTop(e){this.scrollable.y=e}get scrollLeft(){return this.timeAxisSubGrid.scrollable.x}get scrollTop(){return this.scrollable.y}scrollHorizontallyTo(e,t=!0){this.timeAxisSubGrid.scrollable.scrollTo(e,null,t)}scrollVerticallyTo(e,t=!0){this.scrollable.scrollTo(null,e,t)}scrollTo(e,t){this.timeAxisSubGrid.scrollable.scrollTo(e,null,t)}get widgetClass(){}});const timeAxisColumnConfigs=["viewPreset","eventBarTextField","eventRenderer","eventRendererThisObj","eventBodyTemplate"];class TimelineBase extends(base(Grid).mixes(TimelineDateMapper,TimelineDomEvents,TimelineEventRendering,TimelineScroll,TimelineViewPresets,TimelineZoomable)){static get defaultConfig(){return{weekStartDay:DateHelper.weekStartDay,workingTime:null,timeAxis:null,timeAxisViewModel:null,autoAdjustTimeAxis:!0,startDate:null,endDate:null,snap:!1,snapRelativeToEventStartDate:!1,forceFit:!1,eventCls:null,getDateConstraints:null,timeCellCls:null,timeCellSelector:null,scheduledEventName:null,createEventOnDblClick:!0,overScheduledEventClass:null,preventOverCls:!1,hoveredEventNode:null,useBackgroundCanvas:!1,enableEventAnimations:!BrowserHelper.isIE11,disableGridRowModelWarning:!0,animateRemovingRows:!1,partner:null,schedulerRegion:"normal",transitionDuration:200,animationTimeout:null,milestoneLayoutMode:"default"}}construct(e={}){const t=this,r=e.schedulerRegion||"normal",{subGridConfigs:n={}}=e;e.subGridConfigs=n,n[r]=n[r]||{},n[r].headerClass=Header$1,"flex"in n[r]||"width"in n[r]||(n[r].flex=1),super.construct(e),t.onSchedulerViewportResize=t.throttle(t.onSchedulerViewportResize,250),t.onTransitionEnd=FunctionHelper.createBuffered(t.onTransitionEnd,20,t),EventHelper.on({element:t.timeAxisSubGridElement,transitionstart:"onTransitionStart",transitionend:"onTransitionEnd",thisObj:t}),t.initDomEvents(),t.currentOrientation.init(),t.rowManager.on("refresh",()=>{t.forceLayout=!1}),t.loadMask&&t.crudManager&&t.crudManager.isLoading&&t.maskBody(t.loadMask)}doDestroy(){const e=this,{currentOrientation:t}=this;t&&t.destroy(),e.partneredWith&&(e.partneredWith.forEach(t=>{e.removePartner(t)}),e.partneredWith.destroy()),super.doDestroy()}startConfigure(e){super.startConfigure(e),this._thisIsAUsedExpression(this.partner)}initSubGrids(){super.initSubGrids();const e=this,t=e.timeAxisSubGrid=e.timeAxisColumn.subGrid=e.subGrids[e.timeAxisColumn.region];t.sealedColumns=!0,t.on({resize:e.onTimeAxisSubGridResize,thisObj:e})}initScroll(){let e=this,t=0;super.initScroll(),e.on("horizontalscroll",({subGrid:r,scrollLeft:n})=>{e.rendered&&r===e.timeAxisSubGrid&&e.isHorizontal&&e.onSchedulerHorizontalScroll(r,n),t++}),"horizontal"===e.testPerformance&&setTimeout(()=>{let r=performance.now(),n=5,i=1,s=setInterval(()=>{if(n+=5,e.scrollLeft+=(10+Math.floor(n))*i,1===i&&e.scrollLeft>5500&&(i=-1,n=5),-1===i&&e.scrollLeft<=0){let n=1e3/((performance.now()-r)/t);n=Math.round(10*n)/10,clearInterval(s),console.log(e.eventPositionMode,e.eventScrollMode,n+"fps")}},0)},500)}get hasVisibleEvents(){return this.eventStore.storage.values.some(e=>this.timeAxis.isTimeSpanInAxis(e))}get capitalizedEventName(){return this._capitalizedEventName||(this._capitalizedEventName=StringHelper.capitalizeFirstLetter(this.scheduledEventName)),this._capitalizedEventName}set partner(e){const t=this,r=t.partneredWith||(t.partneredWith=new Collection);t._partner=e,r.includes(e)||(r.add(e),(e.partneredWith||(e.partneredWith=new Collection)).add(t),e.on({presetchange:"onPartnerPresetChange",thisObj:t}),t.on({presetchange:"onPartnerPresetChange",thisObj:e}),t.setConfig({viewPreset:e.viewPreset,timeAxis:e.timeAxis,timeAxisViewModel:e.timeAxisViewModel}),t.initScroll=FunctionHelper.createSequence(t.initScroll,()=>{t.scrollable.addPartner(e.scrollable,"x")},t))}removePartner(e){const t=this,r=t.partneredWith;r&&r.includes(e)&&(r.remove(e),e.partneredWith.remove(t),e.scrollable.removePartner(t.scrollable),e.un({presetchange:"onPartnerPresetChange",thisObj:t}),t.un({presetchange:"onPartnerPresetChange",thisObj:e}))}onPartnerPresetChange({preset:e}){this.viewPreset!==e&&this.setViewPreset(e)}get partner(){return this._partner}get timeAxisColumn(){return this.columns&&this._timeAxisColumn}get columns(){return super.columns}set columns(e){const t=this;let r,n,i,s=e&&e.length;e&&((e=e.slice()).forEach((e,t)=>{"timeAxis"===e.type?(s=t,r=e):e.region||"locked"in e||(e.locked=!0)}),r=e[s]=Object.assign({type:"timeAxis",locked:!1,timeline:t,cellCls:t.timeCellCls},r),timeAxisColumnConfigs.forEach(e=>{null!=(i=t[e])&&(r[e]=i)})),super.columns=e,e&&(n=t._timeAxisColumn=t.columns.getAt(s)).relayAll(t)}set eventCls(e){const t=this;t._eventCls=e,t.eventSelector||(t.eventSelector=`.${e}-wrap`,t.unreleasedEventSelector=`${t.eventSelector}:not(.b-sch-released)`),t.eventInnerSelector||(t.eventInnerSelector="."+e)}get eventCls(){return this._eventCls}set timeAxisViewModel(e){const t=this,r={update:"onTimeAxisViewModelUpdate",prio:100,thisObj:t};t.partner&&!e||(e instanceof TimeAxisViewModel?e.on(r):(e=Object.assign({mode:t.mode,snap:t.snap,forceFit:t.forceFit,timeAxis:t.timeAxis,listeners:r},e),e=new TimeAxisViewModel(e)),t._timeAxisViewModel=e)}get timeAxisViewModel(){return this._timeAxisViewModel||(this.timeAxisViewModel=null),this._timeAxisViewModel}set timeAxis(e){const t=this;t.partner&&!e||(t.timeAxisDetacher&&t.timeAxisDetacher(),e instanceof TimeAxis||(e=ObjectHelper.assign({viewPreset:t.viewPreset,autoAdjust:t.autoAdjustTimeAxis,mode:"plain",weekStartDay:t.weekStartDay},e),t.startDate&&(e.startDate=t.startDate),t.endDate&&(e.endDate=t.endDate),t.workingTime&&t.applyWorkingTime(e),e=new TimeAxis(e)),t.timeAxisDetacher=e.on({thisObj:t,reconfigure({config:e}){t.trigger("timeAxisChange",{config:e})}}),t._timeAxis=e)}get timeAxis(){return this._timeAxis||(this.timeAxis=null),this._timeAxis}set workingTime(e){this._workingTime=e,this.isConfiguring||this.applyWorkingTime(this.timeAxis)}get workingTime(){return this._workingTime}applyWorkingTime(e){const t=this,r=t._workingTime;if(r){let t=null;r.fromHour>=0&&r.fromHour<24&&r.toHour>r.fromHour&&r.toHour<=24&&r.toHour-r.fromHour<24&&(t={from:r.fromHour,to:r.toHour});let n=null;r.fromDay>=0&&r.fromDay<7&&r.toDay>r.fromDay&&r.toDay<=7&&r.toDay-r.fromDay<7&&(n={from:r.fromDay,to:r.toDay}),e.include=t||n?{hour:t,day:n}:null}else e.include=null;t.rendered&&(t.timeAxisColumn.refreshHeader(),t.features.columnLines&&t.features.columnLines.drawLines(),t.refreshWithTransition())}set startDate(e){this.setStartDate(e)}setStartDate(e,t=!0){const r=this,n=r._timeAxis||{},{startDate:i,endDate:s,mainUnit:o}=n;if(r._timeAxis&&s){if(e){let r=s;if(t&&i){const t=DateHelper.diff(i,s,o,!0);r=DateHelper.add(e,t,o)}n.setTimeSpan(e,r)}}else r._tempStartDate=e}get startDate(){const e=this;return e._timeAxis?e._timeAxis.startDate:e._tempStartDate||new Date}set endDate(e){this.setEndDate(e)}setEndDate(e,t=!1){const r=this,n=r._timeAxis||{},{startDate:i,endDate:s,mainUnit:o}=n;if(r._timeAxis&&i){if(e){let r=i;if(t&&s){const t=DateHelper.diff(i,s,o,!0);r=DateHelper.add(e,-t,o)}n.setTimeSpan(r,e)}}else r._tempEndDate=e}get endDate(){const e=this;return e._timeAxis?e._timeAxis.endDate:e._tempEndDate||DateHelper.add(e.startDate,e.viewPreset.defaultSpan,e.viewPreset.mainHeader.unit)}get features(){return super.features}set features(e){"regionResize"in(e=!0===e?{}:e)||(e.regionResize=!0),super.features=e}get eventStyle(){return this._eventStyle}set eventStyle(e){const t=this;t._eventStyle=e,t.rendered&&t.refreshWithTransition()}get eventColor(){return this._eventColor}set eventColor(e){const t=this;t._eventColor=e,t.rendered&&t.refreshWithTransition()}onLocaleChange(){super.onLocaleChange(),this.timeAxisColumn.refreshHeader()}onInternalResize(e,t,r,n,i){const s=this._bodyRectangle;super.onInternalResize(e,t,r,n,i),s&&r!==i&&this.onSchedulerViewportResize(s.width,this.bodyContainer.offsetHeight,s.width,s.height)}onTimeAxisSubGridResize({width:e,height:t,oldWidth:r,oldHeight:n}){if(e!==r){const t=this._bodyRectangle;this.onSchedulerViewportResize(e,t.height,r,t.height)}}onSchedulerViewportResize(e,t,r,n){if(this.rendered){const i=this,s=i.currentOrientation,o=i.timeAxisSubGrid;null!=i._lastOverflow&&i._lastOverflow!==o.overflowingHorizontally||(i.setTimeout(()=>i.timeAxisViewModel.availableWidth=o.width,0),s.lastUpdateScrollPos=null,s.update(i),i.partneredWith&&!i.isSyncingFromPartner&&i.partneredWith.forEach(e=>{e.isSyncingFromPartner||(e.isSyncingFromPartner=!0,i.eachSubGrid(t=>{const r=e.subGrids[t.region];r.width!==t.width&&(t.collapsed?r.collapse():(r.collapsed&&r.expand(),t.flex?t.flex!==r.flex&&(r.flex=t.flex):r.width=t.width))}),e.isSyncingFromPartner=!1)}),i.trigger("timelineViewportResize",{width:e,height:t,oldWidth:r,oldHeight:n}),i.trigger("viewportResize",{width:e,height:t,oldWidth:r,oldHeight:n})),i._lastOverflow=o.overflowingHorizontally}}onTimeAxisViewModelUpdate(){this.updateCanvasSize(),this.callEachSubGrid("refreshFakeScroll"),this.refreshVirtualScrollbars()}get currentOrientation(){throw new Error("Implement in subclass")}get backgroundCanvas(){return this._backgroundCanvas}get foregroundCanvas(){return this._foregroundCanvas}get svgCanvas(){const e=this;if(!e._svgCanvas){const t=e._svgCanvas=document.createElementNS("http://www.w3.org/2000/svg","svg");e.foregroundCanvas.appendChild(t),e.trigger("svgCanvasCreated")}return e._svgCanvas}get timeAxisSubGridElement(){return this.timeAxisColumn&&this.timeAxisColumn.subGridElement}updateCanvasSize(){const e=this;e.backgroundCanvas&&(e.backgroundCanvas.style.width=`${e.timeAxisViewModel.totalWidth}px`),e.foregroundCanvas.style.width=`${e.timeAxisViewModel.totalWidth}px`}refresh(e=!0,t=null){const r=this;r.rendered&&!r.refreshSuspended&&(r.hasVisibleEvents?(r.refreshRows(!1,e),t&&t()):r.rowManager.trigger("refresh"))}render(e){const t=this,r=t.timeAxisSubGridElement;t.useBackgroundCanvas&&(t._backgroundCanvas=DomHelper.createElement({className:"b-sch-background-canvas",parent:r,nextSibling:r.firstElementChild}));const n=t._foregroundCanvas=DomHelper.createElement({className:"b-sch-foreground-canvas",style:`font-size:${t.rowHeight-2*t.barMargin}px`,parent:r});t.timeAxisSubGrid.insertRowsBefore=n,super.render(e)}refreshRows(e=!1,t=!0){const r=this;r.isConfiguring||(t&&(r.currentOrientation.cache.clear(r.refreshFromRerender),r.refreshFromRerender=!1),super.refreshRows(e))}reRender(e=!1){this.refreshFromRerender=!0,super.reRender(e),this.initDomEvents()}getDateConstraints(){}runWithTransition(e,t){const r=this;r.isVisible&&!r.runningWithTransition&&(r.runningWithTransition=(r.runningWithTransition||0)+1,null!=t&&!0!==t||(t=this.transitionDuration),r.isAnimating=t&&r.enableEventAnimations),e(),r.runningWithTransition--}refreshWithTransition(e){this.runWithTransition(()=>this.refresh(e))}getVisibleDateRange(){return this.currentOrientation.getVisibleDateRange()}}TimelineBase._$name="TimelineBase";const locale$2={ExcelExporter:{"No resource assigned":"No resource assigned"},ResourceInfoColumn:{eventCountText:e=>`${e} event${1!==e?"s":""}`},Dependencies:{from:"From",to:"To",valid:"Valid",invalid:"Invalid",Checking:"Checking"},DependencyEdit:{From:"From",To:"To",Type:"Type",Lag:"Lag","Edit dependency":"Edit dependency",Save:"Save",Delete:"Delete",Cancel:"Cancel",StartToStart:"Start to Start",StartToEnd:"Start to End",EndToStart:"End to Start",EndToEnd:"End to End"},EventEdit:{Name:"Name",Resource:"Resource",Start:"Start",End:"End",Save:"Save",Delete:"Delete",Cancel:"Cancel","Edit Event":"Edit event"},Scheduler:{"Add event":"Add event","Delete event":"Delete event","Unassign event":"Unassign event"},HeaderContextMenu:{pickZoomLevel:"Zoom",activeDateRange:"Date range",startText:"Start date",endText:"End date",todayText:"Today"},EventFilter:{filterEvents:"Filter tasks",byName:"By name"},TimeRanges:{showCurrentTimeLine:"Show current timeline"},PresetManager:{minuteAndHour:{topDateFormat:"ddd MM/DD, hA"},hourAndDay:{topDateFormat:"ddd MM/DD"},weekAndDay:{displayDateFormat:"hh:mm A"}}};for(let e in locale$1)locale$2[e]=locale$1[e];LocaleManagerSingelton.registerLocale("En",{desc:"English",locale:locale$2});var SchedulerDom=e=>(class extends(e||Base){getElementFromAssignmentRecord(e){return this.currentOrientation.getElementFromEventRecord(e.event,e.resource)}getElementFromEventRecord(e,t){return this.currentOrientation.getElementFromEventRecord(e,t)}getElementsFromEventRecord(e,t){return this.currentOrientation.getElementsFromEventRecord(e,t)}getEventIdFromDomNodeId(e){return e.substring(this.eventPrefix.length).split("-")[0].replace(/\._\./g,"-")}getEventRecordFromDomId(e){return e=this.getEventIdFromDomNodeId(e),this.eventStore.getById(e)}getResourceIdFromDomNodeId(e){return e.substring(this.eventPrefix.length).split("-")[1].replace(/\._\./g,"-")}getResourceRecordFromDomId(e){return e=this.getResourceIdFromDomNodeId(e),this.resourceStore.getById(e)}resolveResourceRecord(e){return this.currentOrientation.resolveRowRecord(e)}resolveEventRecord(e){return(e=DomHelper.up(e,this.eventSelector))&&this.getEventRecordFromDomId(e.id)}resolveTimeSpanRecord(e){return this.resolveEventRecord(e)}resolveAssignmentRecord(e){let t,r,n=this,i=n.eventStore.assignmentStore,s=null;return i&&(e=DomHelper.up(e,this.eventSelector),t=n.getEventRecordFromDomId(e.id),r=n.getResourceRecordFromDomId(e.id),t&&r&&(s=i.getAssignmentForEventAndResource(t,r))),s}isRowVisible(e){return this.store.indexOf(e)>=0}getMilestoneLabelWidth(e){const t=this,r=t.milestoneLayoutMode;if("measure"===r){const r=t.milestoneMeasureElement||(t.milestoneMeasureElement=DomHelper.createElement({className:"b-sch-event-wrap b-milestone-wrap b-measure",children:[{className:"b-sch-event b-milestone",html:"<label></label>"}],parent:t.foregroundCanvas}));return r.firstElementChild.firstElementChild.innerHTML=e.name,r.offsetWidth}return"estimate"===r?Math.max(e.name.length*t.milestoneCharWidth,t.milestoneMinWidth):"data"===r?Math.max(e.milestoneWidth,t.milestoneMinWidth):0}set milestoneLayoutMode(e){this._milestoneLayoutMode=e,this.element.classList["default"!==e?"add":"remove"]("b-sch-layout-milestones"),this.refresh()}get milestoneLayoutMode(){return this._milestoneLayoutMode}set milestoneAlign(e){this._milestoneAlign=e,this.refresh()}get milestoneAlign(){return this._milestoneAlign}set milestoneCharWidth(e){this._milestoneCharWidth=e,this.refresh()}get milestoneCharWidth(){return this._milestoneCharWidth}get widgetClass(){}}),SchedulerDomEvents=e=>(class extends(e||Base){getTimeSpanMouseEventParams(e,t){return{eventRecord:this.resolveEventRecord(e),resourceRecord:this.resolveResourceRecord(e),assignmentRecord:this.resolveAssignmentRecord(e),eventElement:e,event:t}}getScheduleMouseEventParams(e){return{resourceRecord:this.store.getById(e.id)}}onElementKeyDown(e){super.onElementKeyDown(e);const t=this;t.selectedEvents.length&&t.trigger(t.scheduledEventName+"KeyDown",{eventRecord:t.selectedEvents})}onElementKeyUp(e){super.onElementKeyUp(e);const t=this;t.selectedEvents.length&&t.trigger(t.scheduledEventName+"KeyUp",{eventRecord:t.selectedEvents})}get widgetClass(){}}),SchedulerDragResize=e=>(class extends(e||Base){construct(e){const t=this;super.construct(e),t.hasFeature("eventDragCreate")&&t.on({dragcreateend:t.internalOnDragCreateEnd,thisObj:t})}internalOnDragCreateEnd({newEventRecord:e,resourceRecord:t}){const r=this;if(!r.eventEdit){const n=t?[t]:[];!1!==r.trigger("beforeEventAdd",{newEventRecord:e,resourceRecords:n})&&(r.onEventCreated(e),r.eventStore.add(e),e.assign(t))}}onEventCreated(e){}get eventEditor(){return this._eventEditor}set eventEditor(e){this._eventEditor=e}get widgetClass(){}});class HorizontalLayout extends Base{static get defaultConfig(){return{nbrOfBandsByResource:{},bandIndexToPxConvertFn:null,bandIndexToPxConvertThisObj:null}}clearCache(e){e?delete this.nbrOfBandsByResource[e.id]:this.nbrOfBandsByResource={}}getNumberOfBands(e,t){const r=this.nbrOfBandsByResource;if(r.hasOwnProperty(e.id))return r[e.id];const n=("function"==typeof t?t():t).map(e=>({start:e.startDate,end:e.endDate,event:e}));return this.applyLayout(n,e)}applyLayout(e,t){const r=e.slice(),n=this.layoutEventsInBands(r);return this.nbrOfBandsByResource[t.id]=n}sortEvents(e,t){const r=e.startMs-t.startMs,n=e.endMs-t.endMs;return 0===r?-Math.sign(n):Math.sign(r)}}HorizontalLayout._$name="HorizontalLayout";class HorizontalLayoutStack extends HorizontalLayout{layoutEventsInBands(e){let t=0;do{let r=e[0];for(;r;)r.top=this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertThisObj||this,t,r.event),e.splice(e.indexOf(r),1),r=this.findClosestSuccessor(r,e);t++}while(e.length>0);return t}findClosestSuccessor(e,t){let r,n,i,s=1/0,o=e.endMs,a=0===e.event.duration;for(let e=0,l=t.length;e<l;e++)(n=(i=t[e]).startMs-o)>=0&&n<s&&(n>0||i.endMs-i.startMs>0||!a)&&(r=i,s=n);return r}}HorizontalLayoutStack._$name="HorizontalLayoutStack";class HorizontalLayoutPack extends HorizontalLayout{applyLayout(e){const t=this;let r,n,i,s;for(let o=0,a=e.length;o<a;o++){if(i=t.getCluster(e,o),n=e[o],r=t.findStartSlot(e,n),i.length>1){for(n.top=r.start,n.height=r.end-r.start,s=1;s<i.length-1&&i[s+1].start-n.start==0;)s++;let o=t.findStartSlot(e,i[s]);o&&o.start<.8&&(i.length=s)}const a=i.length,l=(r.end-r.start)/a;for(s=0;s<a;s++)i[s].height=l,i[s].top=r.start+s*l;o+=a-1}e.forEach(e=>{Object.assign(e,t.bandIndexToPxConvertFn.call(t.bandIndexToPxConvertThisObj||this,e.top,e.height,null,e.event))})}findStartSlot(e,t){const r=this.getPriorOverlappingEvents(e,t);let n;if(0===r.length)return{start:0,end:1};for(n=0;n<r.length;n++){if(0===n&&r[0].top>0)return{start:0,end:r[0].top};if(r[n].top+r[n].height<(n<r.length-1?r[n+1].top:1))return{start:r[n].top+r[n].height,end:n<r.length-1?r[n+1].top:1}}return!1}getPriorOverlappingEvents(e,t){const r=t.start,n=t.end,i=[];for(let s=0,o=e.indexOf(t);s<o;s++)DateHelper.intersectSpans(r,n,e[s].start,e[s].end)&&i.push(e[s]);return i.sort(this.sortOverlappers),i}sortOverlappers(e,t){return e.top<t.top?-1:1}getCluster(e,t){if(t>=e.length-1)return[e[t]];let r=[e[t]],n=e[t].start,i=e[t].end,s=e.length,o=t+1;for(;o<s&&DateHelper.intersectSpans(n,i,e[o].start,e[o].end);)r.push(e[o]),n=DateHelper.max(n,e[o].start),i=DateHelper.min(e[o].end,i),o++;return r}}HorizontalLayoutPack._$name="HorizontalLayoutPack";const hyphenRe=/-/g;var SchedulerEventRendering=e=>(class extends(e||Base){static get defaultConfig(){return{eventRenderer:null,eventRendererThisObj:null,eventPrefix:"",eventLayout:"stack",horizontalLayoutPackClass:HorizontalLayoutPack,horizontalLayoutStackClass:HorizontalLayoutStack,horizontalEventSorterFn:null,eventBarTextField:"name",eventBodyTemplate:null,eventPositionMode:"translate",eventScrollMode:"move",fillTicks:!1,useInitialAnimation:!0,isFirstRender:!0}}get eventPrefix(){return this._eventPrefix}set eventPrefix(e){this._eventPrefix=e||this.id+"-"}get layouts(){const e=this;return e._eventLayout||(e._eventLayout={},e.horizontalLayoutPackClass&&(e._eventLayout.horizontalPack=new e.horizontalLayoutPackClass(Object.assign({scheduler:e,timeAxisViewModel:e.timeAxisViewModel,bandIndexToPxConvertFn:e.horizontal.layoutEventVerticallyPack,bandIndexToPxConvertThisObj:e.horizontal},e.horizontalEventSorterFn?{sortEvents:this.horizontalEventSorterFn}:{}))),e.horizontalLayoutStackClass&&(e._eventLayout.horizontalStack=new e.horizontalLayoutStackClass(Object.assign({scheduler:e,timeAxisViewModel:e.timeAxisViewModel,bandIndexToPxConvertFn:e.horizontal.layoutEventVerticallyStack,bandIndexToPxConvertThisObj:e.horizontal},e.horizontalEventSorterFn?{sortEvents:this.horizontalEventSorterFn}:{})))),e._eventLayout}get eventLayout(){return this._overlapMode}set eventLayout(e){const t=this;e!=t._overlapMode&&(t.element.classList.remove(`b-eventlayout-${t._overlapMode}`),t._overlapMode=e,t.runWithTransition(()=>{t.element.classList.add(`b-eventlayout-${t._overlapMode}`),t.refresh()}))}get fillTicks(){return this._fillTicks}set fillTicks(e){const t=this;e!=t._fillTicks&&(t._fillTicks=e,t.refreshWithTransition())}get currentEventLayout(){const e=this;if(!e.isHorizontal)return null;switch(e.eventLayout){case"stack":return e.layouts.horizontalStack;case"pack":return e.layouts.horizontalPack;default:return null}}get useInitialAnimation(){return this._useInitialAnimation}set useInitialAnimation(e){const t=this;t._useInitialAnimation&&t.element.classList.remove(`b-initial-${t._useInitialAnimation}`),t._useInitialAnimation=!0===e?"fade-in":e,e&&t.element.classList.add(`b-initial-${t._useInitialAnimation}`)}set isFirstRender(e){const t=this;t._isFirstRender=e,!t._firstRenderDone&&e&&(t._firstRenderDone=t.createOnFrame(()=>{t._isFirstRender=!1,t._firstRenderDone=null}))}get isFirstRender(){return this._isFirstRender}getEventsToRender(e,t){return t}repaintEventsForResource(e){const t=this;if(t.isHorizontal){t.currentOrientation.cache.clearRow(e.id);const r=t.getRowFor(e);r&&r.render()}}repaintEvent(e){this.eventStore.getResourcesForEvent(e).forEach(e=>this.repaintEventsForResource(e))}generateTplData(e,t){const r=this,n=r.currentOrientation.getTimeSpanRenderData(e,t,{viewport:!0});let i="";if(n){let s=e.isResizable;n.startsOutsideView&&(!0===s?s="end":"start"===s&&(s=!1)),n.endsOutsideView&&(!0===s?s="start":"end"===s&&(s=!1));const o=e.isResourceTimeRange?new DomClassList:e.cls.clone(),a=e.isResourceTimeRange?e.cls.clone():new DomClassList;if(Object.assign(o,{[t.cls]:t.cls,[r.generatedIdCls]:e.hasGeneratedId,[r.dirtyCls]:e.modifications,[r.committingCls]:e.isCommitting,[r.endsOutsideViewCls]:n.endsOutsideView,[r.startsOutsideViewCls]:n.startsOutsideView,"b-clipped-start":n.clippedStart,"b-clipped-end":n.clippedEnd}),Object.assign(a,{[`${r.eventCls}-parent`]:t.isParent}),e.isEvent||e.isTask){Object.assign(o,{[r.eventCls]:1,"b-milestone":e.isMilestone,"b-sch-event-narrow":n.width<10,[r.fixedEventCls]:!1===e.isDraggable,[`b-sch-event-resizable-${s}`]:Boolean(r.features.eventResize),[r.eventSelectedCls]:r.isEventSelected(e)}),n.eventId=e.id,n.id=r.getEventRenderId(e,t),"id"in e.meta.modified&&(n.oldId=r.getEventRenderId(e.meta.modified.id,t)),Object.assign(a,{[`${r.eventCls}-wrap`]:1,"b-milestone-wrap":e.isMilestone});const i=e.eventStyle||t.eventStyle||r.eventStyle,l=e.eventColor||t.eventColor||r.eventColor;n.eventColor=l,n.eventStyle=i,r.assignmentStore&&e.assignments&&(n.assignment=e.assignments.find(e=>e.resourceId===t.id))}if(n.wrapperCls=a,n.cls=o,n.iconCls=new DomClassList(e.get(r.eventBarIconClsField)||e.iconCls),e.isResourceTimeRange?(n.style="",n.wrapperStyle=e.style||""):n.style=e.style||"",n.resource=t,n.resourceId=n.rowId,e.isEvent||e.isTask){if(r.eventRenderer){const s=r.eventRenderer.call(r.eventRendererThisObj||r,{eventRecord:e,resourceRecord:t,assignmentRecord:n.assignment,tplData:n});"string"==typeof n.cls&&(n.cls=new DomClassList(n.cls)),"string"==typeof n.wrapperCls&&(n.wrapperCls=new DomClassList(n.wrapperCls)),"string"==typeof n.iconCls&&(n.iconCls=new DomClassList(n.iconCls)),i=r.eventBodyTemplate&&r.eventBodyTemplate(s)||(null==s?"":String(s))}else r.eventBodyTemplate?i=r.eventBodyTemplate(e):r.eventBarTextField&&(i=e.data[r.eventBarTextField]||"");r.eventBodyTemplate||(e.isMilestone&&i&&(i=`<label>${i}</label>`),n.iconCls&&n.iconCls.length&&(i=`<i class="${n.iconCls}"></i>${i}`)),n.wrapperCls[`b-sch-style-${n.eventStyle}`]=n.eventStyle,n.eventColor&&n.eventColor.startsWith("#")?n.style=`background-color:${n.eventColor};`+n.style:n.wrapperCls[`b-sch-color-${n.eventColor}`]=n.eventColor}n.cls["b-sch-event-withicon"]=n.iconCls.length,i.includes("<")?n.body=DomHelper.createElementFromTemplate(i,{fragment:!0}):(n.body=document.createDocumentFragment(),n.body.textContent=i),r.onEventDataGenerated(n)}return n}onEventDataGenerated(e){}getEventRenderId(e,t){const r=(e instanceof TimeSpan?e.id.toString():e.toString()).replace(hyphenRe,"._."),n=t.id.toString().replace(hyphenRe,"._.");return this.eventPrefix+`${r}-${n}-x`}get widgetClass(){}});const MAX_VALUE=Math.MAX_SAFE_INTEGER||Math.pow(2,53)-1,checkResources={add:1,update:1,remove:1,filter:1};var SchedulerStores=e=>(class extends(e||Base){static get defaultConfig(){return{eventStore:null,resourceStore:null,assignmentStore:null,dependencyStore:null,store:null,startParamName:"startDate",endParamName:"endDate",passStartEndParameters:!1,crudManager:null,events:null,resources:null,assignments:null,removeUnassignedEvent:!0}}onStoreDataChange({source:e,action:t}){this.currentOrientation.clearEvents(),super.onStoreDataChange(...arguments)}onStoreAdd({source:e,records:t,isExpand:r,isChild:n}){const i=this,{rowManager:s}=i;if(n&&!t[0].parent.isExpanded(i))return;s.calculateRowCount(!1,!0,!0);const o=Math.max(s.topIndex+s.rowCount,Math.min(s.visibleRowCount,e.count));t=t.sort((t,r)=>e.indexOf(t)-e.indexOf(r));let a=e.indexOf(t[0]);if(a<o){for(let t=a=Math.max(a,s.topIndex);t<o;t++)i.currentOrientation.onRowRecordUpdate({record:e.getAt(t)});i.runWithTransition(()=>{s.renderFromRow(i.getRow(a)),1===e.count&&i.callEachSubGrid("refreshFakeScroll")},!r)}else s.estimateTotalHeight()}onStoreUpdateRecord(){this.suspendStoreRedraw||(this.currentOrientation.onRowRecordUpdate(...arguments),super.onStoreUpdateRecord(...arguments))}onStoreRemove(){this.currentOrientation.onRowRecordRemove(...arguments),super.onStoreRemove(...arguments)}onStoreRemoveAll(){this.currentOrientation.clearEvents(),super.onStoreRemoveAll()}doDestroy(){super.doDestroy();const e=this;e.destroyStores&&(e.assignmentStore&&e.assignmentStore.destroy(),e.resourceStore&&e.resourceStore.destroy(),e.dependencyStore&&e.dependencyStore.destroy(),e.eventStore&&e.eventStore.destroy())}get store(){return this._thisIsAUsedExpression(this.resources),super.store}set store(e){super.store=e}get resources(){const e=this.resourceStore;return e&&e.records}set resources(e){this.resourceStore.data=e}get resourceStore(){const e=this;return e._resourceStore||e.crudManager&&e.crudManager.resourceStore||(e.resourceStore=new ResourceStore),e._resourceStore}set resourceStore(e){const t=this,r=t._resourceStore;if(e!==r){if(e instanceof ResourceStore||(e=new ResourceStore(e)),r){const n=r===t.store;t._resourceStore=e,e&&(t.trigger("resourceStoreChange",{newResourceStore:e,oldResourceStore:r}),n?(t.store=t.resourceStore,t.store.metaMapId=t.id):t.refresh())}else t._resourceStore=e;t._store||(t.store=e)}}get events(){return this._eventStore.records}set events(e){this.eventStore.data=e}get eventStore(){const e=this;return e._eventStore||e.crudManager&&e.crudManager.eventStore||(e.eventStore=new EventStore({resourceStore:e.resourceStore})),this._eventStore}set eventStore(e){const t=this,r=t._eventStore;let n=!1;if(e===r)return;let i=t.resourceStore;if(r){const r=t.eventStore,n=t.assignmentStore,s=t.dependencyStore;if(e===r)return;t.eventStoreDetacher&&t.eventStoreDetacher(),t._eventStore=e,i&&(e.resourceStore||(e.resourceStore=i)),n&&e&&!e.assignmentStore&&(e.assignmentStore=n),s&&e&&!e.dependencyStore&&(e.dependencyStore=s),t.timeAxisViewModel.eventStore=e,e&&(t.trigger("eventStoreChange",{newEventStore:e,oldEventStore:r}),t.refresh())}else e.isEventStore?i&&e.resourceStore!==i&&(e.resourceStore=i):(n=e.autoLoad,e.autoLoad=!1,e=new EventStore(Object.assign({resourceStore:t.resourceStore},e))),t._eventStore=e;if(e){const r={thisObj:t,detachable:!0,change:"onInternalEventStoreChange",clearchanges:"onEventClearChanges",beforecommit:"onEventCommit",commit:"onEventCommit",beforeRemove:"onBeforeEventRemove",refresh:"onEventStoreRefresh",exception:"onEventException"};t.passStartEndParameters&&(r.beforeload=t.applyStartEndParameters),t.eventStoreDetacher&&t.eventStoreDetacher(),t.eventStoreDetacher=e.on(r),e.assignmentStore&&(t.assignmentStore=e.assignmentStore),n&&e.load().catch(()=>{})}t.eventStore.count>0&&(t.eventsRendered=!0)}get assignments(){return this.assignmentStore&&this.assignmentStore.records}set assignments(e){this.assignmentStore||(this.eventStore.assignmentStore=this.assignmentStore=new AssignmentStore),this.assignmentStore.data=e}get assignmentStore(){const e=this.eventStore;return e&&e.assignmentStore}set assignmentStore(e){const t=this,r=t.assignmentStore;t.eventStore.assignmentStore!==e&&(t.eventStore.assignmentStore=e),t.assignmentStoreDetacher&&t.assignmentStoreDetacher(),e&&(t.assignmentStoreDetacher=e.on({thisObj:t,refresh:t.onAssignmentRefresh,update:t.onAssignmentUpdate,add:t.onAssignmentAdd,beforeRemove:{fn:t.onBeforeAssignmentRemove,prio:-1e3},remove:t.onAssignmentRemove,filter:t.onAssignmentFilter,removeall:t.onAssignmentRemoveAll}),t.trigger("assignmentStoreChange",{newAssignmentStore:e,oldAssignmentStore:r}),t.refresh())}get dependencyStore(){const e=this.eventStore;return e&&e.dependencyStore||this._dependencyStore}set dependencyStore(e){const t=this;if(t.isConfigured){const r=t.dependencyStore;t.eventStore.dependencyStore=e,e&&(t.trigger("dependencyStoreChange",{newDependencyStore:e,oldDependencyStore:r}),t.refresh())}else t._dependencyStore=e}get crudManager(){return this._crudManager}set crudManager(e){const t=this;e instanceof CrudManager?t._crudManager=e:e=new CrudManager(Object.assign({scheduler:t},e))}onInternalEventStoreChange(e){const t=this.currentOrientation,r=e.source,{rowManager:n,resourceStore:i}=this,{action:s,changes:o,isCollapse:a}=e,l=e.records||(e.record?[e.record]:null),d=[];let c,u,h=new Set,g=!1;if(this.rendered&&!(a||"update"===s&&l.length&&l[0].meta.removingResource)){if(checkResources[s]&&l){if(o&&"resourceId"in o&&null!=o.resourceId.oldValue){const e=i.getById(o.resourceId.oldValue),t=e&&n.getRowFor(e);t&&(d.push(e),h.add(t))}for(u=0,c=l.length;u<c;u++)d.push(...r.getResourcesForEvent(l[u]).filter(e=>{if(e){const t=n.getRowFor(e);if(t)return h.add(t),!0}return!1}));if(d.length){if(h.size>1)h=new Set([...h].sort((e,t)=>e.dataIndex-t.dataIndex));else if(!h.size)return}else if("filter"!==s||l.length)return void n.estimateTotalHeight();e.resources=d}this.runWithTransition(()=>{switch(s){case"dataset":t.onEventDataset();break;case"add":t.onEventAdd(e),g=!0;break;case"update":t.onEventUpdate(e),g=!0;break;case"remove":t.onEventRemove(e),g=!0;break;case"removeall":t.onEventRemoveAll();break;case"filter":t.onEventFilter(e);break;case"clearchanges":t.onEventClearChanges(e)}h.size?h.forEach(e=>e.render()):n.renderFromRow()},g)}}onEventStoreRefresh({action:e}){"batch"===e&&this.rowManager.rowCount&&(this.currentOrientation.onEventDataset(),this.refresh())}onBeforeEventRemove({records:e}){const t=this;if(t.activeEvent&&e.includes(t.activeEvent)){let r;if("key"===GlobalEvents.lastInteractionType)for(let n=0,i=e.length;n<i&&(!r||e.includes(r));n++)if(t.eventStore.getResourcesForEvent(e[n]).length){const i=e[n],s=i.assignments&&i.assignments.length?i.assignments[0]:i;r=t.getNext(s,!0)||t.getPrevious(s,!0)}r?t.navigateTo(r):t.element.focus()}}onEventCommit({changes:e}){[...e.added,...e.modified].forEach(e=>this.repaintEvent(e))}onEventException({action:e}){if("commit"===e){const{changes:e}=this.eventStore;[...e.added,...e.modified,...e.removed].forEach(e=>this.repaintEvent(e))}}onEventClearChanges(){this.refresh()}onAssignmentRefresh(e){"dataset"!==e.action&&"batch"!==e.action||this.refresh()}onAssignmentAdd({records:e}){e.forEach(e=>{const t=e.resource;t&&this.repaintEventsForResource(t)})}onAssignmentUpdate({record:e,changes:t}){const{rowManager:r}=this,n=this.currentOrientation.cache,i="resourceId"in t&&t.resourceId.oldValue,s=e.resourceId;let o,a=MAX_VALUE;null!=i&&(o=r.getRowFor(i))&&(n.clearRow(i),a=Math.min(a,o.index)),s&&(o=r.getRowFor(s))&&(n.clearRow(s),a=Math.min(a,o.index)),a!==MAX_VALUE&&r.renderFromRow(r.rows[a])}onBeforeAssignmentRemove({records:e}){const t=this,r=e.reduce((e,t)=>{const r=t.event;return r&&!e.includes[r]&&e.push(r),e},[]);let n;if(t.activeEvent&&r.includes(t.activeEvent)){if("key"===GlobalEvents.lastInteractionType)for(let r=0,i=e.length;r<i&&(!n||e.includes(n));r++)if(t.eventStore.getResourcesForEvent(e[r].event).length){const i=e[r],s=i.assignments&&i.assignments.length?i.assignments[0]:i;n=t.getNext(s)||t.getPrevious(s)}n?t.navigateTo(n):t.element.focus()}e.forEach(e=>{const r=e.event;if(r&&!r.placeHolder&&t.removeUnassignedEvent){const e=r.assignments;e&&e.length&&(1!==e.length||e[0].event!==r)||r.remove()}})}onAssignmentRemove({records:e}){e.forEach(e=>{const t=e.resource;t&&this.repaintEventsForResource(t)})}onAssignmentRemoveAll(){this.refresh()}onAssignmentFilter(){this.refresh()}applyStartEndParameters({source:e,params:t}){const r=e.modelClass.fieldMap.startDate.dateFormat;t[this.startParamName]=DateHelper.format(this.startDate,r),t[this.endParamName]=DateHelper.format(this.endDate,r)}get widgetClass(){}});const immediatePromise$4=new Promise(e=>e()),defaultScrollOptions$3={block:"nearest",edgeOffset:20};var SchedulerScroll=e=>(class extends(e||Base){scrollEventIntoView(e,t=defaultScrollOptions$3){let r=e.resources||[e];if(r.length>1)throw new Error("scrollEventIntoView() is not applicable for events with multiple assignments, please use scrollResourceEventIntoView() instead.");return r.length?this.scrollResourceEventIntoView(r[0],e,null,t):immediatePromise$4}scrollResourceEventIntoView(e,t,r,n=defaultScrollOptions$3){let i,s=this,o=t.startDate,a=t.endDate,l=o<s.timeAxis.startDate|(a>s.timeAxis.endDate)<<1;if(null==n.edgeOffset&&(n.edgeOffset=20),l&&!1!==n.extendTimeAxis){let e,r,n=s.timeAxis.endDate-s.timeAxis.startDate;3===l?s.timeAxis.setTimeSpan(new Date(o.valueOf()-n/2),new Date(a.getTime()+n/2)):(e=1&l?s.getCoordinateFromDate(t.endDate):s.getCoordinateFromDate(t.startDate),1&l?s.timeAxis.setTimeSpan(new Date(o),new Date(o.valueOf()+n)):s.timeAxis.setTimeSpan(new Date(a.valueOf()-n),new Date(a)),r=1&l?s.getCoordinateFromDate(t.endDate):s.getCoordinateFromDate(t.startDate),s.timeAxisSubGrid.scrollable.scrollBy(r-e))}if(i=s.getElementFromEventRecord(t,e)){return DomHelper.isFocusable(i)||(i=i.parentNode),s.timeAxisSubGrid.scrollable.scrollIntoView(i,ObjectHelper.assign({silent:!0},n))}return s.scrollUnrenderedEventIntoView(e,t,n)}scrollUnrenderedEventIntoView(e,t,r=defaultScrollOptions$3){null==r.edgeOffset&&(r.edgeOffset=20);const n=this,i=n.timeAxisSubGrid.scrollable,s=n.getResourceEventBox(t,e),o=i.viewport,a=new Rectangle(s.start,s.top,s.end-s.start,s.bottom-s.top).translate(o.x-i.x,o.y-i.y),l=i.scrollIntoView(a,Object.assign({},r,{highlight:!1}));if(r.highlight||r.focus){const e=n.on({eventrepaint({scheduler:n,eventRecord:i,resourceRecord:s,element:o}){i===t&&(e(),l.then(()=>{r.highlight&&DomHelper.highlight(o),r.focus&&o.focus()}))}})}return l}get widgetClass(){}}),SchedulerRegions=e=>(class extends(e||Base){getScheduleRegion(e,t,r){return this.currentOrientation.getScheduleRegion(e,t,r)}getResourceRegion(e,t,r){return this.currentOrientation.getRowRegion(e,t,r)}getStartEndDatesFromRectangle(e,t){return this.currentOrientation.getStartEndDatesFromRectangle(e,t)}getResourceEventBox(e,t,r=!1){const n=this.currentOrientation.cache.getTimeSpan(e.id,t.id);if(n)return n;const i=this,s=i.timeAxis.startDate,o=i.timeAxis.endDate,a=e.startDate,l=e.endDate;let d,c,u,h,g,m,p,f,v,y=null;if(a&&l&&(r||DateHelper.intersectSpans(a,l,s,o))&&this.isRowVisible(t)){if(h=i.getRowFor(t))i.managedEventSizing?(d=i.currentEventLayout,c=i.eventStore.getEventsForResource(t).reduce((e,n)=>{const s=i[i.mode].getTimeSpanRenderData(n,t,r);return s&&e.push(s),e},[]),d&&d.applyLayout(c,t),(u=c.find(t=>t.event==e))&&(g=i.getRecordCoords(t,!0).y,y={layout:!0,start:u.hasOwnProperty("left")?u.left:u.right,end:(u.hasOwnProperty("left")?u.left:u.right)+u.width,top:g+u.top,bottom:g+u.top+u.height})):(m=i.getElementsFromEventRecord(e,e!==t&&t)).length&&(f=(p=m[0]).getOffsetsTo(i.getEl()),v=p.getBox(),y={layout:!0,start:f[0],end:f[0]+v.width,top:f[1],bottom:f[1]+v.height});else{y={layout:!1,start:i.getCoordinateFromDate(Math.max(e.startDateMS,i.timeAxis.startMS)),end:i.getCoordinateFromDate(Math.min(e.endDateMS,i.timeAxis.endMS))};const r=i.rowManager.getRecordCoords(t,!0);y.top=r.y+i.barMargin,y.height=Math.max(i.rowManager.rowHeight-2*i.barMargin,1),y.bottom=y.top+y.height}y&&(y=i.adjustItemBox(e,y))}return y}getItemBox(e,t=!1){return e.resources.map(r=>this.getResourceEventBox(e,r,t))}adjustItemBox(e,t){const r=this.timeAxis.startMS,n=this.timeAxis.endMS,i=e.startDateMS,s=e.endDateMS,o=this.timeAxisViewModel.totalWidth;return r>i&&(t.start=-40),r>s&&(t.end=-40),n<i&&(t.start=o+40),n<s&&(t.end=o+40),t}get widgetClass(){}});const copyProperties=["eventLayout","barMargin","mode","tickWidth","zoomLevel","eventColor","eventStyle","fillTicks"];var SchedulerState=e=>(class extends(e||Base){getState(){return ObjectHelper.copyProperties(super.getState(),this,copyProperties)}applyState(e){ObjectHelper.copyProperties(this,e,copyProperties),super.applyState(e)}get widgetClass(){}}),EventSelection=e=>(class extends(e||Base){static get defaultConfig(){return{multiEventSelect:!1,eventSelectionDisabled:!1,eventSelectedCls:"b-sch-event-selected",triggerSelectionChangeOnRemove:!1,maintainSelectionOnDatasetChange:!0,eventAssignHighlightCls:"b-sch-event-assign-selected",selectedCollection:{}}}afterConstruct(){super.afterConstruct(),this.navigator.on({navigate:"onEventNavigate",thisObj:this})}set selectedCollection(e){e instanceof Collection||(e=new Collection(e)),this._selectedCollection=e,e.on({change:"onSelectedCollectionChange",thisObj:this})}get selectedCollection(){return this._selectedCollection}get selectedEvents(){return this.selectedCollection.values}set selectedEvents(e){this.selectedCollection.splice(0,this.selectedCollection.count,e||[])}isEventSelected(e){return this.selectedCollection.includes(e)}selectEvent(e,t=!1){this.isEventSelected(e)||(t?this.selectedCollection.add(e):this.selectedEvents=e)}deselectEvent(e,t=!1){this.isEventSelected(e)&&this.selectedCollection.remove(e)}selectEvents(e){this.selectedCollection.add(e)}deselectEvents(e){this.selectedCollection.remove(e)}clearEventSelection(){this.selectedEvents=[]}onSelectedCollectionChange({added:e,removed:t}){const r=this,n=r.eventSelectedCls,i=r.eventAssignHighlightCls,s=r.selectedEvents,o=e||[],a=t||[];function l(e,t){const s=e.isTask?e:e.resource,o=e.isAssignment?e.event:e,a=o&&r.getElementFromEventRecord(o,s);if(a){const e=r.currentOrientation.cache.getRenderedTimeSpan(s.id,r.getEventRenderId(o,s));e&&(e.cls[n]=t?1:0),a.classList[t?"add":"remove"](n)}e.isAssignment&&o&&DomHelper.forEachSelector(r.timeAxisSubGridElement,`[data-event-id="${o.id}"]`,e=>{e!==a&&e.classList[t?"add":"remove"](i)})}o.forEach(e=>l(e,!0)),a.forEach(e=>l(e,!1)),r.silent||r.trigger("eventSelectionChange",{action:s.length>0?o.length>0&&a.length>0?"update":o.length>0?"select":"deselect":"clear",selection:s,selected:o,deselected:a})}onInternalEventStoreChange({action:e,records:t,source:r}){super.onInternalEventStoreChange(...arguments);const n=this;n.silent=!n.triggerSelectionChangeOnRemove,"remove"===e?n.deselectEvents(t):"dataset"===e&&(n.maintainSelectionOnDatasetChange?n.selectedEvents=n.selectedEvents.filter(e=>r.includes(e)):n.clearEventSelection()),n.silent=!1}onAssignmentRemove({records:e}){super.onAssignmentRemove(...arguments);this.silent=!this.triggerSelectionChangeOnRemove,this.deselectEvents(e),this.silent=!1}onEventSelectionClick(e,t){const r=this;r.isEventSelected(t)?e.ctrlKey&&r.deselectEvent(t,r.multiEventSelect):r.selectEvent(t,e.ctrlKey&&r.multiEventSelect)}onEventNavigate({event:e,item:t}){if(!this.eventSelectionDisabled){const r=this,n=t&&(1===t.nodeType?r.assignmentStore?r.resolveAssignmentRecord(t):r.resolveEventRecord(t):t);n?r.onEventSelectionClick(e,n):r.clearEventSelection()}}get widgetClass(){}});const sortByStartDate=(e,t)=>e.startDate-t.startDate,preventDefault=e=>e.preventDefault();var EventNavigation=e=>(class extends(e||Base){static get defaultConfig(){return{navigator:null,focusCls:"b-active",enableDeleteKey:!0}}construct(e){const t=this,r=FunctionHelper.createThrottled(t.onDeleteKey,500,t);t.isInTimeAxis=t.isInTimeAxis.bind(t),super.construct(e);const n=ObjectHelper.merge({ownerCmp:t,target:t.timeAxisSubGridElement,processEvent:t.processEvent,itemSelector:`.${t.eventCls}-wrap`,focusCls:t.focusCls,navigatePrevious:FunctionHelper.createThrottled(t.navigatePrevious,200,t,null,preventDefault),navigateNext:FunctionHelper.createThrottled(t.navigateNext,200,t,null,preventDefault),allowCtrlKey:!0,scrollSilently:!0,keys:{Space:"onSpaceKey",Enter:"onEnterKey",Delete:r,Backspace:r}},t.navigator);t.navigator=new Navigator(n)}doDestroy(){this.navigator.destroy(),super.doDestroy()}isInTimeAxis(e){return!e.instanceMeta(this).excluded&&this.timeAxis.isTimeSpanInAxis(e)}accessibleFocusCell(e,t){if((e=this.normalizeCellContext(e)).columnId!==this.timeAxisColumn.id)return super.focusCell(e,t)}getPrevious(e,t){const r=this,n=r.resourceStore,i=e.isAssignment;if(e.isTask)return r.eventStore.getAt(r.eventStore.indexOf(e)-1);let s=e.resource||r.eventStore.getResourcesForEvent(e)[0],o=s.getEvents().filter(r.isInTimeAxis).sort(sortByStartDate),a=i?e.event:e,l=o[o.indexOf(a)-1];if(!l)for(let e=n.indexOf(s)-1;(!l||t&&l===a)&&e>=0;e--){let t=(s=n.getAt(e)).getEvents().filter(r.isInTimeAxis).sort(sortByStartDate);l=t.length&&t[t.length-1]}return i?r.assignmentStore.getAssignmentForEventAndResource(l,s):l}navigatePrevious(e){const t=this,r=t.getPrevious(e.assignmentRecord||e.eventRecord);e.preventDefault(),r&&(e.ctrlKey||t.clearEventSelection(),t.navigateTo(r,e))}getNext(e,t){const r=this,n=r.resourceStore,i=e.isAssignment;if(e.isTask)return r.eventStore.getAt(r.eventStore.indexOf(e)+1);let s=i?e.resource:e.resources[0],o=s.getEvents().filter(r.isInTimeAxis).sort(sortByStartDate),a=i?e.event:e,l=o[o.indexOf(a)+1];if(!l)for(let e=n.indexOf(s)+1;(!l||t&&l===a)&&e<n.count;e++)l=(s=n.getAt(e)).getEvents().filter(r.isInTimeAxis).sort(sortByStartDate)[0];return i?r.assignmentStore.getAssignmentForEventAndResource(l,s):l}navigateNext(e){const t=this,r=t.getNext(e.assignmentRecord||e.eventRecord);e.preventDefault(),r&&(e.ctrlKey||t.clearEventSelection(),t.navigateTo(r,e))}navigateTo(e,t={}){const r=this;if(e){r.navigator.disabled=!0;const n=e.resource;r.scrollResourceEventIntoView(n,e.isAssignment?e.event:e,null,{animate:100}).then(()=>{r.isDestroyed||(r.navigator.disabled=!1,r.activeEvent=e,r.navigator.trigger("navigate",{event:t,item:DomHelper.up(r.getElementFromEventRecord(e,n),r.navigator.itemSelector)}))})}}set activeEvent(e){const t=this.getElementFromEventRecord(e.isAssignment?e.event:e,e.resource);this.navigator.activeItem=t.parentNode}get activeEvent(){const e=this.navigator.activeItem;if(e)return this.resolveEventRecord(e)}processEvent(e){const t=this,r=DomHelper.up(e.target,t.eventSelector);return!t.navigator.disabled&&r&&(e.assignmentRecord=t.resolveAssignmentRecord(r),e.eventRecord=t.resolveEventRecord(r),e.resourceRecord=t.resolveResourceRecord(r)),e}onSpaceKey(e){const t=Rectangle.from(e.target).center,r=new MouseEvent("contextmenu",Object.assign({clientX:t.x,clientY:t.y},e));Object.defineProperty(r,"target",{get:()=>e.target}),this.onElementContextMenu(r)}onDeleteKey(e){const t=e.assignmentRecord||e.eventRecord;!this.readOnly&&this.enableDeleteKey&&t&&this.removeRecords([t])}removeRecords(e){!this.readOnly&&e.length&&e.forEach(e=>e.remove())}onEnterKey(e){}get widgetClass(){}});const emptyObject$3={},elRange=document.createRange();function isEventElAvailable(e){return!(e.classList.contains("b-dragging")||e.classList.contains("b-resizing"))}class BaseHorizontalMapper extends(Delayable(Base)){construct(e){const t=this;t.view=e,t.innerElCls=`${e.eventCls}`,t.availableDivs=new Collection,t.reservedIds={},t.divCount=0}init(){const e=this;e.view.rowManager.on({beforetranslaterow:e.onBeforeTranslateRow,translaterow:e.onTranslateRow,beforerowheight:e.onBeforeRowHeightChange,thisObj:e}),e.view.on({beforetogglenode:e.onBeforeToggleNode,togglenode:e.onToggleNode,beforetoggleallnodes:e.onBeforeToggleAllNodes,toggleallnodes:e.onToggleAllNodes,thisObj:e})}get column(){return this.view.timeAxisColumn}get timeAxis(){return this.view.timeAxis}get timeAxisViewModel(){return this.view.timeAxisViewModel}translateToPageCoordinate(e){const t=this.column.subGridElement;return e+t.getBoundingClientRect().left-t.scrollLeft}calculateMS(e){throw new Error("Implement in subclass")}getTimeSpanRenderData(e,t,r=!1){const n=this,{timeAxis:i}=n,s=!0===r||r.timeAxis,o=!0===r||r.viewport;if(s||i.isTimeSpanInAxis(e)){const r=n.view,s=r.getRowById(t);if(s){const a=r.scrollable.y,l=Math.max(a-50,0),d=Math.min(a+r._bodyRectangle.height+50,r.virtualScrollHeight);if(o||s.top<d&&s.top+(s.height||s.lastHeight)>=l){const o=n.timeAxisViewModel.getSingleUnitInPixels("minute"),a=e.startDate,l=e.endDate||a,d=i.startMS,c=i.endMS,{startMS:u,endMS:h,durationMS:g}=n.calculateMS(e),m=u<d,p=h>c,f=p?o*(g/6e4):null;let v,y,b=!1,C=!1;if(p?v=r.getCoordinateFromDate(u)+f:C=-1===(v=r.getCoordinateFromDate(h,{local:!0,respectExclusion:!0,isEnd:!0})),m?y=(u-d)/6e4*o:b=-1===(y=r.getCoordinateFromDate(u,{local:!0,respectExclusion:!0,isEnd:!1,snapToNextIncluded:!C})),C&&!b&&(v=r.getCoordinateFromDate(h,{local:!0,respectExclusion:!0,isEnd:!0,snapToNextIncluded:!0})),b&&C&&(y=r.getCoordinateFromDate(u,{local:!0,respectExclusion:!0,isEnd:!1,snapToNextIncluded:!0,max:h}))===(v=r.getCoordinateFromDate(h,{local:!0,respectExclusion:!0,isEnd:!0,snapToNextIncluded:!0,min:u})))return e.instanceMeta(r).excluded=!0,null;const S={[n.view.scheduledEventName]:e,left:Math.min(y,v),width:Math.abs(v-y),start:a,end:l,startMs:u,endMs:h,rowId:t.id,startsOutsideView:m,endsOutsideView:p,clippedStart:b,clippedEnd:C,row:s};return n.view.fillTicks&&(S.dataStartMs=S.start.getTime(),S.dataEndMs=S.end.getTime()),S.top=Math.max(0,r.barMargin),r.managedEventSizing&&(S.height=Math.max(r.rowManager.rowHeight-2*r.barMargin,1)),S}}}}onTranslateRow({source:e}){}onBeforeRowHeightChange(e){const t=this.view,r=e?e.height:this.rowHeight;this.cache.clear(),t.foregroundCanvas&&(t.element.classList.add("b-notransition"),t.foregroundCanvas.style.fontSize=`${r-2*t.barMargin}px`,this._thisIsAUsedExpression(window.getComputedStyle(t.foregroundCanvas).fontSize),t.element.classList.remove("b-notransition")),t.milestoneWidth=null}onBeforeTranslateRow({row:e}){this.cache.clearRow(e.id)}positionTimeSpan(e,t,r){switch(this.view.eventPositionMode||"translate"){case"position":return e.style.left=`${t}px`,void(e.style.top=`${r}px`);case"translate":return void(e.style.transform=`translate(${t}px,${r}px)`);case"translate3d":e.style.transform=`translate3d(${t}px,${r}px,0)`}}getTimeSpanDiv(e){const{availableDivs:t}=this,{id:r,oldId:n}=e;if("move"===this.view.eventScrollMode){let e;return r&&(e=t.get(r)||t.get(n)),e&&!isEventElAvailable(e)&&(e=null),e||(e=t.find(isEventElAvailable)),e&&(t.remove(e),e.classList.remove("b-sch-released")),e}return null}releaseTimeSpanDiv(e,t=!1){const r=this,n=e.style;"move"===r.view.eventScrollMode?(r.availableDivs.add(e),!t&&isEventElAvailable(e)&&e.classList.add("b-sch-released")):t||(n.opacity=0,n.pointerEvents="none",r.setTimeout(()=>{e.remove(),n.opacity=1,n.pointerEvents=""},200))}updateElementId(e,t){const{availableDivs:r}=this;r.includes(e)&&(r.changeId(e,t),r.move(e))}triggerPaint(e,t){throw new Error("Implement in subclass")}renderTimeSpan(e,t,r,n=!1){const i=this,s=i.view;let o,{cls:a,id:l}=e,d=t&&t.div,c=!1,u=!1,h=!1,g=t&&t.eventEl;if(n||d||!(d=i.getTimeSpanDiv(e))||(c=d.id!==l),o=d&&d.classList.contains("b-sch-dragcreator-proxy"),!d||c)c?((g=d.innerElement).innerHTML="",g.style.cssText="",g.nextSibling&&(elRange.setStartAfter(g),elRange.setEndAfter(d.lastChild),elRange.deleteContents())):([d,g]=DomHelper.createElement({tabIndex:0,children:[{className:`${i.innerElCls}`}]},!0),d.innerElement=g),d.id=l,e[s.scheduledEventName+"Id"]&&(d.dataset[s.scheduledEventName+"Id"]=e[s.scheduledEventName+"Id"]),DomHelper.syncClassList(d,e.wrapperCls),d.parentNode!==s.foregroundCanvas&&s.foregroundCanvas.appendChild(d),DomHelper.syncClassList(g,a),(e.style||e.internalStyle)&&(g.style.cssText=(e.internalStyle||"")+(e.style||"")),e.body&&g.appendChild(e.body.cloneNode(!0)),d.style.cssText=`width:${e.width}px;height:${e.height}px;${e.wrapperStyle||""}`,i.positionTimeSpan(d,e.left,e.top),u=!0;else{const n=r&&t.div?r:emptyObject$3;if(g=d.querySelector(`.${i.innerElCls}`)||d.firstElementChild,DomHelper.syncClassList(d,e.wrapperCls),DomHelper.syncClassList(g,e.cls),e.style?g.style.cssText=e.style:g.style.cssText="",e.body){const t=g.innerHTML,r=g.featureEls;r&&r.forEach(t=>e.body.appendChild(t)),g.innerHTML="",g.appendChild(e.body.cloneNode(!0)),u=g.innerHTML!==t}document.activeElement&&document.activeElement.id===e.id&&d.classList.add(s.focusCls),h=!0,d.style.cssText+=e.wrapperStyle||"",(n.left!==e.left||n.top!==e.top||e.style)&&(i.positionTimeSpan(d,e.left,e.top),u=!0),(n.width!==e.width||e.style)&&(d.style.width=`${e.width}px`,u=!0),(n.height!==e.height||e.style)&&(d.style.height=`${e.height}px`,u=!0)}return t.div=d,t.eventEl=g,u&&(h&&o&&(h=!1,d.classList.remove("b-sch-dragcreator-proxy")),i.triggerPaint(e,d,h)),d}updateRowTimeSpans(e,t,r=!1,n=!1){}renderer(e){}updateFromHorizontalScroll(e){const t=this,r=t.view,n=r.timeAxisSubGrid.width,i=r.getDateFromX(Math.max(0,e-100)),s=r.getDateFromX(e+n+100)||r.timeAxis.endDate,o=t.view.timeAxisSubGrid.scrollable.x,a=t.lastUpdateScrollPos;t.viewportStart=i&&i.getTime(),t.viewportEnd=s&&s.getTime(),(!a||Math.abs(o-a.x)>50)&&t.update()}update(){const e=this,t=e.view;e.lastUpdateScrollPos={x:t.timeAxisSubGrid.scrollable.x,y:t.scrollable.y};for(const r of t.rowManager){const n=r.getCell(t.timeAxisColumn.id),i=DomDataStore.get(n),s=t.store.getById(i.id);s&&e.updateRowTimeSpans(i.row,s,!1,!0)}}getDateFromXY(e,t,r){let n=e[0];return r||(n=this.translateToScheduleCoordinate(n)),this.timeAxisViewModel.getDateFromPosition(n,t)}translateToScheduleCoordinate(e){return e-this.column.subGridElement.getBoundingClientRect().left+this.view.scrollLeft}onBeforeToggleNode({record:e}){let t=this.view.store.getNext(e);for(;t&&this.view.getRowFor(t);)this.cache.clearRow(t.id),t=this.view.store.getNext(t.id);this.togglingNode=!0}onToggleNode(){this.togglingAllNodes||(this.togglingNode=!1)}onBeforeToggleAllNodes(){this.cache.clear(),this.togglingAllNodes=this.togglingNode=!0}onToggleAllNodes(){this.togglingAllNodes=this.togglingNode=!1}onRowRecordUpdate({record:e}){this.cache.clearRow(e.id,!1,!0)}onRowRecordRemove({records:e}){e.forEach(e=>e.traverse(e=>this.cache.clearRow(e.id)))}getRowRegion(e,t,r){const{view:n,column:i}=this,s=n.getRowById(e.id);if(!s)return null;let o=s.getElement(i.region),a=this.timeAxis.startDate,l=this.timeAxis.endDate,d=t?DateHelper.max(a,t):a,c=r?DateHelper.min(l,r):l,u=n.getCoordinateFromDate(d),h=n.getCoordinateFromDate(c,!0,!0),g=s.top+n.verticalScroller.scrollTop,m=Math.min(u,h),p=g+o.offsetHeight;return new Rectangle(m,g,Math.max(u,h)-m,p-g)}getStartEndDatesFromRectangle(e,t){const r=this.view,n=r.getDateFromCoordinate(e.x,t,!0),i=r.getDateFromCoordinate(e.right,t,!0);return n&&i?{start:DateHelper.min(n,i),end:DateHelper.max(n,i)}:null}getVisibleDateRange(){const e=this.view,t=e.timeAxisSubGrid.scrollable.x,r=e.timeAxisSubGrid.width;return{startDate:e.getDateFromX(t),endDate:e.getDateFromX(t+r)||e.timeAxis.endDate}}getConnectorStartSide(e){}getConnectorEndSide(e){}}BaseHorizontalMapper._$name="BaseHorizontalMapper";class HorizontalEventMapperCache{constructor(e){this.mapper=e,this.renderedEventsMap={},this.rowLayoutCache={}}clear(e=!1){const t=this;t.renderedEventsMap={},Object.keys(t.rowLayoutCache).forEach(r=>t.clearRow(r,!!e&&"immediate"))}addRenderedEvents(e,t){this.renderedEventsMap[e]=t}addRenderedEvent(e){if(e.resourceId in this.renderedEventsMap){(this.renderedEventsMap[e.resourceId]||(this.renderedEventsMap[e.resourceId]={}))[e.id]=e}}getRenderedTimeSpan(e,t){const r=this.renderedEventsMap[e];return r&&r[t]}clearRenderedTimeSpan(e,t){if(this.renderedEventsMap[e]){const r=this.renderedEventsMap[e][t];return delete this.renderedEventsMap[e][t],r}}getRenderedEvents(e){return this.renderedEventsMap[e]}clearRenderedEvents(e){this.renderedEventsMap[e]=null}getTimeSpan(e,t){const r=this.rowLayoutCache[t],n=r&&r[e];return n?n.layoutCache:null}clearEvent(e,t,r=!1,n=!1){const i=this,s=i.getTimeSpan(e,t);if(!s)return null;s.div&&i.mapper.clearDiv(s.div,r,n),i.rowLayoutCache[t][e].layoutCache=null}getRow(e){return this.rowLayoutCache[e]}addRow(e,t){this.rowLayoutCache[e]=t}clearRow(e,t=!1,r=!1){const n=this,i=n.rowLayoutCache[e];i&&(n.renderedEventsMap[e]&&delete n.renderedEventsMap[e],Object.keys(i).forEach(i=>{"_allEvents"!==i&&"_rowHeight"!==i&&n.clearEvent(i,e,t,r)}),delete n.rowLayoutCache[e])}}HorizontalEventMapperCache._$name="HorizontalEventMapperCache";const getStartEnd=(e,t,r,n,i)=>{if(e.fillTicks){const e=Math.floor(t.getTickFromDate(r)),n=t.getAt(e);if(n)return n[i?"endDate":"startDate"].getTime()}return n};class HorizontalEventMapper extends BaseHorizontalMapper{construct(e){this.scheduler=e,super.construct(e),this.cache=new HorizontalEventMapperCache(this)}init(){super.init(),this.scheduler.on({togglegroup:this.onToggleGroup,rowremove:this.onRowRemove,prio:2,thisObj:this})}clearDiv(e,t,r){const n=this,i=e.style;!t||r?n.releaseTimeSpanDiv(e,r):"immediate"!==t&&n.scheduler.enableEventAnimations?(i.opacity=0,i.pointerEvents="none",n.setTimeout(()=>{e.remove(),i.opacity=1,i.pointerEvents=""},200)):e.remove()}clearAllDivs(){this.availableDivs.forEach(e=>e.remove()),this.availableDivs.clear()}clearEvents(){this.cache.clear(!0)}releaseEvent(e,t,r=!1){const n=this,i=n.cache.getRenderedTimeSpan(e,t),s=i&&n.cache.getTimeSpan(i.eventId,e);return s&&s.div&&(n.releaseTimeSpanDiv(s.div,r),s.div=s.eventEl=null),n.cache.clearRenderedTimeSpan(e,t)}getElementFromEventRecord(e,t=this.scheduler.eventStore.getResourcesForEvent(e)[0]){if(t){const r=this.cache.getRenderedEvents(t.id);if(r){const n=r[this.scheduler.getEventRenderId(e,t)],i=n&&n.layoutCache;return i&&i.eventEl}}}getElementsFromEventRecord(e,t){const r=this;return t?[r.getElementFromEventRecord(e,t)]:r.scheduler.eventStore.getResourcesForEvent(e).reduce((t,n)=>{const i=r.getElementFromEventRecord(e,n);return i&&t.push(i),t},[])}resolveRowRecord(e){const t=this.view,r=3===e.nodeType?e.parentElement:e,n=r.matches(t.eventSelector)&&r||DomHelper.up(r,t.eventSelector);return n?t.getResourceRecordFromDomId(n.id):t.getRecordFromElement(r)}getScheduleRegion(e,t,r=!0){let n,i=this,s=i.view,o=i.column;if(e){const r=t&&i.getElementsFromEventRecord(t,e)[0];if(n=Rectangle.from(s.getRowById(e.id).getElement("locked")),r){const e=Rectangle.from(r,o.subGridElement);n.y=e.y,n.bottom=e.bottom}else n.y=n.y+s.barMargin,n.bottom=n.bottom-s.barMargin}else(n=Rectangle.from(o.subGridElement).moveTo(null,0)).width=o.subGridElement.scrollWidth,n.y=n.y+s.barMargin,n.bottom=n.bottom-s.barMargin;let a=i.timeAxis.startDate,l=i.timeAxis.endDate,d=s.getDateConstraints(e,t)||{start:a,end:l},c=s.getCoordinateFromDate(DateHelper.max(a,d.start)),u=s.getCoordinateFromDate(DateHelper.min(l,d.end)),h=n.y,g=n.bottom;return r||(c=i.translateToPageCoordinate(c),u=i.translateToPageCoordinate(u)),{top:h,right:Math.max(c,u),bottom:g,left:Math.min(c,u)}}layoutEventVerticallyStack(e,t){let r=this.scheduler;return 0===e?r.barMargin:e*r.rowManager.rowHeight-(e-1)*r.barMargin}layoutEventVerticallyPack(e,t){let r=this.scheduler,n=r.rowManager.rowHeight-2*r.barMargin,i=n*t-(1===t?0:r.barMargin);return{top:n*e+r.barMargin,height:i}}calculateMS(e){const t=this,r=t.view;let n=getStartEnd(r,t.timeAxis,e.startDate,e.startDateMS,!1),i=getStartEnd(r,t.timeAxis,e.endDate,e.endDateMS,!0),s=i-n;if("default"!==r.milestoneLayoutMode&&0===s){const o=t.timeAxisViewModel.getSingleUnitInPixels("minute");switch(s=60*(r.getMilestoneLabelWidth(e)*(1/o))*1e3,r.milestoneAlign){case"start":case"left":i=n+s;break;case"end":case"right":n=(i=n)-s;break;default:n=(i=n+s/2)-s}}return{startMS:n,endMS:i,durationMS:s}}layoutEvents(e,t,r){const n=this,i=n.timeAxis,{eventStore:s}=e,o=t.id,a=s.getEventsForResource(o),l=s.isFiltered?a.filter(e=>s.indexOf(e)>-1):a,d=(e.getEventsToRender(t,l)||[]).filter(e=>i.isTimeSpanInAxis(e)).reduce((r,i)=>{const s=e.generateTplData(i,t);return s?r.push(s):n.cache.getRenderedEvents(o)&&n.releaseEvent(o,e.getEventRenderId(i,t)),r},[]);if(!d.length)return n.cache.clearRenderedEvents(o),!1;d.sort(n.eventSorter);let c=e.rowHeight;const u=e.currentEventLayout,h=d.filter(e=>e.event.isEvent||e.event.isTask);if("stack"===e.eventLayout){const r=u.applyLayout(h,t);c=r*e.rowHeight-(r-1)*e.barMargin}else"pack"===e.eventLayout&&u.applyLayout(h,t);let g=r.top;c!==r.height&&r.estimatedTop&&(g=r.top+r.height-c);const m={_allEvents:d,_rowHeight:c};return d.forEach(e=>{const t=n.cache.getTimeSpan(e.eventId,o),r=e.top;e.top+=g,e.rowTop=g,e.fillHeight&&(e.height=c),e.layoutCache={layout:!0,div:t&&t.div,eventEl:t&&t.eventEl,width:e.width,height:e.height,start:e.left,end:e.left+e.width,relativeTop:r,top:e.top,relativeBottom:r+e.height,bottom:e.top+e.height},m[e.eventId]=e}),n.cache.addRow(o,m),!0}eventSorter(e,t){const r=e.dataStartMs||e.startMs,n=e.dataEndMs||e.endMs,i=t.dataStartMs||t.startMs,s=t.dataEndMs||t.endMs;return r===i?n-s==0?e.event.name<t.event.name?-1:1:n>s?-1:1:r<i?-1:1}onTranslateRow({row:e}){this.matchRowTranslation(e)}renderEvent(e){const t=this,r=t.cache.getTimeSpan(e.eventId,e.resourceId),n=t.cache.getRenderedEvents(e.resourceId),i=e.event.instanceMeta(t.scheduler),s=t.renderTimeSpan(e,r,n[e.id],i.requireElement&&!i.fromDragProxy);e.assignment&&(s.dataset.assignmentId=e.assignment.id),n[e.id]=e,i.requireElement&&(delete i.requireElement,delete i.fromDragProxy),t.scheduler.trigger("renderEvent",{eventRecord:e.event,resourceRecord:e.resource,assignmentRecord:e.assignment,element:s,tplData:e})}triggerPaint(e,t,r=!1){const{scheduler:n}=this;n.trigger(r?"eventRepaint":"eventPaint",{scheduler:n,eventRecord:e.event,resourceRecord:e.resource,element:t})}isEventInView(e){return e.startMs===e.endMs?e.startMs<=this.viewportEnd&&e.endMs>this.viewportStart:e.startMs<this.viewportEnd&&e.endMs>this.viewportStart}updateRowTimeSpans(e,t,r=!1,n=!1){const i=this,s=i.scheduler,o=t.id;let a=i.cache.getRenderedEvents(o),l=i.cache.getRow(o);if((s.forceLayout||r||!l)&&!i.layoutEvents(s,t,e))return l&&l._rowHeight||0;if(!(l=i.cache.getRow(o)))return 0;const d=l._allEvents.filter(e=>e.event.instanceMeta(s).retainElement||e.assignment&&e.assignment.instanceMeta(s).retainElement||i.isEventInView(e));a||(a={},i.cache.addRenderedEvents(o,a));for(let e=0;e<d.length;e++){const t=d[e];if(s._firstRenderDone&&s._firstRenderDone(),!n&&!t.event.instanceMeta(s).retainElement||n&&!t.layoutCache.div){s.isFirstRender&&t.top<s.bodyHeight&&s.useInitialAnimation&&(t.wrapperCls.add("b-first-render"),t.internalStyle=`animation-delay: ${t.row.index/20}s;`),i.renderEvent(t),t.wrapperCls["b-first-render"]=null}}const c=Object.keys(a);for(let e=0;e<c.length;e++){const t=c[e];d.some(e=>e.id===t)||i.releaseEvent(o,t)}return l._rowHeight}renderer(e){e.size.height=this.updateRowTimeSpans(e.row,e.record)}matchRowTranslation(e){const t=this,r=t.scheduler.store.getAt(e.dataIndex).id,n=t.cache.getRow(r),i=n&&n._allEvents.length>0&&n._allEvents[0];if(i&&i.rowTop!==e.top){const r=e.top-i.rowTop;n._allEvents.forEach(n=>{const i=n.layoutCache;i.top+=r,i.bottom+=r,i.div&&t.positionTimeSpan(i.div,i.start,i.top),n.top+=r,n.rowTop=e.top})}}onRowRemove({isCollapse:e}){const{scheduler:t}=this;e||t.runWithTransition(()=>{t.rowManager.forEach(e=>this.matchRowTranslation(e))})}onToggleGroup({groupRecord:e,collapse:t}){let r=this.scheduler.store,n=r.indexOf(e)+(t?1:e.groupChildren.length);for(t&&e.groupChildren.forEach(e=>{this.cache.clearRow(e.id)});n<r.count;n++)this.cache.clearRow(r.getAt(n).id)}onEventDataset(){this.cache.clear(!0)}onEventAdd({records:e,resources:t}){let r,n,i=this;e.forEach(e=>{if(r=e.startDate,n=e.endDate,r&&n&&i.timeAxis.timeSpanInAxis(r,n)){const r=e.resources;r&&r.some(e=>i.scheduler.getRowFor(e))&&(e.instanceMeta(i.scheduler).requireElement=!0),t.forEach(e=>{this.cache.clearRow(e.id,!1,!0)})}})}onEventRemove({records:e,resources:t}){const r=this;t.forEach(e=>r.cache.clearRow(e.id,!0))}onEventUpdate({source:e,record:t,changes:r={},resources:n}){const i=this,s="resourceId"in r;if(s||n.length){if(s){const n=e.resourceStore.getById(r.resourceId.oldValue),s=t.resource,o=s&&!s.placeHolder,a=t.resource&&Boolean(i.getTimeSpanRenderData(t,t.resource));if(n){const e=i.cache.getTimeSpan(t.id,n.id);e&&(o?(e.div&&s&&(e.div.id=i.scheduler.getEventRenderId(t,s)),i.cache.clearRow(n.id,!1,o)):i.cache.clearEvent(t.id,r.resourceId.oldValue,!0))}else o&&(t.instanceMeta(i.scheduler).requireElement=!0);o&&i.cache.clearRow(s.id,!1,a),i.scheduler.rowManager.averageRowHeight=null}else("startDate"in r||"endDate"in r)&&n.forEach(e=>{i.scheduler.eventStore.getEventsForResource(e).length>1&&(i.scheduler.rowManager.averageRowHeight=null)});n.forEach(e=>{const r=i.getTimeSpanRenderData(t,e),n=Boolean(r&&i.isEventInView(r));i.cache.clearRow(e.id,!1,n)})}}onEventClearChanges(){this.cache.clear()}onEventFilter(){this.cache.clear()}onEventRemoveAll(){this.view.rowManager.averageRowHeight=null,this.cache.clear(!0)}getConnectorStartSide(e){return"left"}getConnectorEndSide(e){return"right"}}HorizontalEventMapper._$name="HorizontalEventMapper";let tpl=TemplateHelper.tpl;class HorizontalTimeAxis extends Base{static get defaultConfig(){return{compactCellWidthThreshold:15}}headerHtmlRowTpl(e){return tpl`${e.levels.map(e=>tpl`<div class="b-sch-header-row b-sch-header-row-${e.position}" headerPosition="${e.position}">
                ${e.cells.map((e,t)=>`<div class="b-sch-header-timeaxis-cell ${e.headerCellCls}  ${e.align?"b-align-"+e.align:""}">${e.value}</div>\n                `)}
            </div>`)}`}fixHtmlHeaderStyles(e,t){t.forEach(t=>{DomHelper.children(e,"[headerPosition="+t.position+"] .b-sch-header-timeaxis-cell").forEach((e,r)=>{e.style.width=e.style.minWidth=`${t.cells[r].width}px`})})}renderTo(e){const t=this,r=t.model.columnConfig,n=[];r.top&&n.push({position:"top",cells:r.top}),r.middle&&n.push({position:"middle",cells:r.middle,cls:!r.bottom&&t.model.tickWidth<=t.compactCellWidthThreshold?"b-sch-header-row-compact":""}),r.bottom&&n.push({position:"bottom",cells:r.bottom,cls:t.model.tickWidth<=t.compactCellWidthThreshold?"b-sch-header-row-compact":""}),e.innerHTML=t.headerHtmlRowTpl({levels:n});const i=e.parentElement;[1,2,3].forEach(e=>i.classList.remove(`b-sch-timeaxiscolumn-levels-${e}`)),i.classList.add(`b-sch-timeaxiscolumn-levels-${n.length}`),t.fixHtmlHeaderStyles(e,n)}}HorizontalTimeAxis._$name="HorizontalTimeAxis";class TimeAxisColumn extends(Events(Column)){constructor(e,t){super(...arguments);const r=this,n=r.timeline;r.initialRender=!0,r.thisObj=r,r.timeAxisViewModel=n.timeAxisViewModel,r.timeAxisView=new HorizontalTimeAxis({model:r.timeAxisViewModel,timeAxis:n.timeAxis,compactCellWidthThreshold:r.compactCellWidthThreshold})}static get autoExposeFields(){return!0}static get defaults(){return{draggable:!1,groupable:!1,hideable:!1,showColumnPicker:!1,filterable:!1,sortable:!1,resizable:!1,searchable:!1,editor:!1,enableCellContextMenu:!1,tooltipRenderer:!1,cls:"b-sch-timeaxiscolumn",needWidth:!0}}static get type(){return"timeAxis"}set subGrid(e){this._subGrid=e,e.on({paint:this.onTimelinePaint,thisObj:this,once:!0})}get subGrid(){return this._subGrid}get subGridElement(){return this.subGrid.element}onViewModelUpdate({source:e}){const t=this;t.refreshHeader(!0),t.width=e.totalWidth,t.isPainting||t.timeline.refresh()}onTimelinePaint(){const e=this;e.subGrid.insertRowsBefore&&(e.isPainting=!0,e.timeAxisViewModel.on({update:e.onViewModelUpdate,thisObj:e}),e.timeAxisViewModel.update(e.subGrid.width,!1,!0),e.subGridElement.classList.add("b-timeline-subgrid"),EventHelper.on({element:e.element,thisObj:e,click:"onContainerElementClick",dblclick:"onContainerElementClick",contextmenu:"onContainerElementClick"}),e.isPainting=!1)}refreshHeader(e){const t=this,{element:r}=t;r&&(!e&&t.timeAxisViewModel.update(null,!0),t.timeAxisView.renderTo(r))}renderer(e){return this.timeline.currentOrientation.renderer(e)}onContainerElementClick(e){const t=e.target;if(t.matches(".b-sch-header-timeaxis-cell")){const r=Array.from(t.parentElement.children).indexOf(t),n=t.parentElement.getAttribute("headerPosition"),i=this.timeAxisViewModel.columnConfig[n][r];this.trigger("timeAxisHeader"+StringHelper.capitalizeFirstLetter(e.type),{startDate:i.start,endDate:i.end,event:e})}}}ColumnStore.registerColumnType(TimeAxisColumn),TimeAxisColumn._$name="TimeAxisColumn";class ScheduleContextMenu extends TimeSpanRecordContextMenuBase{static get defaultConfig(){return{items:null,processItems:null,defaultItems:{addEvent:!0}}}construct(e,t){super.construct(e,t),this.scheduler=e}onElementContextMenu(e){const t=this,{scheduler:r}=t,n=r.getEventData(e),i=n?r.columns.getById(n.columnId)===r.timeAxisColumn:r.timeAxisSubGrid.element===e.target,s=n?n.record:r.resourceStore.last;i&&(t.showContextMenu({menuType:"schedule",date:r.getDateFromDomEvent(e,"floor"),resourceRecord:s,event:e}),e.preventDefault())}get namedItems(){const e=this;return e._namedItems||(e._namedItems={addEvent:{text:e.client.L("Add event",null),icon:"b-icon b-icon-add",weight:100,onItem:({date:t,resourceRecord:r})=>{e.client.internalAddEvent(t,r,e.client.getRowFor(r))}}}),e._namedItems}}ScheduleContextMenu.featureClass="",ScheduleContextMenu._$name="ScheduleContextMenu",GridFeatureManager.registerFeature(ScheduleContextMenu,!0,"Scheduler");class Scheduler extends(base(TimelineBase).mixes(SchedulerDom,SchedulerDomEvents,SchedulerDragResize,SchedulerStores,SchedulerScroll,SchedulerState,SchedulerEventRendering,SchedulerRegions,EventSelection,EventNavigation)){static get defaultConfig(){return{mode:"horizontal",eventCls:"b-sch-event",timeCellCls:"b-sch-timeaxis-cell",timeCellSelector:".b-sch-timeaxis-cell",scheduledEventName:"event",overScheduledEventClass:"b-sch-event-hover",allowOverlap:!0,showAddEventInContextMenu:!0,showRemoveEventInContextMenu:!0,showUnassignEventInContextMenu:!0,rowHeight:60,milestoneCharWidth:10,milestoneAlign:"center",milestoneMinWidth:40}}construct(e={}){const t=this;super.construct(e),t.createEventOnDblClick&&t.on("scheduledblclick",t.onSchedulerDblClick)}set timeAxisViewModel(e){super.timeAxisViewModel=e,this.eventStore&&(this.timeAxisViewModel.eventStore=this.eventStore)}get timeAxisViewModel(){return super.timeAxisViewModel}get store(){const e=this.resourceStore;return e&&!this._store&&(this._store=e),super.store}set store(e){super.store=e}onLocaleChange(){this.currentOrientation.cache.clear(),super.onLocaleChange()}onSchedulerHorizontalScroll(e,t){this.horizontal.updateFromHorizontalScroll(t),super.onSchedulerHorizontalScroll(e,t)}onSchedulerDblClick({date:e,resourceRecord:t,row:r}){this.readOnly||t.meta.specialRow||this.internalAddEvent(e,t,r)}onTimeAxisViewModelUpdate(){super.onTimeAxisViewModelUpdate(),this.horizontal.cache.clear(),this.horizontal.updateFromHorizontalScroll(this.timeAxisSubGrid.scrollable.x)}get isHorizontal(){return"horizontal"===this.mode}get mode(){return this._mode}set mode(e){const t=this;t._mode=e,t[e]||"horizontal"===e&&(t.horizontal=new HorizontalEventMapper(t),t.rendered&&t.horizontal.init())}get currentOrientation(){return this[this.mode]}onElementKeyDown(e){super.onElementKeyDown(e)}onElementKeyUp(e){super.onElementKeyUp(e)}onElementMouseOver(e){super.onElementMouseOver(e)}onElementMouseOut(e){super.onElementMouseOut(e)}getEventMenuItems(){}getScheduleMenuItems(){}internalAddEvent(e,t,r){const n=this,i=new n.eventStore.modelClass({startDate:e,endDate:DateHelper.add(e,1,n.timeAxis.unit)});if(!1!==n.trigger("beforeEventAdd",{newEventRecord:i,resources:[t]}))if(n.eventEdit){const e=n.currentOrientation.getTimeSpanRenderData(i,t),s=n.eventEdit.dragProxyElement=DomHelper.createElement({parent:n.foregroundCanvas,className:"b-sch-dragcreator-proxy",style:`width:${e.width}px;height:${e.height}px`});DomHelper.setTranslateXY(s,e.left,r.top+e.top),n.editEvent(i,t,s)}else n.eventStore.add(i),n.eventStore.assignEventToResource(i,t)}isDateRangeAvailable(e,t,r,n){return this.eventStore.isDateRangeAvailable(e,t,r,n)}}Scheduler._$name="Scheduler",BryntumWidgetAdapterRegister.register("scheduler",Scheduler),VersionHelper.setVersion("scheduler","2.1.0");class Summary$1 extends Summary{static get defaultConfig(){return{showTooltip:!0,summaries:null,renderer:null}}construct(e,t){const r=this;r.scheduler=e,super.construct(e,t),r.summaries||(r.summaries=[{renderer:r.renderer}]),e instanceof Scheduler&&(e.eventStore.on({change:r.updateScheduleSummaries,thisObj:r}),e.resourceStore.on({change:r.updateScheduleSummaries,thisObj:r}),e.timeAxisViewModel.on({update:r.renderRows,thisObj:r}))}renderRows(){super.renderRows(),this.render()}updateScheduleSummaries(){const e=this,t=e.scheduler,r=t.element.querySelector(".b-grid-footer.b-sch-timeaxiscolumn");r&&DomHelper.forEachSelector(r,".b-timeaxis-tick",(r,n)=>{const i=t.timeAxis.getAt(n),s=t.eventStore.getEventsInTimeSpan(i.startDate,i.endDate,!0,!0);let o="",a=`<header>${e.L("Summary for")} ${t.getFormattedDate(i.startDate)}</header>`;e.summaries.forEach(n=>{const l=n.renderer({startDate:i.startDate,endDate:i.endDate,eventStore:t.eventStore,resourceStore:t.resourceStore,events:s,element:r}),d=`<div class="b-timeaxis-summary-value">${l}</div>`;(e.summaries.length>1||""!==l)&&(o+=d),a+=`<label>${n.label||""}</label>`+d}),r.innerHTML=o,r._tipHtml=a})}render(){const e=this,t=e.scheduler,r=t.element.querySelector(".b-grid-footer.b-sch-timeaxiscolumn");r&&(e.summaries.some(e=>e.label)&&e.showTooltip&&!e._tip&&(e._tip=new Tooltip({id:`${t.id}-summary-tip`,cls:"b-timeaxis-summary-tip",hoverDelay:0,hideDelay:100,forElement:r,anchorToTarget:!0,trackMouse:!1,forSelector:".b-timeaxis-tick",getHtml:({forElement:e})=>e._tipHtml})),r.innerHTML=`<div class="b-timeaxis-tick" style="width: ${t.timeAxisViewModel.tickWidth}px"></div>`.repeat(t.timeAxis.count),e.updateScheduleSummaries())}}Summary$1._$name="Summary",Summary$1._$name="Summary",GridFeatureManager.registerFeature(Summary$1,!1,"Scheduler");class TimeRanges extends AbstractTimeRanges{static get defaultConfig(){return{store:{modelClass:TimeSpan,storeId:"timeRanges"},updateCurrentTimeLineInterval:1e4,currentDateFormat:"HH:mm",timeRanges:null,showCurrentTimeLine:!1}}construct(e,t){const r=this;super.construct(e,t),e._timeRangesExposed||(Object.defineProperty(e,"timeRanges",{get:()=>r.store.records,set:e=>r.store.data=e}),e._timeRangesExposed=!0)}startConfigure(e){const{client:t}=this;if(t.project){const r=t.project.timeRangeStore;r&&(e.store=r)}}initCurrentTimeLine(){const e=this,t=new Date;!e.currentTimeLine&&e.showCurrentTimeLine&&(e.currentTimeLine=new e.store.modelClass({id:"currentTime",cls:"b-sch-current-time",startDate:t,name:DateHelper.format(t,e.currentDateFormat)}),e.currentTimeInterval=e.setInterval(()=>{e.currentTimeLine.startDate=new Date,e.currentTimeLine.name=DateHelper.format(e.currentTimeLine.startDate,e.currentDateFormat),e.onStoreChanged({action:"update",record:e.currentTimeLine})},e.updateCurrentTimeLineInterval),e.client.rendered&&e.renderRanges())}hideCurrentTimeLine(){const e=this;e.currentTimeLine&&(e.clearInterval(e.currentTimeInterval),e.currentTimeLine=null,e.client.rendered&&e.renderRanges())}renderRanges(){const e=this;super.renderRanges(),e.showCurrentTimeLine&&!e.disabled&&e.renderRange(e.currentTimeLine,!0)}get showCurrentTimeLine(){return this._showCurrentTimeLine}set showCurrentTimeLine(e){this._showCurrentTimeLine=e,e?this.initCurrentTimeLine():this.hideCurrentTimeLine()}getHeaderMenuItems(e,t){const r=this;t.some(e=>e.isCurrentTimeline)||"timeAxis"!==e.type||t.push({isCurrentTimeline:!0,text:r.L("showCurrentTimeLine"),checked:r.showCurrentTimeLine,onToggle:({item:e,element:t,checked:n})=>{r.showCurrentTimeLine=n}})}get disabled(){return this._disabled}set disabled(e){this._disabled=e,this.client.rendered&&this.renderRanges()}get store(){return this._store}set store(e){const t=this,r=t.client;e.storeId||(e.storeId="timeRanges"),super.store=e,r.timeRanges&&!r._timeRangesExposed&&(t._store.add(r.timeRanges),delete r.timeRanges),t.timeRanges&&(t._store.add(t.timeRanges),delete t.timeRanges)}}TimeRanges._$name="TimeRanges",GridFeatureManager.registerFeature(TimeRanges,!1,"Scheduler");class ResourceInfoColumn extends Column{static get type(){return"resourceInfo"}static get fields(){return["showEventCount","showRole","showImage","imagePath","validNames","defaultImageName","autoScaleThreshold"]}static get defaults(){return{showImage:!0,showEventCount:!0,showRole:!1,imagePath:"",validNames:["amit","angelo","arcady","arnold","celia","chang","dan","dave","emilia","george","gloria","henrik","hitomi","jong","kate","lee","linda","lisa","lola","macy","madison","malik","mark","maxim","mike","rob","steve"],defaultImageName:"none.png",autoScaleThreshold:40,field:"name",htmlEncode:!1,width:140}}construct(){const e=this;super.construct(...arguments),e.grid.element?e.addErrorListener():e.grid.on({paint:e.addErrorListener,thisObj:e,once:!0})}addErrorListener(){const e=`${this.imagePath}${this.defaultImageName}`;EventHelper.on({element:this.grid.element,delegate:".b-resource-image",error:t=>{const r=t.target;r.src!==r._lastMissingUrl&&(r._lastMissingUrl=r.src,r.src=e)},capture:!0})}template(e){const t=this,{showImage:r,showRole:n,showEventCount:i}=t,s=e["string"==typeof n?n:"role"],o=e.events.length,a=e.get(t.field);let l;if(r)if(e.imageUrl)l=e.imageUrl;else{let n="string"==typeof r?r:e.image||a&&a.toLowerCase()||t.defaultImageName;l=t.imagePath+n,n.includes(".")||(t.validNames&&t.validNames.includes(n)?l+=".jpg":l=t.imagePath+t.defaultImageName)}return` \n            <div class="b-resource-info">\n                ${l?`<img class="b-resource-image" draggable="false" src="${l}">`:""}\n                <dl>\n                <dt>${a}</dt>\n                ${n?`<dd class="b-resource-role">${s}</dd>`:""}\n                ${i?`<dd class="b-resource-events">${t.L("eventCountText",o)}</dd>`:""}\n                </dl>\n            </div>\n        `}renderer({grid:e,record:t,cellElement:r}){return t.meta.specialRow?"":(this.autoScaleThreshold&&e.rowHeight<this.autoScaleThreshold?r.style.fontSize=e.rowHeight/40+"em":r.style.fontSize="",this.template(t))}}ColumnStore.registerColumnType(ResourceInfoColumn),ResourceInfoColumn._$name="ResourceInfoColumn";class SchedulerTag extends(window.customElements?HTMLElement:Object){constructor(){super();let e=this,t=[],r=[],n=[];for(let i of e.children)if("COLUMN"===i.tagName){let e=parseInt(i.dataset.width),r=parseInt(i.dataset.flex),n={field:i.dataset.field,text:i.innerHTML};e?n.width=e:n.flex=r||1,t.push(n)}else if("DATA"===i.tagName)for(let e of i.children)for(let t of e.children){let i={};Object.assign(i,t.dataset),"EVENTS"===e.tagName?n.push(i):"RESOURCES"===e.tagName&&r.push(i)}let i=this.attachShadow({mode:"open"}),s=document.createElement("link");s.rel="stylesheet",s.href="../../build/scheduler.default.css",i.appendChild(s);let o=document.createElement("div");o.id="container",o.style.width="100%",o.style.height="100%",i.appendChild(o);const a={appendTo:o,columns:t,resources:r,events:n};Object.assign(a,e.dataset);let l=new Scheduler(a);window.scheduler||(window.scheduler=l)}}try{window.customElements&&window.customElements.define("bryntum-scheduler",SchedulerTag)}catch(e){}SchedulerTag._$name="SchedulerTag",window.bryntum||(window.bryntum={});export{Localizable,LocaleManagerSingelton as LocaleManager,AjaxHelper,ArrayHelper,BrowserHelper,DateHelper,DomHelper,DomClassList,DragHelper,EventHelper,FunctionHelper,IdHelper,ObjectHelper,ResizeHelper,StringHelper,TemplateHelper,VersionHelper,WidgetHelper,Point,Rectangle,ResizeMonitor,GlobalEvents,DataGenerator,DemoBot,Fullscreen,Scroller,Delayable,Events,InstancePlugin,Override,Pluggable,State,BooleanCombo,Button,ButtonGroup,CalendarPanel,Checkbox,Combo,Container,Field,FlagField,DateField,DatePicker,DurationField,List,ChipView,Mask,Menu,MenuItem,NumberField,Tool,Panel,Popup,Ripple,Slider,TabPanel,TextField,TextAreaField,TimeField,TimePicker,Toast,Tooltip,Widget,BryntumWidgetAdapter,BryntumWidgetAdapterRegister,AjaxStore,Model,Store,StateTrackingManager,Transaction,Column,CheckColumn,DateColumn,PercentColumn,RatingColumn,RowNumberColumn,TemplateColumn,TimeColumn,TreeColumn,WidgetColumn,TimeAxisColumn,ResourceInfoColumn,GridFeatureManager,CellEdit,CellTooltip,ColumnPicker,ColumnReorder,ColumnResize,ContextMenu,Filter,FilterBar,Group,QuickFind,Search,Sort,RegionResize,RowReorder,Stripe,Tree,Grid,TreeGrid,AjaxTransport,AbstractCrudManager,ColumnStore,AssignmentStore,Calendar,CrudManager,DependencyStore,EventStore,ResourceStore,ResourceTimeRangeStore,TimeAxis,ColumnLines,Dependencies,DependencyEdit,EventContextMenu,EventDrag,EventDragCreate,EventDragSelect,EventEdit,EventFilter,EventResize,EventTooltip,GroupSummary$1 as GroupSummary,HeaderContextMenu,Labels,NonWorkingTime,Pan,ResourceTimeRanges,ScheduleTooltip,SimpleEventEdit,Summary$1 as Summary,TimeRanges,AssignmentModel,CalendarDayModel,DependencyBaseModel,DependencyModel,EventModel,ResourceModel,ResourceTimeRangeModel,TimeSpan,PresetManager,ViewPreset,RectangularPathFinder,TimeAxisViewModel,HorizontalTimeAxis,Scheduler,RowManager,SchedulerTag};
//# sourceMappingURL=scheduler.module.min.js.map
